<!DOCTYPE html>
<html prefix="og: http://ogp.me/ns#" style="min-height: 100%;" class=" js csstransforms3d csstransitions" lang="en-US"><head>
<meta charset="UTF-8">

<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<link rel="pingback" href="https://machinelearningmastery.com/xmlrpc.php">

<!--  Mobile viewport scale -->
<meta content="initial-scale=1.0, maximum-scale=1.0, user-scalable=yes" name="viewport">

<!-- This site is optimized with the Yoast SEO plugin v9.2.1 - https://yoast.com/wordpress/plugins/seo/ -->
<title>How to Develop LSTM Models for Multi-Step Time Series Forecasting of Household Power Consumption</title>
<link rel="canonical" href="https://machinelearningmastery.com/how-to-develop-lstm-models-for-multi-step-time-series-forecasting-of-household-power-consumption/">
<link rel="publisher" href="https://plus.google.com/u/0/b/117073416089354242117/+MachinelearningmasteryHome/">
<meta property="og:locale" content="en_US">
<meta property="og:type" content="article">
<meta property="og:title" content="How to Develop LSTM Models for Multi-Step Time Series Forecasting of Household Power Consumption">
<meta property="og:description" content="Given the rise of smart electricity meters and the wide adoption of electricity generation technology like solar panels, there is a wealth of electricity usage data available. This data represents a multivariate time series of power-related variables that in turn could be used to model and even forecast future electricity consumption. Unlike other machine learning …">
<meta property="og:url" content="https://machinelearningmastery.com/how-to-develop-lstm-models-for-multi-step-time-series-forecasting-of-household-power-consumption/">
<meta property="og:site_name" content="Machine Learning Mastery">
<meta property="article:publisher" content="https://www.facebook.com/Machine-Learning-Mastery-1429846323896563/">
<meta property="article:author" content="https://www.facebook.com/jason.brownlee.39">
<meta property="article:section" content="Deep Learning for Time Series">
<meta property="article:published_time" content="2018-10-09T18:00:36+00:00">
<meta property="article:modified_time" content="2018-08-30T00:33:55+00:00">
<meta property="og:updated_time" content="2018-08-30T00:33:55+00:00">
<meta property="og:image" content="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2018/10/How-to-Develop-LSTM-Models-for-Multi-Step-Time-Series-Forecasting-of-Household-Power-Consumption.jpg">
<meta property="og:image:secure_url" content="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2018/10/How-to-Develop-LSTM-Models-for-Multi-Step-Time-Series-Forecasting-of-Household-Power-Consumption.jpg">
<meta property="og:image:width" content="640">
<meta property="og:image:height" content="425">
<meta property="og:image:alt" content="How to Develop LSTM Models for Multi-Step Time Series Forecasting of Household Power Consumption">
<script type="text/javascript" async="" src="How%20to%20Develop%20LSTM%20Models%20for%20Multi-Step%20Time%20Series%20Forecasting%20of%20Household%20Power%20Consumption_fichiers/9556588.js"></script><script async="" src="How%20to%20Develop%20LSTM%20Models%20for%20Multi-Step%20Time%20Series%20Forecasting%20of%20Household%20Power%20Consumption_fichiers/analytics.js"></script><script type="application/ld+json">{"@context":"https:\/\/schema.org","@type":"Organization","url":"https:\/\/machinelearningmastery.com\/","sameAs":["https:\/\/www.facebook.com\/Machine-Learning-Mastery-1429846323896563\/","https:\/\/www.linkedin.com\/in\/jasonbrownlee","https:\/\/plus.google.com\/u\/0\/b\/117073416089354242117\/+MachinelearningmasteryHome\/","https:\/\/twitter.com\/TeachTheMachine"],"@id":"https:\/\/machinelearningmastery.com\/#organization","name":"Machine Learning Mastery","logo":"https:\/\/machinelearningmastery.com\/wp-content\/uploads\/2016\/09\/cropped-icon.png"}</script>
<!-- / Yoast SEO plugin. -->

<link rel="dns-prefetch" href="https://s.w.org/">
<link rel="alternate" type="application/rss+xml" title="Machine Learning Mastery » Feed" href="https://feeds.feedburner.com/MachineLearningMastery">
<link rel="alternate" type="application/rss+xml" title="Machine Learning Mastery » Comments Feed" href="https://machinelearningmastery.com/comments/feed/">
<link rel="alternate" type="application/rss+xml" title="Machine Learning Mastery » How to Develop LSTM Models for Multi-Step Time Series Forecasting of Household Power Consumption Comments Feed" href="https://machinelearningmastery.com/how-to-develop-lstm-models-for-multi-step-time-series-forecasting-of-household-power-consumption/feed/">
		<script type="text/javascript">
			window._wpemojiSettings = {"baseUrl":"https:\/\/s.w.org\/images\/core\/emoji\/11\/72x72\/","ext":".png","svgUrl":"https:\/\/s.w.org\/images\/core\/emoji\/11\/svg\/","svgExt":".svg","source":{"concatemoji":"https:\/\/machinelearningmastery.com\/wp-includes\/js\/wp-emoji-release.min.js?ver=4.9.8"}};
			!function(a,b,c){function d(a,b){var c=String.fromCharCode;l.clearRect(0,0,k.width,k.height),l.fillText(c.apply(this,a),0,0);var d=k.toDataURL();l.clearRect(0,0,k.width,k.height),l.fillText(c.apply(this,b),0,0);var e=k.toDataURL();return d===e}function e(a){var b;if(!l||!l.fillText)return!1;switch(l.textBaseline="top",l.font="600 32px Arial",a){case"flag":return!(b=d([55356,56826,55356,56819],[55356,56826,8203,55356,56819]))&&(b=d([55356,57332,56128,56423,56128,56418,56128,56421,56128,56430,56128,56423,56128,56447],[55356,57332,8203,56128,56423,8203,56128,56418,8203,56128,56421,8203,56128,56430,8203,56128,56423,8203,56128,56447]),!b);case"emoji":return b=d([55358,56760,9792,65039],[55358,56760,8203,9792,65039]),!b}return!1}function f(a){var c=b.createElement("script");c.src=a,c.defer=c.type="text/javascript",b.getElementsByTagName("head")[0].appendChild(c)}var g,h,i,j,k=b.createElement("canvas"),l=k.getContext&&k.getContext("2d");for(j=Array("flag","emoji"),c.supports={everything:!0,everythingExceptFlag:!0},i=0;i<j.length;i++)c.supports[j[i]]=e(j[i]),c.supports.everything=c.supports.everything&&c.supports[j[i]],"flag"!==j[i]&&(c.supports.everythingExceptFlag=c.supports.everythingExceptFlag&&c.supports[j[i]]);c.supports.everythingExceptFlag=c.supports.everythingExceptFlag&&!c.supports.flag,c.DOMReady=!1,c.readyCallback=function(){c.DOMReady=!0},c.supports.everything||(h=function(){c.readyCallback()},b.addEventListener?(b.addEventListener("DOMContentLoaded",h,!1),a.addEventListener("load",h,!1)):(a.attachEvent("onload",h),b.attachEvent("onreadystatechange",function(){"complete"===b.readyState&&c.readyCallback()})),g=c.source||{},g.concatemoji?f(g.concatemoji):g.wpemoji&&g.twemoji&&(f(g.twemoji),f(g.wpemoji)))}(window,document,window._wpemojiSettings);
		</script><script src="How%20to%20Develop%20LSTM%20Models%20for%20Multi-Step%20Time%20Series%20Forecasting%20of%20Household%20Power%20Consumption_fichiers/wp-emoji-release.js" type="text/javascript" defer="defer"></script>
		<style type="text/css">
img.wp-smiley,
img.emoji {
	display: inline !important;
	border: none !important;
	box-shadow: none !important;
	height: 1em !important;
	width: 1em !important;
	margin: 0 .07em !important;
	vertical-align: -0.1em !important;
	background: none !important;
	padding: 0 !important;
}
</style>
<style type="text/css" media="all">
.wpautoterms-footer{background-color:#ffffff;text-align:center;}
.wpautoterms-footer a{color:#000000;font-family:Arial, sans-serif;font-size:14px;}
.wpautoterms-footer .separator{color:#cccccc;font-family:Arial, sans-serif;font-size:14px;}</style>
<link rel="stylesheet" id="crayon-css" href="How%20to%20Develop%20LSTM%20Models%20for%20Multi-Step%20Time%20Series%20Forecasting%20of%20Household%20Power%20Consumption_fichiers/crayon.css" type="text/css" media="all">
<link rel="stylesheet" id="crayon-theme-classic-css" href="How%20to%20Develop%20LSTM%20Models%20for%20Multi-Step%20Time%20Series%20Forecasting%20of%20Household%20Power%20Consumption_fichiers/classic.css" type="text/css" media="all">
<link rel="stylesheet" id="crayon-font-monaco-css" href="How%20to%20Develop%20LSTM%20Models%20for%20Multi-Step%20Time%20Series%20Forecasting%20of%20Household%20Power%20Consumption_fichiers/monaco.css" type="text/css" media="all">
<link rel="stylesheet" id="wpautoterms_css-css" href="How%20to%20Develop%20LSTM%20Models%20for%20Multi-Step%20Time%20Series%20Forecasting%20of%20Household%20Power%20Consumption_fichiers/wpautoterms.css" type="text/css" media="all">
<link rel="stylesheet" id="contact-form-7-css" href="How%20to%20Develop%20LSTM%20Models%20for%20Multi-Step%20Time%20Series%20Forecasting%20of%20Household%20Power%20Consumption_fichiers/styles.css" type="text/css" media="all">
<link rel="stylesheet" id="ssb-front-css-css" href="How%20to%20Develop%20LSTM%20Models%20for%20Multi-Step%20Time%20Series%20Forecasting%20of%20Household%20Power%20Consumption_fichiers/front.css" type="text/css" media="all">
<link rel="stylesheet" id="ewd-ufaq-style-css" href="How%20to%20Develop%20LSTM%20Models%20for%20Multi-Step%20Time%20Series%20Forecasting%20of%20Household%20Power%20Consumption_fichiers/ewd-ufaq-styles.css" type="text/css" media="all">
<link rel="stylesheet" id="ewd-ufaq-rrssb-css" href="How%20to%20Develop%20LSTM%20Models%20for%20Multi-Step%20Time%20Series%20Forecasting%20of%20Household%20Power%20Consumption_fichiers/rrssb-min.css" type="text/css" media="all">
<link rel="stylesheet" id="woo-testimonials-css-css" href="How%20to%20Develop%20LSTM%20Models%20for%20Multi-Step%20Time%20Series%20Forecasting%20of%20Household%20Power%20Consumption_fichiers/testimonials.css" type="text/css" media="all">
<link rel="stylesheet" id="theme-stylesheet-css" href="How%20to%20Develop%20LSTM%20Models%20for%20Multi-Step%20Time%20Series%20Forecasting%20of%20Household%20Power%20Consumption_fichiers/style.css" type="text/css" media="all">
<!--[if lt IE 9]>
<link href="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/themes/canvas-new/css/non-responsive.css" rel="stylesheet" type="text/css" />
<style type="text/css">.col-full, #wrapper { width: 960px; max-width: 960px; } #inner-wrapper { padding: 0; } body.full-width #header, #nav-container, body.full-width #content, body.full-width #footer-widgets, body.full-width #footer { padding-left: 0; padding-right: 0; } body.fixed-mobile #top, body.fixed-mobile #header-container, body.fixed-mobile #footer-container, body.fixed-mobile #nav-container, body.fixed-mobile #footer-widgets-container { min-width: 960px; padding: 0 1em; } body.full-width #content { width: auto; padding: 0 1em;}</style>
<![endif]-->
<script type="text/javascript" src="How%20to%20Develop%20LSTM%20Models%20for%20Multi-Step%20Time%20Series%20Forecasting%20of%20Household%20Power%20Consumption_fichiers/jquery.js"></script>
<script type="text/javascript" src="How%20to%20Develop%20LSTM%20Models%20for%20Multi-Step%20Time%20Series%20Forecasting%20of%20Household%20Power%20Consumption_fichiers/jquery-migrate.js"></script>
<script type="text/javascript">
/* <![CDATA[ */
var CrayonSyntaxSettings = {"version":"_2.7.2_beta","is_admin":"0","ajaxurl":"https:\/\/machinelearningmastery.com\/wp-admin\/admin-ajax.php","prefix":"crayon-","setting":"crayon-setting","selected":"crayon-setting-selected","changed":"crayon-setting-changed","special":"crayon-setting-special","orig_value":"data-orig-value","debug":""};
var CrayonSyntaxStrings = {"copy":"Press %s to Copy, %s to Paste","minimize":"Click To Expand Code"};
/* ]]> */
</script>
<script type="text/javascript" src="How%20to%20Develop%20LSTM%20Models%20for%20Multi-Step%20Time%20Series%20Forecasting%20of%20Household%20Power%20Consumption_fichiers/crayon.js"></script>
<script type="text/javascript" src="How%20to%20Develop%20LSTM%20Models%20for%20Multi-Step%20Time%20Series%20Forecasting%20of%20Household%20Power%20Consumption_fichiers/front.js"></script>
<script type="text/javascript" src="How%20to%20Develop%20LSTM%20Models%20for%20Multi-Step%20Time%20Series%20Forecasting%20of%20Household%20Power%20Consumption_fichiers/third-party.js"></script>
<script type="text/javascript" src="How%20to%20Develop%20LSTM%20Models%20for%20Multi-Step%20Time%20Series%20Forecasting%20of%20Household%20Power%20Consumption_fichiers/modernizr.js"></script>
<script type="text/javascript" src="How%20to%20Develop%20LSTM%20Models%20for%20Multi-Step%20Time%20Series%20Forecasting%20of%20Household%20Power%20Consumption_fichiers/general.js"></script>
<link rel="https://api.w.org/" href="https://machinelearningmastery.com/wp-json/">
<link rel="EditURI" type="application/rsd+xml" title="RSD" href="https://machinelearningmastery.com/xmlrpc.php?rsd">
<link rel="wlwmanifest" type="application/wlwmanifest+xml" href="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-includes/wlwmanifest.xml"> 
<link rel="shortlink" href="https://machinelearningmastery.com/?p=6286">
<link rel="alternate" type="application/json+oembed" href="https://machinelearningmastery.com/wp-json/oembed/1.0/embed?url=https%3A%2F%2Fmachinelearningmastery.com%2Fhow-to-develop-lstm-models-for-multi-step-time-series-forecasting-of-household-power-consumption%2F">
<link rel="alternate" type="text/xml+oembed" href="https://machinelearningmastery.com/wp-json/oembed/1.0/embed?url=https%3A%2F%2Fmachinelearningmastery.com%2Fhow-to-develop-lstm-models-for-multi-step-time-series-forecasting-of-household-power-consumption%2F&amp;format=xml">
<!-- Start Google Analytics -->
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-44039733-3', 'auto');
  ga('send', 'pageview');

</script>
<!-- End Google Analytics -->

 <style media="screen">

        .simplesocialbuttons.simplesocialbuttons_inline .ssb-fb-like {
      margin: ;
    }
         /*inline margin*/
    
  
  
  
  
  
          .simplesocialbuttons.simplesocialbuttons_inline.simplesocial-simple-icons button{
         margin: ;
     }

          /*margin-digbar*/

  
  
  
  
 
   
   

</style>
    <script type="text/javascript">
        var ajaxurl = 'https://machinelearningmastery.com/wp-admin/admin-ajax.php';
    </script>

<!-- Custom CSS Styling -->
<style type="text/css">
#logo .site-title, #logo .site-description { display:none; }
body {background-repeat:no-repeat;background-position:top left;background-attachment:scroll;border-top:0px solid #000000;}
#header {background-repeat:no-repeat;background-position:left top;margin-top:0px;margin-bottom:0px;padding-top:10px;padding-bottom:10px;border:0px solid ;}
#logo .site-title a {font:bold 40px/1em "Helvetica Neue", Helvetica, sans-serif;color:#222222;}
#logo .site-description {font:normal 13px/1em "Helvetica Neue", Helvetica, sans-serif;color:#999999;}
body, p { font:normal 14px/1.5em "Helvetica Neue", Helvetica, sans-serif;color:#555555; }
h1 { font:bold 28px/1.2em "Helvetica Neue", Helvetica, sans-serif;color:#222222; }h2 { font:bold 24px/1.2em "Helvetica Neue", Helvetica, sans-serif;color:#222222; }h3 { font:bold 20px/1.2em "Helvetica Neue", Helvetica, sans-serif;color:#222222; }h4 { font:bold 16px/1.2em "Helvetica Neue", Helvetica, sans-serif;color:#222222; }h5 { font:bold 14px/1.2em "Helvetica Neue", Helvetica, sans-serif;color:#222222; }h6 { font:bold 12px/1.2em "Helvetica Neue", Helvetica, sans-serif;color:#222222; }
.page-title, .post .title, .page .title {font:bold 28px/1.1em "Helvetica Neue", Helvetica, sans-serif;color:#222222;}
.post .title a:link, .post .title a:visited, .page .title a:link, .page .title a:visited {color:#222222}
.post-meta { font:normal 12px/1.5em "Helvetica Neue", Helvetica, sans-serif;color:#999999; }
.entry, .entry p{ font:normal 15px/1.5em "Helvetica Neue", Helvetica, sans-serif;color:#555555; }
.post-more {font:normal 13px/1.5em "Helvetica Neue", Helvetica, sans-serif;color:;border-top:0px solid #e6e6e6;border-bottom:0px solid #e6e6e6;}
#post-author, #connect {border-top:1px solid #e6e6e6;border-bottom:1px solid #e6e6e6;border-left:1px solid #e6e6e6;border-right:1px solid #e6e6e6;border-radius:5px;-moz-border-radius:5px;-webkit-border-radius:5px;background-color:#fafafa}
.nav-entries a, .woo-pagination { font:normal 13px/1em "Helvetica Neue", Helvetica, sans-serif;color:#888; }
.woo-pagination a, .woo-pagination a:hover {color:#888!important}
.widget h3 {font:bold 14px/1.2em "Helvetica Neue", Helvetica, sans-serif;color:#555555;border-bottom:1px solid #e6e6e6;}
.widget_recent_comments li, #twitter li { border-color: #e6e6e6;}
.widget p, .widget .textwidget { font:normal 13px/1.5em "Helvetica Neue", Helvetica, sans-serif;color:#555555; }
.widget {font:normal 13px/1.5em "Helvetica Neue", Helvetica, sans-serif;color:#555555;border-radius:0px;-moz-border-radius:0px;-webkit-border-radius:0px;}
#tabs .inside li a, .widget_woodojo_tabs .tabbable .tab-pane li a { font:bold 12px/1.5em "Helvetica Neue", Helvetica, sans-serif;color:#555555; }
#tabs .inside li span.meta, .widget_woodojo_tabs .tabbable .tab-pane li span.meta { font:300 11px/1.5em "Helvetica Neue", Helvetica, sans-serif;color:#999999; }
#tabs ul.wooTabs li a, .widget_woodojo_tabs .tabbable .nav-tabs li a { font:300 11px/2em "Helvetica Neue", Helvetica, sans-serif;color:#999999; }
@media only screen and (min-width:768px) {
ul.nav li a, #navigation ul.rss a, #navigation ul.cart a.cart-contents, #navigation .cart-contents #navigation ul.rss, #navigation ul.nav-search, #navigation ul.nav-search a { font:bold 18px/1.2em "Helvetica Neue", Helvetica, sans-serif;color:#4c89bf; } #navigation ul.rss li a:before, #navigation ul.nav-search a.search-contents:before { color:#4c89bf;}
#navigation ul.nav > li a:hover, #navigation ul.nav > li:hover a, #navigation ul.nav li ul li a, #navigation ul.cart > li:hover > a, #navigation ul.cart > li > ul > div, #navigation ul.cart > li > ul > div p, #navigation ul.cart > li > ul span, #navigation ul.cart .cart_list a, #navigation ul.nav li.current_page_item a, #navigation ul.nav li.current_page_parent a, #navigation ul.nav li.current-menu-ancestor a, #navigation ul.nav li.current-cat a, #navigation ul.nav li.current-menu-item a { color:#4c89bf!important; }
#navigation ul.nav > li a:hover, #navigation ul.nav > li:hover, #navigation ul.nav li ul, #navigation ul.cart li:hover a.cart-contents, #navigation ul.nav-search li:hover a.search-contents, #navigation ul.nav-search a.search-contents + ul, #navigation ul.cart a.cart-contents + ul, #navigation ul.nav li.current_page_item a, #navigation ul.nav li.current_page_parent a, #navigation ul.nav li.current-menu-ancestor a, #navigation ul.nav li.current-cat a, #navigation ul.nav li.current-menu-item a{background-color:#ffffff!important}
#navigation ul.nav li ul, #navigation ul.cart > li > ul > div  { border: 0px solid #dbdbdb; }
#navigation ul.nav > li:hover > ul  { left: 0; }
#navigation ul.nav > li  { border-right: 0px solid #dbdbdb; }#navigation ul.nav > li:hover > ul  { left: 0; }
#navigation { box-shadow: none; -moz-box-shadow: none; -webkit-box-shadow: none; }#navigation ul li:first-child, #navigation ul li:first-child a { border-radius:0px 0 0 0px; -moz-border-radius:0px 0 0 0px; -webkit-border-radius:0px 0 0 0px; }
#navigation {background:#ffffff;border-top:0px solid #dbdbdb;border-bottom:0px solid #dbdbdb;border-left:0px solid #dbdbdb;border-right:0px solid #dbdbdb;border-radius:0px; -moz-border-radius:0px; -webkit-border-radius:0px;}
#top ul.nav li a { font:normal 12px/1.6em "Helvetica Neue", Helvetica, sans-serif;color:#ddd; }
}
#footer, #footer p { font:normal 13px/1.4em "Helvetica Neue", Helvetica, sans-serif;color:#999999; }
#footer {border-top:1px solid #dbdbdb;border-bottom:0px solid ;border-left:0px solid ;border-right:0px solid ;border-radius:0px; -moz-border-radius:0px; -webkit-border-radius:0px;}
.magazine #loopedSlider .content h2.title a { font:bold 24px/1em Arial, sans-serif;color:#ffffff; }
.wooslider-theme-magazine .slide-title a { font:bold 24px/1em Arial, sans-serif;color:#ffffff; }
.magazine #loopedSlider .content .excerpt p { font:300 13px/1.5em Arial, sans-serif;color:#cccccc; }
.wooslider-theme-magazine .slide-content p, .wooslider-theme-magazine .slide-excerpt p { font:300 13px/1.5em Arial, sans-serif;color:#cccccc; }
.magazine .block .post .title a {font:bold 18px/1.2em Helvetica Neue, Helvetica, sans-serif;color:#222222; }
#loopedSlider.business-slider .content h2 { font:bold 24px/1em Arial, sans-serif;color:#ffffff; }
#loopedSlider.business-slider .content h2.title a { font:bold 24px/1em Arial, sans-serif;color:#ffffff; }
.wooslider-theme-business .has-featured-image .slide-title { font:bold 24px/1em Arial, sans-serif;color:#ffffff; }
.wooslider-theme-business .has-featured-image .slide-title a { font:bold 24px/1em Arial, sans-serif;color:#ffffff; }
#wrapper #loopedSlider.business-slider .content p { font:300 13px/1.5em Arial, sans-serif;color:#cccccc; }
.wooslider-theme-business .has-featured-image .slide-content p { font:300 13px/1.5em Arial, sans-serif;color:#cccccc; }
.wooslider-theme-business .has-featured-image .slide-excerpt p { font:300 13px/1.5em Arial, sans-serif;color:#cccccc; }
.archive_header { font:bold 18px/1em Arial, sans-serif;color:#222222; }
.archive_header {border-bottom:1px solid #e6e6e6;}
.archive_header .catrss { display:none; }
</style>

<!-- Woo Shortcodes CSS -->
<link href="How%20to%20Develop%20LSTM%20Models%20for%20Multi-Step%20Time%20Series%20Forecasting%20of%20Household%20Power%20Consumption_fichiers/shortcodes.css" rel="stylesheet" type="text/css">

<!-- Custom Stylesheet -->
<link href="How%20to%20Develop%20LSTM%20Models%20for%20Multi-Step%20Time%20Series%20Forecasting%20of%20Household%20Power%20Consumption_fichiers/custom.css" rel="stylesheet" type="text/css">

<!-- Theme version -->
<meta name="generator" content="Canvas 5.9.21">
<meta name="generator" content="WooFramework 6.2.9">
<link rel="icon" href="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2016/09/cropped-icon-32x32.png" sizes="32x32">
<link rel="icon" href="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2016/09/cropped-icon-192x192.png" sizes="192x192">
<link rel="apple-touch-icon-precomposed" href="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2016/09/cropped-icon-180x180.png">
<meta name="msapplication-TileImage" content="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2016/09/cropped-icon-270x270.png">
<script src="How%20to%20Develop%20LSTM%20Models%20for%20Multi-Step%20Time%20Series%20Forecasting%20of%20Household%20Power%20Consumption_fichiers/can-i-show.js"></script><style id="fit-vids-style">.fluid-width-video-wrapper{width:100%;position:relative;padding:0;}.fluid-width-video-wrapper iframe,.fluid-width-video-wrapper object,.fluid-width-video-wrapper embed {position:absolute;top:0;left:0;width:100%;height:100%;}</style><style type="text/css">
  /* === Form-Specific Styles === */
  /* stylelint-disable */

  #drip-2211 .drip-content,
  #drip-2211 .drip-header {
    background: rgb(9,123,156) !important;
    background: rgba(9,123,156,0.90) !important;
  }

  #drip-2211 .drip-content h3 {
    color: #333333 !important;
    font-size: 21px !important;
  }

  #drip-2211 .drip-submit-button {
    background-color: #333333 !important;
    font-size: 12px !important;
  }

  #drip-2211 .drip-submit-button:hover {
    background-color: #191919 !important;
  }

  #drip-2211 .drip-submit-button:active {
    background-color: #000000 !important;
  }

  #drip-2211 dl dt,
  #drip-2211 .drip-content .drip-description,
  #drip-2211 .drip-content .classic--checkbox,
  #drip-2211 .drip-errors {
    font-size: 13px !important;
  }

  #drip-2211 .drip-text-field {
    font-size: 14px !important;
  }

  /* === Reset styles === */

  .drip-tab h1,
  .drip-tab h2,
  .drip-tab h3,
  .drip-tab div,
  .drip-tab dl,
  .drip-tab dt,
  .drip-tab dd,
  .drip-tab p,
  .drip-tab a,
  .drip-tab .drip-text-field,
  .drip-tab .drip-text-field:focus,
  .drip-tab .drip-submit-button {
    margin: 0;
    padding: 0;
    border: 0;
    font-size: 100%;
    font: inherit;
    vertical-align: baseline;
    float: none;
    width: auto;
    background-image: none;
    letter-spacing: 0;
    -webkit-box-shadow: none;
       -moz-box-shadow: none;
            box-shadow: none;
    -webkit-text-shadow: none !important;
       -moz-text-shadow: none !important;
            text-shadow: none !important;
  }

  .drip-tab a {
    text-decoration: none;
  }

  .drip-tab :focus {
    outline: 0;
  }

  /* === Clearfix === */

  .drip-clearfix:after {
    visibility: hidden;
    display: block;
    font-size: 0;
    content: " ";
    clear: both;
    height: 0;
  }
  * html .drip-clearfix             { zoom: 1; } /* IE6 */
  *:first-child+html .drip-clearfix { zoom: 1; } /* IE7 */

  /* === Main Container === */

  .drip-tab-container * {
    box-sizing: content-box;
  }

  /* === Content === */

  .drip-tab .drip-content {
    margin: 0;
    padding: 5px;
    width: 330px;
    position: fixed;
    font-size: 100%;
    font: inherit;
    z-index: 10000;
    color: #333;
    vertical-align: baseline;
    text-align: left;
    box-sizing: border-box;
    -webkit-box-shadow: 0px 0px 20px rgba(0,0,0,0.25);
       -moz-box-shadow: 0px 0px 20px rgba(0,0,0,0.25);
            box-shadow: 0px 0px 20px rgba(0,0,0,0.25);
  }

  .drip-tab.bottom .drip-content {
    bottom: -800px;
    -webkit-border-radius: 8px 8px 0 0;
       -moz-border-radius: 8px 8px 0 0;
            border-radius: 8px 8px 0 0;
    -webkit-transition: bottom 200ms ease-in;
       -moz-transition: bottom 200ms ease-in;
         -o-transition: bottom 200ms ease-in;
            transition: bottom 200ms ease-in;
  }

  .drip-tab.bottom.left .drip-content {
    left: 40px;
  }

  .drip-tab.bottom.right .drip-content {
    right: 40px;
  }

  .drip-tab.image-left .drip-content,
  .drip-tab.image-right .drip-content {
    width: 510px;
  }

  .drip-tab.side .drip-content {
    top: 10%;
  }

  .drip-tab.side.right .drip-content {
    right: -550px;
    -webkit-border-radius: 8px 0 0 8px;
       -moz-border-radius: 8px 0 0 8px;
            border-radius: 8px 0 0 8px;
    -webkit-transition: right 200ms ease-in;
       -moz-transition: right 200ms ease-in;
         -o-transition: right 200ms ease-in;
            transition: right 200ms ease-in;
  }

  .drip-tab.side.left .drip-content {
    left: -550px;
    -webkit-border-radius: 0 8px 8px 0;
       -moz-border-radius: 0 8px 8px 0;
            border-radius: 0 8px 8px 0;
    -webkit-transition: left 200ms ease-in;
       -moz-transition: left 200ms ease-in;
         -o-transition: left 200ms ease-in;
            transition: left 200ms ease-in;
  }

  .drip-tab.mobile .drip-content {
    width: 100% !important;
    bottom: -800px;
    left: 0;
    -webkit-border-radius: 0;
       -moz-border-radius: 0;
            border-radius: 0;
    -webkit-transition: bottom 200ms ease-in;
       -moz-transition: bottom 200ms ease-in;
         -o-transition: bottom 200ms ease-in;
            transition: bottom 200ms ease-in;
  }

  .drip-tab.drip-scrollable .drip-content {
    overflow-y: scroll;
  }

  /* === Header === */

  .drip-tab .drip-header {
    margin: 0;
    padding: 0;
    position: fixed;
    font-size: 100%;
    font: inherit;
    z-index: 10000;
    color: #333;
    vertical-align: baseline;
    text-align: left;
    -webkit-border-radius: 8px 8px 0 0;
       -moz-border-radius: 8px 8px 0 0;
            border-radius: 8px 8px 0 0;
    -webkit-box-shadow: 0px 10px 28px rgba(0,0,0,0.36);
       -moz-box-shadow: 0px 10px 28px rgba(0,0,0,0.36);
            box-shadow: 0px 10px 28px rgba(0,0,0,0.36);
  }

  .drip-tab.bottom .drip-header {
    width: 330px;
    bottom: 0;
    -webkit-transition: bottom 200ms ease-in;
       -moz-transition: bottom 200ms ease-in;
         -o-transition: bottom 200ms ease-in;
            transition: bottom 200ms ease-in;
  }

  .drip-tab.bottom .drip-header.drip-hidden {
    bottom: -800px;
  }

  .drip-tab.bottom.left .drip-header {
    left: 40px;
  }

  .drip-tab.bottom.right .drip-header {
    right: 40px;
  }

  .drip-tab.bottom.image-left .drip-header,
  .drip-tab.bottom.image-right .drip-header {
    width: 510px;
  }

  .drip-tab.side .drip-header {
    width: 330px;
    top: 10%;
  }

  .drip-tab.side.right .drip-header {
    right: -100px;
    -webkit-transition: right 400ms ease-in;
       -moz-transition: right 400ms ease-in;
         -o-transition: right 400ms ease-in;
            transition: right 400ms ease-in;
    -webkit-transform: rotate(-90deg) !important;
       -moz-transform: rotate(-90deg) !important;
        -ms-transform: rotate(-90deg) !important;
         -o-transform: rotate(-90deg) !important;
            transform: rotate(-90deg) !important;
    -webkit-transform-origin: right center;
       -moz-transform-origin: right center;
         -o-transform-origin: right center;
            transform-origin: right center;
  }

  .drip-tab.side.right .drip-header.drip-hidden {
    right: -100px;
  }

  .drip-tab.side.left .drip-header {
    left: -100px;
    -webkit-transition: left 400ms ease-in;
       -moz-transition: left 400ms ease-in;
         -o-transition: left 400ms ease-in;
            transition: left 400ms ease-in;
    -webkit-transform: rotate(90deg) !important;
       -moz-transform: rotate(90deg) !important;
        -ms-transform: rotate(90deg) !important;
         -o-transform: rotate(90deg) !important;
            transform: rotate(90deg) !important;
    -webkit-transform-origin: left center;
       -moz-transform-origin: left center;
         -o-transform-origin: left center;
            transform-origin: left center;
  }

  .drip-tab.side.left .drip-header.drip-hidden {
    left: -100px;
  }

  .drip-tab.mobile .drip-header {
    width: 100% !important;
    bottom: 0;
    left: 0;
    -webkit-border-radius: 0;
       -moz-border-radius: 0;
            border-radius: 0;
    -webkit-transition: bottom 200ms ease-in;
       -moz-transition: bottom 200ms ease-in;
         -o-transition: bottom 200ms ease-in;
            transition: bottom 200ms ease-in;
  }

  .drip-tab.mobile .drip-header.drip-hidden {
    bottom: -300px;
  }

  /* === Header Toggle === */

  .drip-tab .drip-toggle {
    display: block;
    text-decoration: none;
    padding: 10px 50px 10px 20px; /* extra padding for the arrow */
  }

  /* === Teaser === */

  .drip-tab .drip-header h2 {
    display: block;
    margin: 0 !important;
    padding: 0 !important;
    border: 0 !important;
    font-size: 14px !important;
    line-height: 1.5 !important;
    font-weight: bold !important;
    text-align: left !important;
    color: #fff !important;
    clear: none !important;
    letter-spacing: 0 !important;
    width: auto !important;
  }

  /* === Arrows === */

  .drip-tab .drip-header span.drip-arrow {
    display: block;
    position: absolute;
    margin: 0;
    padding: 0;
    width: 0;
    height: 0;
    line-height: 0;
    top: 17px;
    right: 32px;
  }

  /* === Panel === */

  .drip-tab .drip-content > div.drip-panel {
    padding: 15px 15px 12px;
    background-color: #fff;
    -webkit-border-radius: 6px;
       -moz-border-radius: 6px;
            border-radius: 6px;
  }

  /* === Powered By === */

  .drip-tab .drip-powered-by {
    padding: 8px;
    margin-bottom: -5px;
    font-family: Helvetica, Arial, sans-serif;
    text-align: left;
    font-weight: bold;
    font-size: 10px;
    line-height: 16px;
    color: #ffffff;
    letter-spacing: 1px;
    text-align: center;
    text-transform: uppercase;
    display: -webkit-box;
    display: -ms-flexbox;
    display: -webkit-flex;
    display: flex;
    justify-content: center;
    align-items: center;
  }

  .drip-tab .drip-powered-by a {
    color: #ffffff !important;
    text-decoration: underline !important;
    letter-spacing: 1px;
    margin-left: 6px;
  }

  /* === Content Headings & Paragraphs === */

  .drip-tab .drip-content h3 {
    display: block;
    margin: 0 20px 0 0 !important;
    padding: 0 0 15px 0 !important;
    line-height: 1.4 !important;
    font-weight: bold !important;
    text-align: left !important;
    color: #4477bd !important;
    clear: none !important;
  }

  .drip-tab .drip-content .drip-description {
    margin: 0;
    padding: 0 0 20px 0;
    line-height: 1.6;
    text-align: left;
  }

  .drip-tab.image-left .drip-content .drip-description {
    margin-left: 170px;
  }

  .drip-tab.image-right .drip-content .drip-description {
    margin-right: 170px;
  }

  @media screen and (max-width: 510px) {
    .drip-tab.image-left .drip-content .drip-description {
      margin-left: 0; /* 120px; */
    }

    .drip-tab.image-right .drip-content .drip-description {
      margin-right: 0; /* 120px; */
    }
  }

  .drip-tab .drip-content .drip-description a {
    text-decoration: underline;
  }

  .drip-tab .drip-content .drip-description em {
    font-style: italic;
  }

  .drip-tab .drip-content .drip-description ul,
  .drip-tab .drip-content .drip-description ol {
    list-style-position: outside;
    margin: 8px 0 8px 30px;
  }

  .drip-tab .drip-content .drip-description ul li
  .drip-tab .drip-content .drip-description ol li {
    padding: 0;
  }

  .drip-tab .drip-content img.drip-image {
    margin-bottom: 20px;
  }

  .drip-tab.image-left .drip-content img.drip-image {
    float: left;
    width: 150px;
  }

  .drip-tab.image-right .drip-content img.drip-image {
    float: right;
    width: 150px;
  }

  @media screen and (max-width: 510px) {
    .drip-tab.image-left .drip-content img.drip-image {
      margin-right: 20px;
      width: 100px;
    }

    .drip-tab.image-right .drip-content img.drip-image {
      margin-left: 20px;
      width: 100px;
    }
  }

  .drip-tab .drip-content a.drip-close {
    font-family: Arial, Helvetica, sans-serif;
    margin: -1px 0 0 0;
    float: right;
    font-size: 28px;
    line-height: 15px;
    font-weight: normal;
    color: #333;
    opacity: 0.4;
  }

  .drip-tab .drip-content a.drip-close:hover {
    text-decoration: none;
    cursor: pointer;
    opacity: 0.6;
  }

  /* === Content Subscribe Form === */

  .drip-tab form {
    margin: 0 !important;
    padding: 0 !important;
  }

  .drip-tab dl {
    display: block;
    margin: 0;
    padding: 0;
  }

  .drip-tab dl dt {
    display: block;
    padding: 0 0 5px 0;
    font-weight: bold;
  }

  .drip-tab dl.no-labels dt {
    display: none;
  }

  .drip-tab dl dd {
    display: block;
    padding: 0 0 10px 0;
  }

  .drip-tab .drip-text-field {
    margin: 0 !important;
    padding: 6px !important;
    height: auto !important;
    width: 100% !important;
    color: #333 !important;
    background-color: #fff !important;
    border: 1px solid #c4c4c4 !important;
    -webkit-box-shadow: inset 0 0 3px rgba(0,0,0,0.18) !important;
       -moz-box-shadow: inset 0 0 3px rgba(0,0,0,0.18) !important;
            box-shadow: inset 0 0 3px rgba(0,0,0,0.18) !important;
    -webkit-border-radius: 4px !important;
       -moz-border-radius: 4px !important;
            border-radius: 4px !important;
    -webkit-box-sizing: border-box !important;
       -moz-box-sizing: border-box !important;
        -ms-box-sizing: border-box !important;
            box-sizing: border-box !important;
    background-image: none !important;
    min-width: 0 !important;
    min-height: 0 !important;
  }

  .drip-tab .drip-text-field::-webkit-input-placeholder { /* WebKit browsers */
    color: #999999 !important;
  }
  .drip-tab .drip-text-field:-moz-placeholder { /* Mozilla Firefox 4 to 18 */
    color: #999999 !important;
  }
  .drip-tab .drip-text-field::-moz-placeholder { /* Mozilla Firefox 19+ */
    color: #999999 !important;
  }
  .drip-tab .drip-text-field:-ms-input-placeholder { /* Internet Explorer 10+ */
    color: #999999 !important;
  }

  .drip-tab .drip-text-field:focus {
    border-color: #a4a4a4 !important;
    outline: 0;
    background-image: none;
    background-color: #fff !important;
  }

  .drip-tab.mobile .drip-text-field {
    font-size: 16px;
  }

  .drip-tab .drip-errors {
    padding: 5px 0 0 0;
    font-weight: normal;
    color: red;
  }

  .drip-tab .drip-submit-button {
    font-family: 'Helvetica Neue', Helvetica, Arial, sans-serif !important;
    padding: 3px 12px !important;
    color: #ffffff !important;
    font-weight: bold !important;
    line-height: 1.6 !important;
    border: 0 !important;
    -webkit-border-radius: 15px !important;
       -moz-border-radius: 15px !important;
            border-radius: 15px !important;
    cursor: pointer !important;
    background-image: none !important;
    min-width: 0 !important;
    min-height: 0 !important;
    height: auto;
  }

  .drip-tab .drip-submit-button:hover {
    background-image: none !important;
  }

  .drip-tab .drip-submit-button:active {
    background-image: none !important;
  }

  /* checkbox */
  .drip-tab .classic--checkbox.hidden {
    margin-bottom: -8px;
    display: none;
  }

  .drip-tab .classic--checkbox input[type="checkbox"] {
    display: inline-block;
    width: auto;
  }

  /* stylelint-enable */

</style></head>
<body class="post-template-default single single-post postid-6286 single-format-standard gecko alt-style-default two-col-left width-960 two-col-left-960">
<div id="wrapper">

	<div id="inner-wrapper">

	<h3 class="nav-toggle icon"><a href="#navigation">Navigation</a></h3>

	<header id="header" class="col-full">

		<div id="logo">
<a href="https://machinelearningmastery.com/" title="Making developers awesome at machine learning"><img src="How%20to%20Develop%20LSTM%20Models%20for%20Multi-Step%20Time%20Series%20Forecasting%20of%20Household%20Power%20Consumption_fichiers/icon-100x100.png" alt="Machine Learning Mastery"></a>
<span class="site-title"><a href="https://machinelearningmastery.com/">Machine Learning Mastery</a></span>
<span class="site-description">Making developers awesome at machine learning</span>
</div>
	    <div class="header-widget">
	        <div id="text-53" class="widget widget_text">			<div class="textwidget"><p>Want help with deep learning for time series? <a href="https://machinelearningmastery.lpages.co/deep-learning-for-time-series-forecasting-mini-course/">Take the FREE Mini-Course</a></p>
</div>
		</div><div id="search-3" class="widget widget_search"><div class="search_main">
    <form method="get" class="searchform" action="https://machinelearningmastery.com/">
        <input type="text" class="field s" name="s" value="Search..." onfocus="if (this.value == 'Search...') {this.value = '';}" onblur="if (this.value == '') {this.value = 'Search...';}">
		<input type="hidden" name="post_type" value="post">
        <button type="submit" class="fa fa-search submit" name="submit" value="Search"></button>
    </form>
    <div class="fix"></div>
</div></div>	    </div>
	
	</header>
	<nav id="navigation" class="col-full" role="navigation">

	
	<section class="menus">

		<a href="https://machinelearningmastery.com/" class="nav-home"><span>Home</span></a>

	<h3>Main Menu</h3><ul id="main-nav" class="nav fl"><li id="menu-item-6503" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-6503"><a href="https://machinelearningmastery.com/start-here/">Start Here</a></li>
<li id="menu-item-6501" class="menu-item menu-item-type-post_type menu-item-object-page current_page_parent menu-item-6501"><a href="https://machinelearningmastery.com/blog/">Blog</a></li>
<li id="menu-item-6506" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-has-children menu-item-6506 parent"><a href="#">Topics</a>
<ul class="sub-menu">
	<li id="menu-item-6508" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-6508"><a href="https://machinelearningmastery.com/category/deep-learning/">Deep Learning (Keras)</a></li>
	<li id="menu-item-6511" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-6511"><a href="https://machinelearningmastery.com/category/lstm/">LSTMs</a></li>
	<li id="menu-item-6509" class="menu-item menu-item-type-taxonomy menu-item-object-category current-post-ancestor current-menu-parent current-post-parent menu-item-6509"><a href="https://machinelearningmastery.com/category/deep-learning-time-series/">Deep Learning for Time Series</a></li>
	<li id="menu-item-6515" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-6515"><a href="https://machinelearningmastery.com/category/natural-language-processing/">Deep Learning for NLP</a></li>
	<li id="menu-item-6512" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-6512"><a href="https://machinelearningmastery.com/category/machine-learning-algorithms/">Understand Algorithms</a></li>
	<li id="menu-item-6507" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-6507"><a href="https://machinelearningmastery.com/category/algorithms-from-scratch/">Code Algorithms (Python)</a></li>
	<li id="menu-item-6513" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-6513"><a href="https://machinelearningmastery.com/category/machine-learning-process/">Machine Learning Process</a></li>
	<li id="menu-item-6516" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-6516"><a href="https://machinelearningmastery.com/category/python-machine-learning/">Python (scikit-learn)</a></li>
	<li id="menu-item-6517" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-6517"><a href="https://machinelearningmastery.com/category/r-machine-learning/">R (caret)</a></li>
	<li id="menu-item-6522" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-6522"><a href="https://machinelearningmastery.com/category/weka-machine-learning/">Weka (no code)</a></li>
	<li id="menu-item-6518" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-6518"><a href="https://machinelearningmastery.com/category/start-machine-learning/">Getting Started</a></li>
	<li id="menu-item-6510" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-6510"><a href="https://machinelearningmastery.com/category/linear-algebra/">Linear Algebra</a></li>
	<li id="menu-item-6519" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-6519"><a href="https://machinelearningmastery.com/category/statistical-methods/">Statistical Methods</a></li>
	<li id="menu-item-6520" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-6520"><a href="https://machinelearningmastery.com/category/time-series/">Time Series (introductory)</a></li>
	<li id="menu-item-6523" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-6523"><a href="https://machinelearningmastery.com/category/xgboost/">XGBoost</a></li>
	<li id="menu-item-6514" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-6514"><a href="https://machinelearningmastery.com/category/machine-learning-resources/">Resources</a></li>
</ul>
</li>
<li id="menu-item-6502" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-6502"><a href="https://machinelearningmastery.com/products/">Ebooks</a></li>
<li id="menu-item-6500" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-6500"><a href="https://machinelearningmastery.com/faq/">FAQ</a></li>
<li id="menu-item-6504" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-6504"><a href="https://machinelearningmastery.com/about/">About</a></li>
<li id="menu-item-6505" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-6505"><a href="https://machinelearningmastery.com/contact/">Contact</a></li>
</ul>	<div class="side-nav">
		</div><!-- /#side-nav -->

	</section><!-- /.menus -->

	<a href="#top" class="nav-close"><span>Return to Content</span></a>

</nav>
       
    <!-- #content Starts -->
	    <div id="content" class="col-full">
    
    	<div id="main-sidebar-container">    

            <!-- #main Starts -->
                        <section id="main">                       
<article class="post-6286 post type-post status-publish format-standard has-post-thumbnail hentry category-deep-learning-time-series">
	<header>
	<h1 class="title entry-title">How to Develop LSTM Models for Multi-Step Time Series Forecasting of Household Power Consumption</h1>	</header>
<div class="post-meta"><span class="small">By</span> <span class="author vcard"><span class="fn"><a href="https://machinelearningmastery.com/author/jasonb/" title="Posts by Jason Brownlee" rel="author">Jason Brownlee</a></span></span> <span class="small">on</span> <abbr class="date time published updated" title="2018-10-10T05:00:36+1100">October 10, 2018</abbr>  <span class="small">in</span> <span class="categories"><a href="https://machinelearningmastery.com/category/deep-learning-time-series/" title="View all items in Deep Learning for Time Series">Deep Learning for Time Series</a></span>  </div>
	<section class="entry">
<div class="simplesocialbuttons simplesocial-simple-icons simplesocialbuttons_inline simplesocialbuttons-align-left post-6286 post  simplesocialbuttons-inline-no-animation simplesocialbuttons-inline-in">
<button class="ssb_tweet-icon" data-href="https://twitter.com/share?text=How+to+Develop+LSTM+Models+for+Multi-Step+Time+Series+Forecasting+of+Household+Power+Consumption&amp;url=https://machinelearningmastery.com/how-to-develop-lstm-models-for-multi-step-time-series-forecasting-of-household-power-consumption/" rel="nofollow" onclick="javascript:window.open(this.dataset.href, '', 'menubar=no,toolbar=no,resizable=yes,scrollbars=yes,height=600,width=600');return false;">
						<span class="icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 72 72"><path fill="none" d="M0 0h72v72H0z"></path><path class="icon" fill="#fff" d="M68.812 15.14c-2.348 1.04-4.87 1.744-7.52 2.06 2.704-1.62 4.78-4.186 5.757-7.243-2.53 1.5-5.33 2.592-8.314 3.176C56.35 10.59 52.948 9 49.182 9c-7.23 0-13.092 5.86-13.092 13.093 0 1.026.118 2.02.338 2.98C25.543 24.527 15.9 19.318 9.44 11.396c-1.125 1.936-1.77 4.184-1.77 6.58 0 4.543 2.312 8.552 5.824 10.9-2.146-.07-4.165-.658-5.93-1.64-.002.056-.002.11-.002.163 0 6.345 4.513 11.638 10.504 12.84-1.1.298-2.256.457-3.45.457-.845 0-1.666-.078-2.464-.23 1.667 5.2 6.5 8.985 12.23 9.09-4.482 3.51-10.13 5.605-16.26 5.605-1.055 0-2.096-.06-3.122-.184 5.794 3.717 12.676 5.882 20.067 5.882 24.083 0 37.25-19.95 37.25-37.25 0-.565-.013-1.133-.038-1.693 2.558-1.847 4.778-4.15 6.532-6.774z"></path></svg></span><i class="simplesocialtxt">Tweet </i></button>
		<button class="ssb_fbshare-icon" target="_blank" data-href="https://www.facebook.com/sharer/sharer.php?u=https://machinelearningmastery.com/how-to-develop-lstm-models-for-multi-step-time-series-forecasting-of-household-power-consumption/" onclick="javascript:window.open(this.dataset.href, '', 'menubar=no,toolbar=no,resizable=yes,scrollbars=yes,height=600,width=600');return false;">
						<span class="icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16" class="_1pbq" color="#ffffff"><path fill="#ffffff" fill-rule="evenodd" class="icon" d="M8 14H3.667C2.733 13.9 2 13.167 2 12.233V3.667A1.65 1.65 0 0 1 3.667 2h8.666A1.65 1.65 0 0 1 14 3.667v8.566c0 .934-.733 1.667-1.667 1.767H10v-3.967h1.3l.7-2.066h-2V6.933c0-.466.167-.9.867-.9H12v-1.8c.033 0-.933-.266-1.533-.266-1.267 0-2.434.7-2.467 2.133v1.867H6v2.066h2V14z"></path></svg></span>
						<span class="simplesocialtxt">Share </span> </button>
<button class="ssb_linkedin-icon" data-href="https://www.linkedin.com/cws/share?url=https://machinelearningmastery.com/how-to-develop-lstm-models-for-multi-step-time-series-forecasting-of-household-power-consumption/" onclick="javascript:window.open(this.dataset.href, '', 'menubar=no,toolbar=no,resizable=yes,scrollbars=yes,height=600,width=600');return false;">
						<span class="icon"> <svg version="1.1" id="Layer_1" xmlns="http://www.w3.org/2000/svg" xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" width="15px" height="14.1px" viewBox="-301.4 387.5 15 14.1" enable-background="new -301.4 387.5 15 14.1" xml:space="preserve"> <g id="XMLID_398_"> <path id="XMLID_399_" fill="#FFFFFF" d="M-296.2,401.6c0-3.2,0-6.3,0-9.5h0.1c1,0,2,0,2.9,0c0.1,0,0.1,0,0.1,0.1c0,0.4,0,0.8,0,1.2 c0.1-0.1,0.2-0.3,0.3-0.4c0.5-0.7,1.2-1,2.1-1.1c0.8-0.1,1.5,0,2.2,0.3c0.7,0.4,1.2,0.8,1.5,1.4c0.4,0.8,0.6,1.7,0.6,2.5 c0,1.8,0,3.6,0,5.4v0.1c-1.1,0-2.1,0-3.2,0c0-0.1,0-0.1,0-0.2c0-1.6,0-3.2,0-4.8c0-0.4,0-0.8-0.2-1.2c-0.2-0.7-0.8-1-1.6-1 c-0.8,0.1-1.3,0.5-1.6,1.2c-0.1,0.2-0.1,0.5-0.1,0.8c0,1.7,0,3.4,0,5.1c0,0.2,0,0.2-0.2,0.2c-1,0-1.9,0-2.9,0 C-296.1,401.6-296.2,401.6-296.2,401.6z"></path> <path id="XMLID_400_" fill="#FFFFFF" d="M-298,401.6L-298,401.6c-1.1,0-2.1,0-3,0c-0.1,0-0.1,0-0.1-0.1c0-3.1,0-6.1,0-9.2 c0-0.1,0-0.1,0.1-0.1c1,0,2,0,2.9,0h0.1C-298,395.3-298,398.5-298,401.6z"></path> <path id="XMLID_401_" fill="#FFFFFF" d="M-299.6,390.9c-0.7-0.1-1.2-0.3-1.6-0.8c-0.5-0.8-0.2-2.1,1-2.4c0.6-0.2,1.2-0.1,1.8,0.2 c0.5,0.4,0.7,0.9,0.6,1.5c-0.1,0.7-0.5,1.1-1.1,1.3C-299.1,390.8-299.4,390.8-299.6,390.9L-299.6,390.9z"></path> </g> </svg> </span>
						<span class="simplesocialtxt">Share</span> </button>
<button class="ssb_gplus-icon" data-href="https://plus.google.com/share?url=https://machinelearningmastery.com/how-to-develop-lstm-models-for-multi-step-time-series-forecasting-of-household-power-consumption/" onclick="javascript:window.open(this.dataset.href, '', 'menubar=no,toolbar=no,resizable=yes,scrollbars=yes,height=600,width=600');return false;">
						<span class="icon"><svg version="1.1" xmlns="http://www.w3.org/2000/svg" preserveAspectRatio="xMidYMid meet" width="30px" height="18px" viewBox="-10 -6 60 36" class="ozWidgetRioButtonSvg_ ozWidgetRioButtonPlusOne_"><path d="M30 7h-3v4h-4v3h4v4h3v-4h4v-3h-4V7z"></path><path d="M11 9.9v4h5.4C16 16.3 14 18 11 18c-3.3 0-5.9-2.8-5.9-6S7.7 6 11 6c1.5 0 2.8.5 3.8 1.5l2.9-2.9C15.9 3 13.7 2 11 2 5.5 2 1 6.5 1 12s4.5 10 10 10c5.8 0 9.6-4.1 9.6-9.8 0-.7-.1-1.5-.2-2.2H11z"></path></svg></span>
						<span class="simplesocialtxt">Google Plus </span></button>
</div>
<p>Given the rise of smart electricity meters and the wide adoption of 
electricity generation technology like solar panels, there is a wealth 
of electricity usage data available.</p>
<p>This data represents a multivariate time series of power-related 
variables that in turn could be used to model and even forecast future 
electricity consumption.</p>
<p>Unlike other machine learning algorithms, long short-term memory 
recurrent neural networks are capable of automatically learning features
 from sequence data, support multiple-variate data, and can output a 
variable length sequences that can be used for multi-step forecasting.</p>
<p>In this tutorial, you will discover how to develop long short-term 
memory recurrent neural networks for multi-step time series forecasting 
of household power consumption.</p>
<p>After completing this tutorial, you will know:</p>
<ul>
<li>How to develop and evaluate Univariate and multivariate Encoder-Decoder LSTMs for multi-step time series forecasting.</li>
<li>How to develop and evaluate an CNN-LSTM Encoder-Decoder model for multi-step time series forecasting.</li>
<li>How to develop and evaluate a ConvLSTM Encoder-Decoder model for multi-step time series forecasting.</li>
</ul>
<p>Let’s get started.</p>
<div id="attachment_6293" style="width: 650px" class="wp-caption aligncenter"><img class="size-full wp-image-6293" src="How%20to%20Develop%20LSTM%20Models%20for%20Multi-Step%20Time%20Series%20Forecasting%20of%20Household%20Power%20Consumption_fichiers/How-to-Develop-LSTM-Models-for-Multi-Step-Time-Series-Foreca.jpg" alt="How to Develop LSTM Models for Multi-Step Time Series Forecasting of Household Power Consumption" srcset="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2018/10/How-to-Develop-LSTM-Models-for-Multi-Step-Time-Series-Forecasting-of-Household-Power-Consumption.jpg 640w, https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2018/10/How-to-Develop-LSTM-Models-for-Multi-Step-Time-Series-Forecasting-of-Household-Power-Consumption-300x199.jpg 300w" sizes="(max-width: 640px) 100vw, 640px" width="640" height="425"><p class="wp-caption-text">How to Develop LSTM Models for Multi-Step Time Series Forecasting of Household Power Consumption<br>Photo by <a href="https://www.flickr.com/photos/imuttoo/4257813689/">Ian Muttoo</a>, some rights reserved.</p></div>
<h2>Tutorial Overview</h2>
<p>This tutorial is divided into nine parts; they are:</p>
<ol>
<li>Problem Description</li>
<li>Load and Prepare Dataset</li>
<li>Model Evaluation</li>
<li>LSTMs for Multi-Step Forecasting</li>
<li>LSTM Model With Univariate Input and Vector Output</li>
<li>Encoder-Decoder LSTM Model With Univariate Input</li>
<li>Encoder-Decoder LSTM Model With Multivariate Input</li>
<li>CNN-LSTM Encoder-Decoder Model With Univariate Input</li>
<li>ConvLSTM Encoder-Decoder Model With Univariate Input</li>
</ol>
<h2>Problem Description</h2>
<p>The ‘<a href="https://archive.ics.uci.edu/ml/datasets/individual+household+electric+power+consumption">Household Power Consumption</a>‘
 dataset is a multivariate time series dataset that describes the 
electricity consumption for a single household over four years.</p>
<p>The data was collected between December 2006 and November 2010 and 
observations of power consumption within the household were collected 
every minute.</p>
<p>It is a multivariate series comprised of seven variables (besides the date and time); they are:</p>
<ul>
<li><strong>global_active_power</strong>: The total active power consumed by the household (kilowatts).</li>
<li><strong>global_reactive_power</strong>: The total reactive power consumed by the household (kilowatts).</li>
<li><strong>voltage</strong>: Average voltage (volts).</li>
<li><strong>global_intensity</strong>: Average current intensity (amps).</li>
<li><strong>sub_metering_1</strong>: Active energy for kitchen (watt-hours of active energy).</li>
<li><strong>sub_metering_2</strong>: Active energy for laundry (watt-hours of active energy).</li>
<li><strong>sub_metering_3</strong>: Active energy for climate control systems (watt-hours of active energy).</li>
</ul>
<p>Active and reactive energy refer to the technical details of <a href="https://en.wikipedia.org/wiki/AC_power">alternative current</a>.</p>
<p>A fourth sub-metering variable can be created by subtracting the sum 
of three defined sub-metering variables from the total active energy as 
follows:</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->

		<div id="crayon-5c08128ae92ac655970726" class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" style="margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important; height: auto;">
		
			<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important; height: 18px !important; line-height: 18px !important; margin-top: -19px; display: none; z-index: 4;"><span class="crayon-title"></span>
			<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button crayon-pressed" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
			<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
			<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="readonly" style="-moz-tab-size: 4; font-size: 12px !important; line-height: 15px !important; z-index: 0; opacity: 0; overflow: hidden;" wrap="soft">sub_metering_remainder = (global_active_power * 1000 / 60) - (sub_metering_1 + sub_metering_2 + sub_metering_3)</textarea></div>
			<div class="crayon-main" style="position: relative; z-index: 1; overflow: hidden;">
				<table class="crayon-table" style="">
					<tbody><tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5c08128ae92ac655970726-1">1</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5c08128ae92ac655970726-1">sub_metering_remainder = (global_active_power * 1000 / 60) - (sub_metering_1 + sub_metering_2 + sub_metering_3)</div></div></td>
					</tr>
				</tbody></table>
			</div>
		</div>
<!-- [Format Time: 0.0001 seconds] -->
<p></p>
<h2>Load and Prepare Dataset</h2>
<p>The dataset can be downloaded from the UCI Machine Learning repository as a single 20 megabyte .zip file:</p>
<ul>
<li><a href="https://archive.ics.uci.edu/ml/machine-learning-databases/00235/household_power_consumption.zip">household_power_consumption.zip</a></li>
</ul>
<p>Download the dataset and unzip it into your current working directory. You will now have the file “<em>household_power_consumption.txt</em>” that is about 127 megabytes in size and contains all of the observations.</p>
<p>We can use the <em>read_csv()</em> function to load the data and combine the first two columns into a single date-time column that we can use as an index.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->

		<div id="crayon-5c08128ae92b4674682210" class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" style="margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important; height: auto;">
		
			<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important; height: 18px !important; line-height: 18px !important; margin-top: -19px; display: none; z-index: 4;"><span class="crayon-title"></span>
			<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button crayon-pressed" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
			<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
			<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="readonly" style="-moz-tab-size: 4; font-size: 12px !important; line-height: 15px !important; z-index: 0; opacity: 0; overflow: hidden;" wrap="soft">#
 load all data
dataset = read_csv('household_power_consumption.txt', sep=';', header=0,
 low_memory=False, infer_datetime_format=True, 
parse_dates={'datetime':[0,1]}, index_col=['datetime'])</textarea></div>
			<div class="crayon-main" style="position: relative; z-index: 1; overflow: hidden;">
				<table class="crayon-table" style="">
					<tbody><tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5c08128ae92b4674682210-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c08128ae92b4674682210-2">2</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5c08128ae92b4674682210-1"><span class="crayon-p"># load all data</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c08128ae92b4674682210-2"><span class="crayon-v">dataset</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">read_csv</span><span class="crayon-sy">(</span><span class="crayon-s">'household_power_consumption.txt'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">sep</span><span class="crayon-o">=</span><span class="crayon-s">';'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">header</span><span class="crayon-o">=</span><span class="crayon-cn">0</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">low_memory</span><span class="crayon-o">=</span><span class="crayon-t">False</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">infer_datetime_format</span><span class="crayon-o">=</span><span class="crayon-t">True</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">parse_dates</span><span class="crayon-o">=</span><span class="crayon-sy">{</span><span class="crayon-s">'datetime'</span><span class="crayon-o">:</span><span class="crayon-sy">[</span><span class="crayon-cn">0</span><span class="crayon-sy">,</span><span class="crayon-cn">1</span><span class="crayon-sy">]</span><span class="crayon-sy">}</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">index_col</span><span class="crayon-o">=</span><span class="crayon-sy">[</span><span class="crayon-s">'datetime'</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span></div></div></td>
					</tr>
				</tbody></table>
			</div>
		</div>
<!-- [Format Time: 0.0007 seconds] -->
<p>Next, we can mark all <a href="https://machinelearningmastery.com/handle-missing-timesteps-sequence-prediction-problems-python/">missing values</a> indicated with a ‘<em>?</em>‘ character with a <em>NaN</em> value, which is a float.</p>
<p>This will allow us to work with the data as one array of floating point values rather than mixed types (less efficient.)</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->

		<div id="crayon-5c08128ae92b6614656352" class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" style="margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important; height: auto;">
		
			<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important; height: 18px !important; line-height: 18px !important; margin-top: -19px; display: none; position: absolute; z-index: 2;"><span class="crayon-title"></span>
			<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button crayon-pressed" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code" style="display: none;"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
			<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
			<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="readonly" style="-moz-tab-size: 4; font-size: 12px !important; line-height: 15px !important; z-index: 0; opacity: 0; overflow: hidden;" wrap="soft"># mark all missing values
dataset.replace('?', nan, inplace=True)
# make dataset numeric
dataset = dataset.astype('float32')</textarea></div>
			<div class="crayon-main" style="position: relative; z-index: 1; overflow: hidden;">
				<table class="crayon-table" style="">
					<tbody><tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5c08128ae92b6614656352-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c08128ae92b6614656352-2">2</div><div class="crayon-num" data-line="crayon-5c08128ae92b6614656352-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c08128ae92b6614656352-4">4</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5c08128ae92b6614656352-1"><span class="crayon-p"># mark all missing values</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c08128ae92b6614656352-2"><span class="crayon-v">dataset</span><span class="crayon-sy">.</span><span class="crayon-e">replace</span><span class="crayon-sy">(</span><span class="crayon-s">'?'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">nan</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">inplace</span><span class="crayon-o">=</span><span class="crayon-t">True</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c08128ae92b6614656352-3"><span class="crayon-p"># make dataset numeric</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c08128ae92b6614656352-4"><span class="crayon-v">dataset</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">dataset</span><span class="crayon-sy">.</span><span class="crayon-e">astype</span><span class="crayon-sy">(</span><span class="crayon-s">'float32'</span><span class="crayon-sy">)</span></div></div></td>
					</tr>
				</tbody></table>
			</div>
		</div>
<!-- [Format Time: 0.0002 seconds] -->
<p>We also need to fill in the missing values now that they have been marked.</p>
<p>A very simple approach would be to copy the observation from the same
 time the day before. We can implement this in a function named <em>fill_missing()</em> that will take the NumPy array of the data and copy values from exactly 24 hours ago.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->

		<div id="crayon-5c08128ae92b8768422235" class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" style="margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important; height: auto;">
		
			<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important; height: 18px !important; line-height: 18px !important; margin-top: -19px; display: none; position: absolute; z-index: 2;"><span class="crayon-title"></span>
			<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button crayon-pressed" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code" style="display: none;"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
			<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
			<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="readonly" style="-moz-tab-size: 4; font-size: 12px !important; line-height: 15px !important; z-index: 0; opacity: 0; overflow: hidden;" wrap="soft"># fill missing values with a value at the same time one day ago
def fill_missing(values):
	one_day = 60 * 24
	for row in range(values.shape[0]):
		for col in range(values.shape[1]):
			if isnan(values[row, col]):
				values[row, col] = values[row - one_day, col]</textarea></div>
			<div class="crayon-main" style="position: relative; z-index: 1; overflow: hidden;">
				<table class="crayon-table" style="">
					<tbody><tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5c08128ae92b8768422235-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c08128ae92b8768422235-2">2</div><div class="crayon-num" data-line="crayon-5c08128ae92b8768422235-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c08128ae92b8768422235-4">4</div><div class="crayon-num" data-line="crayon-5c08128ae92b8768422235-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c08128ae92b8768422235-6">6</div><div class="crayon-num" data-line="crayon-5c08128ae92b8768422235-7">7</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5c08128ae92b8768422235-1"><span class="crayon-p"># fill missing values with a value at the same time one day ago</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c08128ae92b8768422235-2"><span class="crayon-e">def </span><span class="crayon-e">fill_missing</span><span class="crayon-sy">(</span><span class="crayon-v">values</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5c08128ae92b8768422235-3"><span class="crayon-h">	</span><span class="crayon-v">one_day</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-cn">60</span><span class="crayon-h"> </span><span class="crayon-o">*</span><span class="crayon-h"> </span><span class="crayon-cn">24</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c08128ae92b8768422235-4"><span class="crayon-h">	</span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-e">row </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-v">values</span><span class="crayon-sy">.</span><span class="crayon-v">shape</span><span class="crayon-sy">[</span><span class="crayon-cn">0</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5c08128ae92b8768422235-5"><span class="crayon-h">		</span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-e">col </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-v">values</span><span class="crayon-sy">.</span><span class="crayon-v">shape</span><span class="crayon-sy">[</span><span class="crayon-cn">1</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c08128ae92b8768422235-6"><span class="crayon-h">			</span><span class="crayon-st">if</span><span class="crayon-h"> </span><span class="crayon-e">isnan</span><span class="crayon-sy">(</span><span class="crayon-v">values</span><span class="crayon-sy">[</span><span class="crayon-v">row</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">col</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5c08128ae92b8768422235-7"><span class="crayon-h">				</span><span class="crayon-v">values</span><span class="crayon-sy">[</span><span class="crayon-v">row</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">col</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">values</span><span class="crayon-sy">[</span><span class="crayon-v">row</span><span class="crayon-h"> </span><span class="crayon-o">-</span><span class="crayon-h"> </span><span class="crayon-v">one_day</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">col</span><span class="crayon-sy">]</span></div></div></td>
					</tr>
				</tbody></table>
			</div>
		</div>
<!-- [Format Time: 0.0010 seconds] -->
<p>We can apply this function directly to the data within the DataFrame.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->

		<div id="crayon-5c08128ae92ba467430186" class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" style="margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important; height: auto;">
		
			<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important; height: 18px !important; line-height: 18px !important; margin-top: -19px; display: none; z-index: 4;"><span class="crayon-title"></span>
			<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button crayon-pressed" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code" style="display: none;"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
			<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
			<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="readonly" style="-moz-tab-size: 4; font-size: 12px !important; line-height: 15px !important; z-index: 0; opacity: 0; overflow: hidden;" wrap="soft"># fill missing
fill_missing(dataset.values)</textarea></div>
			<div class="crayon-main" style="position: relative; z-index: 1; overflow: hidden;">
				<table class="crayon-table" style="">
					<tbody><tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5c08128ae92ba467430186-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c08128ae92ba467430186-2">2</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5c08128ae92ba467430186-1"><span class="crayon-p"># fill missing</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c08128ae92ba467430186-2"><span class="crayon-e">fill_missing</span><span class="crayon-sy">(</span><span class="crayon-v">dataset</span><span class="crayon-sy">.</span><span class="crayon-v">values</span><span class="crayon-sy">)</span></div></div></td>
					</tr>
				</tbody></table>
			</div>
		</div>
<!-- [Format Time: 0.0001 seconds] -->
<p>Now we can create a new column that contains the remainder of the sub-metering, using the calculation from the previous section.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->

		<div id="crayon-5c08128ae92bc736372375" class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" style="margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important; height: auto;">
		
			<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important; height: 18px !important; line-height: 18px !important; margin-top: -19px; display: none; position: absolute; z-index: 2;"><span class="crayon-title"></span>
			<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button crayon-pressed" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
			<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
			<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="readonly" style="-moz-tab-size: 4; font-size: 12px !important; line-height: 15px !important; z-index: 0; opacity: 0; overflow: hidden;" wrap="soft"># add a column for for the remainder of sub metering
values = dataset.values
dataset['sub_metering_4'] = (values[:,0] * 1000 / 60) - (values[:,4] + values[:,5] + values[:,6])</textarea></div>
			<div class="crayon-main" style="position: relative; z-index: 1; overflow: hidden;">
				<table class="crayon-table" style="">
					<tbody><tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5c08128ae92bc736372375-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c08128ae92bc736372375-2">2</div><div class="crayon-num" data-line="crayon-5c08128ae92bc736372375-3">3</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5c08128ae92bc736372375-1"><span class="crayon-p"># add a column for for the remainder of sub metering</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c08128ae92bc736372375-2"><span class="crayon-v">values</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">dataset</span><span class="crayon-sy">.</span><span class="crayon-e">values</span></div><div class="crayon-line" id="crayon-5c08128ae92bc736372375-3"><span class="crayon-v">dataset</span><span class="crayon-sy">[</span><span class="crayon-s">'sub_metering_4'</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-v">values</span><span class="crayon-sy">[</span><span class="crayon-o">:</span><span class="crayon-sy">,</span><span class="crayon-cn">0</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-o">*</span><span class="crayon-h"> </span><span class="crayon-cn">1000</span><span class="crayon-h"> </span><span class="crayon-o">/</span><span class="crayon-h"> </span><span class="crayon-cn">60</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-o">-</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-v">values</span><span class="crayon-sy">[</span><span class="crayon-o">:</span><span class="crayon-sy">,</span><span class="crayon-cn">4</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-o">+</span><span class="crayon-h"> </span><span class="crayon-v">values</span><span class="crayon-sy">[</span><span class="crayon-o">:</span><span class="crayon-sy">,</span><span class="crayon-cn">5</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-o">+</span><span class="crayon-h"> </span><span class="crayon-v">values</span><span class="crayon-sy">[</span><span class="crayon-o">:</span><span class="crayon-sy">,</span><span class="crayon-cn">6</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span></div></div></td>
					</tr>
				</tbody></table>
			</div>
		</div>
<!-- [Format Time: 0.0006 seconds] -->
<p>We can now save the cleaned-up version of the dataset to a new file; 
in this case we will just change the file extension to .csv and save the
 dataset as ‘<em>household_power_consumption.csv</em>‘.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->

		<div id="crayon-5c08128ae92bd563958137" class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" style="margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important; height: auto;">
		
			<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important; height: 18px !important; line-height: 18px !important; margin-top: -19px; display: none; z-index: 4;"><span class="crayon-title"></span>
			<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button crayon-pressed" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code" style="display: none;"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
			<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
			<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="readonly" style="-moz-tab-size: 4; font-size: 12px !important; line-height: 15px !important; z-index: 0; opacity: 0; overflow: hidden;" wrap="soft"># save updated dataset
dataset.to_csv('household_power_consumption.csv')</textarea></div>
			<div class="crayon-main" style="position: relative; z-index: 1; overflow: hidden;">
				<table class="crayon-table" style="">
					<tbody><tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5c08128ae92bd563958137-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c08128ae92bd563958137-2">2</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5c08128ae92bd563958137-1"><span class="crayon-p"># save updated dataset</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c08128ae92bd563958137-2"><span class="crayon-v">dataset</span><span class="crayon-sy">.</span><span class="crayon-e">to_csv</span><span class="crayon-sy">(</span><span class="crayon-s">'household_power_consumption.csv'</span><span class="crayon-sy">)</span></div></div></td>
					</tr>
				</tbody></table>
			</div>
		</div>
<!-- [Format Time: 0.0001 seconds] -->
<p>Tying all of this together, the complete example of loading, cleaning-up, and saving the dataset is listed below.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->

		<div id="crayon-5c08128ae92bf554906252" class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" style="margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important; height: auto;">
		
			<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important; height: 18px !important; line-height: 18px !important; margin-top: -19px; display: none; position: absolute; z-index: 2;"><span class="crayon-title"></span>
			<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button crayon-pressed" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
			<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
			<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="readonly" style="-moz-tab-size: 4; font-size: 12px !important; line-height: 15px !important; z-index: 0; opacity: 0; overflow: hidden;" wrap="soft">#
 load and clean-up data
from numpy import nan
from numpy import isnan
from pandas import read_csv
from pandas import to_numeric

# fill missing values with a value at the same time one day ago
def fill_missing(values):
	one_day = 60 * 24
	for row in range(values.shape[0]):
		for col in range(values.shape[1]):
			if isnan(values[row, col]):
				values[row, col] = values[row - one_day, col]

# load all data
dataset = read_csv('household_power_consumption.txt', sep=';', header=0,
 low_memory=False, infer_datetime_format=True, 
parse_dates={'datetime':[0,1]}, index_col=['datetime'])
# mark all missing values
dataset.replace('?', nan, inplace=True)
# make dataset numeric
dataset = dataset.astype('float32')
# fill missing
fill_missing(dataset.values)
# add a column for for the remainder of sub metering
values = dataset.values
dataset['sub_metering_4'] = (values[:,0] * 1000 / 60) - (values[:,4] + 
values[:,5] + values[:,6])
# save updated dataset
dataset.to_csv('household_power_consumption.csv')</textarea></div>
			<div class="crayon-main" style="position: relative; z-index: 1; overflow: hidden;">
				<table class="crayon-table" style="">
					<tbody><tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5c08128ae92bf554906252-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c08128ae92bf554906252-2">2</div><div class="crayon-num" data-line="crayon-5c08128ae92bf554906252-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c08128ae92bf554906252-4">4</div><div class="crayon-num" data-line="crayon-5c08128ae92bf554906252-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c08128ae92bf554906252-6">6</div><div class="crayon-num" data-line="crayon-5c08128ae92bf554906252-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c08128ae92bf554906252-8">8</div><div class="crayon-num" data-line="crayon-5c08128ae92bf554906252-9">9</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c08128ae92bf554906252-10">10</div><div class="crayon-num" data-line="crayon-5c08128ae92bf554906252-11">11</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c08128ae92bf554906252-12">12</div><div class="crayon-num" data-line="crayon-5c08128ae92bf554906252-13">13</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c08128ae92bf554906252-14">14</div><div class="crayon-num" data-line="crayon-5c08128ae92bf554906252-15">15</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c08128ae92bf554906252-16">16</div><div class="crayon-num" data-line="crayon-5c08128ae92bf554906252-17">17</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c08128ae92bf554906252-18">18</div><div class="crayon-num" data-line="crayon-5c08128ae92bf554906252-19">19</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c08128ae92bf554906252-20">20</div><div class="crayon-num" data-line="crayon-5c08128ae92bf554906252-21">21</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c08128ae92bf554906252-22">22</div><div class="crayon-num" data-line="crayon-5c08128ae92bf554906252-23">23</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c08128ae92bf554906252-24">24</div><div class="crayon-num" data-line="crayon-5c08128ae92bf554906252-25">25</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c08128ae92bf554906252-26">26</div><div class="crayon-num" data-line="crayon-5c08128ae92bf554906252-27">27</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5c08128ae92bf554906252-1"><span class="crayon-p"># load and clean-up data</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c08128ae92bf554906252-2"><span class="crayon-e">from </span><span class="crayon-e">numpy </span><span class="crayon-e">import </span><span class="crayon-e">nan</span></div><div class="crayon-line" id="crayon-5c08128ae92bf554906252-3"><span class="crayon-e">from </span><span class="crayon-e">numpy </span><span class="crayon-e">import </span><span class="crayon-e">isnan</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c08128ae92bf554906252-4"><span class="crayon-e">from </span><span class="crayon-e">pandas </span><span class="crayon-e">import </span><span class="crayon-e">read_csv</span></div><div class="crayon-line" id="crayon-5c08128ae92bf554906252-5"><span class="crayon-e">from </span><span class="crayon-e">pandas </span><span class="crayon-e">import </span><span class="crayon-v">to_numeric</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c08128ae92bf554906252-6">&nbsp;</div><div class="crayon-line" id="crayon-5c08128ae92bf554906252-7"><span class="crayon-p"># fill missing values with a value at the same time one day ago</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c08128ae92bf554906252-8"><span class="crayon-e">def </span><span class="crayon-e">fill_missing</span><span class="crayon-sy">(</span><span class="crayon-v">values</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5c08128ae92bf554906252-9"><span class="crayon-h">	</span><span class="crayon-v">one_day</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-cn">60</span><span class="crayon-h"> </span><span class="crayon-o">*</span><span class="crayon-h"> </span><span class="crayon-cn">24</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c08128ae92bf554906252-10"><span class="crayon-h">	</span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-e">row </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-v">values</span><span class="crayon-sy">.</span><span class="crayon-v">shape</span><span class="crayon-sy">[</span><span class="crayon-cn">0</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5c08128ae92bf554906252-11"><span class="crayon-h">		</span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-e">col </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-v">values</span><span class="crayon-sy">.</span><span class="crayon-v">shape</span><span class="crayon-sy">[</span><span class="crayon-cn">1</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c08128ae92bf554906252-12"><span class="crayon-h">			</span><span class="crayon-st">if</span><span class="crayon-h"> </span><span class="crayon-e">isnan</span><span class="crayon-sy">(</span><span class="crayon-v">values</span><span class="crayon-sy">[</span><span class="crayon-v">row</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">col</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5c08128ae92bf554906252-13"><span class="crayon-h">				</span><span class="crayon-v">values</span><span class="crayon-sy">[</span><span class="crayon-v">row</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">col</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">values</span><span class="crayon-sy">[</span><span class="crayon-v">row</span><span class="crayon-h"> </span><span class="crayon-o">-</span><span class="crayon-h"> </span><span class="crayon-v">one_day</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">col</span><span class="crayon-sy">]</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c08128ae92bf554906252-14">&nbsp;</div><div class="crayon-line" id="crayon-5c08128ae92bf554906252-15"><span class="crayon-p"># load all data</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c08128ae92bf554906252-16"><span class="crayon-v">dataset</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">read_csv</span><span class="crayon-sy">(</span><span class="crayon-s">'household_power_consumption.txt'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">sep</span><span class="crayon-o">=</span><span class="crayon-s">';'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">header</span><span class="crayon-o">=</span><span class="crayon-cn">0</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">low_memory</span><span class="crayon-o">=</span><span class="crayon-t">False</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">infer_datetime_format</span><span class="crayon-o">=</span><span class="crayon-t">True</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">parse_dates</span><span class="crayon-o">=</span><span class="crayon-sy">{</span><span class="crayon-s">'datetime'</span><span class="crayon-o">:</span><span class="crayon-sy">[</span><span class="crayon-cn">0</span><span class="crayon-sy">,</span><span class="crayon-cn">1</span><span class="crayon-sy">]</span><span class="crayon-sy">}</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">index_col</span><span class="crayon-o">=</span><span class="crayon-sy">[</span><span class="crayon-s">'datetime'</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c08128ae92bf554906252-17"><span class="crayon-p"># mark all missing values</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c08128ae92bf554906252-18"><span class="crayon-v">dataset</span><span class="crayon-sy">.</span><span class="crayon-e">replace</span><span class="crayon-sy">(</span><span class="crayon-s">'?'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">nan</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">inplace</span><span class="crayon-o">=</span><span class="crayon-t">True</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c08128ae92bf554906252-19"><span class="crayon-p"># make dataset numeric</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c08128ae92bf554906252-20"><span class="crayon-v">dataset</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">dataset</span><span class="crayon-sy">.</span><span class="crayon-e">astype</span><span class="crayon-sy">(</span><span class="crayon-s">'float32'</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c08128ae92bf554906252-21"><span class="crayon-p"># fill missing</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c08128ae92bf554906252-22"><span class="crayon-e">fill_missing</span><span class="crayon-sy">(</span><span class="crayon-v">dataset</span><span class="crayon-sy">.</span><span class="crayon-v">values</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c08128ae92bf554906252-23"><span class="crayon-p"># add a column for for the remainder of sub metering</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c08128ae92bf554906252-24"><span class="crayon-v">values</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">dataset</span><span class="crayon-sy">.</span><span class="crayon-e">values</span></div><div class="crayon-line" id="crayon-5c08128ae92bf554906252-25"><span class="crayon-v">dataset</span><span class="crayon-sy">[</span><span class="crayon-s">'sub_metering_4'</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-v">values</span><span class="crayon-sy">[</span><span class="crayon-o">:</span><span class="crayon-sy">,</span><span class="crayon-cn">0</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-o">*</span><span class="crayon-h"> </span><span class="crayon-cn">1000</span><span class="crayon-h"> </span><span class="crayon-o">/</span><span class="crayon-h"> </span><span class="crayon-cn">60</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-o">-</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-v">values</span><span class="crayon-sy">[</span><span class="crayon-o">:</span><span class="crayon-sy">,</span><span class="crayon-cn">4</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-o">+</span><span class="crayon-h"> </span><span class="crayon-v">values</span><span class="crayon-sy">[</span><span class="crayon-o">:</span><span class="crayon-sy">,</span><span class="crayon-cn">5</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-o">+</span><span class="crayon-h"> </span><span class="crayon-v">values</span><span class="crayon-sy">[</span><span class="crayon-o">:</span><span class="crayon-sy">,</span><span class="crayon-cn">6</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c08128ae92bf554906252-26"><span class="crayon-p"># save updated dataset</span></div><div class="crayon-line" id="crayon-5c08128ae92bf554906252-27"><span class="crayon-v">dataset</span><span class="crayon-sy">.</span><span class="crayon-e">to_csv</span><span class="crayon-sy">(</span><span class="crayon-s">'household_power_consumption.csv'</span><span class="crayon-sy">)</span></div></div></td>
					</tr>
				</tbody></table>
			</div>
		</div>
<!-- [Format Time: 0.0016 seconds] -->
<p>Running the example creates the new file ‘<em>household_power_consumption.csv</em>‘ that we can use as the starting point for our modeling project.</p>
<p></p><div class="woo-sc-hr"></div><p></p>
<center>
<h3>Need help with Deep Learning for Time Series?</h3>
<p>Take my free 7-day email crash course now (with sample code).</p>
<p>Click to sign-up and also get a free PDF Ebook version of the course.</p>
<p><a href="https://machinelearningmastery.lpages.co/leadbox/14531ee73f72a2%3A164f8be4f346dc/5630742793027584/" target="_blank" style="background: rgb(255, 206, 10); color: rgb(255, 255, 255); text-decoration: none; font-family: Helvetica, Arial, sans-serif; font-weight: bold; font-size: 16px; line-height: 20px; padding: 10px; display: inline-block; max-width: 300px; border-radius: 5px; text-shadow: rgba(0, 0, 0, 0.25) 0px -1px 1px; box-shadow: rgba(255, 255, 255, 0.5) 0px 1px 3px inset, rgba(0, 0, 0, 0.5) 0px 1px 3px;" data-leadbox="https://machinelearningmastery.lpages.co/leadbox/14531ee73f72a2%3A164f8be4f346dc/5630742793027584/" data-leadbox-id="14531ee73f72a2:164f8be4f346dc">Download Your FREE Mini-Course</a><script data-leadbox="14531ee73f72a2:164f8be4f346dc" data-url="https://machinelearningmastery.lpages.co/leadbox/14531ee73f72a2%3A164f8be4f346dc/5630742793027584/" data-config="%7B%7D" type="text/javascript" src="How%20to%20Develop%20LSTM%20Models%20for%20Multi-Step%20Time%20Series%20Forecasting%20of%20Household%20Power%20Consumption_fichiers/leadbox-1534880695.js"></script></p>
</center>
<p></p><div class="woo-sc-hr"></div><p></p>
<h2>Model Evaluation</h2>
<p>In this section, we will consider how we can develop and evaluate predictive models for the household power dataset.</p>
<p>This section is divided into four parts; they are:</p>
<ol>
<li>Problem Framing</li>
<li>Evaluation Metric</li>
<li>Train and Test Sets</li>
<li>Walk-Forward Validation</li>
</ol>
<h3>Problem Framing</h3>
<p>There are many ways to harness and explore the household power consumption dataset.</p>
<p>In this tutorial, we will use the data to explore a very specific question; that is:</p>
<blockquote><p>Given recent power consumption, what is the expected power consumption for the week ahead?</p></blockquote>
<p>This requires that a predictive model forecast the total active power for each day over the next seven days.</p>
<p>Technically, this framing of the problem is referred to as a 
multi-step time series forecasting problem, given the multiple forecast 
steps. A model that makes use of multiple input variables may be 
referred to as a multivariate multi-step time series forecasting model.</p>
<p>A model of this type could be helpful within the household in 
planning expenditures. It could also be helpful on the supply side for 
planning electricity demand for a specific household.</p>
<p>This framing of the dataset also suggests that it would be useful to 
downsample the per-minute observations of power consumption to daily 
totals. This is not required, but makes sense, given that we are 
interested in total power per day.</p>
<p>We can achieve this easily using the <a href="https://pandas.pydata.org/pandas-docs/stable/generated/pandas.DataFrame.resample.html">resample() function</a> on the pandas DataFrame. Calling this function with the argument ‘<em>D</em>‘ allows the loaded data indexed by date-time to be grouped by day (<a href="http://pandas.pydata.org/pandas-docs/stable/timeseries.html#offset-aliases">see all offset aliases</a>).
 We can then calculate the sum of all observations for each day and 
create a new dataset of daily power consumption data for each of the 
eight variables.</p>
<p>The complete example is listed below.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->

		<div id="crayon-5c08128ae92c1102300243" class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" style="margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important; height: auto;">
		
			<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important; height: 18px !important; line-height: 18px !important; margin-top: -19px; display: none; position: absolute; z-index: 2;"><span class="crayon-title"></span>
			<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button crayon-pressed" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
			<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
			<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="readonly" style="-moz-tab-size: 4; font-size: 12px !important; line-height: 15px !important; z-index: 0; opacity: 0; overflow: hidden;" wrap="soft">#
 resample minute data to total for each day
from pandas import read_csv
# load the new file
dataset = read_csv('household_power_consumption.csv', header=0, 
infer_datetime_format=True, parse_dates=['datetime'], 
index_col=['datetime'])
# resample data to daily
daily_groups = dataset.resample('D')
daily_data = daily_groups.sum()
# summarize
print(daily_data.shape)
print(daily_data.head())
# save
daily_data.to_csv('household_power_consumption_days.csv')</textarea></div>
			<div class="crayon-main" style="position: relative; z-index: 1; overflow: hidden;">
				<table class="crayon-table" style="">
					<tbody><tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5c08128ae92c1102300243-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c08128ae92c1102300243-2">2</div><div class="crayon-num" data-line="crayon-5c08128ae92c1102300243-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c08128ae92c1102300243-4">4</div><div class="crayon-num" data-line="crayon-5c08128ae92c1102300243-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c08128ae92c1102300243-6">6</div><div class="crayon-num" data-line="crayon-5c08128ae92c1102300243-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c08128ae92c1102300243-8">8</div><div class="crayon-num" data-line="crayon-5c08128ae92c1102300243-9">9</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c08128ae92c1102300243-10">10</div><div class="crayon-num" data-line="crayon-5c08128ae92c1102300243-11">11</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c08128ae92c1102300243-12">12</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5c08128ae92c1102300243-1"><span class="crayon-p"># resample minute data to total for each day</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c08128ae92c1102300243-2"><span class="crayon-e">from </span><span class="crayon-e">pandas </span><span class="crayon-e">import </span><span class="crayon-v">read_csv</span></div><div class="crayon-line" id="crayon-5c08128ae92c1102300243-3"><span class="crayon-p"># load the new file</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c08128ae92c1102300243-4"><span class="crayon-v">dataset</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">read_csv</span><span class="crayon-sy">(</span><span class="crayon-s">'household_power_consumption.csv'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">header</span><span class="crayon-o">=</span><span class="crayon-cn">0</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">infer_datetime_format</span><span class="crayon-o">=</span><span class="crayon-t">True</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">parse_dates</span><span class="crayon-o">=</span><span class="crayon-sy">[</span><span class="crayon-s">'datetime'</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">index_col</span><span class="crayon-o">=</span><span class="crayon-sy">[</span><span class="crayon-s">'datetime'</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c08128ae92c1102300243-5"><span class="crayon-p"># resample data to daily</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c08128ae92c1102300243-6"><span class="crayon-v">daily_groups</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">dataset</span><span class="crayon-sy">.</span><span class="crayon-e">resample</span><span class="crayon-sy">(</span><span class="crayon-s">'D'</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c08128ae92c1102300243-7"><span class="crayon-v">daily_data</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">daily_groups</span><span class="crayon-sy">.</span><span class="crayon-e">sum</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c08128ae92c1102300243-8"><span class="crayon-p"># summarize</span></div><div class="crayon-line" id="crayon-5c08128ae92c1102300243-9"><span class="crayon-e">print</span><span class="crayon-sy">(</span><span class="crayon-v">daily_data</span><span class="crayon-sy">.</span><span class="crayon-v">shape</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c08128ae92c1102300243-10"><span class="crayon-e">print</span><span class="crayon-sy">(</span><span class="crayon-v">daily_data</span><span class="crayon-sy">.</span><span class="crayon-e">head</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c08128ae92c1102300243-11"><span class="crayon-p"># save</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c08128ae92c1102300243-12"><span class="crayon-v">daily_data</span><span class="crayon-sy">.</span><span class="crayon-e">to_csv</span><span class="crayon-sy">(</span><span class="crayon-s">'household_power_consumption_days.csv'</span><span class="crayon-sy">)</span></div></div></td>
					</tr>
				</tbody></table>
			</div>
		</div>
<!-- [Format Time: 0.0006 seconds] -->
<p>Running the example creates a new daily total power consumption dataset and saves the result into a separate file named ‘<em>household_power_consumption_days.csv</em>‘.</p>
<p>We can use this as the dataset for fitting and evaluating predictive models for the chosen framing of the problem.</p>
<h3>Evaluation Metric</h3>
<p>A forecast will be comprised of seven values, one for each day of the week ahead.</p>
<p>It is common with multi-step forecasting problems to evaluate each 
forecasted time step separately. This is helpful for a few reasons:</p>
<ul>
<li>To comment on the skill at a specific lead time (e.g. +1 day vs +3 days).</li>
<li>To contrast models based on their skills at different lead times (e.g. models good at +1 day vs models good at days +5).</li>
</ul>
<p>The units of the total power are kilowatts and it would be useful to 
have an error metric that was also in the same units. Both Root Mean 
Squared Error (RMSE) and Mean Absolute Error (MAE) fit this bill, 
although RMSE is more commonly used and will be adopted in this 
tutorial. Unlike MAE, RMSE is more punishing of forecast errors.</p>
<p>The performance metric for this problem will be the RMSE for each lead time from day 1 to day 7.</p>
<p>As a short-cut, it may be useful to summarize the performance of a 
model using a single score in order to aide in model selection.</p>
<p>One possible score that could be used would be the RMSE across all forecast days.</p>
<p>The function <em>evaluate_forecasts()</em> below will implement this behavior and return the performance of a model based on multiple seven-day forecasts.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->

		<div id="crayon-5c08128ae92c5947707184" class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" style="margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important; height: auto;">
		
			<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important; height: 18px !important; line-height: 18px !important; margin-top: -19px; display: none; position: absolute; z-index: 2;"><span class="crayon-title"></span>
			<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button crayon-pressed" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code" style="display: none;"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
			<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
			<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="readonly" style="-moz-tab-size: 4; font-size: 12px !important; line-height: 15px !important; z-index: 0; opacity: 0; overflow: hidden;" wrap="soft"># evaluate one or more weekly forecasts against expected values
def evaluate_forecasts(actual, predicted):
	scores = list()
	# calculate an RMSE score for each day
	for i in range(actual.shape[1]):
		# calculate mse
		mse = mean_squared_error(actual[:, i], predicted[:, i])
		# calculate rmse
		rmse = sqrt(mse)
		# store
		scores.append(rmse)
	# calculate overall RMSE
	s = 0
	for row in range(actual.shape[0]):
		for col in range(actual.shape[1]):
			s += (actual[row, col] - predicted[row, col])**2
	score = sqrt(s / (actual.shape[0] * actual.shape[1]))
	return score, scores</textarea></div>
			<div class="crayon-main" style="position: relative; z-index: 1; overflow: hidden;">
				<table class="crayon-table" style="">
					<tbody><tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5c08128ae92c5947707184-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c08128ae92c5947707184-2">2</div><div class="crayon-num" data-line="crayon-5c08128ae92c5947707184-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c08128ae92c5947707184-4">4</div><div class="crayon-num" data-line="crayon-5c08128ae92c5947707184-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c08128ae92c5947707184-6">6</div><div class="crayon-num" data-line="crayon-5c08128ae92c5947707184-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c08128ae92c5947707184-8">8</div><div class="crayon-num" data-line="crayon-5c08128ae92c5947707184-9">9</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c08128ae92c5947707184-10">10</div><div class="crayon-num" data-line="crayon-5c08128ae92c5947707184-11">11</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c08128ae92c5947707184-12">12</div><div class="crayon-num" data-line="crayon-5c08128ae92c5947707184-13">13</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c08128ae92c5947707184-14">14</div><div class="crayon-num" data-line="crayon-5c08128ae92c5947707184-15">15</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c08128ae92c5947707184-16">16</div><div class="crayon-num" data-line="crayon-5c08128ae92c5947707184-17">17</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c08128ae92c5947707184-18">18</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5c08128ae92c5947707184-1"><span class="crayon-p"># evaluate one or more weekly forecasts against expected values</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c08128ae92c5947707184-2"><span class="crayon-e">def </span><span class="crayon-e">evaluate_forecasts</span><span class="crayon-sy">(</span><span class="crayon-v">actual</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">predicted</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5c08128ae92c5947707184-3"><span class="crayon-h">	</span><span class="crayon-v">scores</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">list</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c08128ae92c5947707184-4"><span class="crayon-h">	</span><span class="crayon-p"># calculate an RMSE score for each day</span></div><div class="crayon-line" id="crayon-5c08128ae92c5947707184-5"><span class="crayon-h">	</span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">i</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-v">actual</span><span class="crayon-sy">.</span><span class="crayon-v">shape</span><span class="crayon-sy">[</span><span class="crayon-cn">1</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c08128ae92c5947707184-6"><span class="crayon-h">		</span><span class="crayon-p"># calculate mse</span></div><div class="crayon-line" id="crayon-5c08128ae92c5947707184-7"><span class="crayon-h">		</span><span class="crayon-v">mse</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">mean_squared_error</span><span class="crayon-sy">(</span><span class="crayon-v">actual</span><span class="crayon-sy">[</span><span class="crayon-o">:</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">i</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">predicted</span><span class="crayon-sy">[</span><span class="crayon-o">:</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">i</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c08128ae92c5947707184-8"><span class="crayon-h">		</span><span class="crayon-p"># calculate rmse</span></div><div class="crayon-line" id="crayon-5c08128ae92c5947707184-9"><span class="crayon-h">		</span><span class="crayon-v">rmse</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">sqrt</span><span class="crayon-sy">(</span><span class="crayon-v">mse</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c08128ae92c5947707184-10"><span class="crayon-h">		</span><span class="crayon-p"># store</span></div><div class="crayon-line" id="crayon-5c08128ae92c5947707184-11"><span class="crayon-h">		</span><span class="crayon-v">scores</span><span class="crayon-sy">.</span><span class="crayon-e">append</span><span class="crayon-sy">(</span><span class="crayon-v">rmse</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c08128ae92c5947707184-12"><span class="crayon-h">	</span><span class="crayon-p"># calculate overall RMSE</span></div><div class="crayon-line" id="crayon-5c08128ae92c5947707184-13"><span class="crayon-h">	</span><span class="crayon-v">s</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-cn">0</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c08128ae92c5947707184-14"><span class="crayon-h">	</span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-e">row </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-v">actual</span><span class="crayon-sy">.</span><span class="crayon-v">shape</span><span class="crayon-sy">[</span><span class="crayon-cn">0</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5c08128ae92c5947707184-15"><span class="crayon-h">		</span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-e">col </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-v">actual</span><span class="crayon-sy">.</span><span class="crayon-v">shape</span><span class="crayon-sy">[</span><span class="crayon-cn">1</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c08128ae92c5947707184-16"><span class="crayon-h">			</span><span class="crayon-v">s</span><span class="crayon-h"> </span><span class="crayon-o">+=</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-v">actual</span><span class="crayon-sy">[</span><span class="crayon-v">row</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">col</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-o">-</span><span class="crayon-h"> </span><span class="crayon-v">predicted</span><span class="crayon-sy">[</span><span class="crayon-v">row</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">col</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span><span class="crayon-o">*</span><span class="crayon-o">*</span><span class="crayon-cn">2</span></div><div class="crayon-line" id="crayon-5c08128ae92c5947707184-17"><span class="crayon-h">	</span><span class="crayon-v">score</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">sqrt</span><span class="crayon-sy">(</span><span class="crayon-v">s</span><span class="crayon-h"> </span><span class="crayon-o">/</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-v">actual</span><span class="crayon-sy">.</span><span class="crayon-v">shape</span><span class="crayon-sy">[</span><span class="crayon-cn">0</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-o">*</span><span class="crayon-h"> </span><span class="crayon-v">actual</span><span class="crayon-sy">.</span><span class="crayon-v">shape</span><span class="crayon-sy">[</span><span class="crayon-cn">1</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c08128ae92c5947707184-18"><span class="crayon-h">	</span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">score</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">scores</span></div></div></td>
					</tr>
				</tbody></table>
			</div>
		</div>
<!-- [Format Time: 0.0013 seconds] -->
<p>Running the function will first return the overall RMSE regardless of day, then an array of RMSE scores for each day.</p>
<h3>Train and Test Sets</h3>
<p>We will use the first three years of data for training predictive models and the final year for evaluating models.</p>
<p>The data in a given dataset will be divided into standard weeks. These are weeks that begin on a Sunday and end on a Saturday.</p>
<p>This is a realistic and useful way for using the chosen framing of 
the model, where the power consumption for the week ahead can be 
predicted. It is also helpful with modeling, where models can be used to
 predict a specific day (e.g. Wednesday) or the entire sequence.</p>
<p>We will split the data into standard weeks, working backwards from the test dataset.</p>
<p>The final year of the data is in 2010 and the first Sunday for 2010 
was January 3rd. The data ends in mid November 2010 and the closest 
final Saturday in the data is November 20th. This gives 46 weeks of test
 data.</p>
<p>The first and last rows of daily data for the test dataset are provided below for confirmation.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->

		<div id="crayon-5c08128ae92c7698219016" class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" style="margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important; height: auto;">
		
			<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important; height: 18px !important; line-height: 18px !important; margin-top: -19px; display: none; position: absolute; z-index: 2;"><span class="crayon-title"></span>
			<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button crayon-pressed" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
			<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
			<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="readonly" style="-moz-tab-size: 4; font-size: 12px !important; line-height: 15px !important; z-index: 0; opacity: 0; overflow: hidden;" wrap="soft">2010-01-03,2083.4539999999984,191.61000000000055,350992.12000000034,8703.600000000033,3842.0,4920.0,10074.0,15888.233355799992
...
2010-11-20,2197.006000000004,153.76800000000028,346475.9999999998,9320.20000000002,4367.0,2947.0,11433.0,17869.76663959999</textarea></div>
			<div class="crayon-main" style="position: relative; z-index: 1; overflow: hidden;">
				<table class="crayon-table" style="">
					<tbody><tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5c08128ae92c7698219016-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c08128ae92c7698219016-2">2</div><div class="crayon-num" data-line="crayon-5c08128ae92c7698219016-3">3</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5c08128ae92c7698219016-1">2010-01-03,2083.4539999999984,191.61000000000055,350992.12000000034,8703.600000000033,3842.0,4920.0,10074.0,15888.233355799992</div><div class="crayon-line crayon-striped-line" id="crayon-5c08128ae92c7698219016-2">...</div><div class="crayon-line" id="crayon-5c08128ae92c7698219016-3">2010-11-20,2197.006000000004,153.76800000000028,346475.9999999998,9320.20000000002,4367.0,2947.0,11433.0,17869.76663959999</div></div></td>
					</tr>
				</tbody></table>
			</div>
		</div>
<!-- [Format Time: 0.0000 seconds] -->
<p>The daily data starts in late 2006.</p>
<p>The first Sunday in the dataset is December 17th, which is the second row of data.</p>
<p>Organizing the data into standard weeks gives 159 full standard weeks for training a predictive model.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->

		<div id="crayon-5c08128ae92c9952954148" class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" style="margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important; height: auto;">
		
			<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important; height: 18px !important; line-height: 18px !important; margin-top: -19px; display: none; position: absolute; z-index: 2;"><span class="crayon-title"></span>
			<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button crayon-pressed" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
			<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
			<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="readonly" style="-moz-tab-size: 4; font-size: 12px !important; line-height: 15px !important; z-index: 0; opacity: 0; overflow: hidden;" wrap="soft">2006-12-17,3390.46,226.0059999999994,345725.32000000024,14398.59999999998,2033.0,4187.0,13341.0,36946.66673200004
...
2010-01-02,1309.2679999999998,199.54600000000016,352332.8399999997,5489.7999999999865,801.0,298.0,6425.0,14297.133406600002</textarea></div>
			<div class="crayon-main" style="position: relative; z-index: 1; overflow: hidden;">
				<table class="crayon-table" style="">
					<tbody><tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5c08128ae92c9952954148-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c08128ae92c9952954148-2">2</div><div class="crayon-num" data-line="crayon-5c08128ae92c9952954148-3">3</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5c08128ae92c9952954148-1">2006-12-17,3390.46,226.0059999999994,345725.32000000024,14398.59999999998,2033.0,4187.0,13341.0,36946.66673200004</div><div class="crayon-line crayon-striped-line" id="crayon-5c08128ae92c9952954148-2">...</div><div class="crayon-line" id="crayon-5c08128ae92c9952954148-3">2010-01-02,1309.2679999999998,199.54600000000016,352332.8399999997,5489.7999999999865,801.0,298.0,6425.0,14297.133406600002</div></div></td>
					</tr>
				</tbody></table>
			</div>
		</div>
<!-- [Format Time: 0.0000 seconds] -->
<p>The function <em>split_dataset()</em> below splits the daily data into train and test sets and organizes each into standard weeks.</p>
<p>Specific row offsets are used to split the data using knowledge of 
the dataset. The split datasets are then organized into weekly data 
using the NumPy <a href="https://docs.scipy.org/doc/numpy/reference/generated/numpy.split.html">split() function</a>.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->

		<div id="crayon-5c08128ae92cb205762596" class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" style="margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important; height: auto;">
		
			<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important; height: 18px !important; line-height: 18px !important; margin-top: -19px; display: none; position: absolute; z-index: 2;"><span class="crayon-title"></span>
			<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button crayon-pressed" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code" style="display: none;"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
			<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
			<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="readonly" style="-moz-tab-size: 4; font-size: 12px !important; line-height: 15px !important; z-index: 0; opacity: 0; overflow: hidden;" wrap="soft"># split a univariate dataset into train/test sets
def split_dataset(data):
	# split into standard weeks
	train, test = data[1:-328], data[-328:-6]
	# restructure into windows of weekly data
	train = array(split(train, len(train)/7))
	test = array(split(test, len(test)/7))
	return train, test</textarea></div>
			<div class="crayon-main" style="position: relative; z-index: 1; overflow: hidden;">
				<table class="crayon-table" style="">
					<tbody><tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5c08128ae92cb205762596-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c08128ae92cb205762596-2">2</div><div class="crayon-num" data-line="crayon-5c08128ae92cb205762596-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c08128ae92cb205762596-4">4</div><div class="crayon-num" data-line="crayon-5c08128ae92cb205762596-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c08128ae92cb205762596-6">6</div><div class="crayon-num" data-line="crayon-5c08128ae92cb205762596-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c08128ae92cb205762596-8">8</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5c08128ae92cb205762596-1"><span class="crayon-p"># split a univariate dataset into train/test sets</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c08128ae92cb205762596-2"><span class="crayon-e">def </span><span class="crayon-e">split_dataset</span><span class="crayon-sy">(</span><span class="crayon-v">data</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5c08128ae92cb205762596-3"><span class="crayon-h">	</span><span class="crayon-p"># split into standard weeks</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c08128ae92cb205762596-4"><span class="crayon-h">	</span><span class="crayon-v">train</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">test</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">data</span><span class="crayon-sy">[</span><span class="crayon-cn">1</span><span class="crayon-o">:</span><span class="crayon-o">-</span><span class="crayon-cn">328</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">data</span><span class="crayon-sy">[</span><span class="crayon-o">-</span><span class="crayon-cn">328</span><span class="crayon-o">:</span><span class="crayon-o">-</span><span class="crayon-cn">6</span><span class="crayon-sy">]</span></div><div class="crayon-line" id="crayon-5c08128ae92cb205762596-5"><span class="crayon-h">	</span><span class="crayon-p"># restructure into windows of weekly data</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c08128ae92cb205762596-6"><span class="crayon-h">	</span><span class="crayon-v">train</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-t">array</span><span class="crayon-sy">(</span><span class="crayon-e">split</span><span class="crayon-sy">(</span><span class="crayon-v">train</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-e">len</span><span class="crayon-sy">(</span><span class="crayon-v">train</span><span class="crayon-sy">)</span><span class="crayon-o">/</span><span class="crayon-cn">7</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c08128ae92cb205762596-7"><span class="crayon-h">	</span><span class="crayon-v">test</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-t">array</span><span class="crayon-sy">(</span><span class="crayon-e">split</span><span class="crayon-sy">(</span><span class="crayon-v">test</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-e">len</span><span class="crayon-sy">(</span><span class="crayon-v">test</span><span class="crayon-sy">)</span><span class="crayon-o">/</span><span class="crayon-cn">7</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c08128ae92cb205762596-8"><span class="crayon-h">	</span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">train</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">test</span></div></div></td>
					</tr>
				</tbody></table>
			</div>
		</div>
<!-- [Format Time: 0.0006 seconds] -->
<p>We can test this function out by loading the daily dataset and 
printing the first and last rows of data from both the train and test 
sets to confirm they match the expectations above.</p>
<p>The complete code example is listed below.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->

		<div id="crayon-5c08128ae92cd872314126" class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" style="margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important; height: auto;">
		
			<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important; height: 18px !important; line-height: 18px !important; margin-top: -19px; display: none; position: absolute; z-index: 2;"><span class="crayon-title"></span>
			<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button crayon-pressed" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
			<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
			<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="readonly" style="-moz-tab-size: 4; font-size: 12px !important; line-height: 15px !important; z-index: 0; opacity: 0; overflow: hidden;" wrap="soft">#
 split into standard weeks
from numpy import split
from numpy import array
from pandas import read_csv

# split a univariate dataset into train/test sets
def split_dataset(data):
	# split into standard weeks
	train, test = data[1:-328], data[-328:-6]
	# restructure into windows of weekly data
	train = array(split(train, len(train)/7))
	test = array(split(test, len(test)/7))
	return train, test

# load the new file
dataset = read_csv('household_power_consumption_days.csv', header=0, 
infer_datetime_format=True, parse_dates=['datetime'], 
index_col=['datetime'])
train, test = split_dataset(dataset.values)
# validate train data
print(train.shape)
print(train[0, 0, 0], train[-1, -1, 0])
# validate test
print(test.shape)
print(test[0, 0, 0], test[-1, -1, 0])</textarea></div>
			<div class="crayon-main" style="position: relative; z-index: 1; overflow: hidden;">
				<table class="crayon-table" style="">
					<tbody><tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5c08128ae92cd872314126-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c08128ae92cd872314126-2">2</div><div class="crayon-num" data-line="crayon-5c08128ae92cd872314126-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c08128ae92cd872314126-4">4</div><div class="crayon-num" data-line="crayon-5c08128ae92cd872314126-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c08128ae92cd872314126-6">6</div><div class="crayon-num" data-line="crayon-5c08128ae92cd872314126-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c08128ae92cd872314126-8">8</div><div class="crayon-num" data-line="crayon-5c08128ae92cd872314126-9">9</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c08128ae92cd872314126-10">10</div><div class="crayon-num" data-line="crayon-5c08128ae92cd872314126-11">11</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c08128ae92cd872314126-12">12</div><div class="crayon-num" data-line="crayon-5c08128ae92cd872314126-13">13</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c08128ae92cd872314126-14">14</div><div class="crayon-num" data-line="crayon-5c08128ae92cd872314126-15">15</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c08128ae92cd872314126-16">16</div><div class="crayon-num" data-line="crayon-5c08128ae92cd872314126-17">17</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c08128ae92cd872314126-18">18</div><div class="crayon-num" data-line="crayon-5c08128ae92cd872314126-19">19</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c08128ae92cd872314126-20">20</div><div class="crayon-num" data-line="crayon-5c08128ae92cd872314126-21">21</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c08128ae92cd872314126-22">22</div><div class="crayon-num" data-line="crayon-5c08128ae92cd872314126-23">23</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5c08128ae92cd872314126-1"><span class="crayon-p"># split into standard weeks</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c08128ae92cd872314126-2"><span class="crayon-e">from </span><span class="crayon-e">numpy </span><span class="crayon-e">import </span><span class="crayon-e">split</span></div><div class="crayon-line" id="crayon-5c08128ae92cd872314126-3"><span class="crayon-e">from </span><span class="crayon-e">numpy </span><span class="crayon-e">import </span><span class="crayon-t">array</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c08128ae92cd872314126-4"><span class="crayon-e">from </span><span class="crayon-e">pandas </span><span class="crayon-e">import </span><span class="crayon-v">read_csv</span></div><div class="crayon-line" id="crayon-5c08128ae92cd872314126-5">&nbsp;</div><div class="crayon-line crayon-striped-line" id="crayon-5c08128ae92cd872314126-6"><span class="crayon-p"># split a univariate dataset into train/test sets</span></div><div class="crayon-line" id="crayon-5c08128ae92cd872314126-7"><span class="crayon-e">def </span><span class="crayon-e">split_dataset</span><span class="crayon-sy">(</span><span class="crayon-v">data</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c08128ae92cd872314126-8"><span class="crayon-h">	</span><span class="crayon-p"># split into standard weeks</span></div><div class="crayon-line" id="crayon-5c08128ae92cd872314126-9"><span class="crayon-h">	</span><span class="crayon-v">train</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">test</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">data</span><span class="crayon-sy">[</span><span class="crayon-cn">1</span><span class="crayon-o">:</span><span class="crayon-o">-</span><span class="crayon-cn">328</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">data</span><span class="crayon-sy">[</span><span class="crayon-o">-</span><span class="crayon-cn">328</span><span class="crayon-o">:</span><span class="crayon-o">-</span><span class="crayon-cn">6</span><span class="crayon-sy">]</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c08128ae92cd872314126-10"><span class="crayon-h">	</span><span class="crayon-p"># restructure into windows of weekly data</span></div><div class="crayon-line" id="crayon-5c08128ae92cd872314126-11"><span class="crayon-h">	</span><span class="crayon-v">train</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-t">array</span><span class="crayon-sy">(</span><span class="crayon-e">split</span><span class="crayon-sy">(</span><span class="crayon-v">train</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-e">len</span><span class="crayon-sy">(</span><span class="crayon-v">train</span><span class="crayon-sy">)</span><span class="crayon-o">/</span><span class="crayon-cn">7</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c08128ae92cd872314126-12"><span class="crayon-h">	</span><span class="crayon-v">test</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-t">array</span><span class="crayon-sy">(</span><span class="crayon-e">split</span><span class="crayon-sy">(</span><span class="crayon-v">test</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-e">len</span><span class="crayon-sy">(</span><span class="crayon-v">test</span><span class="crayon-sy">)</span><span class="crayon-o">/</span><span class="crayon-cn">7</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c08128ae92cd872314126-13"><span class="crayon-h">	</span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">train</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">test</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c08128ae92cd872314126-14">&nbsp;</div><div class="crayon-line" id="crayon-5c08128ae92cd872314126-15"><span class="crayon-p"># load the new file</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c08128ae92cd872314126-16"><span class="crayon-v">dataset</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">read_csv</span><span class="crayon-sy">(</span><span class="crayon-s">'household_power_consumption_days.csv'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">header</span><span class="crayon-o">=</span><span class="crayon-cn">0</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">infer_datetime_format</span><span class="crayon-o">=</span><span class="crayon-t">True</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">parse_dates</span><span class="crayon-o">=</span><span class="crayon-sy">[</span><span class="crayon-s">'datetime'</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">index_col</span><span class="crayon-o">=</span><span class="crayon-sy">[</span><span class="crayon-s">'datetime'</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c08128ae92cd872314126-17"><span class="crayon-v">train</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">test</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">split_dataset</span><span class="crayon-sy">(</span><span class="crayon-v">dataset</span><span class="crayon-sy">.</span><span class="crayon-v">values</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c08128ae92cd872314126-18"><span class="crayon-p"># validate train data</span></div><div class="crayon-line" id="crayon-5c08128ae92cd872314126-19"><span class="crayon-e">print</span><span class="crayon-sy">(</span><span class="crayon-v">train</span><span class="crayon-sy">.</span><span class="crayon-v">shape</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c08128ae92cd872314126-20"><span class="crayon-e">print</span><span class="crayon-sy">(</span><span class="crayon-v">train</span><span class="crayon-sy">[</span><span class="crayon-cn">0</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">0</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">0</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">train</span><span class="crayon-sy">[</span><span class="crayon-o">-</span><span class="crayon-cn">1</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-o">-</span><span class="crayon-cn">1</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">0</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c08128ae92cd872314126-21"><span class="crayon-p"># validate test</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c08128ae92cd872314126-22"><span class="crayon-e">print</span><span class="crayon-sy">(</span><span class="crayon-v">test</span><span class="crayon-sy">.</span><span class="crayon-v">shape</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c08128ae92cd872314126-23"><span class="crayon-e">print</span><span class="crayon-sy">(</span><span class="crayon-v">test</span><span class="crayon-sy">[</span><span class="crayon-cn">0</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">0</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">0</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">test</span><span class="crayon-sy">[</span><span class="crayon-o">-</span><span class="crayon-cn">1</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-o">-</span><span class="crayon-cn">1</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">0</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span></div></div></td>
					</tr>
				</tbody></table>
			</div>
		</div>
<!-- [Format Time: 0.0015 seconds] -->
<p>Running the example shows that indeed the train dataset has 159 weeks of data, whereas the test dataset has 46 weeks.</p>
<p>We can see that the total active power for the train and test dataset
 for the first and last rows match the data for the specific dates that 
we defined as the bounds on the standard weeks for each set.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->

		<div id="crayon-5c08128ae92cf871735827" class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" style="margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important; height: auto;">
		
			<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important; height: 18px !important; line-height: 18px !important; margin-top: -19px; display: none; position: absolute; z-index: 2;"><span class="crayon-title"></span>
			<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button crayon-pressed" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code" style="display: none;"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
			<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
			<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="readonly" style="-moz-tab-size: 4; font-size: 12px !important; line-height: 15px !important; z-index: 0; opacity: 0; overflow: hidden;" wrap="soft">(159, 7, 8)
3390.46 1309.2679999999998
(46, 7, 8)
2083.4539999999984 2197.006000000004</textarea></div>
			<div class="crayon-main" style="position: relative; z-index: 1; overflow: hidden;">
				<table class="crayon-table" style="">
					<tbody><tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5c08128ae92cf871735827-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c08128ae92cf871735827-2">2</div><div class="crayon-num" data-line="crayon-5c08128ae92cf871735827-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c08128ae92cf871735827-4">4</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5c08128ae92cf871735827-1">(159, 7, 8)</div><div class="crayon-line crayon-striped-line" id="crayon-5c08128ae92cf871735827-2">3390.46 1309.2679999999998</div><div class="crayon-line" id="crayon-5c08128ae92cf871735827-3">(46, 7, 8)</div><div class="crayon-line crayon-striped-line" id="crayon-5c08128ae92cf871735827-4">2083.4539999999984 2197.006000000004</div></div></td>
					</tr>
				</tbody></table>
			</div>
		</div>
<!-- [Format Time: 0.0000 seconds] -->
<p></p>
<h3>Walk-Forward Validation</h3>
<p>Models will be evaluated using a scheme called <a href="https://machinelearningmastery.com/backtest-machine-learning-models-time-series-forecasting/">walk-forward validation</a>.</p>
<p>This is where a model is required to make a one week prediction, then
 the actual data for that week is made available to the model so that it
 can be used as the basis for making a prediction on the subsequent 
week. This is both realistic for how the model may be used in practice 
and beneficial to the models allowing them to make use of the best 
available data.</p>
<p>We can demonstrate this below with separation of input data and output/predicted data.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->

		<div id="crayon-5c08128ae92d1390900379" class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" style="margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important; height: auto;">
		
			<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important; height: 18px !important; line-height: 18px !important; margin-top: -19px; display: none; position: absolute; z-index: 2;"><span class="crayon-title"></span>
			<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button crayon-pressed" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code" style="display: none;"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
			<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
			<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="readonly" style="-moz-tab-size: 4; font-size: 12px !important; line-height: 15px !important; z-index: 0; opacity: 0; overflow: hidden;" wrap="soft">Input, 						Predict
[Week1]						Week2
[Week1 + Week2]				Week3
[Week1 + Week2 + Week3]		Week4
...</textarea></div>
			<div class="crayon-main" style="position: relative; z-index: 1; overflow: hidden;">
				<table class="crayon-table" style="">
					<tbody><tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5c08128ae92d1390900379-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c08128ae92d1390900379-2">2</div><div class="crayon-num" data-line="crayon-5c08128ae92d1390900379-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c08128ae92d1390900379-4">4</div><div class="crayon-num" data-line="crayon-5c08128ae92d1390900379-5">5</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5c08128ae92d1390900379-1">Input, 						Predict</div><div class="crayon-line crayon-striped-line" id="crayon-5c08128ae92d1390900379-2">[Week1]						Week2</div><div class="crayon-line" id="crayon-5c08128ae92d1390900379-3">[Week1 + Week2]				Week3</div><div class="crayon-line crayon-striped-line" id="crayon-5c08128ae92d1390900379-4">[Week1 + Week2 + Week3]		Week4</div><div class="crayon-line" id="crayon-5c08128ae92d1390900379-5">...</div></div></td>
					</tr>
				</tbody></table>
			</div>
		</div>
<!-- [Format Time: 0.0001 seconds] -->
<p>The walk-forward validation approach to evaluating predictive models on this dataset is provided below named <em>evaluate_model()</em>.</p>
<p>The train and test datasets in standard-week format are provided to 
the function as arguments. An additional argument n_input is provided 
that is used to define the number of prior observations that the model 
will use as input in order to make a prediction.</p>
<p>Two new functions are called: one to build a model from the training data called <em>build_model()</em> and another that uses the model to make forecasts for each new standard week called <em>forecast()</em>. These will be covered in subsequent sections.</p>
<p>We are working with neural networks, and as such, they are generally 
slow to train but fast to evaluate. This means that the preferred usage 
of the models is to build them once on historical data and to use them 
to forecast each step of the walk-forward validation. The models are 
static (i.e. not updated) during their evaluation.</p>
<p>This is different to other models that are faster to train where a 
model may be re-fit or updated each step of the walk-forward validation 
as new data is made available. With sufficient resources, it is possible
 to use neural networks this way, but we will not in this tutorial.</p>
<p>The complete <em>evaluate_model()</em> function is listed below.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->

		<div id="crayon-5c08128ae92d3182498043" class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" style="margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important; height: auto;">
		
			<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important; height: 18px !important; line-height: 18px !important; margin-top: -19px; display: none; position: absolute; z-index: 2;"><span class="crayon-title"></span>
			<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button crayon-pressed" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code" style="display: none;"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
			<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
			<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="readonly" style="-moz-tab-size: 4; font-size: 12px !important; line-height: 15px !important; z-index: 0; opacity: 0; overflow: hidden;" wrap="soft"># evaluate a single model
def evaluate_model(train, test, n_input):
	# fit model
	model = build_model(train, n_input)
	# history is a list of weekly data
	history = [x for x in train]
	# walk-forward validation over each week
	predictions = list()
	for i in range(len(test)):
		# predict the week
		yhat_sequence = forecast(model, history, n_input)
		# store the predictions
		predictions.append(yhat_sequence)
		# get real observation and add to history for predicting the next week
		history.append(test[i, :])
	# evaluate predictions days for each week
	predictions = array(predictions)
	score, scores = evaluate_forecasts(test[:, :, 0], predictions)
	return score, scores</textarea></div>
			<div class="crayon-main" style="position: relative; z-index: 1; overflow: hidden;">
				<table class="crayon-table" style="">
					<tbody><tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5c08128ae92d3182498043-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c08128ae92d3182498043-2">2</div><div class="crayon-num" data-line="crayon-5c08128ae92d3182498043-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c08128ae92d3182498043-4">4</div><div class="crayon-num" data-line="crayon-5c08128ae92d3182498043-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c08128ae92d3182498043-6">6</div><div class="crayon-num" data-line="crayon-5c08128ae92d3182498043-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c08128ae92d3182498043-8">8</div><div class="crayon-num" data-line="crayon-5c08128ae92d3182498043-9">9</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c08128ae92d3182498043-10">10</div><div class="crayon-num" data-line="crayon-5c08128ae92d3182498043-11">11</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c08128ae92d3182498043-12">12</div><div class="crayon-num" data-line="crayon-5c08128ae92d3182498043-13">13</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c08128ae92d3182498043-14">14</div><div class="crayon-num" data-line="crayon-5c08128ae92d3182498043-15">15</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c08128ae92d3182498043-16">16</div><div class="crayon-num" data-line="crayon-5c08128ae92d3182498043-17">17</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c08128ae92d3182498043-18">18</div><div class="crayon-num" data-line="crayon-5c08128ae92d3182498043-19">19</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5c08128ae92d3182498043-1"><span class="crayon-p"># evaluate a single model</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c08128ae92d3182498043-2"><span class="crayon-e">def </span><span class="crayon-e">evaluate_model</span><span class="crayon-sy">(</span><span class="crayon-v">train</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">test</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_input</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5c08128ae92d3182498043-3"><span class="crayon-h">	</span><span class="crayon-p"># fit model</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c08128ae92d3182498043-4"><span class="crayon-h">	</span><span class="crayon-v">model</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">build_model</span><span class="crayon-sy">(</span><span class="crayon-v">train</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_input</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c08128ae92d3182498043-5"><span class="crayon-h">	</span><span class="crayon-p"># history is a list of weekly data</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c08128ae92d3182498043-6"><span class="crayon-h">	</span><span class="crayon-v">history</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-i">x</span><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">x</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-v">train</span><span class="crayon-sy">]</span></div><div class="crayon-line" id="crayon-5c08128ae92d3182498043-7"><span class="crayon-h">	</span><span class="crayon-p"># walk-forward validation over each week</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c08128ae92d3182498043-8"><span class="crayon-h">	</span><span class="crayon-v">predictions</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">list</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c08128ae92d3182498043-9"><span class="crayon-h">	</span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">i</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-e">len</span><span class="crayon-sy">(</span><span class="crayon-v">test</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c08128ae92d3182498043-10"><span class="crayon-h">		</span><span class="crayon-p"># predict the week</span></div><div class="crayon-line" id="crayon-5c08128ae92d3182498043-11"><span class="crayon-h">		</span><span class="crayon-v">yhat_sequence</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">forecast</span><span class="crayon-sy">(</span><span class="crayon-v">model</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">history</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_input</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c08128ae92d3182498043-12"><span class="crayon-h">		</span><span class="crayon-p"># store the predictions</span></div><div class="crayon-line" id="crayon-5c08128ae92d3182498043-13"><span class="crayon-h">		</span><span class="crayon-v">predictions</span><span class="crayon-sy">.</span><span class="crayon-e">append</span><span class="crayon-sy">(</span><span class="crayon-v">yhat_sequence</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c08128ae92d3182498043-14"><span class="crayon-h">		</span><span class="crayon-p"># get real observation and add to history for predicting the next week</span></div><div class="crayon-line" id="crayon-5c08128ae92d3182498043-15"><span class="crayon-h">		</span><span class="crayon-v">history</span><span class="crayon-sy">.</span><span class="crayon-e">append</span><span class="crayon-sy">(</span><span class="crayon-v">test</span><span class="crayon-sy">[</span><span class="crayon-v">i</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-o">:</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c08128ae92d3182498043-16"><span class="crayon-h">	</span><span class="crayon-p"># evaluate predictions days for each week</span></div><div class="crayon-line" id="crayon-5c08128ae92d3182498043-17"><span class="crayon-h">	</span><span class="crayon-v">predictions</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-t">array</span><span class="crayon-sy">(</span><span class="crayon-v">predictions</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c08128ae92d3182498043-18"><span class="crayon-h">	</span><span class="crayon-v">score</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">scores</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">evaluate_forecasts</span><span class="crayon-sy">(</span><span class="crayon-v">test</span><span class="crayon-sy">[</span><span class="crayon-o">:</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-o">:</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">0</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">predictions</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c08128ae92d3182498043-19"><span class="crayon-h">	</span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">score</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">scores</span></div></div></td>
					</tr>
				</tbody></table>
			</div>
		</div>
<!-- [Format Time: 0.0010 seconds] -->
<p>Once we have the evaluation for a model, we can summarize the performance.</p>
<p>The function below named <em>summarize_scores()</em> will display the performance of a model as a single line for easy comparison with other models.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->

		<div id="crayon-5c08128ae92d4658613283" class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" style="margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important; height: auto;">
		
			<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important; height: 18px !important; line-height: 18px !important; margin-top: -19px; display: none; position: absolute; z-index: 2;"><span class="crayon-title"></span>
			<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button crayon-pressed" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code" style="display: none;"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
			<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
			<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="readonly" style="-moz-tab-size: 4; font-size: 12px !important; line-height: 15px !important; z-index: 0; opacity: 0; overflow: hidden;" wrap="soft"># summarize scores
def summarize_scores(name, score, scores):
	s_scores = ', '.join(['%.1f' % s for s in scores])
	print('%s: [%.3f] %s' % (name, score, s_scores))</textarea></div>
			<div class="crayon-main" style="position: relative; z-index: 1; overflow: hidden;">
				<table class="crayon-table" style="">
					<tbody><tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5c08128ae92d4658613283-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c08128ae92d4658613283-2">2</div><div class="crayon-num" data-line="crayon-5c08128ae92d4658613283-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c08128ae92d4658613283-4">4</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5c08128ae92d4658613283-1"><span class="crayon-p"># summarize scores</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c08128ae92d4658613283-2"><span class="crayon-e">def </span><span class="crayon-e">summarize_scores</span><span class="crayon-sy">(</span><span class="crayon-v">name</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">score</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">scores</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5c08128ae92d4658613283-3"><span class="crayon-h">	</span><span class="crayon-v">s_scores</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-s">', '</span><span class="crayon-sy">.</span><span class="crayon-e">join</span><span class="crayon-sy">(</span><span class="crayon-sy">[</span><span class="crayon-s">'%.1f'</span><span class="crayon-h"> </span><span class="crayon-o">%</span><span class="crayon-h"> </span><span class="crayon-i">s</span><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">s</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-v">scores</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c08128ae92d4658613283-4"><span class="crayon-h">	</span><span class="crayon-e">print</span><span class="crayon-sy">(</span><span class="crayon-s">'%s: [%.3f] %s'</span><span class="crayon-h"> </span><span class="crayon-o">%</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-v">name</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">score</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">s_scores</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div></div></td>
					</tr>
				</tbody></table>
			</div>
		</div>
<!-- [Format Time: 0.0004 seconds] -->
<p>We now have all of the elements to begin evaluating predictive models on the dataset.</p>
<h2>LSTMs for Multi-Step Forecasting</h2>
<p>Recurrent neural networks, or RNNs, are specifically designed to work, learn, and predict sequence data.</p>
<p>A recurrent neural network is a neural network where the output of 
the network from one time step is provided as an input in the subsequent
 time step. This allows the model to make a decision as to what to 
predict based on both the input for the current time step and direct 
knowledge of what was output in the prior time step.</p>
<p>Perhaps the most successful and widely used RNN is the long 
short-term memory network, or LSTM for short. It is successful because 
it overcomes the challenges involved in training a recurrent neural 
network, resulting in stable models. In addition to harnessing the 
recurrent connection of the outputs from the prior time step, LSTMs also
 have an internal memory that operates like a local variable, allowing 
them to accumulate state over the input sequence.</p>
<p>For more information about Recurrent Neural Networks, see the post:</p>
<ul>
<li><a href="https://machinelearningmastery.com/crash-course-recurrent-neural-networks-deep-learning/">Crash Course in Recurrent Neural Networks for Deep Learning</a></li>
</ul>
<p>For more information about Long Short-Term Memory networks, see the post:</p>
<ul>
<li><a href="https://machinelearningmastery.com/gentle-introduction-long-short-term-memory-networks-experts/">A Gentle Introduction to Long Short-Term Memory Networks by the Experts</a></li>
</ul>
<p>LSTMs offer a number of benefits when it comes to multi-step time series forecasting; they are:</p>
<ul>
<li><strong>Native Support for Sequences</strong>. LSTMs are a type of 
recurrent network, and as such are designed to take sequence data as 
input, unlike other models where lag observations must be presented as 
input features.</li>
<li><strong>Multivariate Inputs</strong>. LSTMs directly support 
multiple parallel input sequences for multivariate inputs, unlike other 
models where multivariate inputs are presented in a flat structure.</li>
<li><strong>Vector Output</strong>. Like other neural networks, LSTMs 
are able to map input data directly to an output vector that may 
represent multiple output time steps.</li>
</ul>
<p>Further, specialized architectures have been developed that are 
specifically designed to make multi-step sequence predictions, generally
 referred to as sequence-to-sequence prediction, or seq2seq for short. 
This is useful as multi-step time series forecasting is a type of 
seq2seq prediction.</p>
<p>An example of a recurrent neural network architecture designed for seq2seq problems is the encoder-decoder LSTM.</p>
<p>An encoder-decoder LSTM is a model comprised of two sub-models: one 
called the encoder that reads the input sequences and compresses it to a
 fixed-length internal representation, and an output model called the 
decoder that interprets the internal representation and uses it to 
predict the output sequence.</p>
<p>The encoder-decoder approach to sequence prediction has proven much 
more effective than outputting a vector directly and is the preferred 
approach.</p>
<p>Generally, LSTMs have been found to not be very effective at 
auto-regression type problems. These are problems where forecasting the 
next time step is a function of recent time steps.</p>
<p>For more on this issue, see the post:</p>
<ul>
<li><a href="https://machinelearningmastery.com/suitability-long-short-term-memory-networks-time-series-forecasting/">On the Suitability of LSTMs for Time Series Forecasting</a></li>
</ul>
<p>One-dimensional convolutional neural networks, or CNNs, have proven 
effective at automatically learning features from input sequences.</p>
<p>A popular approach has been to combine CNNs with LSTMs, where the CNN
 is as an encoder to learn features from sub-sequences of input data 
which are provided as time steps to an LSTM. This architecture is called
 a <a href="https://machinelearningmastery.com/cnn-long-short-term-memory-networks/">CNN-LSTM</a>.</p>
<p>For more information on this architecture, see the post:</p>
<ul>
<li><a href="https://machinelearningmastery.com/cnn-long-short-term-memory-networks/">CNN Long Short-Term Memory Networks</a></li>
</ul>
<p>A power variation on the CNN LSTM architecture is the ConvLSTM that 
uses the convolutional reading of input subsequences directly within an 
LSTM’s units. This approach has proven very effective for time series 
classification and can be adapted for use in multi-step time series 
forecasting.</p>
<p>In this tutorial, we will explore a suite of LSTM architectures for 
multi-step time series forecasting. Specifically, we will look at how to
 develop the following models:</p>
<ul>
<li><strong>LSTM</strong> model with vector output for multi-step forecasting with univariate input data.</li>
<li><strong>Encoder-Decoder LSTM</strong> model for multi-step forecasting with univariate input data.</li>
<li><strong>Encoder-Decoder LSTM</strong> model for multi-step forecasting with multivariate input data.</li>
<li><strong>CNN-LSTM Encoder-Decoder</strong> model for multi-step forecasting with univariate input data.</li>
<li><strong>ConvLSTM Encoder-Decoder</strong> model for multi-step forecasting with univariate input data.</li>
</ul>
<p>The models will be developed and demonstrated on the household power 
prediction problem. A model is considered skillful if it achieves 
performance better than a naive model, which is an overall RMSE of about
 465 kilowatts across a seven day forecast.</p>
<p>We will not focus on the tuning of these models to achieve optimal 
performance; instead, we will stop short at skillful models as compared 
to a naive forecast. The chosen structures and hyperparameters are 
chosen with a little trial and error. The scores should be taken as just
 an example rather than a study of the optimal model or configuration 
for the problem.</p>
<p>Given the stochastic nature of the models, it is <a href="https://machinelearningmastery.com/evaluate-skill-deep-learning-models/">good practice</a>
 to evaluate a given model multiple times and report the mean 
performance on a test dataset. In the interest of brevity and keeping 
the code simple, we will instead present single-runs of models in this 
tutorial.</p>
<p>We cannot know which approach will be the most effective for a given 
multi-step forecasting problem. It is a good idea to explore a suite of 
methods in order to discover what works best on your specific dataset.</p>
<h2>LSTM Model With Univariate Input and Vector Output</h2>
<p>We will start off by developing a simple or vanilla LSTM model that 
reads in a sequence of days of total daily power consumption and 
predicts a vector output of the next standard week of daily power 
consumption.</p>
<p>This will provide the foundation for the more elaborate models developed in subsequent sections.</p>
<p>The number of prior days used as input defines the one-dimensional 
(1D) subsequence of data that the LSTM will read and learn to extract 
features. Some ideas on the size and nature of this input include:</p>
<ul>
<li>All prior days, up to years worth of data.</li>
<li>The prior seven days.</li>
<li>The prior two weeks.</li>
<li>The prior one month.</li>
<li>The prior one year.</li>
<li>The prior week and the week to be predicted from one year ago.</li>
</ul>
<p>There is no right answer; instead, each approach and more can be 
tested and the performance of the model can be used to choose the nature
 of the input that results in the best model performance.</p>
<p>These choices define a few things:</p>
<ul>
<li>How the training data must be prepared in order to fit the model.</li>
<li>How the test data must be prepared in order to evaluate the model.</li>
<li>How to use the model to make predictions with a final model in the future.</li>
</ul>
<p>A good starting point would be to use the prior seven days.</p>
<p>An LSTM model expects data to have the shape:</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->

		<div id="crayon-5c08128ae92d7672227550" class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" style="margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important; height: auto;">
		
			<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important; height: 18px !important; line-height: 18px !important; margin-top: -19px; display: none; z-index: 4;"><span class="crayon-title"></span>
			<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button crayon-pressed" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code" style="display: none;"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
			<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
			<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="readonly" style="-moz-tab-size: 4; font-size: 12px !important; line-height: 15px !important; z-index: 0; opacity: 0; overflow: hidden;" wrap="soft">[samples, timesteps, features]</textarea></div>
			<div class="crayon-main" style="position: relative; z-index: 1; overflow: hidden;">
				<table class="crayon-table" style="">
					<tbody><tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5c08128ae92d7672227550-1">1</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5c08128ae92d7672227550-1">[samples, timesteps, features]</div></div></td>
					</tr>
				</tbody></table>
			</div>
		</div>
<!-- [Format Time: 0.0000 seconds] -->
<p>One sample will be comprised of seven time steps with one feature for the seven days of total daily power consumed.</p>
<p>The training dataset has 159 weeks of data, so the shape of the training dataset would be:</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->

		<div id="crayon-5c08128ae92da339733668" class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" style="margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important; height: auto;">
		
			<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important; height: 18px !important; line-height: 18px !important; margin-top: -19px; display: none; z-index: 4;"><span class="crayon-title"></span>
			<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button crayon-pressed" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code" style="display: none;"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
			<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
			<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="readonly" style="-moz-tab-size: 4; font-size: 12px !important; line-height: 15px !important; z-index: 0; opacity: 0; overflow: hidden;" wrap="soft">[159, 7, 1]</textarea></div>
			<div class="crayon-main" style="position: relative; z-index: 1; overflow: hidden;">
				<table class="crayon-table" style="">
					<tbody><tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5c08128ae92da339733668-1">1</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5c08128ae92da339733668-1">[159, 7, 1]</div></div></td>
					</tr>
				</tbody></table>
			</div>
		</div>
<!-- [Format Time: 0.0000 seconds] -->
<p>This is a good start. The data in this format would use the prior 
standard week to predict the next standard week. A problem is that 159 
instances is not a lot to train a neural network.</p>
<p>A way to create a lot more training data is to change the problem 
during training to predict the next seven days given the prior seven 
days, regardless of the standard week.</p>
<p>This only impacts the training data, and the test problem remains the
 same: predict the daily power consumption for the next standard week 
given the prior standard week.</p>
<p>This will require a little preparation of the training data.</p>
<p>The training data is provided in standard weeks with eight variables, specifically in the shape [<em>159, 7, 8</em>]. The first step is to flatten the data so that we have eight time series sequences.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->

		<div id="crayon-5c08128ae92dc320316388" class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" style="margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important; height: auto;">
		
			<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important; height: 18px !important; line-height: 18px !important; margin-top: -19px; display: none; z-index: 4;"><span class="crayon-title"></span>
			<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button crayon-pressed" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code" style="display: none;"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
			<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
			<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="readonly" style="-moz-tab-size: 4; font-size: 12px !important; line-height: 15px !important; z-index: 0; opacity: 0; overflow: hidden;" wrap="soft"># flatten data
data = train.reshape((train.shape[0]*train.shape[1], train.shape[2]))</textarea></div>
			<div class="crayon-main" style="position: relative; z-index: 1; overflow: hidden;">
				<table class="crayon-table" style="">
					<tbody><tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5c08128ae92dc320316388-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c08128ae92dc320316388-2">2</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5c08128ae92dc320316388-1"><span class="crayon-p"># flatten data</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c08128ae92dc320316388-2"><span class="crayon-v">data</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">train</span><span class="crayon-sy">.</span><span class="crayon-e">reshape</span><span class="crayon-sy">(</span><span class="crayon-sy">(</span><span class="crayon-v">train</span><span class="crayon-sy">.</span><span class="crayon-v">shape</span><span class="crayon-sy">[</span><span class="crayon-cn">0</span><span class="crayon-sy">]</span><span class="crayon-o">*</span><span class="crayon-v">train</span><span class="crayon-sy">.</span><span class="crayon-v">shape</span><span class="crayon-sy">[</span><span class="crayon-cn">1</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">train</span><span class="crayon-sy">.</span><span class="crayon-v">shape</span><span class="crayon-sy">[</span><span class="crayon-cn">2</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div></div></td>
					</tr>
				</tbody></table>
			</div>
		</div>
<!-- [Format Time: 0.0003 seconds] -->
<p>We then need to iterate over the time steps and divide the data into 
overlapping windows; each iteration moves along one time step and 
predicts the subsequent seven days.</p>
<p>For example:</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->

		<div id="crayon-5c08128ae92de429580288" class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" style="margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important; height: auto;">
		
			<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important; height: 18px !important; line-height: 18px !important; margin-top: -19px; display: none; position: absolute; z-index: 2;"><span class="crayon-title"></span>
			<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button crayon-pressed" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code" style="display: none;"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
			<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
			<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="readonly" style="-moz-tab-size: 4; font-size: 12px !important; line-height: 15px !important; z-index: 0; opacity: 0; overflow: hidden;" wrap="soft">Input, Output
[d01, d02, d03, d04, d05, d06, d07], [d08, d09, d10, d11, d12, d13, d14]
[d02, d03, d04, d05, d06, d07, d08], [d09, d10, d11, d12, d13, d14, d15]
...</textarea></div>
			<div class="crayon-main" style="position: relative; z-index: 1; overflow: hidden;">
				<table class="crayon-table" style="">
					<tbody><tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5c08128ae92de429580288-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c08128ae92de429580288-2">2</div><div class="crayon-num" data-line="crayon-5c08128ae92de429580288-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c08128ae92de429580288-4">4</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5c08128ae92de429580288-1">Input, Output</div><div class="crayon-line crayon-striped-line" id="crayon-5c08128ae92de429580288-2">[d01, d02, d03, d04, d05, d06, d07], [d08, d09, d10, d11, d12, d13, d14]</div><div class="crayon-line" id="crayon-5c08128ae92de429580288-3">[d02, d03, d04, d05, d06, d07, d08], [d09, d10, d11, d12, d13, d14, d15]</div><div class="crayon-line crayon-striped-line" id="crayon-5c08128ae92de429580288-4">...</div></div></td>
					</tr>
				</tbody></table>
			</div>
		</div>
<!-- [Format Time: 0.0000 seconds] -->
<p>We can do this by keeping track of start and end indexes for the 
inputs and outputs as we iterate across the length of the flattened data
 in terms of time steps.</p>
<p>We can also do this in a way where the number of inputs and outputs are parameterized (e.g. <em>n_input</em>, <em>n_out</em>) so that you can experiment with different values or adapt it for your own problem.</p>
<p>Below is a function named <em>to_supervised()</em> that takes a list 
of weeks (history) and the number of time steps to use as inputs and 
outputs and returns the data in the overlapping moving window format.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->

		<div id="crayon-5c08128ae92df336764278" class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" style="margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important; height: auto;">
		
			<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important; height: 18px !important; line-height: 18px !important; margin-top: -19px; display: none; position: absolute; z-index: 2;"><span class="crayon-title"></span>
			<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button crayon-pressed" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code" style="display: none;"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
			<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
			<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="readonly" style="-moz-tab-size: 4; font-size: 12px !important; line-height: 15px !important; z-index: 0; opacity: 0; overflow: hidden;" wrap="soft"># convert history into inputs and outputs
def to_supervised(train, n_input, n_out=7):
	# flatten data
	data = train.reshape((train.shape[0]*train.shape[1], train.shape[2]))
	X, y = list(), list()
	in_start = 0
	# step over the entire history one time step at a time
	for _ in range(len(data)):
		# define the end of the input sequence
		in_end = in_start + n_input
		out_end = in_end + n_out
		# ensure we have enough data for this instance
		if out_end &lt; len(data):
			x_input = data[in_start:in_end, 0]
			x_input = x_input.reshape((len(x_input), 1))
			X.append(x_input)
			y.append(data[in_end:out_end, 0])
		# move along one time step
		in_start += 1
	return array(X), array(y)</textarea></div>
			<div class="crayon-main" style="position: relative; z-index: 1; overflow: hidden;">
				<table class="crayon-table" style="">
					<tbody><tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5c08128ae92df336764278-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c08128ae92df336764278-2">2</div><div class="crayon-num" data-line="crayon-5c08128ae92df336764278-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c08128ae92df336764278-4">4</div><div class="crayon-num" data-line="crayon-5c08128ae92df336764278-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c08128ae92df336764278-6">6</div><div class="crayon-num" data-line="crayon-5c08128ae92df336764278-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c08128ae92df336764278-8">8</div><div class="crayon-num" data-line="crayon-5c08128ae92df336764278-9">9</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c08128ae92df336764278-10">10</div><div class="crayon-num" data-line="crayon-5c08128ae92df336764278-11">11</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c08128ae92df336764278-12">12</div><div class="crayon-num" data-line="crayon-5c08128ae92df336764278-13">13</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c08128ae92df336764278-14">14</div><div class="crayon-num" data-line="crayon-5c08128ae92df336764278-15">15</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c08128ae92df336764278-16">16</div><div class="crayon-num" data-line="crayon-5c08128ae92df336764278-17">17</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c08128ae92df336764278-18">18</div><div class="crayon-num" data-line="crayon-5c08128ae92df336764278-19">19</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c08128ae92df336764278-20">20</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5c08128ae92df336764278-1"><span class="crayon-p"># convert history into inputs and outputs</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c08128ae92df336764278-2"><span class="crayon-e">def </span><span class="crayon-e">to_supervised</span><span class="crayon-sy">(</span><span class="crayon-v">train</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_input</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_out</span><span class="crayon-o">=</span><span class="crayon-cn">7</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5c08128ae92df336764278-3"><span class="crayon-h">	</span><span class="crayon-p"># flatten data</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c08128ae92df336764278-4"><span class="crayon-h">	</span><span class="crayon-v">data</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">train</span><span class="crayon-sy">.</span><span class="crayon-e">reshape</span><span class="crayon-sy">(</span><span class="crayon-sy">(</span><span class="crayon-v">train</span><span class="crayon-sy">.</span><span class="crayon-v">shape</span><span class="crayon-sy">[</span><span class="crayon-cn">0</span><span class="crayon-sy">]</span><span class="crayon-o">*</span><span class="crayon-v">train</span><span class="crayon-sy">.</span><span class="crayon-v">shape</span><span class="crayon-sy">[</span><span class="crayon-cn">1</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">train</span><span class="crayon-sy">.</span><span class="crayon-v">shape</span><span class="crayon-sy">[</span><span class="crayon-cn">2</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c08128ae92df336764278-5"><span class="crayon-h">	</span><span class="crayon-v">X</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">y</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">list</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-e">list</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c08128ae92df336764278-6"><span class="crayon-h">	</span><span class="crayon-v">in_start</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-cn">0</span></div><div class="crayon-line" id="crayon-5c08128ae92df336764278-7"><span class="crayon-h">	</span><span class="crayon-p"># step over the entire history one time step at a time</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c08128ae92df336764278-8"><span class="crayon-h">	</span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">_</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-e">len</span><span class="crayon-sy">(</span><span class="crayon-v">data</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5c08128ae92df336764278-9"><span class="crayon-h">		</span><span class="crayon-p"># define the end of the input sequence</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c08128ae92df336764278-10"><span class="crayon-h">		</span><span class="crayon-v">in_end</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">in_start</span><span class="crayon-h"> </span><span class="crayon-o">+</span><span class="crayon-h"> </span><span class="crayon-e">n_input</span></div><div class="crayon-line" id="crayon-5c08128ae92df336764278-11"><span class="crayon-e">		</span><span class="crayon-v">out_end</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">in_end</span><span class="crayon-h"> </span><span class="crayon-o">+</span><span class="crayon-h"> </span><span class="crayon-v">n_out</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c08128ae92df336764278-12"><span class="crayon-h">		</span><span class="crayon-p"># ensure we have enough data for this instance</span></div><div class="crayon-line" id="crayon-5c08128ae92df336764278-13"><span class="crayon-h">		</span><span class="crayon-st">if</span><span class="crayon-h"> </span><span class="crayon-v">out_end</span><span class="crayon-h"> </span><span class="crayon-o">&lt;</span><span class="crayon-h"> </span><span class="crayon-e">len</span><span class="crayon-sy">(</span><span class="crayon-v">data</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c08128ae92df336764278-14"><span class="crayon-h">			</span><span class="crayon-v">x_input</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">data</span><span class="crayon-sy">[</span><span class="crayon-v">in_start</span><span class="crayon-o">:</span><span class="crayon-v">in_end</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">0</span><span class="crayon-sy">]</span></div><div class="crayon-line" id="crayon-5c08128ae92df336764278-15"><span class="crayon-h">			</span><span class="crayon-v">x_input</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">x_input</span><span class="crayon-sy">.</span><span class="crayon-e">reshape</span><span class="crayon-sy">(</span><span class="crayon-sy">(</span><span class="crayon-e">len</span><span class="crayon-sy">(</span><span class="crayon-v">x_input</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">1</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c08128ae92df336764278-16"><span class="crayon-h">			</span><span class="crayon-v">X</span><span class="crayon-sy">.</span><span class="crayon-e">append</span><span class="crayon-sy">(</span><span class="crayon-v">x_input</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c08128ae92df336764278-17"><span class="crayon-h">			</span><span class="crayon-v">y</span><span class="crayon-sy">.</span><span class="crayon-e">append</span><span class="crayon-sy">(</span><span class="crayon-v">data</span><span class="crayon-sy">[</span><span class="crayon-v">in_end</span><span class="crayon-o">:</span><span class="crayon-v">out_end</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">0</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c08128ae92df336764278-18"><span class="crayon-h">		</span><span class="crayon-p"># move along one time step</span></div><div class="crayon-line" id="crayon-5c08128ae92df336764278-19"><span class="crayon-h">		</span><span class="crayon-v">in_start</span><span class="crayon-h"> </span><span class="crayon-o">+=</span><span class="crayon-h"> </span><span class="crayon-cn">1</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c08128ae92df336764278-20"><span class="crayon-h">	</span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-t">array</span><span class="crayon-sy">(</span><span class="crayon-v">X</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-t">array</span><span class="crayon-sy">(</span><span class="crayon-v">y</span><span class="crayon-sy">)</span></div></div></td>
					</tr>
				</tbody></table>
			</div>
		</div>
<!-- [Format Time: 0.0013 seconds] -->
<p>When we run this function on the entire training dataset, we 
transform 159 samples into 1,099; specifically, the transformed dataset 
has the shapes <em>X=[1099, 7, 1]</em> and <em>y=[1099, 7].</em></p>
<p>Next, we can define and fit the LSTM model on the training data.</p>
<p>This multi-step time series forecasting problem is an autoregression.
 That means it is likely best modeled where that the next seven days is 
some function of observations at prior time steps. This and the 
relatively small amount of data means that a small model is required.</p>
<p>We will develop a model with a single hidden LSTM layer with 200 
units. The number of units in the hidden layer is unrelated to the 
number of time steps in the input sequences. The LSTM layer is followed 
by a fully connected layer with 200 nodes that will interpret the 
features learned by the LSTM layer. Finally, an output layer will 
directly predict a vector with seven elements, one for each day in the 
output sequence.</p>
<p>We will use the mean squared error loss function as it is a good 
match for our chosen error metric of RMSE. We will use the efficient <a href="https://machinelearningmastery.com/adam-optimization-algorithm-for-deep-learning/">Adam implementation</a> of stochastic gradient descent and fit the model for 70 epochs with a batch size of 16.</p>
<p>The small batch size and the stochastic nature of the algorithm means
 that the same model will learn a slightly different mapping of inputs 
to outputs each time it is trained. This means results may vary when the
 model is evaluated. You can try running the model multiple times and 
calculate an average of model performance.</p>
<p>The <em>build_model()</em> below prepares the training data, defines 
the model, and fits the model on the training data, returning the fit 
model ready for making predictions.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->

		<div id="crayon-5c08128ae92e1781106488" class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" style="margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important; height: auto;">
		
			<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important; height: 18px !important; line-height: 18px !important; margin-top: -19px; display: none; position: absolute; z-index: 2;"><span class="crayon-title"></span>
			<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button crayon-pressed" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
			<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
			<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="readonly" style="-moz-tab-size: 4; font-size: 12px !important; line-height: 15px !important; z-index: 0; opacity: 0; overflow: hidden;" wrap="soft"># train the model
def build_model(train, n_input):
	# prepare data
	train_x, train_y = to_supervised(train, n_input)
	# define parameters
	verbose, epochs, batch_size = 0, 70, 16
	n_timesteps, n_features, n_outputs = train_x.shape[1], train_x.shape[2], train_y.shape[1]
	# define model
	model = Sequential()
	model.add(LSTM(200, activation='relu', input_shape=(n_timesteps, n_features)))
	model.add(Dense(100, activation='relu'))
	model.add(Dense(n_outputs))
	model.compile(loss='mse', optimizer='adam')
	# fit network
	model.fit(train_x, train_y, epochs=epochs, batch_size=batch_size, verbose=verbose)
	return model</textarea></div>
			<div class="crayon-main" style="position: relative; z-index: 1; overflow: hidden;">
				<table class="crayon-table" style="">
					<tbody><tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5c08128ae92e1781106488-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c08128ae92e1781106488-2">2</div><div class="crayon-num" data-line="crayon-5c08128ae92e1781106488-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c08128ae92e1781106488-4">4</div><div class="crayon-num" data-line="crayon-5c08128ae92e1781106488-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c08128ae92e1781106488-6">6</div><div class="crayon-num" data-line="crayon-5c08128ae92e1781106488-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c08128ae92e1781106488-8">8</div><div class="crayon-num" data-line="crayon-5c08128ae92e1781106488-9">9</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c08128ae92e1781106488-10">10</div><div class="crayon-num" data-line="crayon-5c08128ae92e1781106488-11">11</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c08128ae92e1781106488-12">12</div><div class="crayon-num" data-line="crayon-5c08128ae92e1781106488-13">13</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c08128ae92e1781106488-14">14</div><div class="crayon-num" data-line="crayon-5c08128ae92e1781106488-15">15</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c08128ae92e1781106488-16">16</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5c08128ae92e1781106488-1"><span class="crayon-p"># train the model</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c08128ae92e1781106488-2"><span class="crayon-e">def </span><span class="crayon-e">build_model</span><span class="crayon-sy">(</span><span class="crayon-v">train</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_input</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5c08128ae92e1781106488-3"><span class="crayon-h">	</span><span class="crayon-p"># prepare data</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c08128ae92e1781106488-4"><span class="crayon-h">	</span><span class="crayon-v">train_x</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">train_y</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">to_supervised</span><span class="crayon-sy">(</span><span class="crayon-v">train</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_input</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c08128ae92e1781106488-5"><span class="crayon-h">	</span><span class="crayon-p"># define parameters</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c08128ae92e1781106488-6"><span class="crayon-h">	</span><span class="crayon-v">verbose</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">epochs</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">batch_size</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-cn">0</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">70</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">16</span></div><div class="crayon-line" id="crayon-5c08128ae92e1781106488-7"><span class="crayon-h">	</span><span class="crayon-v">n_timesteps</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_features</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_outputs</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">train_x</span><span class="crayon-sy">.</span><span class="crayon-v">shape</span><span class="crayon-sy">[</span><span class="crayon-cn">1</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">train_x</span><span class="crayon-sy">.</span><span class="crayon-v">shape</span><span class="crayon-sy">[</span><span class="crayon-cn">2</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">train_y</span><span class="crayon-sy">.</span><span class="crayon-v">shape</span><span class="crayon-sy">[</span><span class="crayon-cn">1</span><span class="crayon-sy">]</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c08128ae92e1781106488-8"><span class="crayon-h">	</span><span class="crayon-p"># define model</span></div><div class="crayon-line" id="crayon-5c08128ae92e1781106488-9"><span class="crayon-h">	</span><span class="crayon-v">model</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">Sequential</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c08128ae92e1781106488-10"><span class="crayon-h">	</span><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">add</span><span class="crayon-sy">(</span><span class="crayon-e">LSTM</span><span class="crayon-sy">(</span><span class="crayon-cn">200</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">activation</span><span class="crayon-o">=</span><span class="crayon-s">'relu'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">input_shape</span><span class="crayon-o">=</span><span class="crayon-sy">(</span><span class="crayon-v">n_timesteps</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_features</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c08128ae92e1781106488-11"><span class="crayon-h">	</span><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">add</span><span class="crayon-sy">(</span><span class="crayon-e">Dense</span><span class="crayon-sy">(</span><span class="crayon-cn">100</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">activation</span><span class="crayon-o">=</span><span class="crayon-s">'relu'</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c08128ae92e1781106488-12"><span class="crayon-h">	</span><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">add</span><span class="crayon-sy">(</span><span class="crayon-e">Dense</span><span class="crayon-sy">(</span><span class="crayon-v">n_outputs</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c08128ae92e1781106488-13"><span class="crayon-h">	</span><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">compile</span><span class="crayon-sy">(</span><span class="crayon-v">loss</span><span class="crayon-o">=</span><span class="crayon-s">'mse'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">optimizer</span><span class="crayon-o">=</span><span class="crayon-s">'adam'</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c08128ae92e1781106488-14"><span class="crayon-h">	</span><span class="crayon-p"># fit network</span></div><div class="crayon-line" id="crayon-5c08128ae92e1781106488-15"><span class="crayon-h">	</span><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">fit</span><span class="crayon-sy">(</span><span class="crayon-v">train_x</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">train_y</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">epochs</span><span class="crayon-o">=</span><span class="crayon-v">epochs</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">batch_size</span><span class="crayon-o">=</span><span class="crayon-v">batch_size</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">verbose</span><span class="crayon-o">=</span><span class="crayon-v">verbose</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c08128ae92e1781106488-16"><span class="crayon-h">	</span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">model</span></div></div></td>
					</tr>
				</tbody></table>
			</div>
		</div>
<!-- [Format Time: 0.0013 seconds] -->
<p>Now that we know how to fit the model, we can look at how the model can be used to make a prediction.</p>
<p>Generally, the model expects data to have the same three dimensional shape when making a prediction.</p>
<p>In this case, the expected shape of an input pattern is one sample, seven days of one feature for the daily power consumed:</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->

		<div id="crayon-5c08128ae92e3050863137" class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" style="margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important; height: auto;">
		
			<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important; height: 18px !important; line-height: 18px !important; margin-top: -19px; display: none; z-index: 4;"><span class="crayon-title"></span>
			<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button crayon-pressed" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code" style="display: none;"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
			<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
			<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="readonly" style="-moz-tab-size: 4; font-size: 12px !important; line-height: 15px !important; z-index: 0; opacity: 0; overflow: hidden;" wrap="soft">[1, 7, 1]</textarea></div>
			<div class="crayon-main" style="position: relative; z-index: 1; overflow: hidden;">
				<table class="crayon-table" style="">
					<tbody><tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5c08128ae92e3050863137-1">1</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5c08128ae92e3050863137-1">[1, 7, 1]</div></div></td>
					</tr>
				</tbody></table>
			</div>
		</div>
<!-- [Format Time: 0.0000 seconds] -->
<p>Data must have this shape when making predictions for the test set 
and when a final model is being used to make predictions in the future. 
If you change the number if input days to 14, then the shape of the 
training data and the shape of new samples when making predictions must 
be changed accordingly to have 14 time steps. It is a modeling choice 
that you must carry forward when using the model.</p>
<p>We are using walk-forward validation to evaluate the model as described in the previous section.</p>
<p>This means that we have the observations available for the prior week
 in order to predict the coming week. These are collected into an array 
of standard weeks called history.</p>
<p>In order to predict the next standard week, we need to retrieve the 
last days of observations. As with the training data, we must first 
flatten the history data to remove the weekly structure so that we end 
up with eight parallel time series.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->

		<div id="crayon-5c08128ae92e6895492889" class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" style="margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important; height: auto;">
		
			<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important; height: 18px !important; line-height: 18px !important; margin-top: -19px; display: none; z-index: 4;"><span class="crayon-title"></span>
			<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button crayon-pressed" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code" style="display: none;"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
			<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
			<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="readonly" style="-moz-tab-size: 4; font-size: 12px !important; line-height: 15px !important; z-index: 0; opacity: 0; overflow: hidden;" wrap="soft"># flatten data
data = data.reshape((data.shape[0]*data.shape[1], data.shape[2]))</textarea></div>
			<div class="crayon-main" style="position: relative; z-index: 1; overflow: hidden;">
				<table class="crayon-table" style="">
					<tbody><tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5c08128ae92e6895492889-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c08128ae92e6895492889-2">2</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5c08128ae92e6895492889-1"><span class="crayon-p"># flatten data</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c08128ae92e6895492889-2"><span class="crayon-v">data</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">data</span><span class="crayon-sy">.</span><span class="crayon-e">reshape</span><span class="crayon-sy">(</span><span class="crayon-sy">(</span><span class="crayon-v">data</span><span class="crayon-sy">.</span><span class="crayon-v">shape</span><span class="crayon-sy">[</span><span class="crayon-cn">0</span><span class="crayon-sy">]</span><span class="crayon-o">*</span><span class="crayon-v">data</span><span class="crayon-sy">.</span><span class="crayon-v">shape</span><span class="crayon-sy">[</span><span class="crayon-cn">1</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">data</span><span class="crayon-sy">.</span><span class="crayon-v">shape</span><span class="crayon-sy">[</span><span class="crayon-cn">2</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div></div></td>
					</tr>
				</tbody></table>
			</div>
		</div>
<!-- [Format Time: 0.0003 seconds] -->
<p>Next, we need to retrieve the last seven days of daily total power consumed (feature index 0).</p>
<p>We will parameterize this as we did for the training data so that the
 number of prior days used as input by the model can be modified in the 
future.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->

		<div id="crayon-5c08128ae92e8070718729" class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" style="margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important; height: auto;">
		
			<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important; height: 18px !important; line-height: 18px !important; margin-top: -19px; display: none; z-index: 4;"><span class="crayon-title"></span>
			<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button crayon-pressed" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code" style="display: none;"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
			<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
			<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="readonly" style="-moz-tab-size: 4; font-size: 12px !important; line-height: 15px !important; z-index: 0; opacity: 0; overflow: hidden;" wrap="soft"># retrieve last observations for input data
input_x = data[-n_input:, 0]</textarea></div>
			<div class="crayon-main" style="position: relative; z-index: 1; overflow: hidden;">
				<table class="crayon-table" style="">
					<tbody><tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5c08128ae92e8070718729-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c08128ae92e8070718729-2">2</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5c08128ae92e8070718729-1"><span class="crayon-p"># retrieve last observations for input data</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c08128ae92e8070718729-2"><span class="crayon-v">input_x</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">data</span><span class="crayon-sy">[</span><span class="crayon-o">-</span><span class="crayon-v">n_input</span><span class="crayon-o">:</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">0</span><span class="crayon-sy">]</span></div></div></td>
					</tr>
				</tbody></table>
			</div>
		</div>
<!-- [Format Time: 0.0001 seconds] -->
<p>Next, we reshape the input into the expected three-dimensional structure.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->

		<div id="crayon-5c08128ae92ea672083181" class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" style="margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important; height: auto;">
		
			<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important; height: 18px !important; line-height: 18px !important; margin-top: -19px; display: none; z-index: 4;"><span class="crayon-title"></span>
			<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button crayon-pressed" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code" style="display: none;"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
			<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
			<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="readonly" style="-moz-tab-size: 4; font-size: 12px !important; line-height: 15px !important; z-index: 0; opacity: 0; overflow: hidden;" wrap="soft"># reshape into [1, n_input, 1]
input_x = input_x.reshape((1, len(input_x), 1))</textarea></div>
			<div class="crayon-main" style="position: relative; z-index: 1; overflow: hidden;">
				<table class="crayon-table" style="">
					<tbody><tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5c08128ae92ea672083181-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c08128ae92ea672083181-2">2</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5c08128ae92ea672083181-1"><span class="crayon-p"># reshape into [1, n_input, 1]</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c08128ae92ea672083181-2"><span class="crayon-v">input_x</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">input_x</span><span class="crayon-sy">.</span><span class="crayon-e">reshape</span><span class="crayon-sy">(</span><span class="crayon-sy">(</span><span class="crayon-cn">1</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-e">len</span><span class="crayon-sy">(</span><span class="crayon-v">input_x</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">1</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div></div></td>
					</tr>
				</tbody></table>
			</div>
		</div>
<!-- [Format Time: 0.0002 seconds] -->
<p>We then make a prediction using the fit model and the input data and retrieve the vector of seven days of output.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->

		<div id="crayon-5c08128ae92ec835949829" class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" style="margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important; height: auto;">
		
			<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important; height: 18px !important; line-height: 18px !important; margin-top: -19px; display: none; position: absolute; z-index: 2;"><span class="crayon-title"></span>
			<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button crayon-pressed" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code" style="display: none;"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
			<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
			<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="readonly" style="-moz-tab-size: 4; font-size: 12px !important; line-height: 15px !important; z-index: 0; opacity: 0; overflow: hidden;" wrap="soft"># forecast the next week
yhat = model.predict(input_x, verbose=0)
# we only want the vector forecast
yhat = yhat[0]</textarea></div>
			<div class="crayon-main" style="position: relative; z-index: 1; overflow: hidden;">
				<table class="crayon-table" style="">
					<tbody><tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5c08128ae92ec835949829-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c08128ae92ec835949829-2">2</div><div class="crayon-num" data-line="crayon-5c08128ae92ec835949829-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c08128ae92ec835949829-4">4</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5c08128ae92ec835949829-1"><span class="crayon-p"># forecast the next week</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c08128ae92ec835949829-2"><span class="crayon-v">yhat</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">predict</span><span class="crayon-sy">(</span><span class="crayon-v">input_x</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">verbose</span><span class="crayon-o">=</span><span class="crayon-cn">0</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c08128ae92ec835949829-3"><span class="crayon-p"># we only want the vector forecast</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c08128ae92ec835949829-4"><span class="crayon-v">yhat</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">yhat</span><span class="crayon-sy">[</span><span class="crayon-cn">0</span><span class="crayon-sy">]</span></div></div></td>
					</tr>
				</tbody></table>
			</div>
		</div>
<!-- [Format Time: 0.0002 seconds] -->
<p>The <em>forecast()</em> function below implements this and takes as 
arguments the model fit on the training dataset, the history of data 
observed so far, and the number of input time steps expected by the 
model.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->

		<div id="crayon-5c08128ae92ed276187224" class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" style="margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important; height: auto;">
		
			<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important; height: 18px !important; line-height: 18px !important; margin-top: -19px; display: none; position: absolute; z-index: 2;"><span class="crayon-title"></span>
			<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button crayon-pressed" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code" style="display: none;"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
			<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
			<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="readonly" style="-moz-tab-size: 4; font-size: 12px !important; line-height: 15px !important; z-index: 0; opacity: 0; overflow: hidden;" wrap="soft"># make a forecast
def forecast(model, history, n_input):
	# flatten data
	data = array(history)
	data = data.reshape((data.shape[0]*data.shape[1], data.shape[2]))
	# retrieve last observations for input data
	input_x = data[-n_input:, 0]
	# reshape into [1, n_input, 1]
	input_x = input_x.reshape((1, len(input_x), 1))
	# forecast the next week
	yhat = model.predict(input_x, verbose=0)
	# we only want the vector forecast
	yhat = yhat[0]
	return yhat</textarea></div>
			<div class="crayon-main" style="position: relative; z-index: 1; overflow: hidden;">
				<table class="crayon-table" style="">
					<tbody><tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5c08128ae92ed276187224-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c08128ae92ed276187224-2">2</div><div class="crayon-num" data-line="crayon-5c08128ae92ed276187224-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c08128ae92ed276187224-4">4</div><div class="crayon-num" data-line="crayon-5c08128ae92ed276187224-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c08128ae92ed276187224-6">6</div><div class="crayon-num" data-line="crayon-5c08128ae92ed276187224-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c08128ae92ed276187224-8">8</div><div class="crayon-num" data-line="crayon-5c08128ae92ed276187224-9">9</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c08128ae92ed276187224-10">10</div><div class="crayon-num" data-line="crayon-5c08128ae92ed276187224-11">11</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c08128ae92ed276187224-12">12</div><div class="crayon-num" data-line="crayon-5c08128ae92ed276187224-13">13</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c08128ae92ed276187224-14">14</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5c08128ae92ed276187224-1"><span class="crayon-p"># make a forecast</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c08128ae92ed276187224-2"><span class="crayon-e">def </span><span class="crayon-e">forecast</span><span class="crayon-sy">(</span><span class="crayon-v">model</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">history</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_input</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5c08128ae92ed276187224-3"><span class="crayon-h">	</span><span class="crayon-p"># flatten data</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c08128ae92ed276187224-4"><span class="crayon-h">	</span><span class="crayon-v">data</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-t">array</span><span class="crayon-sy">(</span><span class="crayon-v">history</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c08128ae92ed276187224-5"><span class="crayon-h">	</span><span class="crayon-v">data</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">data</span><span class="crayon-sy">.</span><span class="crayon-e">reshape</span><span class="crayon-sy">(</span><span class="crayon-sy">(</span><span class="crayon-v">data</span><span class="crayon-sy">.</span><span class="crayon-v">shape</span><span class="crayon-sy">[</span><span class="crayon-cn">0</span><span class="crayon-sy">]</span><span class="crayon-o">*</span><span class="crayon-v">data</span><span class="crayon-sy">.</span><span class="crayon-v">shape</span><span class="crayon-sy">[</span><span class="crayon-cn">1</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">data</span><span class="crayon-sy">.</span><span class="crayon-v">shape</span><span class="crayon-sy">[</span><span class="crayon-cn">2</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c08128ae92ed276187224-6"><span class="crayon-h">	</span><span class="crayon-p"># retrieve last observations for input data</span></div><div class="crayon-line" id="crayon-5c08128ae92ed276187224-7"><span class="crayon-h">	</span><span class="crayon-v">input_x</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">data</span><span class="crayon-sy">[</span><span class="crayon-o">-</span><span class="crayon-v">n_input</span><span class="crayon-o">:</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">0</span><span class="crayon-sy">]</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c08128ae92ed276187224-8"><span class="crayon-h">	</span><span class="crayon-p"># reshape into [1, n_input, 1]</span></div><div class="crayon-line" id="crayon-5c08128ae92ed276187224-9"><span class="crayon-h">	</span><span class="crayon-v">input_x</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">input_x</span><span class="crayon-sy">.</span><span class="crayon-e">reshape</span><span class="crayon-sy">(</span><span class="crayon-sy">(</span><span class="crayon-cn">1</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-e">len</span><span class="crayon-sy">(</span><span class="crayon-v">input_x</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">1</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c08128ae92ed276187224-10"><span class="crayon-h">	</span><span class="crayon-p"># forecast the next week</span></div><div class="crayon-line" id="crayon-5c08128ae92ed276187224-11"><span class="crayon-h">	</span><span class="crayon-v">yhat</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">predict</span><span class="crayon-sy">(</span><span class="crayon-v">input_x</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">verbose</span><span class="crayon-o">=</span><span class="crayon-cn">0</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c08128ae92ed276187224-12"><span class="crayon-h">	</span><span class="crayon-p"># we only want the vector forecast</span></div><div class="crayon-line" id="crayon-5c08128ae92ed276187224-13"><span class="crayon-h">	</span><span class="crayon-v">yhat</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">yhat</span><span class="crayon-sy">[</span><span class="crayon-cn">0</span><span class="crayon-sy">]</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c08128ae92ed276187224-14"><span class="crayon-h">	</span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">yhat</span></div></div></td>
					</tr>
				</tbody></table>
			</div>
		</div>
<!-- [Format Time: 0.0008 seconds] -->
<p>That’s it; we now have everything we need to make multi-step time 
series forecasts with an LSTM model on the daily total power consumed 
univariate dataset.</p>
<p>We can tie all of this together. The complete example is listed below.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->

		<div id="crayon-5c08128ae92f0251551785" class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" style="margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important; height: auto;">
		
			<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important; height: 18px !important; line-height: 18px !important; margin-top: -19px; display: none; position: absolute; z-index: 2;"><span class="crayon-title"></span>
			<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button crayon-pressed" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
			<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
			<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="readonly" style="-moz-tab-size: 4; font-size: 12px !important; line-height: 15px !important; z-index: 0; opacity: 0; overflow: hidden;" wrap="soft">#
 univariate multi-step lstm
from math import sqrt
from numpy import split
from numpy import array
from pandas import read_csv
from sklearn.metrics import mean_squared_error
from matplotlib import pyplot
from keras.models import Sequential
from keras.layers import Dense
from keras.layers import Flatten
from keras.layers import LSTM

# split a univariate dataset into train/test sets
def split_dataset(data):
	# split into standard weeks
	train, test = data[1:-328], data[-328:-6]
	# restructure into windows of weekly data
	train = array(split(train, len(train)/7))
	test = array(split(test, len(test)/7))
	return train, test

# evaluate one or more weekly forecasts against expected values
def evaluate_forecasts(actual, predicted):
	scores = list()
	# calculate an RMSE score for each day
	for i in range(actual.shape[1]):
		# calculate mse
		mse = mean_squared_error(actual[:, i], predicted[:, i])
		# calculate rmse
		rmse = sqrt(mse)
		# store
		scores.append(rmse)
	# calculate overall RMSE
	s = 0
	for row in range(actual.shape[0]):
		for col in range(actual.shape[1]):
			s += (actual[row, col] - predicted[row, col])**2
	score = sqrt(s / (actual.shape[0] * actual.shape[1]))
	return score, scores

# summarize scores
def summarize_scores(name, score, scores):
	s_scores = ', '.join(['%.1f' % s for s in scores])
	print('%s: [%.3f] %s' % (name, score, s_scores))

# convert history into inputs and outputs
def to_supervised(train, n_input, n_out=7):
	# flatten data
	data = train.reshape((train.shape[0]*train.shape[1], train.shape[2]))
	X, y = list(), list()
	in_start = 0
	# step over the entire history one time step at a time
	for _ in range(len(data)):
		# define the end of the input sequence
		in_end = in_start + n_input
		out_end = in_end + n_out
		# ensure we have enough data for this instance
		if out_end &lt; len(data):
			x_input = data[in_start:in_end, 0]
			x_input = x_input.reshape((len(x_input), 1))
			X.append(x_input)
			y.append(data[in_end:out_end, 0])
		# move along one time step
		in_start += 1
	return array(X), array(y)

# train the model
def build_model(train, n_input):
	# prepare data
	train_x, train_y = to_supervised(train, n_input)
	# define parameters
	verbose, epochs, batch_size = 0, 70, 16
	n_timesteps, n_features, n_outputs = train_x.shape[1], 
train_x.shape[2], train_y.shape[1]
	# define model
	model = Sequential()
	model.add(LSTM(200, activation='relu', input_shape=(n_timesteps, 
n_features)))
	model.add(Dense(100, activation='relu'))
	model.add(Dense(n_outputs))
	model.compile(loss='mse', optimizer='adam')
	# fit network
	model.fit(train_x, train_y, epochs=epochs, batch_size=batch_size, 
verbose=verbose)
	return model

# make a forecast
def forecast(model, history, n_input):
	# flatten data
	data = array(history)
	data = data.reshape((data.shape[0]*data.shape[1], data.shape[2]))
	# retrieve last observations for input data
	input_x = data[-n_input:, 0]
	# reshape into [1, n_input, 1]
	input_x = input_x.reshape((1, len(input_x), 1))
	# forecast the next week
	yhat = model.predict(input_x, verbose=0)
	# we only want the vector forecast
	yhat = yhat[0]
	return yhat

# evaluate a single model
def evaluate_model(train, test, n_input):
	# fit model
	model = build_model(train, n_input)
	# history is a list of weekly data
	history = [x for x in train]
	# walk-forward validation over each week
	predictions = list()
	for i in range(len(test)):
		# predict the week
		yhat_sequence = forecast(model, history, n_input)
		# store the predictions
		predictions.append(yhat_sequence)
		# get real observation and add to history for predicting the next week
		history.append(test[i, :])
	# evaluate predictions days for each week
	predictions = array(predictions)
	score, scores = evaluate_forecasts(test[:, :, 0], predictions)
	return score, scores

# load the new file
dataset = read_csv('household_power_consumption_days.csv', header=0, 
infer_datetime_format=True, parse_dates=['datetime'], 
index_col=['datetime'])
# split into train and test
train, test = split_dataset(dataset.values)
# evaluate model and get scores
n_input = 7
score, scores = evaluate_model(train, test, n_input)
# summarize scores
summarize_scores('lstm', score, scores)
# plot scores
days = ['sun', 'mon', 'tue', 'wed', 'thr', 'fri', 'sat']
pyplot.plot(days, scores, marker='o', label='lstm')
pyplot.show()</textarea></div>
			<div class="crayon-main" style="position: relative; z-index: 1; overflow: hidden;">
				<table class="crayon-table" style="">
					<tbody><tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5c08128ae92f0251551785-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c08128ae92f0251551785-2">2</div><div class="crayon-num" data-line="crayon-5c08128ae92f0251551785-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c08128ae92f0251551785-4">4</div><div class="crayon-num" data-line="crayon-5c08128ae92f0251551785-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c08128ae92f0251551785-6">6</div><div class="crayon-num" data-line="crayon-5c08128ae92f0251551785-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c08128ae92f0251551785-8">8</div><div class="crayon-num" data-line="crayon-5c08128ae92f0251551785-9">9</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c08128ae92f0251551785-10">10</div><div class="crayon-num" data-line="crayon-5c08128ae92f0251551785-11">11</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c08128ae92f0251551785-12">12</div><div class="crayon-num" data-line="crayon-5c08128ae92f0251551785-13">13</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c08128ae92f0251551785-14">14</div><div class="crayon-num" data-line="crayon-5c08128ae92f0251551785-15">15</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c08128ae92f0251551785-16">16</div><div class="crayon-num" data-line="crayon-5c08128ae92f0251551785-17">17</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c08128ae92f0251551785-18">18</div><div class="crayon-num" data-line="crayon-5c08128ae92f0251551785-19">19</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c08128ae92f0251551785-20">20</div><div class="crayon-num" data-line="crayon-5c08128ae92f0251551785-21">21</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c08128ae92f0251551785-22">22</div><div class="crayon-num" data-line="crayon-5c08128ae92f0251551785-23">23</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c08128ae92f0251551785-24">24</div><div class="crayon-num" data-line="crayon-5c08128ae92f0251551785-25">25</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c08128ae92f0251551785-26">26</div><div class="crayon-num" data-line="crayon-5c08128ae92f0251551785-27">27</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c08128ae92f0251551785-28">28</div><div class="crayon-num" data-line="crayon-5c08128ae92f0251551785-29">29</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c08128ae92f0251551785-30">30</div><div class="crayon-num" data-line="crayon-5c08128ae92f0251551785-31">31</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c08128ae92f0251551785-32">32</div><div class="crayon-num" data-line="crayon-5c08128ae92f0251551785-33">33</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c08128ae92f0251551785-34">34</div><div class="crayon-num" data-line="crayon-5c08128ae92f0251551785-35">35</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c08128ae92f0251551785-36">36</div><div class="crayon-num" data-line="crayon-5c08128ae92f0251551785-37">37</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c08128ae92f0251551785-38">38</div><div class="crayon-num" data-line="crayon-5c08128ae92f0251551785-39">39</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c08128ae92f0251551785-40">40</div><div class="crayon-num" data-line="crayon-5c08128ae92f0251551785-41">41</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c08128ae92f0251551785-42">42</div><div class="crayon-num" data-line="crayon-5c08128ae92f0251551785-43">43</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c08128ae92f0251551785-44">44</div><div class="crayon-num" data-line="crayon-5c08128ae92f0251551785-45">45</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c08128ae92f0251551785-46">46</div><div class="crayon-num" data-line="crayon-5c08128ae92f0251551785-47">47</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c08128ae92f0251551785-48">48</div><div class="crayon-num" data-line="crayon-5c08128ae92f0251551785-49">49</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c08128ae92f0251551785-50">50</div><div class="crayon-num" data-line="crayon-5c08128ae92f0251551785-51">51</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c08128ae92f0251551785-52">52</div><div class="crayon-num" data-line="crayon-5c08128ae92f0251551785-53">53</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c08128ae92f0251551785-54">54</div><div class="crayon-num" data-line="crayon-5c08128ae92f0251551785-55">55</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c08128ae92f0251551785-56">56</div><div class="crayon-num" data-line="crayon-5c08128ae92f0251551785-57">57</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c08128ae92f0251551785-58">58</div><div class="crayon-num" data-line="crayon-5c08128ae92f0251551785-59">59</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c08128ae92f0251551785-60">60</div><div class="crayon-num" data-line="crayon-5c08128ae92f0251551785-61">61</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c08128ae92f0251551785-62">62</div><div class="crayon-num" data-line="crayon-5c08128ae92f0251551785-63">63</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c08128ae92f0251551785-64">64</div><div class="crayon-num" data-line="crayon-5c08128ae92f0251551785-65">65</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c08128ae92f0251551785-66">66</div><div class="crayon-num" data-line="crayon-5c08128ae92f0251551785-67">67</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c08128ae92f0251551785-68">68</div><div class="crayon-num" data-line="crayon-5c08128ae92f0251551785-69">69</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c08128ae92f0251551785-70">70</div><div class="crayon-num" data-line="crayon-5c08128ae92f0251551785-71">71</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c08128ae92f0251551785-72">72</div><div class="crayon-num" data-line="crayon-5c08128ae92f0251551785-73">73</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c08128ae92f0251551785-74">74</div><div class="crayon-num" data-line="crayon-5c08128ae92f0251551785-75">75</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c08128ae92f0251551785-76">76</div><div class="crayon-num" data-line="crayon-5c08128ae92f0251551785-77">77</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c08128ae92f0251551785-78">78</div><div class="crayon-num" data-line="crayon-5c08128ae92f0251551785-79">79</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c08128ae92f0251551785-80">80</div><div class="crayon-num" data-line="crayon-5c08128ae92f0251551785-81">81</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c08128ae92f0251551785-82">82</div><div class="crayon-num" data-line="crayon-5c08128ae92f0251551785-83">83</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c08128ae92f0251551785-84">84</div><div class="crayon-num" data-line="crayon-5c08128ae92f0251551785-85">85</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c08128ae92f0251551785-86">86</div><div class="crayon-num" data-line="crayon-5c08128ae92f0251551785-87">87</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c08128ae92f0251551785-88">88</div><div class="crayon-num" data-line="crayon-5c08128ae92f0251551785-89">89</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c08128ae92f0251551785-90">90</div><div class="crayon-num" data-line="crayon-5c08128ae92f0251551785-91">91</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c08128ae92f0251551785-92">92</div><div class="crayon-num" data-line="crayon-5c08128ae92f0251551785-93">93</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c08128ae92f0251551785-94">94</div><div class="crayon-num" data-line="crayon-5c08128ae92f0251551785-95">95</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c08128ae92f0251551785-96">96</div><div class="crayon-num" data-line="crayon-5c08128ae92f0251551785-97">97</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c08128ae92f0251551785-98">98</div><div class="crayon-num" data-line="crayon-5c08128ae92f0251551785-99">99</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c08128ae92f0251551785-100">100</div><div class="crayon-num" data-line="crayon-5c08128ae92f0251551785-101">101</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c08128ae92f0251551785-102">102</div><div class="crayon-num" data-line="crayon-5c08128ae92f0251551785-103">103</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c08128ae92f0251551785-104">104</div><div class="crayon-num" data-line="crayon-5c08128ae92f0251551785-105">105</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c08128ae92f0251551785-106">106</div><div class="crayon-num" data-line="crayon-5c08128ae92f0251551785-107">107</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c08128ae92f0251551785-108">108</div><div class="crayon-num" data-line="crayon-5c08128ae92f0251551785-109">109</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c08128ae92f0251551785-110">110</div><div class="crayon-num" data-line="crayon-5c08128ae92f0251551785-111">111</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c08128ae92f0251551785-112">112</div><div class="crayon-num" data-line="crayon-5c08128ae92f0251551785-113">113</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c08128ae92f0251551785-114">114</div><div class="crayon-num" data-line="crayon-5c08128ae92f0251551785-115">115</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c08128ae92f0251551785-116">116</div><div class="crayon-num" data-line="crayon-5c08128ae92f0251551785-117">117</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c08128ae92f0251551785-118">118</div><div class="crayon-num" data-line="crayon-5c08128ae92f0251551785-119">119</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c08128ae92f0251551785-120">120</div><div class="crayon-num" data-line="crayon-5c08128ae92f0251551785-121">121</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c08128ae92f0251551785-122">122</div><div class="crayon-num" data-line="crayon-5c08128ae92f0251551785-123">123</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c08128ae92f0251551785-124">124</div><div class="crayon-num" data-line="crayon-5c08128ae92f0251551785-125">125</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c08128ae92f0251551785-126">126</div><div class="crayon-num" data-line="crayon-5c08128ae92f0251551785-127">127</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c08128ae92f0251551785-128">128</div><div class="crayon-num" data-line="crayon-5c08128ae92f0251551785-129">129</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c08128ae92f0251551785-130">130</div><div class="crayon-num" data-line="crayon-5c08128ae92f0251551785-131">131</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5c08128ae92f0251551785-1"><span class="crayon-p"># univariate multi-step lstm</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c08128ae92f0251551785-2"><span class="crayon-e">from </span><span class="crayon-e">math </span><span class="crayon-e">import </span><span class="crayon-e">sqrt</span></div><div class="crayon-line" id="crayon-5c08128ae92f0251551785-3"><span class="crayon-e">from </span><span class="crayon-e">numpy </span><span class="crayon-e">import </span><span class="crayon-e">split</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c08128ae92f0251551785-4"><span class="crayon-e">from </span><span class="crayon-e">numpy </span><span class="crayon-e">import </span><span class="crayon-t">array</span></div><div class="crayon-line" id="crayon-5c08128ae92f0251551785-5"><span class="crayon-e">from </span><span class="crayon-e">pandas </span><span class="crayon-e">import </span><span class="crayon-e">read_csv</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c08128ae92f0251551785-6"><span class="crayon-e">from </span><span class="crayon-v">sklearn</span><span class="crayon-sy">.</span><span class="crayon-e">metrics </span><span class="crayon-e">import </span><span class="crayon-e">mean_squared_error</span></div><div class="crayon-line" id="crayon-5c08128ae92f0251551785-7"><span class="crayon-e">from </span><span class="crayon-e">matplotlib </span><span class="crayon-e">import </span><span class="crayon-e">pyplot</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c08128ae92f0251551785-8"><span class="crayon-e">from </span><span class="crayon-v">keras</span><span class="crayon-sy">.</span><span class="crayon-e">models </span><span class="crayon-e">import </span><span class="crayon-e">Sequential</span></div><div class="crayon-line" id="crayon-5c08128ae92f0251551785-9"><span class="crayon-e">from </span><span class="crayon-v">keras</span><span class="crayon-sy">.</span><span class="crayon-e">layers </span><span class="crayon-e">import </span><span class="crayon-e">Dense</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c08128ae92f0251551785-10"><span class="crayon-e">from </span><span class="crayon-v">keras</span><span class="crayon-sy">.</span><span class="crayon-e">layers </span><span class="crayon-e">import </span><span class="crayon-e">Flatten</span></div><div class="crayon-line" id="crayon-5c08128ae92f0251551785-11"><span class="crayon-e">from </span><span class="crayon-v">keras</span><span class="crayon-sy">.</span><span class="crayon-e">layers </span><span class="crayon-e">import </span><span class="crayon-v">LSTM</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c08128ae92f0251551785-12">&nbsp;</div><div class="crayon-line" id="crayon-5c08128ae92f0251551785-13"><span class="crayon-p"># split a univariate dataset into train/test sets</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c08128ae92f0251551785-14"><span class="crayon-e">def </span><span class="crayon-e">split_dataset</span><span class="crayon-sy">(</span><span class="crayon-v">data</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5c08128ae92f0251551785-15"><span class="crayon-h">	</span><span class="crayon-p"># split into standard weeks</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c08128ae92f0251551785-16"><span class="crayon-h">	</span><span class="crayon-v">train</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">test</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">data</span><span class="crayon-sy">[</span><span class="crayon-cn">1</span><span class="crayon-o">:</span><span class="crayon-o">-</span><span class="crayon-cn">328</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">data</span><span class="crayon-sy">[</span><span class="crayon-o">-</span><span class="crayon-cn">328</span><span class="crayon-o">:</span><span class="crayon-o">-</span><span class="crayon-cn">6</span><span class="crayon-sy">]</span></div><div class="crayon-line" id="crayon-5c08128ae92f0251551785-17"><span class="crayon-h">	</span><span class="crayon-p"># restructure into windows of weekly data</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c08128ae92f0251551785-18"><span class="crayon-h">	</span><span class="crayon-v">train</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-t">array</span><span class="crayon-sy">(</span><span class="crayon-e">split</span><span class="crayon-sy">(</span><span class="crayon-v">train</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-e">len</span><span class="crayon-sy">(</span><span class="crayon-v">train</span><span class="crayon-sy">)</span><span class="crayon-o">/</span><span class="crayon-cn">7</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c08128ae92f0251551785-19"><span class="crayon-h">	</span><span class="crayon-v">test</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-t">array</span><span class="crayon-sy">(</span><span class="crayon-e">split</span><span class="crayon-sy">(</span><span class="crayon-v">test</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-e">len</span><span class="crayon-sy">(</span><span class="crayon-v">test</span><span class="crayon-sy">)</span><span class="crayon-o">/</span><span class="crayon-cn">7</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c08128ae92f0251551785-20"><span class="crayon-h">	</span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">train</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">test</span></div><div class="crayon-line" id="crayon-5c08128ae92f0251551785-21">&nbsp;</div><div class="crayon-line crayon-striped-line" id="crayon-5c08128ae92f0251551785-22"><span class="crayon-p"># evaluate one or more weekly forecasts against expected values</span></div><div class="crayon-line" id="crayon-5c08128ae92f0251551785-23"><span class="crayon-e">def </span><span class="crayon-e">evaluate_forecasts</span><span class="crayon-sy">(</span><span class="crayon-v">actual</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">predicted</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c08128ae92f0251551785-24"><span class="crayon-h">	</span><span class="crayon-v">scores</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">list</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c08128ae92f0251551785-25"><span class="crayon-h">	</span><span class="crayon-p"># calculate an RMSE score for each day</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c08128ae92f0251551785-26"><span class="crayon-h">	</span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">i</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-v">actual</span><span class="crayon-sy">.</span><span class="crayon-v">shape</span><span class="crayon-sy">[</span><span class="crayon-cn">1</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5c08128ae92f0251551785-27"><span class="crayon-h">		</span><span class="crayon-p"># calculate mse</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c08128ae92f0251551785-28"><span class="crayon-h">		</span><span class="crayon-v">mse</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">mean_squared_error</span><span class="crayon-sy">(</span><span class="crayon-v">actual</span><span class="crayon-sy">[</span><span class="crayon-o">:</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">i</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">predicted</span><span class="crayon-sy">[</span><span class="crayon-o">:</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">i</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c08128ae92f0251551785-29"><span class="crayon-h">		</span><span class="crayon-p"># calculate rmse</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c08128ae92f0251551785-30"><span class="crayon-h">		</span><span class="crayon-v">rmse</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">sqrt</span><span class="crayon-sy">(</span><span class="crayon-v">mse</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c08128ae92f0251551785-31"><span class="crayon-h">		</span><span class="crayon-p"># store</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c08128ae92f0251551785-32"><span class="crayon-h">		</span><span class="crayon-v">scores</span><span class="crayon-sy">.</span><span class="crayon-e">append</span><span class="crayon-sy">(</span><span class="crayon-v">rmse</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c08128ae92f0251551785-33"><span class="crayon-h">	</span><span class="crayon-p"># calculate overall RMSE</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c08128ae92f0251551785-34"><span class="crayon-h">	</span><span class="crayon-v">s</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-cn">0</span></div><div class="crayon-line" id="crayon-5c08128ae92f0251551785-35"><span class="crayon-h">	</span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-e">row </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-v">actual</span><span class="crayon-sy">.</span><span class="crayon-v">shape</span><span class="crayon-sy">[</span><span class="crayon-cn">0</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c08128ae92f0251551785-36"><span class="crayon-h">		</span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-e">col </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-v">actual</span><span class="crayon-sy">.</span><span class="crayon-v">shape</span><span class="crayon-sy">[</span><span class="crayon-cn">1</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5c08128ae92f0251551785-37"><span class="crayon-h">			</span><span class="crayon-v">s</span><span class="crayon-h"> </span><span class="crayon-o">+=</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-v">actual</span><span class="crayon-sy">[</span><span class="crayon-v">row</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">col</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-o">-</span><span class="crayon-h"> </span><span class="crayon-v">predicted</span><span class="crayon-sy">[</span><span class="crayon-v">row</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">col</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span><span class="crayon-o">*</span><span class="crayon-o">*</span><span class="crayon-cn">2</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c08128ae92f0251551785-38"><span class="crayon-h">	</span><span class="crayon-v">score</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">sqrt</span><span class="crayon-sy">(</span><span class="crayon-v">s</span><span class="crayon-h"> </span><span class="crayon-o">/</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-v">actual</span><span class="crayon-sy">.</span><span class="crayon-v">shape</span><span class="crayon-sy">[</span><span class="crayon-cn">0</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-o">*</span><span class="crayon-h"> </span><span class="crayon-v">actual</span><span class="crayon-sy">.</span><span class="crayon-v">shape</span><span class="crayon-sy">[</span><span class="crayon-cn">1</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c08128ae92f0251551785-39"><span class="crayon-h">	</span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">score</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">scores</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c08128ae92f0251551785-40">&nbsp;</div><div class="crayon-line" id="crayon-5c08128ae92f0251551785-41"><span class="crayon-p"># summarize scores</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c08128ae92f0251551785-42"><span class="crayon-e">def </span><span class="crayon-e">summarize_scores</span><span class="crayon-sy">(</span><span class="crayon-v">name</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">score</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">scores</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5c08128ae92f0251551785-43"><span class="crayon-h">	</span><span class="crayon-v">s_scores</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-s">', '</span><span class="crayon-sy">.</span><span class="crayon-e">join</span><span class="crayon-sy">(</span><span class="crayon-sy">[</span><span class="crayon-s">'%.1f'</span><span class="crayon-h"> </span><span class="crayon-o">%</span><span class="crayon-h"> </span><span class="crayon-i">s</span><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">s</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-v">scores</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c08128ae92f0251551785-44"><span class="crayon-h">	</span><span class="crayon-e">print</span><span class="crayon-sy">(</span><span class="crayon-s">'%s: [%.3f] %s'</span><span class="crayon-h"> </span><span class="crayon-o">%</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-v">name</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">score</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">s_scores</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c08128ae92f0251551785-45">&nbsp;</div><div class="crayon-line crayon-striped-line" id="crayon-5c08128ae92f0251551785-46"><span class="crayon-p"># convert history into inputs and outputs</span></div><div class="crayon-line" id="crayon-5c08128ae92f0251551785-47"><span class="crayon-e">def </span><span class="crayon-e">to_supervised</span><span class="crayon-sy">(</span><span class="crayon-v">train</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_input</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_out</span><span class="crayon-o">=</span><span class="crayon-cn">7</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c08128ae92f0251551785-48"><span class="crayon-h">	</span><span class="crayon-p"># flatten data</span></div><div class="crayon-line" id="crayon-5c08128ae92f0251551785-49"><span class="crayon-h">	</span><span class="crayon-v">data</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">train</span><span class="crayon-sy">.</span><span class="crayon-e">reshape</span><span class="crayon-sy">(</span><span class="crayon-sy">(</span><span class="crayon-v">train</span><span class="crayon-sy">.</span><span class="crayon-v">shape</span><span class="crayon-sy">[</span><span class="crayon-cn">0</span><span class="crayon-sy">]</span><span class="crayon-o">*</span><span class="crayon-v">train</span><span class="crayon-sy">.</span><span class="crayon-v">shape</span><span class="crayon-sy">[</span><span class="crayon-cn">1</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">train</span><span class="crayon-sy">.</span><span class="crayon-v">shape</span><span class="crayon-sy">[</span><span class="crayon-cn">2</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c08128ae92f0251551785-50"><span class="crayon-h">	</span><span class="crayon-v">X</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">y</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">list</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-e">list</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c08128ae92f0251551785-51"><span class="crayon-h">	</span><span class="crayon-v">in_start</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-cn">0</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c08128ae92f0251551785-52"><span class="crayon-h">	</span><span class="crayon-p"># step over the entire history one time step at a time</span></div><div class="crayon-line" id="crayon-5c08128ae92f0251551785-53"><span class="crayon-h">	</span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">_</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-e">len</span><span class="crayon-sy">(</span><span class="crayon-v">data</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c08128ae92f0251551785-54"><span class="crayon-h">		</span><span class="crayon-p"># define the end of the input sequence</span></div><div class="crayon-line" id="crayon-5c08128ae92f0251551785-55"><span class="crayon-h">		</span><span class="crayon-v">in_end</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">in_start</span><span class="crayon-h"> </span><span class="crayon-o">+</span><span class="crayon-h"> </span><span class="crayon-e">n_input</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c08128ae92f0251551785-56"><span class="crayon-e">		</span><span class="crayon-v">out_end</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">in_end</span><span class="crayon-h"> </span><span class="crayon-o">+</span><span class="crayon-h"> </span><span class="crayon-v">n_out</span></div><div class="crayon-line" id="crayon-5c08128ae92f0251551785-57"><span class="crayon-h">		</span><span class="crayon-p"># ensure we have enough data for this instance</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c08128ae92f0251551785-58"><span class="crayon-h">		</span><span class="crayon-st">if</span><span class="crayon-h"> </span><span class="crayon-v">out_end</span><span class="crayon-h"> </span><span class="crayon-o">&lt;</span><span class="crayon-h"> </span><span class="crayon-e">len</span><span class="crayon-sy">(</span><span class="crayon-v">data</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5c08128ae92f0251551785-59"><span class="crayon-h">			</span><span class="crayon-v">x_input</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">data</span><span class="crayon-sy">[</span><span class="crayon-v">in_start</span><span class="crayon-o">:</span><span class="crayon-v">in_end</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">0</span><span class="crayon-sy">]</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c08128ae92f0251551785-60"><span class="crayon-h">			</span><span class="crayon-v">x_input</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">x_input</span><span class="crayon-sy">.</span><span class="crayon-e">reshape</span><span class="crayon-sy">(</span><span class="crayon-sy">(</span><span class="crayon-e">len</span><span class="crayon-sy">(</span><span class="crayon-v">x_input</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">1</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c08128ae92f0251551785-61"><span class="crayon-h">			</span><span class="crayon-v">X</span><span class="crayon-sy">.</span><span class="crayon-e">append</span><span class="crayon-sy">(</span><span class="crayon-v">x_input</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c08128ae92f0251551785-62"><span class="crayon-h">			</span><span class="crayon-v">y</span><span class="crayon-sy">.</span><span class="crayon-e">append</span><span class="crayon-sy">(</span><span class="crayon-v">data</span><span class="crayon-sy">[</span><span class="crayon-v">in_end</span><span class="crayon-o">:</span><span class="crayon-v">out_end</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">0</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c08128ae92f0251551785-63"><span class="crayon-h">		</span><span class="crayon-p"># move along one time step</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c08128ae92f0251551785-64"><span class="crayon-h">		</span><span class="crayon-v">in_start</span><span class="crayon-h"> </span><span class="crayon-o">+=</span><span class="crayon-h"> </span><span class="crayon-cn">1</span></div><div class="crayon-line" id="crayon-5c08128ae92f0251551785-65"><span class="crayon-h">	</span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-t">array</span><span class="crayon-sy">(</span><span class="crayon-v">X</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-t">array</span><span class="crayon-sy">(</span><span class="crayon-v">y</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c08128ae92f0251551785-66">&nbsp;</div><div class="crayon-line" id="crayon-5c08128ae92f0251551785-67"><span class="crayon-p"># train the model</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c08128ae92f0251551785-68"><span class="crayon-e">def </span><span class="crayon-e">build_model</span><span class="crayon-sy">(</span><span class="crayon-v">train</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_input</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5c08128ae92f0251551785-69"><span class="crayon-h">	</span><span class="crayon-p"># prepare data</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c08128ae92f0251551785-70"><span class="crayon-h">	</span><span class="crayon-v">train_x</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">train_y</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">to_supervised</span><span class="crayon-sy">(</span><span class="crayon-v">train</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_input</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c08128ae92f0251551785-71"><span class="crayon-h">	</span><span class="crayon-p"># define parameters</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c08128ae92f0251551785-72"><span class="crayon-h">	</span><span class="crayon-v">verbose</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">epochs</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">batch_size</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-cn">0</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">70</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">16</span></div><div class="crayon-line" id="crayon-5c08128ae92f0251551785-73"><span class="crayon-h">	</span><span class="crayon-v">n_timesteps</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_features</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_outputs</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">train_x</span><span class="crayon-sy">.</span><span class="crayon-v">shape</span><span class="crayon-sy">[</span><span class="crayon-cn">1</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">train_x</span><span class="crayon-sy">.</span><span class="crayon-v">shape</span><span class="crayon-sy">[</span><span class="crayon-cn">2</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">train_y</span><span class="crayon-sy">.</span><span class="crayon-v">shape</span><span class="crayon-sy">[</span><span class="crayon-cn">1</span><span class="crayon-sy">]</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c08128ae92f0251551785-74"><span class="crayon-h">	</span><span class="crayon-p"># define model</span></div><div class="crayon-line" id="crayon-5c08128ae92f0251551785-75"><span class="crayon-h">	</span><span class="crayon-v">model</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">Sequential</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c08128ae92f0251551785-76"><span class="crayon-h">	</span><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">add</span><span class="crayon-sy">(</span><span class="crayon-e">LSTM</span><span class="crayon-sy">(</span><span class="crayon-cn">200</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">activation</span><span class="crayon-o">=</span><span class="crayon-s">'relu'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">input_shape</span><span class="crayon-o">=</span><span class="crayon-sy">(</span><span class="crayon-v">n_timesteps</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_features</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c08128ae92f0251551785-77"><span class="crayon-h">	</span><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">add</span><span class="crayon-sy">(</span><span class="crayon-e">Dense</span><span class="crayon-sy">(</span><span class="crayon-cn">100</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">activation</span><span class="crayon-o">=</span><span class="crayon-s">'relu'</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c08128ae92f0251551785-78"><span class="crayon-h">	</span><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">add</span><span class="crayon-sy">(</span><span class="crayon-e">Dense</span><span class="crayon-sy">(</span><span class="crayon-v">n_outputs</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c08128ae92f0251551785-79"><span class="crayon-h">	</span><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">compile</span><span class="crayon-sy">(</span><span class="crayon-v">loss</span><span class="crayon-o">=</span><span class="crayon-s">'mse'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">optimizer</span><span class="crayon-o">=</span><span class="crayon-s">'adam'</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c08128ae92f0251551785-80"><span class="crayon-h">	</span><span class="crayon-p"># fit network</span></div><div class="crayon-line" id="crayon-5c08128ae92f0251551785-81"><span class="crayon-h">	</span><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">fit</span><span class="crayon-sy">(</span><span class="crayon-v">train_x</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">train_y</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">epochs</span><span class="crayon-o">=</span><span class="crayon-v">epochs</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">batch_size</span><span class="crayon-o">=</span><span class="crayon-v">batch_size</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">verbose</span><span class="crayon-o">=</span><span class="crayon-v">verbose</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c08128ae92f0251551785-82"><span class="crayon-h">	</span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">model</span></div><div class="crayon-line" id="crayon-5c08128ae92f0251551785-83">&nbsp;</div><div class="crayon-line crayon-striped-line" id="crayon-5c08128ae92f0251551785-84"><span class="crayon-p"># make a forecast</span></div><div class="crayon-line" id="crayon-5c08128ae92f0251551785-85"><span class="crayon-e">def </span><span class="crayon-e">forecast</span><span class="crayon-sy">(</span><span class="crayon-v">model</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">history</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_input</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c08128ae92f0251551785-86"><span class="crayon-h">	</span><span class="crayon-p"># flatten data</span></div><div class="crayon-line" id="crayon-5c08128ae92f0251551785-87"><span class="crayon-h">	</span><span class="crayon-v">data</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-t">array</span><span class="crayon-sy">(</span><span class="crayon-v">history</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c08128ae92f0251551785-88"><span class="crayon-h">	</span><span class="crayon-v">data</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">data</span><span class="crayon-sy">.</span><span class="crayon-e">reshape</span><span class="crayon-sy">(</span><span class="crayon-sy">(</span><span class="crayon-v">data</span><span class="crayon-sy">.</span><span class="crayon-v">shape</span><span class="crayon-sy">[</span><span class="crayon-cn">0</span><span class="crayon-sy">]</span><span class="crayon-o">*</span><span class="crayon-v">data</span><span class="crayon-sy">.</span><span class="crayon-v">shape</span><span class="crayon-sy">[</span><span class="crayon-cn">1</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">data</span><span class="crayon-sy">.</span><span class="crayon-v">shape</span><span class="crayon-sy">[</span><span class="crayon-cn">2</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c08128ae92f0251551785-89"><span class="crayon-h">	</span><span class="crayon-p"># retrieve last observations for input data</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c08128ae92f0251551785-90"><span class="crayon-h">	</span><span class="crayon-v">input_x</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">data</span><span class="crayon-sy">[</span><span class="crayon-o">-</span><span class="crayon-v">n_input</span><span class="crayon-o">:</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">0</span><span class="crayon-sy">]</span></div><div class="crayon-line" id="crayon-5c08128ae92f0251551785-91"><span class="crayon-h">	</span><span class="crayon-p"># reshape into [1, n_input, 1]</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c08128ae92f0251551785-92"><span class="crayon-h">	</span><span class="crayon-v">input_x</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">input_x</span><span class="crayon-sy">.</span><span class="crayon-e">reshape</span><span class="crayon-sy">(</span><span class="crayon-sy">(</span><span class="crayon-cn">1</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-e">len</span><span class="crayon-sy">(</span><span class="crayon-v">input_x</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">1</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c08128ae92f0251551785-93"><span class="crayon-h">	</span><span class="crayon-p"># forecast the next week</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c08128ae92f0251551785-94"><span class="crayon-h">	</span><span class="crayon-v">yhat</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">predict</span><span class="crayon-sy">(</span><span class="crayon-v">input_x</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">verbose</span><span class="crayon-o">=</span><span class="crayon-cn">0</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c08128ae92f0251551785-95"><span class="crayon-h">	</span><span class="crayon-p"># we only want the vector forecast</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c08128ae92f0251551785-96"><span class="crayon-h">	</span><span class="crayon-v">yhat</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">yhat</span><span class="crayon-sy">[</span><span class="crayon-cn">0</span><span class="crayon-sy">]</span></div><div class="crayon-line" id="crayon-5c08128ae92f0251551785-97"><span class="crayon-h">	</span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">yhat</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c08128ae92f0251551785-98">&nbsp;</div><div class="crayon-line" id="crayon-5c08128ae92f0251551785-99"><span class="crayon-p"># evaluate a single model</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c08128ae92f0251551785-100"><span class="crayon-e">def </span><span class="crayon-e">evaluate_model</span><span class="crayon-sy">(</span><span class="crayon-v">train</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">test</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_input</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5c08128ae92f0251551785-101"><span class="crayon-h">	</span><span class="crayon-p"># fit model</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c08128ae92f0251551785-102"><span class="crayon-h">	</span><span class="crayon-v">model</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">build_model</span><span class="crayon-sy">(</span><span class="crayon-v">train</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_input</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c08128ae92f0251551785-103"><span class="crayon-h">	</span><span class="crayon-p"># history is a list of weekly data</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c08128ae92f0251551785-104"><span class="crayon-h">	</span><span class="crayon-v">history</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-i">x</span><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">x</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-v">train</span><span class="crayon-sy">]</span></div><div class="crayon-line" id="crayon-5c08128ae92f0251551785-105"><span class="crayon-h">	</span><span class="crayon-p"># walk-forward validation over each week</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c08128ae92f0251551785-106"><span class="crayon-h">	</span><span class="crayon-v">predictions</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">list</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c08128ae92f0251551785-107"><span class="crayon-h">	</span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">i</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-e">len</span><span class="crayon-sy">(</span><span class="crayon-v">test</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c08128ae92f0251551785-108"><span class="crayon-h">		</span><span class="crayon-p"># predict the week</span></div><div class="crayon-line" id="crayon-5c08128ae92f0251551785-109"><span class="crayon-h">		</span><span class="crayon-v">yhat_sequence</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">forecast</span><span class="crayon-sy">(</span><span class="crayon-v">model</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">history</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_input</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c08128ae92f0251551785-110"><span class="crayon-h">		</span><span class="crayon-p"># store the predictions</span></div><div class="crayon-line" id="crayon-5c08128ae92f0251551785-111"><span class="crayon-h">		</span><span class="crayon-v">predictions</span><span class="crayon-sy">.</span><span class="crayon-e">append</span><span class="crayon-sy">(</span><span class="crayon-v">yhat_sequence</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c08128ae92f0251551785-112"><span class="crayon-h">		</span><span class="crayon-p"># get real observation and add to history for predicting the next week</span></div><div class="crayon-line" id="crayon-5c08128ae92f0251551785-113"><span class="crayon-h">		</span><span class="crayon-v">history</span><span class="crayon-sy">.</span><span class="crayon-e">append</span><span class="crayon-sy">(</span><span class="crayon-v">test</span><span class="crayon-sy">[</span><span class="crayon-v">i</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-o">:</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c08128ae92f0251551785-114"><span class="crayon-h">	</span><span class="crayon-p"># evaluate predictions days for each week</span></div><div class="crayon-line" id="crayon-5c08128ae92f0251551785-115"><span class="crayon-h">	</span><span class="crayon-v">predictions</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-t">array</span><span class="crayon-sy">(</span><span class="crayon-v">predictions</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c08128ae92f0251551785-116"><span class="crayon-h">	</span><span class="crayon-v">score</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">scores</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">evaluate_forecasts</span><span class="crayon-sy">(</span><span class="crayon-v">test</span><span class="crayon-sy">[</span><span class="crayon-o">:</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-o">:</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">0</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">predictions</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c08128ae92f0251551785-117"><span class="crayon-h">	</span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">score</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">scores</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c08128ae92f0251551785-118">&nbsp;</div><div class="crayon-line" id="crayon-5c08128ae92f0251551785-119"><span class="crayon-p"># load the new file</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c08128ae92f0251551785-120"><span class="crayon-v">dataset</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">read_csv</span><span class="crayon-sy">(</span><span class="crayon-s">'household_power_consumption_days.csv'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">header</span><span class="crayon-o">=</span><span class="crayon-cn">0</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">infer_datetime_format</span><span class="crayon-o">=</span><span class="crayon-t">True</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">parse_dates</span><span class="crayon-o">=</span><span class="crayon-sy">[</span><span class="crayon-s">'datetime'</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">index_col</span><span class="crayon-o">=</span><span class="crayon-sy">[</span><span class="crayon-s">'datetime'</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c08128ae92f0251551785-121"><span class="crayon-p"># split into train and test</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c08128ae92f0251551785-122"><span class="crayon-v">train</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">test</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">split_dataset</span><span class="crayon-sy">(</span><span class="crayon-v">dataset</span><span class="crayon-sy">.</span><span class="crayon-v">values</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c08128ae92f0251551785-123"><span class="crayon-p"># evaluate model and get scores</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c08128ae92f0251551785-124"><span class="crayon-v">n_input</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-cn">7</span></div><div class="crayon-line" id="crayon-5c08128ae92f0251551785-125"><span class="crayon-v">score</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">scores</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">evaluate_model</span><span class="crayon-sy">(</span><span class="crayon-v">train</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">test</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_input</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c08128ae92f0251551785-126"><span class="crayon-p"># summarize scores</span></div><div class="crayon-line" id="crayon-5c08128ae92f0251551785-127"><span class="crayon-e">summarize_scores</span><span class="crayon-sy">(</span><span class="crayon-s">'lstm'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">score</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">scores</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c08128ae92f0251551785-128"><span class="crayon-p"># plot scores</span></div><div class="crayon-line" id="crayon-5c08128ae92f0251551785-129"><span class="crayon-v">days</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-s">'sun'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-s">'mon'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-s">'tue'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-s">'wed'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-s">'thr'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-s">'fri'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-s">'sat'</span><span class="crayon-sy">]</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c08128ae92f0251551785-130"><span class="crayon-v">pyplot</span><span class="crayon-sy">.</span><span class="crayon-e">plot</span><span class="crayon-sy">(</span><span class="crayon-v">days</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">scores</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">marker</span><span class="crayon-o">=</span><span class="crayon-s">'o'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">label</span><span class="crayon-o">=</span><span class="crayon-s">'lstm'</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c08128ae92f0251551785-131"><span class="crayon-v">pyplot</span><span class="crayon-sy">.</span><span class="crayon-e">show</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div></div></td>
					</tr>
				</tbody></table>
			</div>
		</div>
<!-- [Format Time: 0.0073 seconds] -->
<p>Running the example fits and evaluates the model, printing the 
overall RMSE across all seven days, and the per-day RMSE for each lead 
time.</p>
<p>Your specific results may vary given the stochastic nature of the 
algorithm. You may want to try running the example a few times.</p>
<p>We can see that in this case, the model was skillful as compared to a
 naive forecast, achieving an overall RMSE of about 399 kilowatts, less 
than 465 kilowatts achieved by a naive model.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->

		<div id="crayon-5c08128ae92f3270331046" class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" style="margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important; height: auto;">
		
			<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important; height: 18px !important; line-height: 18px !important; margin-top: -19px; display: none; z-index: 4;"><span class="crayon-title"></span>
			<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button crayon-pressed" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code" style="display: none;"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
			<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
			<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="readonly" style="-moz-tab-size: 4; font-size: 12px !important; line-height: 15px !important; z-index: 0; opacity: 0; overflow: hidden;" wrap="soft">lstm: [399.456] 419.4, 422.1, 384.5, 395.1, 403.9, 317.7, 441.5</textarea></div>
			<div class="crayon-main" style="position: relative; z-index: 1; overflow: hidden;">
				<table class="crayon-table" style="">
					<tbody><tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5c08128ae92f3270331046-1">1</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5c08128ae92f3270331046-1">lstm: [399.456] 419.4, 422.1, 384.5, 395.1, 403.9, 317.7, 441.5</div></div></td>
					</tr>
				</tbody></table>
			</div>
		</div>
<!-- [Format Time: 0.0000 seconds] -->
<p>A plot of the daily RMSE is also created.</p>
<p>The plot shows that perhaps Tuesdays and Fridays are easier days to 
forecast than the other days and that perhaps Saturday at the end of the
 standard week is the hardest day to forecast.</p>
<div id="attachment_6287" style="width: 1290px" class="wp-caption aligncenter"><img class="size-full wp-image-6287" src="How%20to%20Develop%20LSTM%20Models%20for%20Multi-Step%20Time%20Series%20Forecasting%20of%20Household%20Power%20Consumption_fichiers/Line-Plot-of-RMSE-per-Day-for-Univariate-LSTM-with-Vector-Ou.png" alt="Line Plot of RMSE per Day for Univariate LSTM with Vector Output and 7-day Inputs" srcset="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2018/07/Line-Plot-of-RMSE-per-Day-for-Univariate-LSTM-with-Vector-Output-and-7-day-Inputs.png 1280w, https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2018/07/Line-Plot-of-RMSE-per-Day-for-Univariate-LSTM-with-Vector-Output-and-7-day-Inputs-300x225.png 300w, https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2018/07/Line-Plot-of-RMSE-per-Day-for-Univariate-LSTM-with-Vector-Output-and-7-day-Inputs-768x576.png 768w, https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2018/07/Line-Plot-of-RMSE-per-Day-for-Univariate-LSTM-with-Vector-Output-and-7-day-Inputs-1024x768.png 1024w" sizes="(max-width: 1280px) 100vw, 1280px" width="1280" height="960"><p class="wp-caption-text">Line Plot of RMSE per Day for Univariate LSTM with Vector Output and 7-day Inputs</p></div>
<p>We can increase the number of prior days to use as input from seven to 14 by changing the <em>n_input</em> variable.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->

		<div id="crayon-5c08128ae92f6907112232" class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" style="margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important; height: auto;">
		
			<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important; height: 18px !important; line-height: 18px !important; margin-top: -19px; display: none; z-index: 4;"><span class="crayon-title"></span>
			<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button crayon-pressed" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code" style="display: none;"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
			<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
			<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="readonly" style="-moz-tab-size: 4; font-size: 12px !important; line-height: 15px !important; z-index: 0; opacity: 0; overflow: hidden;" wrap="soft"># evaluate model and get scores
n_input = 14</textarea></div>
			<div class="crayon-main" style="position: relative; z-index: 1; overflow: hidden;">
				<table class="crayon-table" style="">
					<tbody><tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5c08128ae92f6907112232-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c08128ae92f6907112232-2">2</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5c08128ae92f6907112232-1"><span class="crayon-p"># evaluate model and get scores</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c08128ae92f6907112232-2"><span class="crayon-v">n_input</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-cn">14</span></div></div></td>
					</tr>
				</tbody></table>
			</div>
		</div>
<!-- [Format Time: 0.0001 seconds] -->
<p>Re-running the example with this change first prints a summary of performance of the model.</p>
<p>Your specific results may vary; try running the example a few times.</p>
<p>In this case, we can see a further drop in the overall RMSE to about 
370 kilowatts, suggesting that further tuning of the input size and 
perhaps the number of nodes in the model may result in better 
performance.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->

		<div id="crayon-5c08128ae92f9452024054" class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" style="margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important; height: auto;">
		
			<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important; height: 18px !important; line-height: 18px !important; margin-top: -19px; display: none; z-index: 4;"><span class="crayon-title"></span>
			<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button crayon-pressed" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code" style="display: none;"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
			<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
			<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="readonly" style="-moz-tab-size: 4; font-size: 12px !important; line-height: 15px !important; z-index: 0; opacity: 0; overflow: hidden;" wrap="soft">lstm: [370.028] 387.4, 377.9, 334.0, 371.2, 367.1, 330.4, 415.1</textarea></div>
			<div class="crayon-main" style="position: relative; z-index: 1; overflow: hidden;">
				<table class="crayon-table" style="">
					<tbody><tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5c08128ae92f9452024054-1">1</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5c08128ae92f9452024054-1">lstm: [370.028] 387.4, 377.9, 334.0, 371.2, 367.1, 330.4, 415.1</div></div></td>
					</tr>
				</tbody></table>
			</div>
		</div>
<!-- [Format Time: 0.0000 seconds] -->
<p>Comparing the per-day RMSE scores we see some are better and some are worse than using seven-day inputs.</p>
<p>This may suggest benefit in using the two different sized inputs in 
some way, such as an ensemble of the two approaches or perhaps a single 
model (e.g. a multi-headed model) that reads the training data in 
different ways.</p>
<div id="attachment_6288" style="width: 1290px" class="wp-caption aligncenter"><img class="size-full wp-image-6288" src="How%20to%20Develop%20LSTM%20Models%20for%20Multi-Step%20Time%20Series%20Forecasting%20of%20Household%20Power%20Consumption_fichiers/Line-Plot-of-RMSE-per-Day-for-Univariate-LSTM-with-Vecto_002.png" alt="Line Plot of RMSE per Day for Univariate LSTM with Vector Output and 14-day Inputs" srcset="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2018/07/Line-Plot-of-RMSE-per-Day-for-Univariate-LSTM-with-Vector-Output-and-14-day-Inputs.png 1280w, https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2018/07/Line-Plot-of-RMSE-per-Day-for-Univariate-LSTM-with-Vector-Output-and-14-day-Inputs-300x225.png 300w, https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2018/07/Line-Plot-of-RMSE-per-Day-for-Univariate-LSTM-with-Vector-Output-and-14-day-Inputs-768x576.png 768w, https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2018/07/Line-Plot-of-RMSE-per-Day-for-Univariate-LSTM-with-Vector-Output-and-14-day-Inputs-1024x768.png 1024w" sizes="(max-width: 1280px) 100vw, 1280px" width="1280" height="960"><p class="wp-caption-text">Line Plot of RMSE per Day for Univariate LSTM with Vector Output and 14-day Inputs</p></div>
<h2>Encoder-Decoder LSTM Model With Univariate Input</h2>
<p>In this section, we can update the vanilla LSTM to use an encoder-decoder model.</p>
<p>This means that the model will not output a vector sequence directly.
 Instead, the model will be comprised of two sub models, the encoder to 
read and encode the input sequence, and the decoder that will read the 
encoded input sequence and make a one-step prediction for each element 
in the output sequence.</p>
<p>The difference is subtle, as in practice both approaches do in fact predict a sequence output.</p>
<p>The important difference is that an LSTM model is used in the 
decoder, allowing it to both know what was predicted for the prior day 
in the sequence and accumulate internal state while outputting the 
sequence.</p>
<p>Let’s take a closer look at how this model is defined.</p>
<p>As before, we define an LSTM hidden layer with 200 units. This is the
 decoder model that will read the input sequence and will output a 200 
element vector (one output per unit) that captures features from the 
input sequence. We will use 14 days of total power consumption as input.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->

		<div id="crayon-5c08128ae92fb416318902" class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" style="margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important; height: auto;">
		
			<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important; height: 18px !important; line-height: 18px !important; margin-top: -19px; display: none; position: absolute; z-index: 2;"><span class="crayon-title"></span>
			<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button crayon-pressed" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code" style="display: none;"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
			<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
			<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="readonly" style="-moz-tab-size: 4; font-size: 12px !important; line-height: 15px !important; z-index: 0; opacity: 0; overflow: hidden;" wrap="soft"># define model
model = Sequential()
model.add(LSTM(200, activation='relu', input_shape=(n_timesteps, n_features)))</textarea></div>
			<div class="crayon-main" style="position: relative; z-index: 1; overflow: hidden;">
				<table class="crayon-table" style="">
					<tbody><tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5c08128ae92fb416318902-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c08128ae92fb416318902-2">2</div><div class="crayon-num" data-line="crayon-5c08128ae92fb416318902-3">3</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5c08128ae92fb416318902-1"><span class="crayon-p"># define model</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c08128ae92fb416318902-2"><span class="crayon-v">model</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">Sequential</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c08128ae92fb416318902-3"><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">add</span><span class="crayon-sy">(</span><span class="crayon-e">LSTM</span><span class="crayon-sy">(</span><span class="crayon-cn">200</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">activation</span><span class="crayon-o">=</span><span class="crayon-s">'relu'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">input_shape</span><span class="crayon-o">=</span><span class="crayon-sy">(</span><span class="crayon-v">n_timesteps</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_features</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div></div></td>
					</tr>
				</tbody></table>
			</div>
		</div>
<!-- [Format Time: 0.0003 seconds] -->
<p>We will use a simple encoder-decoder architecture that is easy to 
implement in Keras, that has a lot of similarity to the architecture of 
an LSTM autoencoder.</p>
<p>First, the internal representation of the input sequence is repeated 
multiple times, once for each time step in the output sequence. This 
sequence of vectors will be presented to the LSTM decoder.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->

		<div id="crayon-5c08128ae92fd637199202" class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" style="margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important; height: auto;">
		
			<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important; height: 18px !important; line-height: 18px !important; margin-top: -19px; display: none; z-index: 4;"><span class="crayon-title"></span>
			<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button crayon-pressed" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code" style="display: none;"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
			<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
			<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="readonly" style="-moz-tab-size: 4; font-size: 12px !important; line-height: 15px !important; z-index: 0; opacity: 0; overflow: hidden;" wrap="soft">model.add(RepeatVector(7))</textarea></div>
			<div class="crayon-main" style="position: relative; z-index: 1; overflow: hidden;">
				<table class="crayon-table" style="">
					<tbody><tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5c08128ae92fd637199202-1">1</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5c08128ae92fd637199202-1"><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">add</span><span class="crayon-sy">(</span><span class="crayon-e">RepeatVector</span><span class="crayon-sy">(</span><span class="crayon-cn">7</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div></div></td>
					</tr>
				</tbody></table>
			</div>
		</div>
<!-- [Format Time: 0.0001 seconds] -->
<p>We then define the decoder as an LSTM hidden layer with 200 units. 
Importantly, the decoder will output the entire sequence, not just the 
output at the end of the sequence as we did with the encoder. This means
 that each of the 200 units will output a value for each of the seven 
days, representing the basis for what to predict for each day in the 
output sequence.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->

		<div id="crayon-5c08128ae92fe337428532" class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" style="margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important; height: auto;">
		
			<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important; height: 18px !important; line-height: 18px !important; margin-top: -19px; display: none; z-index: 4;"><span class="crayon-title"></span>
			<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button crayon-pressed" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code" style="display: none;"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
			<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
			<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="readonly" style="-moz-tab-size: 4; font-size: 12px !important; line-height: 15px !important; z-index: 0; opacity: 0; overflow: hidden;" wrap="soft">model.add(LSTM(200, activation='relu', return_sequences=True))</textarea></div>
			<div class="crayon-main" style="position: relative; z-index: 1; overflow: hidden;">
				<table class="crayon-table" style="">
					<tbody><tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5c08128ae92fe337428532-1">1</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5c08128ae92fe337428532-1"><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">add</span><span class="crayon-sy">(</span><span class="crayon-e">LSTM</span><span class="crayon-sy">(</span><span class="crayon-cn">200</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">activation</span><span class="crayon-o">=</span><span class="crayon-s">'relu'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">return_sequences</span><span class="crayon-o">=</span><span class="crayon-t">True</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div></div></td>
					</tr>
				</tbody></table>
			</div>
		</div>
<!-- [Format Time: 0.0002 seconds] -->
<p>We will then use a fully connected layer to interpret each time step 
in the output sequence before the final output layer. Importantly, the 
output layer predicts a single step in the output sequence, not all 
seven days at a time,</p>
<p>This means that we will use the same layers applied to each step in 
the output sequence. It means that the same fully connected layer and 
output layer will be used to process each time step provided by the 
decoder. To achieve this, we will wrap the interpretation layer and the 
output layer in a <a href="https://machinelearningmastery.com/timedistributed-layer-for-long-short-term-memory-networks-in-python/">TimeDistributed wrapper</a> that allows the wrapped layers to be used for each time step from the decoder.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->

		<div id="crayon-5c08128ae9300155667847" class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" style="margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important; height: auto;">
		
			<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important; height: 18px !important; line-height: 18px !important; margin-top: -19px; display: none; z-index: 4;"><span class="crayon-title"></span>
			<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button crayon-pressed" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code" style="display: none;"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
			<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
			<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="readonly" style="-moz-tab-size: 4; font-size: 12px !important; line-height: 15px !important; z-index: 0; opacity: 0; overflow: hidden;" wrap="soft">model.add(TimeDistributed(Dense(100, activation='relu')))
model.add(TimeDistributed(Dense(1)))</textarea></div>
			<div class="crayon-main" style="position: relative; z-index: 1; overflow: hidden;">
				<table class="crayon-table" style="">
					<tbody><tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5c08128ae9300155667847-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c08128ae9300155667847-2">2</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5c08128ae9300155667847-1"><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">add</span><span class="crayon-sy">(</span><span class="crayon-e">TimeDistributed</span><span class="crayon-sy">(</span><span class="crayon-e">Dense</span><span class="crayon-sy">(</span><span class="crayon-cn">100</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">activation</span><span class="crayon-o">=</span><span class="crayon-s">'relu'</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c08128ae9300155667847-2"><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">add</span><span class="crayon-sy">(</span><span class="crayon-e">TimeDistributed</span><span class="crayon-sy">(</span><span class="crayon-e">Dense</span><span class="crayon-sy">(</span><span class="crayon-cn">1</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div></div></td>
					</tr>
				</tbody></table>
			</div>
		</div>
<!-- [Format Time: 0.0002 seconds] -->
<p>This allows the LSTM decoder to figure out the context required for 
each step in the output sequence and the wrapped dense layers to 
interpret each time step separately, yet reusing the same weights to 
perform the interpretation. An alternative would be to flatten all of 
the structure created by the LSTM decoder and to output the vector 
directly. You can try this as an extension to see how it compares.</p>
<p>The network therefore outputs a three-dimensional vector with the same structure as the input, with the dimensions [<em>samples, timesteps, features</em>].</p>
<p>There is a single feature, the daily total power consumed, and there 
are always seven features. A single one-week prediction will therefore 
have the size: [<em>1, 7, 1</em>].</p>
<p>Therefore, when training the model, we must restructure the output data (<em>y</em>) to have the three-dimensional structure instead of the two-dimensional structure of [<em>samples, features</em>] used in the previous section.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->

		<div id="crayon-5c08128ae9302007067005" class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" style="margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important; height: auto;">
		
			<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important; height: 18px !important; line-height: 18px !important; margin-top: -19px; display: none; z-index: 4;"><span class="crayon-title"></span>
			<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button crayon-pressed" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code" style="display: none;"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
			<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
			<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="readonly" style="-moz-tab-size: 4; font-size: 12px !important; line-height: 15px !important; z-index: 0; opacity: 0; overflow: hidden;" wrap="soft"># reshape output into [samples, timesteps, features]
train_y = train_y.reshape((train_y.shape[0], train_y.shape[1], 1))</textarea></div>
			<div class="crayon-main" style="position: relative; z-index: 1; overflow: hidden;">
				<table class="crayon-table" style="">
					<tbody><tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5c08128ae9302007067005-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c08128ae9302007067005-2">2</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5c08128ae9302007067005-1"><span class="crayon-p"># reshape output into [samples, timesteps, features]</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c08128ae9302007067005-2"><span class="crayon-v">train_y</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">train_y</span><span class="crayon-sy">.</span><span class="crayon-e">reshape</span><span class="crayon-sy">(</span><span class="crayon-sy">(</span><span class="crayon-v">train_y</span><span class="crayon-sy">.</span><span class="crayon-v">shape</span><span class="crayon-sy">[</span><span class="crayon-cn">0</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">train_y</span><span class="crayon-sy">.</span><span class="crayon-v">shape</span><span class="crayon-sy">[</span><span class="crayon-cn">1</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">1</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div></div></td>
					</tr>
				</tbody></table>
			</div>
		</div>
<!-- [Format Time: 0.0002 seconds] -->
<p>We can tie all of this together into the updated <em>build_model()</em> function listed below.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->

		<div id="crayon-5c08128ae9304644461670" class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" style="margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important; height: auto;">
		
			<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important; height: 18px !important; line-height: 18px !important; margin-top: -19px; display: none; position: absolute; z-index: 2;"><span class="crayon-title"></span>
			<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button crayon-pressed" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
			<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
			<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="readonly" style="-moz-tab-size: 4; font-size: 12px !important; line-height: 15px !important; z-index: 0; opacity: 0; overflow: hidden;" wrap="soft"># train the model
def build_model(train, n_input):
	# prepare data
	train_x, train_y = to_supervised(train, n_input)
	# define parameters
	verbose, epochs, batch_size = 0, 20, 16
	n_timesteps, n_features, n_outputs = train_x.shape[1], train_x.shape[2], train_y.shape[1]
	# reshape output into [samples, timesteps, features]
	train_y = train_y.reshape((train_y.shape[0], train_y.shape[1], 1))
	# define model
	model = Sequential()
	model.add(LSTM(200, activation='relu', input_shape=(n_timesteps, n_features)))
	model.add(RepeatVector(n_outputs))
	model.add(LSTM(200, activation='relu', return_sequences=True))
	model.add(TimeDistributed(Dense(100, activation='relu')))
	model.add(TimeDistributed(Dense(1)))
	model.compile(loss='mse', optimizer='adam')
	# fit network
	model.fit(train_x, train_y, epochs=epochs, batch_size=batch_size, verbose=verbose)
	return model</textarea></div>
			<div class="crayon-main" style="position: relative; z-index: 1; overflow: hidden;">
				<table class="crayon-table" style="">
					<tbody><tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5c08128ae9304644461670-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c08128ae9304644461670-2">2</div><div class="crayon-num" data-line="crayon-5c08128ae9304644461670-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c08128ae9304644461670-4">4</div><div class="crayon-num" data-line="crayon-5c08128ae9304644461670-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c08128ae9304644461670-6">6</div><div class="crayon-num" data-line="crayon-5c08128ae9304644461670-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c08128ae9304644461670-8">8</div><div class="crayon-num" data-line="crayon-5c08128ae9304644461670-9">9</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c08128ae9304644461670-10">10</div><div class="crayon-num" data-line="crayon-5c08128ae9304644461670-11">11</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c08128ae9304644461670-12">12</div><div class="crayon-num" data-line="crayon-5c08128ae9304644461670-13">13</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c08128ae9304644461670-14">14</div><div class="crayon-num" data-line="crayon-5c08128ae9304644461670-15">15</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c08128ae9304644461670-16">16</div><div class="crayon-num" data-line="crayon-5c08128ae9304644461670-17">17</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c08128ae9304644461670-18">18</div><div class="crayon-num" data-line="crayon-5c08128ae9304644461670-19">19</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c08128ae9304644461670-20">20</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5c08128ae9304644461670-1"><span class="crayon-p"># train the model</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c08128ae9304644461670-2"><span class="crayon-e">def </span><span class="crayon-e">build_model</span><span class="crayon-sy">(</span><span class="crayon-v">train</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_input</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5c08128ae9304644461670-3"><span class="crayon-h">	</span><span class="crayon-p"># prepare data</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c08128ae9304644461670-4"><span class="crayon-h">	</span><span class="crayon-v">train_x</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">train_y</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">to_supervised</span><span class="crayon-sy">(</span><span class="crayon-v">train</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_input</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c08128ae9304644461670-5"><span class="crayon-h">	</span><span class="crayon-p"># define parameters</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c08128ae9304644461670-6"><span class="crayon-h">	</span><span class="crayon-v">verbose</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">epochs</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">batch_size</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-cn">0</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">20</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">16</span></div><div class="crayon-line" id="crayon-5c08128ae9304644461670-7"><span class="crayon-h">	</span><span class="crayon-v">n_timesteps</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_features</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_outputs</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">train_x</span><span class="crayon-sy">.</span><span class="crayon-v">shape</span><span class="crayon-sy">[</span><span class="crayon-cn">1</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">train_x</span><span class="crayon-sy">.</span><span class="crayon-v">shape</span><span class="crayon-sy">[</span><span class="crayon-cn">2</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">train_y</span><span class="crayon-sy">.</span><span class="crayon-v">shape</span><span class="crayon-sy">[</span><span class="crayon-cn">1</span><span class="crayon-sy">]</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c08128ae9304644461670-8"><span class="crayon-h">	</span><span class="crayon-p"># reshape output into [samples, timesteps, features]</span></div><div class="crayon-line" id="crayon-5c08128ae9304644461670-9"><span class="crayon-h">	</span><span class="crayon-v">train_y</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">train_y</span><span class="crayon-sy">.</span><span class="crayon-e">reshape</span><span class="crayon-sy">(</span><span class="crayon-sy">(</span><span class="crayon-v">train_y</span><span class="crayon-sy">.</span><span class="crayon-v">shape</span><span class="crayon-sy">[</span><span class="crayon-cn">0</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">train_y</span><span class="crayon-sy">.</span><span class="crayon-v">shape</span><span class="crayon-sy">[</span><span class="crayon-cn">1</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">1</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c08128ae9304644461670-10"><span class="crayon-h">	</span><span class="crayon-p"># define model</span></div><div class="crayon-line" id="crayon-5c08128ae9304644461670-11"><span class="crayon-h">	</span><span class="crayon-v">model</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">Sequential</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c08128ae9304644461670-12"><span class="crayon-h">	</span><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">add</span><span class="crayon-sy">(</span><span class="crayon-e">LSTM</span><span class="crayon-sy">(</span><span class="crayon-cn">200</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">activation</span><span class="crayon-o">=</span><span class="crayon-s">'relu'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">input_shape</span><span class="crayon-o">=</span><span class="crayon-sy">(</span><span class="crayon-v">n_timesteps</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_features</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c08128ae9304644461670-13"><span class="crayon-h">	</span><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">add</span><span class="crayon-sy">(</span><span class="crayon-e">RepeatVector</span><span class="crayon-sy">(</span><span class="crayon-v">n_outputs</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c08128ae9304644461670-14"><span class="crayon-h">	</span><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">add</span><span class="crayon-sy">(</span><span class="crayon-e">LSTM</span><span class="crayon-sy">(</span><span class="crayon-cn">200</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">activation</span><span class="crayon-o">=</span><span class="crayon-s">'relu'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">return_sequences</span><span class="crayon-o">=</span><span class="crayon-t">True</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c08128ae9304644461670-15"><span class="crayon-h">	</span><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">add</span><span class="crayon-sy">(</span><span class="crayon-e">TimeDistributed</span><span class="crayon-sy">(</span><span class="crayon-e">Dense</span><span class="crayon-sy">(</span><span class="crayon-cn">100</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">activation</span><span class="crayon-o">=</span><span class="crayon-s">'relu'</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c08128ae9304644461670-16"><span class="crayon-h">	</span><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">add</span><span class="crayon-sy">(</span><span class="crayon-e">TimeDistributed</span><span class="crayon-sy">(</span><span class="crayon-e">Dense</span><span class="crayon-sy">(</span><span class="crayon-cn">1</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c08128ae9304644461670-17"><span class="crayon-h">	</span><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">compile</span><span class="crayon-sy">(</span><span class="crayon-v">loss</span><span class="crayon-o">=</span><span class="crayon-s">'mse'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">optimizer</span><span class="crayon-o">=</span><span class="crayon-s">'adam'</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c08128ae9304644461670-18"><span class="crayon-h">	</span><span class="crayon-p"># fit network</span></div><div class="crayon-line" id="crayon-5c08128ae9304644461670-19"><span class="crayon-h">	</span><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">fit</span><span class="crayon-sy">(</span><span class="crayon-v">train_x</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">train_y</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">epochs</span><span class="crayon-o">=</span><span class="crayon-v">epochs</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">batch_size</span><span class="crayon-o">=</span><span class="crayon-v">batch_size</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">verbose</span><span class="crayon-o">=</span><span class="crayon-v">verbose</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c08128ae9304644461670-20"><span class="crayon-h">	</span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">model</span></div></div></td>
					</tr>
				</tbody></table>
			</div>
		</div>
<!-- [Format Time: 0.0016 seconds] -->
<p>The complete example with the encoder-decoder model is listed below.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->

		<div id="crayon-5c08128ae9306271388512" class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" style="margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important; height: auto;">
		
			<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important; height: 18px !important; line-height: 18px !important; margin-top: -19px; display: none; position: absolute; z-index: 2;"><span class="crayon-title"></span>
			<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button crayon-pressed" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
			<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
			<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="readonly" style="-moz-tab-size: 4; font-size: 12px !important; line-height: 15px !important; z-index: 0; opacity: 0; overflow: hidden;" wrap="soft">#
 univariate multi-step encoder-decoder lstm
from math import sqrt
from numpy import split
from numpy import array
from pandas import read_csv
from sklearn.metrics import mean_squared_error
from matplotlib import pyplot
from keras.models import Sequential
from keras.layers import Dense
from keras.layers import Flatten
from keras.layers import LSTM
from keras.layers import RepeatVector
from keras.layers import TimeDistributed

# split a univariate dataset into train/test sets
def split_dataset(data):
	# split into standard weeks
	train, test = data[1:-328], data[-328:-6]
	# restructure into windows of weekly data
	train = array(split(train, len(train)/7))
	test = array(split(test, len(test)/7))
	return train, test

# evaluate one or more weekly forecasts against expected values
def evaluate_forecasts(actual, predicted):
	scores = list()
	# calculate an RMSE score for each day
	for i in range(actual.shape[1]):
		# calculate mse
		mse = mean_squared_error(actual[:, i], predicted[:, i])
		# calculate rmse
		rmse = sqrt(mse)
		# store
		scores.append(rmse)
	# calculate overall RMSE
	s = 0
	for row in range(actual.shape[0]):
		for col in range(actual.shape[1]):
			s += (actual[row, col] - predicted[row, col])**2
	score = sqrt(s / (actual.shape[0] * actual.shape[1]))
	return score, scores

# summarize scores
def summarize_scores(name, score, scores):
	s_scores = ', '.join(['%.1f' % s for s in scores])
	print('%s: [%.3f] %s' % (name, score, s_scores))

# convert history into inputs and outputs
def to_supervised(train, n_input, n_out=7):
	# flatten data
	data = train.reshape((train.shape[0]*train.shape[1], train.shape[2]))
	X, y = list(), list()
	in_start = 0
	# step over the entire history one time step at a time
	for _ in range(len(data)):
		# define the end of the input sequence
		in_end = in_start + n_input
		out_end = in_end + n_out
		# ensure we have enough data for this instance
		if out_end &lt; len(data):
			x_input = data[in_start:in_end, 0]
			x_input = x_input.reshape((len(x_input), 1))
			X.append(x_input)
			y.append(data[in_end:out_end, 0])
		# move along one time step
		in_start += 1
	return array(X), array(y)

# train the model
def build_model(train, n_input):
	# prepare data
	train_x, train_y = to_supervised(train, n_input)
	# define parameters
	verbose, epochs, batch_size = 0, 20, 16
	n_timesteps, n_features, n_outputs = train_x.shape[1], 
train_x.shape[2], train_y.shape[1]
	# reshape output into [samples, timesteps, features]
	train_y = train_y.reshape((train_y.shape[0], train_y.shape[1], 1))
	# define model
	model = Sequential()
	model.add(LSTM(200, activation='relu', input_shape=(n_timesteps, 
n_features)))
	model.add(RepeatVector(n_outputs))
	model.add(LSTM(200, activation='relu', return_sequences=True))
	model.add(TimeDistributed(Dense(100, activation='relu')))
	model.add(TimeDistributed(Dense(1)))
	model.compile(loss='mse', optimizer='adam')
	# fit network
	model.fit(train_x, train_y, epochs=epochs, batch_size=batch_size, 
verbose=verbose)
	return model

# make a forecast
def forecast(model, history, n_input):
	# flatten data
	data = array(history)
	data = data.reshape((data.shape[0]*data.shape[1], data.shape[2]))
	# retrieve last observations for input data
	input_x = data[-n_input:, 0]
	# reshape into [1, n_input, 1]
	input_x = input_x.reshape((1, len(input_x), 1))
	# forecast the next week
	yhat = model.predict(input_x, verbose=0)
	# we only want the vector forecast
	yhat = yhat[0]
	return yhat

# evaluate a single model
def evaluate_model(train, test, n_input):
	# fit model
	model = build_model(train, n_input)
	# history is a list of weekly data
	history = [x for x in train]
	# walk-forward validation over each week
	predictions = list()
	for i in range(len(test)):
		# predict the week
		yhat_sequence = forecast(model, history, n_input)
		# store the predictions
		predictions.append(yhat_sequence)
		# get real observation and add to history for predicting the next week
		history.append(test[i, :])
	# evaluate predictions days for each week
	predictions = array(predictions)
	score, scores = evaluate_forecasts(test[:, :, 0], predictions)
	return score, scores

# load the new file
dataset = read_csv('household_power_consumption_days.csv', header=0, 
infer_datetime_format=True, parse_dates=['datetime'], 
index_col=['datetime'])
# split into train and test
train, test = split_dataset(dataset.values)
# evaluate model and get scores
n_input = 14
score, scores = evaluate_model(train, test, n_input)
# summarize scores
summarize_scores('lstm', score, scores)
# plot scores
days = ['sun', 'mon', 'tue', 'wed', 'thr', 'fri', 'sat']
pyplot.plot(days, scores, marker='o', label='lstm')
pyplot.show()</textarea></div>
			<div class="crayon-main" style="position: relative; z-index: 1; overflow: hidden;">
				<table class="crayon-table" style="">
					<tbody><tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5c08128ae9306271388512-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c08128ae9306271388512-2">2</div><div class="crayon-num" data-line="crayon-5c08128ae9306271388512-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c08128ae9306271388512-4">4</div><div class="crayon-num" data-line="crayon-5c08128ae9306271388512-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c08128ae9306271388512-6">6</div><div class="crayon-num" data-line="crayon-5c08128ae9306271388512-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c08128ae9306271388512-8">8</div><div class="crayon-num" data-line="crayon-5c08128ae9306271388512-9">9</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c08128ae9306271388512-10">10</div><div class="crayon-num" data-line="crayon-5c08128ae9306271388512-11">11</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c08128ae9306271388512-12">12</div><div class="crayon-num" data-line="crayon-5c08128ae9306271388512-13">13</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c08128ae9306271388512-14">14</div><div class="crayon-num" data-line="crayon-5c08128ae9306271388512-15">15</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c08128ae9306271388512-16">16</div><div class="crayon-num" data-line="crayon-5c08128ae9306271388512-17">17</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c08128ae9306271388512-18">18</div><div class="crayon-num" data-line="crayon-5c08128ae9306271388512-19">19</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c08128ae9306271388512-20">20</div><div class="crayon-num" data-line="crayon-5c08128ae9306271388512-21">21</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c08128ae9306271388512-22">22</div><div class="crayon-num" data-line="crayon-5c08128ae9306271388512-23">23</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c08128ae9306271388512-24">24</div><div class="crayon-num" data-line="crayon-5c08128ae9306271388512-25">25</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c08128ae9306271388512-26">26</div><div class="crayon-num" data-line="crayon-5c08128ae9306271388512-27">27</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c08128ae9306271388512-28">28</div><div class="crayon-num" data-line="crayon-5c08128ae9306271388512-29">29</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c08128ae9306271388512-30">30</div><div class="crayon-num" data-line="crayon-5c08128ae9306271388512-31">31</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c08128ae9306271388512-32">32</div><div class="crayon-num" data-line="crayon-5c08128ae9306271388512-33">33</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c08128ae9306271388512-34">34</div><div class="crayon-num" data-line="crayon-5c08128ae9306271388512-35">35</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c08128ae9306271388512-36">36</div><div class="crayon-num" data-line="crayon-5c08128ae9306271388512-37">37</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c08128ae9306271388512-38">38</div><div class="crayon-num" data-line="crayon-5c08128ae9306271388512-39">39</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c08128ae9306271388512-40">40</div><div class="crayon-num" data-line="crayon-5c08128ae9306271388512-41">41</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c08128ae9306271388512-42">42</div><div class="crayon-num" data-line="crayon-5c08128ae9306271388512-43">43</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c08128ae9306271388512-44">44</div><div class="crayon-num" data-line="crayon-5c08128ae9306271388512-45">45</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c08128ae9306271388512-46">46</div><div class="crayon-num" data-line="crayon-5c08128ae9306271388512-47">47</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c08128ae9306271388512-48">48</div><div class="crayon-num" data-line="crayon-5c08128ae9306271388512-49">49</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c08128ae9306271388512-50">50</div><div class="crayon-num" data-line="crayon-5c08128ae9306271388512-51">51</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c08128ae9306271388512-52">52</div><div class="crayon-num" data-line="crayon-5c08128ae9306271388512-53">53</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c08128ae9306271388512-54">54</div><div class="crayon-num" data-line="crayon-5c08128ae9306271388512-55">55</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c08128ae9306271388512-56">56</div><div class="crayon-num" data-line="crayon-5c08128ae9306271388512-57">57</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c08128ae9306271388512-58">58</div><div class="crayon-num" data-line="crayon-5c08128ae9306271388512-59">59</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c08128ae9306271388512-60">60</div><div class="crayon-num" data-line="crayon-5c08128ae9306271388512-61">61</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c08128ae9306271388512-62">62</div><div class="crayon-num" data-line="crayon-5c08128ae9306271388512-63">63</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c08128ae9306271388512-64">64</div><div class="crayon-num" data-line="crayon-5c08128ae9306271388512-65">65</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c08128ae9306271388512-66">66</div><div class="crayon-num" data-line="crayon-5c08128ae9306271388512-67">67</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c08128ae9306271388512-68">68</div><div class="crayon-num" data-line="crayon-5c08128ae9306271388512-69">69</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c08128ae9306271388512-70">70</div><div class="crayon-num" data-line="crayon-5c08128ae9306271388512-71">71</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c08128ae9306271388512-72">72</div><div class="crayon-num" data-line="crayon-5c08128ae9306271388512-73">73</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c08128ae9306271388512-74">74</div><div class="crayon-num" data-line="crayon-5c08128ae9306271388512-75">75</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c08128ae9306271388512-76">76</div><div class="crayon-num" data-line="crayon-5c08128ae9306271388512-77">77</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c08128ae9306271388512-78">78</div><div class="crayon-num" data-line="crayon-5c08128ae9306271388512-79">79</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c08128ae9306271388512-80">80</div><div class="crayon-num" data-line="crayon-5c08128ae9306271388512-81">81</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c08128ae9306271388512-82">82</div><div class="crayon-num" data-line="crayon-5c08128ae9306271388512-83">83</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c08128ae9306271388512-84">84</div><div class="crayon-num" data-line="crayon-5c08128ae9306271388512-85">85</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c08128ae9306271388512-86">86</div><div class="crayon-num" data-line="crayon-5c08128ae9306271388512-87">87</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c08128ae9306271388512-88">88</div><div class="crayon-num" data-line="crayon-5c08128ae9306271388512-89">89</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c08128ae9306271388512-90">90</div><div class="crayon-num" data-line="crayon-5c08128ae9306271388512-91">91</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c08128ae9306271388512-92">92</div><div class="crayon-num" data-line="crayon-5c08128ae9306271388512-93">93</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c08128ae9306271388512-94">94</div><div class="crayon-num" data-line="crayon-5c08128ae9306271388512-95">95</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c08128ae9306271388512-96">96</div><div class="crayon-num" data-line="crayon-5c08128ae9306271388512-97">97</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c08128ae9306271388512-98">98</div><div class="crayon-num" data-line="crayon-5c08128ae9306271388512-99">99</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c08128ae9306271388512-100">100</div><div class="crayon-num" data-line="crayon-5c08128ae9306271388512-101">101</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c08128ae9306271388512-102">102</div><div class="crayon-num" data-line="crayon-5c08128ae9306271388512-103">103</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c08128ae9306271388512-104">104</div><div class="crayon-num" data-line="crayon-5c08128ae9306271388512-105">105</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c08128ae9306271388512-106">106</div><div class="crayon-num" data-line="crayon-5c08128ae9306271388512-107">107</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c08128ae9306271388512-108">108</div><div class="crayon-num" data-line="crayon-5c08128ae9306271388512-109">109</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c08128ae9306271388512-110">110</div><div class="crayon-num" data-line="crayon-5c08128ae9306271388512-111">111</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c08128ae9306271388512-112">112</div><div class="crayon-num" data-line="crayon-5c08128ae9306271388512-113">113</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c08128ae9306271388512-114">114</div><div class="crayon-num" data-line="crayon-5c08128ae9306271388512-115">115</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c08128ae9306271388512-116">116</div><div class="crayon-num" data-line="crayon-5c08128ae9306271388512-117">117</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c08128ae9306271388512-118">118</div><div class="crayon-num" data-line="crayon-5c08128ae9306271388512-119">119</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c08128ae9306271388512-120">120</div><div class="crayon-num" data-line="crayon-5c08128ae9306271388512-121">121</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c08128ae9306271388512-122">122</div><div class="crayon-num" data-line="crayon-5c08128ae9306271388512-123">123</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c08128ae9306271388512-124">124</div><div class="crayon-num" data-line="crayon-5c08128ae9306271388512-125">125</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c08128ae9306271388512-126">126</div><div class="crayon-num" data-line="crayon-5c08128ae9306271388512-127">127</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c08128ae9306271388512-128">128</div><div class="crayon-num" data-line="crayon-5c08128ae9306271388512-129">129</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c08128ae9306271388512-130">130</div><div class="crayon-num" data-line="crayon-5c08128ae9306271388512-131">131</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c08128ae9306271388512-132">132</div><div class="crayon-num" data-line="crayon-5c08128ae9306271388512-133">133</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c08128ae9306271388512-134">134</div><div class="crayon-num" data-line="crayon-5c08128ae9306271388512-135">135</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c08128ae9306271388512-136">136</div><div class="crayon-num" data-line="crayon-5c08128ae9306271388512-137">137</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5c08128ae9306271388512-1"><span class="crayon-p"># univariate multi-step encoder-decoder lstm</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c08128ae9306271388512-2"><span class="crayon-e">from </span><span class="crayon-e">math </span><span class="crayon-e">import </span><span class="crayon-e">sqrt</span></div><div class="crayon-line" id="crayon-5c08128ae9306271388512-3"><span class="crayon-e">from </span><span class="crayon-e">numpy </span><span class="crayon-e">import </span><span class="crayon-e">split</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c08128ae9306271388512-4"><span class="crayon-e">from </span><span class="crayon-e">numpy </span><span class="crayon-e">import </span><span class="crayon-t">array</span></div><div class="crayon-line" id="crayon-5c08128ae9306271388512-5"><span class="crayon-e">from </span><span class="crayon-e">pandas </span><span class="crayon-e">import </span><span class="crayon-e">read_csv</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c08128ae9306271388512-6"><span class="crayon-e">from </span><span class="crayon-v">sklearn</span><span class="crayon-sy">.</span><span class="crayon-e">metrics </span><span class="crayon-e">import </span><span class="crayon-e">mean_squared_error</span></div><div class="crayon-line" id="crayon-5c08128ae9306271388512-7"><span class="crayon-e">from </span><span class="crayon-e">matplotlib </span><span class="crayon-e">import </span><span class="crayon-e">pyplot</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c08128ae9306271388512-8"><span class="crayon-e">from </span><span class="crayon-v">keras</span><span class="crayon-sy">.</span><span class="crayon-e">models </span><span class="crayon-e">import </span><span class="crayon-e">Sequential</span></div><div class="crayon-line" id="crayon-5c08128ae9306271388512-9"><span class="crayon-e">from </span><span class="crayon-v">keras</span><span class="crayon-sy">.</span><span class="crayon-e">layers </span><span class="crayon-e">import </span><span class="crayon-e">Dense</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c08128ae9306271388512-10"><span class="crayon-e">from </span><span class="crayon-v">keras</span><span class="crayon-sy">.</span><span class="crayon-e">layers </span><span class="crayon-e">import </span><span class="crayon-e">Flatten</span></div><div class="crayon-line" id="crayon-5c08128ae9306271388512-11"><span class="crayon-e">from </span><span class="crayon-v">keras</span><span class="crayon-sy">.</span><span class="crayon-e">layers </span><span class="crayon-e">import </span><span class="crayon-e">LSTM</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c08128ae9306271388512-12"><span class="crayon-e">from </span><span class="crayon-v">keras</span><span class="crayon-sy">.</span><span class="crayon-e">layers </span><span class="crayon-e">import </span><span class="crayon-e">RepeatVector</span></div><div class="crayon-line" id="crayon-5c08128ae9306271388512-13"><span class="crayon-e">from </span><span class="crayon-v">keras</span><span class="crayon-sy">.</span><span class="crayon-e">layers </span><span class="crayon-e">import </span><span class="crayon-v">TimeDistributed</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c08128ae9306271388512-14">&nbsp;</div><div class="crayon-line" id="crayon-5c08128ae9306271388512-15"><span class="crayon-p"># split a univariate dataset into train/test sets</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c08128ae9306271388512-16"><span class="crayon-e">def </span><span class="crayon-e">split_dataset</span><span class="crayon-sy">(</span><span class="crayon-v">data</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5c08128ae9306271388512-17"><span class="crayon-h">	</span><span class="crayon-p"># split into standard weeks</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c08128ae9306271388512-18"><span class="crayon-h">	</span><span class="crayon-v">train</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">test</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">data</span><span class="crayon-sy">[</span><span class="crayon-cn">1</span><span class="crayon-o">:</span><span class="crayon-o">-</span><span class="crayon-cn">328</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">data</span><span class="crayon-sy">[</span><span class="crayon-o">-</span><span class="crayon-cn">328</span><span class="crayon-o">:</span><span class="crayon-o">-</span><span class="crayon-cn">6</span><span class="crayon-sy">]</span></div><div class="crayon-line" id="crayon-5c08128ae9306271388512-19"><span class="crayon-h">	</span><span class="crayon-p"># restructure into windows of weekly data</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c08128ae9306271388512-20"><span class="crayon-h">	</span><span class="crayon-v">train</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-t">array</span><span class="crayon-sy">(</span><span class="crayon-e">split</span><span class="crayon-sy">(</span><span class="crayon-v">train</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-e">len</span><span class="crayon-sy">(</span><span class="crayon-v">train</span><span class="crayon-sy">)</span><span class="crayon-o">/</span><span class="crayon-cn">7</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c08128ae9306271388512-21"><span class="crayon-h">	</span><span class="crayon-v">test</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-t">array</span><span class="crayon-sy">(</span><span class="crayon-e">split</span><span class="crayon-sy">(</span><span class="crayon-v">test</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-e">len</span><span class="crayon-sy">(</span><span class="crayon-v">test</span><span class="crayon-sy">)</span><span class="crayon-o">/</span><span class="crayon-cn">7</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c08128ae9306271388512-22"><span class="crayon-h">	</span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">train</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">test</span></div><div class="crayon-line" id="crayon-5c08128ae9306271388512-23">&nbsp;</div><div class="crayon-line crayon-striped-line" id="crayon-5c08128ae9306271388512-24"><span class="crayon-p"># evaluate one or more weekly forecasts against expected values</span></div><div class="crayon-line" id="crayon-5c08128ae9306271388512-25"><span class="crayon-e">def </span><span class="crayon-e">evaluate_forecasts</span><span class="crayon-sy">(</span><span class="crayon-v">actual</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">predicted</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c08128ae9306271388512-26"><span class="crayon-h">	</span><span class="crayon-v">scores</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">list</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c08128ae9306271388512-27"><span class="crayon-h">	</span><span class="crayon-p"># calculate an RMSE score for each day</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c08128ae9306271388512-28"><span class="crayon-h">	</span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">i</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-v">actual</span><span class="crayon-sy">.</span><span class="crayon-v">shape</span><span class="crayon-sy">[</span><span class="crayon-cn">1</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5c08128ae9306271388512-29"><span class="crayon-h">		</span><span class="crayon-p"># calculate mse</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c08128ae9306271388512-30"><span class="crayon-h">		</span><span class="crayon-v">mse</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">mean_squared_error</span><span class="crayon-sy">(</span><span class="crayon-v">actual</span><span class="crayon-sy">[</span><span class="crayon-o">:</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">i</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">predicted</span><span class="crayon-sy">[</span><span class="crayon-o">:</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">i</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c08128ae9306271388512-31"><span class="crayon-h">		</span><span class="crayon-p"># calculate rmse</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c08128ae9306271388512-32"><span class="crayon-h">		</span><span class="crayon-v">rmse</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">sqrt</span><span class="crayon-sy">(</span><span class="crayon-v">mse</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c08128ae9306271388512-33"><span class="crayon-h">		</span><span class="crayon-p"># store</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c08128ae9306271388512-34"><span class="crayon-h">		</span><span class="crayon-v">scores</span><span class="crayon-sy">.</span><span class="crayon-e">append</span><span class="crayon-sy">(</span><span class="crayon-v">rmse</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c08128ae9306271388512-35"><span class="crayon-h">	</span><span class="crayon-p"># calculate overall RMSE</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c08128ae9306271388512-36"><span class="crayon-h">	</span><span class="crayon-v">s</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-cn">0</span></div><div class="crayon-line" id="crayon-5c08128ae9306271388512-37"><span class="crayon-h">	</span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-e">row </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-v">actual</span><span class="crayon-sy">.</span><span class="crayon-v">shape</span><span class="crayon-sy">[</span><span class="crayon-cn">0</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c08128ae9306271388512-38"><span class="crayon-h">		</span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-e">col </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-v">actual</span><span class="crayon-sy">.</span><span class="crayon-v">shape</span><span class="crayon-sy">[</span><span class="crayon-cn">1</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5c08128ae9306271388512-39"><span class="crayon-h">			</span><span class="crayon-v">s</span><span class="crayon-h"> </span><span class="crayon-o">+=</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-v">actual</span><span class="crayon-sy">[</span><span class="crayon-v">row</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">col</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-o">-</span><span class="crayon-h"> </span><span class="crayon-v">predicted</span><span class="crayon-sy">[</span><span class="crayon-v">row</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">col</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span><span class="crayon-o">*</span><span class="crayon-o">*</span><span class="crayon-cn">2</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c08128ae9306271388512-40"><span class="crayon-h">	</span><span class="crayon-v">score</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">sqrt</span><span class="crayon-sy">(</span><span class="crayon-v">s</span><span class="crayon-h"> </span><span class="crayon-o">/</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-v">actual</span><span class="crayon-sy">.</span><span class="crayon-v">shape</span><span class="crayon-sy">[</span><span class="crayon-cn">0</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-o">*</span><span class="crayon-h"> </span><span class="crayon-v">actual</span><span class="crayon-sy">.</span><span class="crayon-v">shape</span><span class="crayon-sy">[</span><span class="crayon-cn">1</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c08128ae9306271388512-41"><span class="crayon-h">	</span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">score</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">scores</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c08128ae9306271388512-42">&nbsp;</div><div class="crayon-line" id="crayon-5c08128ae9306271388512-43"><span class="crayon-p"># summarize scores</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c08128ae9306271388512-44"><span class="crayon-e">def </span><span class="crayon-e">summarize_scores</span><span class="crayon-sy">(</span><span class="crayon-v">name</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">score</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">scores</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5c08128ae9306271388512-45"><span class="crayon-h">	</span><span class="crayon-v">s_scores</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-s">', '</span><span class="crayon-sy">.</span><span class="crayon-e">join</span><span class="crayon-sy">(</span><span class="crayon-sy">[</span><span class="crayon-s">'%.1f'</span><span class="crayon-h"> </span><span class="crayon-o">%</span><span class="crayon-h"> </span><span class="crayon-i">s</span><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">s</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-v">scores</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c08128ae9306271388512-46"><span class="crayon-h">	</span><span class="crayon-e">print</span><span class="crayon-sy">(</span><span class="crayon-s">'%s: [%.3f] %s'</span><span class="crayon-h"> </span><span class="crayon-o">%</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-v">name</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">score</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">s_scores</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c08128ae9306271388512-47">&nbsp;</div><div class="crayon-line crayon-striped-line" id="crayon-5c08128ae9306271388512-48"><span class="crayon-p"># convert history into inputs and outputs</span></div><div class="crayon-line" id="crayon-5c08128ae9306271388512-49"><span class="crayon-e">def </span><span class="crayon-e">to_supervised</span><span class="crayon-sy">(</span><span class="crayon-v">train</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_input</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_out</span><span class="crayon-o">=</span><span class="crayon-cn">7</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c08128ae9306271388512-50"><span class="crayon-h">	</span><span class="crayon-p"># flatten data</span></div><div class="crayon-line" id="crayon-5c08128ae9306271388512-51"><span class="crayon-h">	</span><span class="crayon-v">data</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">train</span><span class="crayon-sy">.</span><span class="crayon-e">reshape</span><span class="crayon-sy">(</span><span class="crayon-sy">(</span><span class="crayon-v">train</span><span class="crayon-sy">.</span><span class="crayon-v">shape</span><span class="crayon-sy">[</span><span class="crayon-cn">0</span><span class="crayon-sy">]</span><span class="crayon-o">*</span><span class="crayon-v">train</span><span class="crayon-sy">.</span><span class="crayon-v">shape</span><span class="crayon-sy">[</span><span class="crayon-cn">1</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">train</span><span class="crayon-sy">.</span><span class="crayon-v">shape</span><span class="crayon-sy">[</span><span class="crayon-cn">2</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c08128ae9306271388512-52"><span class="crayon-h">	</span><span class="crayon-v">X</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">y</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">list</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-e">list</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c08128ae9306271388512-53"><span class="crayon-h">	</span><span class="crayon-v">in_start</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-cn">0</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c08128ae9306271388512-54"><span class="crayon-h">	</span><span class="crayon-p"># step over the entire history one time step at a time</span></div><div class="crayon-line" id="crayon-5c08128ae9306271388512-55"><span class="crayon-h">	</span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">_</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-e">len</span><span class="crayon-sy">(</span><span class="crayon-v">data</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c08128ae9306271388512-56"><span class="crayon-h">		</span><span class="crayon-p"># define the end of the input sequence</span></div><div class="crayon-line" id="crayon-5c08128ae9306271388512-57"><span class="crayon-h">		</span><span class="crayon-v">in_end</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">in_start</span><span class="crayon-h"> </span><span class="crayon-o">+</span><span class="crayon-h"> </span><span class="crayon-e">n_input</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c08128ae9306271388512-58"><span class="crayon-e">		</span><span class="crayon-v">out_end</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">in_end</span><span class="crayon-h"> </span><span class="crayon-o">+</span><span class="crayon-h"> </span><span class="crayon-v">n_out</span></div><div class="crayon-line" id="crayon-5c08128ae9306271388512-59"><span class="crayon-h">		</span><span class="crayon-p"># ensure we have enough data for this instance</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c08128ae9306271388512-60"><span class="crayon-h">		</span><span class="crayon-st">if</span><span class="crayon-h"> </span><span class="crayon-v">out_end</span><span class="crayon-h"> </span><span class="crayon-o">&lt;</span><span class="crayon-h"> </span><span class="crayon-e">len</span><span class="crayon-sy">(</span><span class="crayon-v">data</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5c08128ae9306271388512-61"><span class="crayon-h">			</span><span class="crayon-v">x_input</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">data</span><span class="crayon-sy">[</span><span class="crayon-v">in_start</span><span class="crayon-o">:</span><span class="crayon-v">in_end</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">0</span><span class="crayon-sy">]</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c08128ae9306271388512-62"><span class="crayon-h">			</span><span class="crayon-v">x_input</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">x_input</span><span class="crayon-sy">.</span><span class="crayon-e">reshape</span><span class="crayon-sy">(</span><span class="crayon-sy">(</span><span class="crayon-e">len</span><span class="crayon-sy">(</span><span class="crayon-v">x_input</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">1</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c08128ae9306271388512-63"><span class="crayon-h">			</span><span class="crayon-v">X</span><span class="crayon-sy">.</span><span class="crayon-e">append</span><span class="crayon-sy">(</span><span class="crayon-v">x_input</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c08128ae9306271388512-64"><span class="crayon-h">			</span><span class="crayon-v">y</span><span class="crayon-sy">.</span><span class="crayon-e">append</span><span class="crayon-sy">(</span><span class="crayon-v">data</span><span class="crayon-sy">[</span><span class="crayon-v">in_end</span><span class="crayon-o">:</span><span class="crayon-v">out_end</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">0</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c08128ae9306271388512-65"><span class="crayon-h">		</span><span class="crayon-p"># move along one time step</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c08128ae9306271388512-66"><span class="crayon-h">		</span><span class="crayon-v">in_start</span><span class="crayon-h"> </span><span class="crayon-o">+=</span><span class="crayon-h"> </span><span class="crayon-cn">1</span></div><div class="crayon-line" id="crayon-5c08128ae9306271388512-67"><span class="crayon-h">	</span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-t">array</span><span class="crayon-sy">(</span><span class="crayon-v">X</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-t">array</span><span class="crayon-sy">(</span><span class="crayon-v">y</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c08128ae9306271388512-68">&nbsp;</div><div class="crayon-line" id="crayon-5c08128ae9306271388512-69"><span class="crayon-p"># train the model</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c08128ae9306271388512-70"><span class="crayon-e">def </span><span class="crayon-e">build_model</span><span class="crayon-sy">(</span><span class="crayon-v">train</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_input</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5c08128ae9306271388512-71"><span class="crayon-h">	</span><span class="crayon-p"># prepare data</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c08128ae9306271388512-72"><span class="crayon-h">	</span><span class="crayon-v">train_x</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">train_y</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">to_supervised</span><span class="crayon-sy">(</span><span class="crayon-v">train</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_input</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c08128ae9306271388512-73"><span class="crayon-h">	</span><span class="crayon-p"># define parameters</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c08128ae9306271388512-74"><span class="crayon-h">	</span><span class="crayon-v">verbose</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">epochs</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">batch_size</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-cn">0</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">20</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">16</span></div><div class="crayon-line" id="crayon-5c08128ae9306271388512-75"><span class="crayon-h">	</span><span class="crayon-v">n_timesteps</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_features</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_outputs</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">train_x</span><span class="crayon-sy">.</span><span class="crayon-v">shape</span><span class="crayon-sy">[</span><span class="crayon-cn">1</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">train_x</span><span class="crayon-sy">.</span><span class="crayon-v">shape</span><span class="crayon-sy">[</span><span class="crayon-cn">2</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">train_y</span><span class="crayon-sy">.</span><span class="crayon-v">shape</span><span class="crayon-sy">[</span><span class="crayon-cn">1</span><span class="crayon-sy">]</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c08128ae9306271388512-76"><span class="crayon-h">	</span><span class="crayon-p"># reshape output into [samples, timesteps, features]</span></div><div class="crayon-line" id="crayon-5c08128ae9306271388512-77"><span class="crayon-h">	</span><span class="crayon-v">train_y</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">train_y</span><span class="crayon-sy">.</span><span class="crayon-e">reshape</span><span class="crayon-sy">(</span><span class="crayon-sy">(</span><span class="crayon-v">train_y</span><span class="crayon-sy">.</span><span class="crayon-v">shape</span><span class="crayon-sy">[</span><span class="crayon-cn">0</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">train_y</span><span class="crayon-sy">.</span><span class="crayon-v">shape</span><span class="crayon-sy">[</span><span class="crayon-cn">1</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">1</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c08128ae9306271388512-78"><span class="crayon-h">	</span><span class="crayon-p"># define model</span></div><div class="crayon-line" id="crayon-5c08128ae9306271388512-79"><span class="crayon-h">	</span><span class="crayon-v">model</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">Sequential</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c08128ae9306271388512-80"><span class="crayon-h">	</span><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">add</span><span class="crayon-sy">(</span><span class="crayon-e">LSTM</span><span class="crayon-sy">(</span><span class="crayon-cn">200</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">activation</span><span class="crayon-o">=</span><span class="crayon-s">'relu'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">input_shape</span><span class="crayon-o">=</span><span class="crayon-sy">(</span><span class="crayon-v">n_timesteps</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_features</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c08128ae9306271388512-81"><span class="crayon-h">	</span><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">add</span><span class="crayon-sy">(</span><span class="crayon-e">RepeatVector</span><span class="crayon-sy">(</span><span class="crayon-v">n_outputs</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c08128ae9306271388512-82"><span class="crayon-h">	</span><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">add</span><span class="crayon-sy">(</span><span class="crayon-e">LSTM</span><span class="crayon-sy">(</span><span class="crayon-cn">200</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">activation</span><span class="crayon-o">=</span><span class="crayon-s">'relu'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">return_sequences</span><span class="crayon-o">=</span><span class="crayon-t">True</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c08128ae9306271388512-83"><span class="crayon-h">	</span><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">add</span><span class="crayon-sy">(</span><span class="crayon-e">TimeDistributed</span><span class="crayon-sy">(</span><span class="crayon-e">Dense</span><span class="crayon-sy">(</span><span class="crayon-cn">100</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">activation</span><span class="crayon-o">=</span><span class="crayon-s">'relu'</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c08128ae9306271388512-84"><span class="crayon-h">	</span><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">add</span><span class="crayon-sy">(</span><span class="crayon-e">TimeDistributed</span><span class="crayon-sy">(</span><span class="crayon-e">Dense</span><span class="crayon-sy">(</span><span class="crayon-cn">1</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c08128ae9306271388512-85"><span class="crayon-h">	</span><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">compile</span><span class="crayon-sy">(</span><span class="crayon-v">loss</span><span class="crayon-o">=</span><span class="crayon-s">'mse'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">optimizer</span><span class="crayon-o">=</span><span class="crayon-s">'adam'</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c08128ae9306271388512-86"><span class="crayon-h">	</span><span class="crayon-p"># fit network</span></div><div class="crayon-line" id="crayon-5c08128ae9306271388512-87"><span class="crayon-h">	</span><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">fit</span><span class="crayon-sy">(</span><span class="crayon-v">train_x</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">train_y</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">epochs</span><span class="crayon-o">=</span><span class="crayon-v">epochs</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">batch_size</span><span class="crayon-o">=</span><span class="crayon-v">batch_size</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">verbose</span><span class="crayon-o">=</span><span class="crayon-v">verbose</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c08128ae9306271388512-88"><span class="crayon-h">	</span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">model</span></div><div class="crayon-line" id="crayon-5c08128ae9306271388512-89">&nbsp;</div><div class="crayon-line crayon-striped-line" id="crayon-5c08128ae9306271388512-90"><span class="crayon-p"># make a forecast</span></div><div class="crayon-line" id="crayon-5c08128ae9306271388512-91"><span class="crayon-e">def </span><span class="crayon-e">forecast</span><span class="crayon-sy">(</span><span class="crayon-v">model</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">history</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_input</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c08128ae9306271388512-92"><span class="crayon-h">	</span><span class="crayon-p"># flatten data</span></div><div class="crayon-line" id="crayon-5c08128ae9306271388512-93"><span class="crayon-h">	</span><span class="crayon-v">data</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-t">array</span><span class="crayon-sy">(</span><span class="crayon-v">history</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c08128ae9306271388512-94"><span class="crayon-h">	</span><span class="crayon-v">data</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">data</span><span class="crayon-sy">.</span><span class="crayon-e">reshape</span><span class="crayon-sy">(</span><span class="crayon-sy">(</span><span class="crayon-v">data</span><span class="crayon-sy">.</span><span class="crayon-v">shape</span><span class="crayon-sy">[</span><span class="crayon-cn">0</span><span class="crayon-sy">]</span><span class="crayon-o">*</span><span class="crayon-v">data</span><span class="crayon-sy">.</span><span class="crayon-v">shape</span><span class="crayon-sy">[</span><span class="crayon-cn">1</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">data</span><span class="crayon-sy">.</span><span class="crayon-v">shape</span><span class="crayon-sy">[</span><span class="crayon-cn">2</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c08128ae9306271388512-95"><span class="crayon-h">	</span><span class="crayon-p"># retrieve last observations for input data</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c08128ae9306271388512-96"><span class="crayon-h">	</span><span class="crayon-v">input_x</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">data</span><span class="crayon-sy">[</span><span class="crayon-o">-</span><span class="crayon-v">n_input</span><span class="crayon-o">:</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">0</span><span class="crayon-sy">]</span></div><div class="crayon-line" id="crayon-5c08128ae9306271388512-97"><span class="crayon-h">	</span><span class="crayon-p"># reshape into [1, n_input, 1]</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c08128ae9306271388512-98"><span class="crayon-h">	</span><span class="crayon-v">input_x</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">input_x</span><span class="crayon-sy">.</span><span class="crayon-e">reshape</span><span class="crayon-sy">(</span><span class="crayon-sy">(</span><span class="crayon-cn">1</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-e">len</span><span class="crayon-sy">(</span><span class="crayon-v">input_x</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">1</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c08128ae9306271388512-99"><span class="crayon-h">	</span><span class="crayon-p"># forecast the next week</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c08128ae9306271388512-100"><span class="crayon-h">	</span><span class="crayon-v">yhat</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">predict</span><span class="crayon-sy">(</span><span class="crayon-v">input_x</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">verbose</span><span class="crayon-o">=</span><span class="crayon-cn">0</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c08128ae9306271388512-101"><span class="crayon-h">	</span><span class="crayon-p"># we only want the vector forecast</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c08128ae9306271388512-102"><span class="crayon-h">	</span><span class="crayon-v">yhat</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">yhat</span><span class="crayon-sy">[</span><span class="crayon-cn">0</span><span class="crayon-sy">]</span></div><div class="crayon-line" id="crayon-5c08128ae9306271388512-103"><span class="crayon-h">	</span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">yhat</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c08128ae9306271388512-104">&nbsp;</div><div class="crayon-line" id="crayon-5c08128ae9306271388512-105"><span class="crayon-p"># evaluate a single model</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c08128ae9306271388512-106"><span class="crayon-e">def </span><span class="crayon-e">evaluate_model</span><span class="crayon-sy">(</span><span class="crayon-v">train</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">test</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_input</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5c08128ae9306271388512-107"><span class="crayon-h">	</span><span class="crayon-p"># fit model</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c08128ae9306271388512-108"><span class="crayon-h">	</span><span class="crayon-v">model</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">build_model</span><span class="crayon-sy">(</span><span class="crayon-v">train</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_input</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c08128ae9306271388512-109"><span class="crayon-h">	</span><span class="crayon-p"># history is a list of weekly data</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c08128ae9306271388512-110"><span class="crayon-h">	</span><span class="crayon-v">history</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-i">x</span><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">x</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-v">train</span><span class="crayon-sy">]</span></div><div class="crayon-line" id="crayon-5c08128ae9306271388512-111"><span class="crayon-h">	</span><span class="crayon-p"># walk-forward validation over each week</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c08128ae9306271388512-112"><span class="crayon-h">	</span><span class="crayon-v">predictions</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">list</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c08128ae9306271388512-113"><span class="crayon-h">	</span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">i</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-e">len</span><span class="crayon-sy">(</span><span class="crayon-v">test</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c08128ae9306271388512-114"><span class="crayon-h">		</span><span class="crayon-p"># predict the week</span></div><div class="crayon-line" id="crayon-5c08128ae9306271388512-115"><span class="crayon-h">		</span><span class="crayon-v">yhat_sequence</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">forecast</span><span class="crayon-sy">(</span><span class="crayon-v">model</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">history</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_input</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c08128ae9306271388512-116"><span class="crayon-h">		</span><span class="crayon-p"># store the predictions</span></div><div class="crayon-line" id="crayon-5c08128ae9306271388512-117"><span class="crayon-h">		</span><span class="crayon-v">predictions</span><span class="crayon-sy">.</span><span class="crayon-e">append</span><span class="crayon-sy">(</span><span class="crayon-v">yhat_sequence</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c08128ae9306271388512-118"><span class="crayon-h">		</span><span class="crayon-p"># get real observation and add to history for predicting the next week</span></div><div class="crayon-line" id="crayon-5c08128ae9306271388512-119"><span class="crayon-h">		</span><span class="crayon-v">history</span><span class="crayon-sy">.</span><span class="crayon-e">append</span><span class="crayon-sy">(</span><span class="crayon-v">test</span><span class="crayon-sy">[</span><span class="crayon-v">i</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-o">:</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c08128ae9306271388512-120"><span class="crayon-h">	</span><span class="crayon-p"># evaluate predictions days for each week</span></div><div class="crayon-line" id="crayon-5c08128ae9306271388512-121"><span class="crayon-h">	</span><span class="crayon-v">predictions</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-t">array</span><span class="crayon-sy">(</span><span class="crayon-v">predictions</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c08128ae9306271388512-122"><span class="crayon-h">	</span><span class="crayon-v">score</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">scores</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">evaluate_forecasts</span><span class="crayon-sy">(</span><span class="crayon-v">test</span><span class="crayon-sy">[</span><span class="crayon-o">:</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-o">:</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">0</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">predictions</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c08128ae9306271388512-123"><span class="crayon-h">	</span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">score</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">scores</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c08128ae9306271388512-124">&nbsp;</div><div class="crayon-line" id="crayon-5c08128ae9306271388512-125"><span class="crayon-p"># load the new file</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c08128ae9306271388512-126"><span class="crayon-v">dataset</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">read_csv</span><span class="crayon-sy">(</span><span class="crayon-s">'household_power_consumption_days.csv'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">header</span><span class="crayon-o">=</span><span class="crayon-cn">0</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">infer_datetime_format</span><span class="crayon-o">=</span><span class="crayon-t">True</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">parse_dates</span><span class="crayon-o">=</span><span class="crayon-sy">[</span><span class="crayon-s">'datetime'</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">index_col</span><span class="crayon-o">=</span><span class="crayon-sy">[</span><span class="crayon-s">'datetime'</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c08128ae9306271388512-127"><span class="crayon-p"># split into train and test</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c08128ae9306271388512-128"><span class="crayon-v">train</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">test</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">split_dataset</span><span class="crayon-sy">(</span><span class="crayon-v">dataset</span><span class="crayon-sy">.</span><span class="crayon-v">values</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c08128ae9306271388512-129"><span class="crayon-p"># evaluate model and get scores</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c08128ae9306271388512-130"><span class="crayon-v">n_input</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-cn">14</span></div><div class="crayon-line" id="crayon-5c08128ae9306271388512-131"><span class="crayon-v">score</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">scores</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">evaluate_model</span><span class="crayon-sy">(</span><span class="crayon-v">train</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">test</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_input</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c08128ae9306271388512-132"><span class="crayon-p"># summarize scores</span></div><div class="crayon-line" id="crayon-5c08128ae9306271388512-133"><span class="crayon-e">summarize_scores</span><span class="crayon-sy">(</span><span class="crayon-s">'lstm'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">score</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">scores</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c08128ae9306271388512-134"><span class="crayon-p"># plot scores</span></div><div class="crayon-line" id="crayon-5c08128ae9306271388512-135"><span class="crayon-v">days</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-s">'sun'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-s">'mon'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-s">'tue'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-s">'wed'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-s">'thr'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-s">'fri'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-s">'sat'</span><span class="crayon-sy">]</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c08128ae9306271388512-136"><span class="crayon-v">pyplot</span><span class="crayon-sy">.</span><span class="crayon-e">plot</span><span class="crayon-sy">(</span><span class="crayon-v">days</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">scores</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">marker</span><span class="crayon-o">=</span><span class="crayon-s">'o'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">label</span><span class="crayon-o">=</span><span class="crayon-s">'lstm'</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c08128ae9306271388512-137"><span class="crayon-v">pyplot</span><span class="crayon-sy">.</span><span class="crayon-e">show</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div></div></td>
					</tr>
				</tbody></table>
			</div>
		</div>
<!-- [Format Time: 0.0075 seconds] -->
<p>Running the example fits the model and summarizes the performance on the test dataset.</p>
<p>Your specific results may vary given the stochastic nature of the 
algorithm. You may want to try running the example a few times.</p>
<p>We can see that in this case, the model is skillful, achieving an overall RMSE score of about 372 kilowatts.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->

		<div id="crayon-5c08128ae9309456555041" class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" style="margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important; height: auto;">
		
			<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important; height: 18px !important; line-height: 18px !important; margin-top: -19px; display: none; z-index: 4;"><span class="crayon-title"></span>
			<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button crayon-pressed" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code" style="display: none;"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
			<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
			<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="readonly" style="-moz-tab-size: 4; font-size: 12px !important; line-height: 15px !important; z-index: 0; opacity: 0; overflow: hidden;" wrap="soft">lstm: [372.595] 379.5, 399.8, 339.6, 372.2, 370.9, 309.9, 424.8</textarea></div>
			<div class="crayon-main" style="position: relative; z-index: 1; overflow: hidden;">
				<table class="crayon-table" style="">
					<tbody><tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5c08128ae9309456555041-1">1</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5c08128ae9309456555041-1">lstm: [372.595] 379.5, 399.8, 339.6, 372.2, 370.9, 309.9, 424.8</div></div></td>
					</tr>
				</tbody></table>
			</div>
		</div>
<!-- [Format Time: 0.0000 seconds] -->
<p>A line plot of the per-day RMSE is also created showing a similar pattern in error as was seen in the previous section.</p>
<div id="attachment_6289" style="width: 1290px" class="wp-caption aligncenter"><img class="size-full wp-image-6289" src="How%20to%20Develop%20LSTM%20Models%20for%20Multi-Step%20Time%20Series%20Forecasting%20of%20Household%20Power%20Consumption_fichiers/Line-Plot-of-RMSE-per-Day-for-Univariate-Encoder-Decoder-LST.png" alt="Line Plot of RMSE per Day for Univariate Encoder-Decoder LSTM with 14-day Inputs" srcset="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2018/07/Line-Plot-of-RMSE-per-Day-for-Univariate-Encoder-Decoder-LSTM-with-14-day-Inputs.png 1280w, https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2018/07/Line-Plot-of-RMSE-per-Day-for-Univariate-Encoder-Decoder-LSTM-with-14-day-Inputs-300x225.png 300w, https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2018/07/Line-Plot-of-RMSE-per-Day-for-Univariate-Encoder-Decoder-LSTM-with-14-day-Inputs-768x576.png 768w, https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2018/07/Line-Plot-of-RMSE-per-Day-for-Univariate-Encoder-Decoder-LSTM-with-14-day-Inputs-1024x768.png 1024w" sizes="(max-width: 1280px) 100vw, 1280px" width="1280" height="960"><p class="wp-caption-text">Line Plot of RMSE per Day for Univariate Encoder-Decoder LSTM with 14-day Inputs</p></div>
<h2>Encoder-Decoder LSTM Model With Multivariate Input</h2>
<p>In this section, we will update the Encoder-Decoder LSTM developed in
 the previous section to use each of the eight time series variables to 
predict the next standard week of daily total power consumption.</p>
<p>We will do this by providing each one-dimensional time series to the model as a separate sequence of input.</p>
<p>The LSTM will in turn create an internal representation of each input sequence that will together be interpreted by the decoder.</p>
<p>Using multivariate inputs is helpful for those problems where the 
output sequence is some function of the observations at prior time steps
 from multiple different features, not just (or including) the feature 
being forecasted. It is unclear whether this is the case in the power 
consumption problem, but we can explore it nonetheless.</p>
<p>First, we must update the preparation of the training data to include
 all of the eight features, not just the one total daily power consumed.
 It requires a single line change:</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->

		<div id="crayon-5c08128ae930c190504359" class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" style="margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important; height: auto;">
		
			<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important; height: 18px !important; line-height: 18px !important; margin-top: -19px; display: none; z-index: 4;"><span class="crayon-title"></span>
			<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button crayon-pressed" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code" style="display: none;"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
			<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
			<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="readonly" style="-moz-tab-size: 4; font-size: 12px !important; line-height: 15px !important; z-index: 0; opacity: 0; overflow: hidden;" wrap="soft">X.append(data[in_start:in_end, :])</textarea></div>
			<div class="crayon-main" style="position: relative; z-index: 1; overflow: hidden;">
				<table class="crayon-table" style="">
					<tbody><tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5c08128ae930c190504359-1">1</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5c08128ae930c190504359-1"><span class="crayon-v">X</span><span class="crayon-sy">.</span><span class="crayon-e">append</span><span class="crayon-sy">(</span><span class="crayon-v">data</span><span class="crayon-sy">[</span><span class="crayon-v">in_start</span><span class="crayon-o">:</span><span class="crayon-v">in_end</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-o">:</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span></div></div></td>
					</tr>
				</tbody></table>
			</div>
		</div>
<!-- [Format Time: 0.0002 seconds] -->
<p>The complete <em>to_supervised()</em> function with this change is listed below.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->

		<div id="crayon-5c08128ae930e285876590" class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" style="margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important; height: auto;">
		
			<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important; height: 18px !important; line-height: 18px !important; margin-top: -19px; display: none; position: absolute; z-index: 2;"><span class="crayon-title"></span>
			<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button crayon-pressed" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code" style="display: none;"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
			<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
			<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="readonly" style="-moz-tab-size: 4; font-size: 12px !important; line-height: 15px !important; z-index: 0; opacity: 0; overflow: hidden;" wrap="soft"># convert history into inputs and outputs
def to_supervised(train, n_input, n_out=7):
	# flatten data
	data = train.reshape((train.shape[0]*train.shape[1], train.shape[2]))
	X, y = list(), list()
	in_start = 0
	# step over the entire history one time step at a time
	for _ in range(len(data)):
		# define the end of the input sequence
		in_end = in_start + n_input
		out_end = in_end + n_out
		# ensure we have enough data for this instance
		if out_end &lt; len(data):
			X.append(data[in_start:in_end, :])
			y.append(data[in_end:out_end, 0])
		# move along one time step
		in_start += 1
	return array(X), array(y)</textarea></div>
			<div class="crayon-main" style="position: relative; z-index: 1; overflow: hidden;">
				<table class="crayon-table" style="">
					<tbody><tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5c08128ae930e285876590-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c08128ae930e285876590-2">2</div><div class="crayon-num" data-line="crayon-5c08128ae930e285876590-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c08128ae930e285876590-4">4</div><div class="crayon-num" data-line="crayon-5c08128ae930e285876590-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c08128ae930e285876590-6">6</div><div class="crayon-num" data-line="crayon-5c08128ae930e285876590-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c08128ae930e285876590-8">8</div><div class="crayon-num" data-line="crayon-5c08128ae930e285876590-9">9</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c08128ae930e285876590-10">10</div><div class="crayon-num" data-line="crayon-5c08128ae930e285876590-11">11</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c08128ae930e285876590-12">12</div><div class="crayon-num" data-line="crayon-5c08128ae930e285876590-13">13</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c08128ae930e285876590-14">14</div><div class="crayon-num" data-line="crayon-5c08128ae930e285876590-15">15</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c08128ae930e285876590-16">16</div><div class="crayon-num" data-line="crayon-5c08128ae930e285876590-17">17</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c08128ae930e285876590-18">18</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5c08128ae930e285876590-1"><span class="crayon-p"># convert history into inputs and outputs</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c08128ae930e285876590-2"><span class="crayon-e">def </span><span class="crayon-e">to_supervised</span><span class="crayon-sy">(</span><span class="crayon-v">train</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_input</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_out</span><span class="crayon-o">=</span><span class="crayon-cn">7</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5c08128ae930e285876590-3"><span class="crayon-h">	</span><span class="crayon-p"># flatten data</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c08128ae930e285876590-4"><span class="crayon-h">	</span><span class="crayon-v">data</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">train</span><span class="crayon-sy">.</span><span class="crayon-e">reshape</span><span class="crayon-sy">(</span><span class="crayon-sy">(</span><span class="crayon-v">train</span><span class="crayon-sy">.</span><span class="crayon-v">shape</span><span class="crayon-sy">[</span><span class="crayon-cn">0</span><span class="crayon-sy">]</span><span class="crayon-o">*</span><span class="crayon-v">train</span><span class="crayon-sy">.</span><span class="crayon-v">shape</span><span class="crayon-sy">[</span><span class="crayon-cn">1</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">train</span><span class="crayon-sy">.</span><span class="crayon-v">shape</span><span class="crayon-sy">[</span><span class="crayon-cn">2</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c08128ae930e285876590-5"><span class="crayon-h">	</span><span class="crayon-v">X</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">y</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">list</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-e">list</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c08128ae930e285876590-6"><span class="crayon-h">	</span><span class="crayon-v">in_start</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-cn">0</span></div><div class="crayon-line" id="crayon-5c08128ae930e285876590-7"><span class="crayon-h">	</span><span class="crayon-p"># step over the entire history one time step at a time</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c08128ae930e285876590-8"><span class="crayon-h">	</span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">_</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-e">len</span><span class="crayon-sy">(</span><span class="crayon-v">data</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5c08128ae930e285876590-9"><span class="crayon-h">		</span><span class="crayon-p"># define the end of the input sequence</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c08128ae930e285876590-10"><span class="crayon-h">		</span><span class="crayon-v">in_end</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">in_start</span><span class="crayon-h"> </span><span class="crayon-o">+</span><span class="crayon-h"> </span><span class="crayon-e">n_input</span></div><div class="crayon-line" id="crayon-5c08128ae930e285876590-11"><span class="crayon-e">		</span><span class="crayon-v">out_end</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">in_end</span><span class="crayon-h"> </span><span class="crayon-o">+</span><span class="crayon-h"> </span><span class="crayon-v">n_out</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c08128ae930e285876590-12"><span class="crayon-h">		</span><span class="crayon-p"># ensure we have enough data for this instance</span></div><div class="crayon-line" id="crayon-5c08128ae930e285876590-13"><span class="crayon-h">		</span><span class="crayon-st">if</span><span class="crayon-h"> </span><span class="crayon-v">out_end</span><span class="crayon-h"> </span><span class="crayon-o">&lt;</span><span class="crayon-h"> </span><span class="crayon-e">len</span><span class="crayon-sy">(</span><span class="crayon-v">data</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c08128ae930e285876590-14"><span class="crayon-h">			</span><span class="crayon-v">X</span><span class="crayon-sy">.</span><span class="crayon-e">append</span><span class="crayon-sy">(</span><span class="crayon-v">data</span><span class="crayon-sy">[</span><span class="crayon-v">in_start</span><span class="crayon-o">:</span><span class="crayon-v">in_end</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-o">:</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c08128ae930e285876590-15"><span class="crayon-h">			</span><span class="crayon-v">y</span><span class="crayon-sy">.</span><span class="crayon-e">append</span><span class="crayon-sy">(</span><span class="crayon-v">data</span><span class="crayon-sy">[</span><span class="crayon-v">in_end</span><span class="crayon-o">:</span><span class="crayon-v">out_end</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">0</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c08128ae930e285876590-16"><span class="crayon-h">		</span><span class="crayon-p"># move along one time step</span></div><div class="crayon-line" id="crayon-5c08128ae930e285876590-17"><span class="crayon-h">		</span><span class="crayon-v">in_start</span><span class="crayon-h"> </span><span class="crayon-o">+=</span><span class="crayon-h"> </span><span class="crayon-cn">1</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c08128ae930e285876590-18"><span class="crayon-h">	</span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-t">array</span><span class="crayon-sy">(</span><span class="crayon-v">X</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-t">array</span><span class="crayon-sy">(</span><span class="crayon-v">y</span><span class="crayon-sy">)</span></div></div></td>
					</tr>
				</tbody></table>
			</div>
		</div>
<!-- [Format Time: 0.0011 seconds] -->
<p>We also must update the function used to make forecasts with the fit model to use all eight features from the prior time steps.</p>
<p>Again, another small change:</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->

		<div id="crayon-5c08128ae9310491259734" class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" style="margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important; height: auto;">
		
			<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important; height: 18px !important; line-height: 18px !important; margin-top: -19px; display: none; position: absolute; z-index: 2;"><span class="crayon-title"></span>
			<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button crayon-pressed" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code" style="display: none;"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
			<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
			<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="readonly" style="-moz-tab-size: 4; font-size: 12px !important; line-height: 15px !important; z-index: 0; opacity: 0; overflow: hidden;" wrap="soft"># retrieve last observations for input data
input_x = data[-n_input:, :]
# reshape into [1, n_input, n]
input_x = input_x.reshape((1, input_x.shape[0], input_x.shape[1]))</textarea></div>
			<div class="crayon-main" style="position: relative; z-index: 1; overflow: hidden;">
				<table class="crayon-table" style="">
					<tbody><tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5c08128ae9310491259734-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c08128ae9310491259734-2">2</div><div class="crayon-num" data-line="crayon-5c08128ae9310491259734-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c08128ae9310491259734-4">4</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5c08128ae9310491259734-1"><span class="crayon-p"># retrieve last observations for input data</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c08128ae9310491259734-2"><span class="crayon-v">input_x</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">data</span><span class="crayon-sy">[</span><span class="crayon-o">-</span><span class="crayon-v">n_input</span><span class="crayon-o">:</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-o">:</span><span class="crayon-sy">]</span></div><div class="crayon-line" id="crayon-5c08128ae9310491259734-3"><span class="crayon-p"># reshape into [1, n_input, n]</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c08128ae9310491259734-4"><span class="crayon-v">input_x</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">input_x</span><span class="crayon-sy">.</span><span class="crayon-e">reshape</span><span class="crayon-sy">(</span><span class="crayon-sy">(</span><span class="crayon-cn">1</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">input_x</span><span class="crayon-sy">.</span><span class="crayon-v">shape</span><span class="crayon-sy">[</span><span class="crayon-cn">0</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">input_x</span><span class="crayon-sy">.</span><span class="crayon-v">shape</span><span class="crayon-sy">[</span><span class="crayon-cn">1</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div></div></td>
					</tr>
				</tbody></table>
			</div>
		</div>
<!-- [Format Time: 0.0003 seconds] -->
<p>The complete <em>forecast()</em>&nbsp;function with this change is listed below:</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->

		<div id="crayon-5c08128ae9312536458154" class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" style="margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important; height: auto;">
		
			<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important; height: 18px !important; line-height: 18px !important; margin-top: -19px; display: none; position: absolute; z-index: 2;"><span class="crayon-title"></span>
			<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button crayon-pressed" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code" style="display: none;"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
			<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
			<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="readonly" style="-moz-tab-size: 4; font-size: 12px !important; line-height: 15px !important; z-index: 0; opacity: 0; overflow: hidden;" wrap="soft"># make a forecast
def forecast(model, history, n_input):
	# flatten data
	data = array(history)
	data = data.reshape((data.shape[0]*data.shape[1], data.shape[2]))
	# retrieve last observations for input data
	input_x = data[-n_input:, :]
	# reshape into [1, n_input, n]
	input_x = input_x.reshape((1, input_x.shape[0], input_x.shape[1]))
	# forecast the next week
	yhat = model.predict(input_x, verbose=0)
	# we only want the vector forecast
	yhat = yhat[0]
	return yhat</textarea></div>
			<div class="crayon-main" style="position: relative; z-index: 1; overflow: hidden;">
				<table class="crayon-table" style="">
					<tbody><tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5c08128ae9312536458154-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c08128ae9312536458154-2">2</div><div class="crayon-num" data-line="crayon-5c08128ae9312536458154-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c08128ae9312536458154-4">4</div><div class="crayon-num" data-line="crayon-5c08128ae9312536458154-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c08128ae9312536458154-6">6</div><div class="crayon-num" data-line="crayon-5c08128ae9312536458154-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c08128ae9312536458154-8">8</div><div class="crayon-num" data-line="crayon-5c08128ae9312536458154-9">9</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c08128ae9312536458154-10">10</div><div class="crayon-num" data-line="crayon-5c08128ae9312536458154-11">11</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c08128ae9312536458154-12">12</div><div class="crayon-num" data-line="crayon-5c08128ae9312536458154-13">13</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c08128ae9312536458154-14">14</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5c08128ae9312536458154-1"><span class="crayon-p"># make a forecast</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c08128ae9312536458154-2"><span class="crayon-e">def </span><span class="crayon-e">forecast</span><span class="crayon-sy">(</span><span class="crayon-v">model</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">history</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_input</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5c08128ae9312536458154-3"><span class="crayon-h">	</span><span class="crayon-p"># flatten data</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c08128ae9312536458154-4"><span class="crayon-h">	</span><span class="crayon-v">data</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-t">array</span><span class="crayon-sy">(</span><span class="crayon-v">history</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c08128ae9312536458154-5"><span class="crayon-h">	</span><span class="crayon-v">data</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">data</span><span class="crayon-sy">.</span><span class="crayon-e">reshape</span><span class="crayon-sy">(</span><span class="crayon-sy">(</span><span class="crayon-v">data</span><span class="crayon-sy">.</span><span class="crayon-v">shape</span><span class="crayon-sy">[</span><span class="crayon-cn">0</span><span class="crayon-sy">]</span><span class="crayon-o">*</span><span class="crayon-v">data</span><span class="crayon-sy">.</span><span class="crayon-v">shape</span><span class="crayon-sy">[</span><span class="crayon-cn">1</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">data</span><span class="crayon-sy">.</span><span class="crayon-v">shape</span><span class="crayon-sy">[</span><span class="crayon-cn">2</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c08128ae9312536458154-6"><span class="crayon-h">	</span><span class="crayon-p"># retrieve last observations for input data</span></div><div class="crayon-line" id="crayon-5c08128ae9312536458154-7"><span class="crayon-h">	</span><span class="crayon-v">input_x</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">data</span><span class="crayon-sy">[</span><span class="crayon-o">-</span><span class="crayon-v">n_input</span><span class="crayon-o">:</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-o">:</span><span class="crayon-sy">]</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c08128ae9312536458154-8"><span class="crayon-h">	</span><span class="crayon-p"># reshape into [1, n_input, n]</span></div><div class="crayon-line" id="crayon-5c08128ae9312536458154-9"><span class="crayon-h">	</span><span class="crayon-v">input_x</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">input_x</span><span class="crayon-sy">.</span><span class="crayon-e">reshape</span><span class="crayon-sy">(</span><span class="crayon-sy">(</span><span class="crayon-cn">1</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">input_x</span><span class="crayon-sy">.</span><span class="crayon-v">shape</span><span class="crayon-sy">[</span><span class="crayon-cn">0</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">input_x</span><span class="crayon-sy">.</span><span class="crayon-v">shape</span><span class="crayon-sy">[</span><span class="crayon-cn">1</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c08128ae9312536458154-10"><span class="crayon-h">	</span><span class="crayon-p"># forecast the next week</span></div><div class="crayon-line" id="crayon-5c08128ae9312536458154-11"><span class="crayon-h">	</span><span class="crayon-v">yhat</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">predict</span><span class="crayon-sy">(</span><span class="crayon-v">input_x</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">verbose</span><span class="crayon-o">=</span><span class="crayon-cn">0</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c08128ae9312536458154-12"><span class="crayon-h">	</span><span class="crayon-p"># we only want the vector forecast</span></div><div class="crayon-line" id="crayon-5c08128ae9312536458154-13"><span class="crayon-h">	</span><span class="crayon-v">yhat</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">yhat</span><span class="crayon-sy">[</span><span class="crayon-cn">0</span><span class="crayon-sy">]</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c08128ae9312536458154-14"><span class="crayon-h">	</span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">yhat</span></div></div></td>
					</tr>
				</tbody></table>
			</div>
		</div>
<!-- [Format Time: 0.0010 seconds] -->
<p>The same model architecture and configuration is used directly, 
although we will increase the number of training epochs from 20 to 50 
given the 8-fold increase in the amount of input data.</p>
<p>The complete example is listed below.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->

		<div id="crayon-5c08128ae9314684980846" class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" style="margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important; height: auto;">
		
			<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important; height: 18px !important; line-height: 18px !important; margin-top: -19px; display: none; position: absolute; z-index: 2;"><span class="crayon-title"></span>
			<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button crayon-pressed" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
			<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
			<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="readonly" style="-moz-tab-size: 4; font-size: 12px !important; line-height: 15px !important; z-index: 0; opacity: 0; overflow: hidden;" wrap="soft">#
 multivariate multi-step encoder-decoder lstm
from math import sqrt
from numpy import split
from numpy import array
from pandas import read_csv
from sklearn.metrics import mean_squared_error
from matplotlib import pyplot
from keras.models import Sequential
from keras.layers import Dense
from keras.layers import Flatten
from keras.layers import LSTM
from keras.layers import RepeatVector
from keras.layers import TimeDistributed

# split a univariate dataset into train/test sets
def split_dataset(data):
	# split into standard weeks
	train, test = data[1:-328], data[-328:-6]
	# restructure into windows of weekly data
	train = array(split(train, len(train)/7))
	test = array(split(test, len(test)/7))
	return train, test

# evaluate one or more weekly forecasts against expected values
def evaluate_forecasts(actual, predicted):
	scores = list()
	# calculate an RMSE score for each day
	for i in range(actual.shape[1]):
		# calculate mse
		mse = mean_squared_error(actual[:, i], predicted[:, i])
		# calculate rmse
		rmse = sqrt(mse)
		# store
		scores.append(rmse)
	# calculate overall RMSE
	s = 0
	for row in range(actual.shape[0]):
		for col in range(actual.shape[1]):
			s += (actual[row, col] - predicted[row, col])**2
	score = sqrt(s / (actual.shape[0] * actual.shape[1]))
	return score, scores

# summarize scores
def summarize_scores(name, score, scores):
	s_scores = ', '.join(['%.1f' % s for s in scores])
	print('%s: [%.3f] %s' % (name, score, s_scores))

# convert history into inputs and outputs
def to_supervised(train, n_input, n_out=7):
	# flatten data
	data = train.reshape((train.shape[0]*train.shape[1], train.shape[2]))
	X, y = list(), list()
	in_start = 0
	# step over the entire history one time step at a time
	for _ in range(len(data)):
		# define the end of the input sequence
		in_end = in_start + n_input
		out_end = in_end + n_out
		# ensure we have enough data for this instance
		if out_end &lt; len(data):
			X.append(data[in_start:in_end, :])
			y.append(data[in_end:out_end, 0])
		# move along one time step
		in_start += 1
	return array(X), array(y)

# train the model
def build_model(train, n_input):
	# prepare data
	train_x, train_y = to_supervised(train, n_input)
	# define parameters
	verbose, epochs, batch_size = 0, 50, 16
	n_timesteps, n_features, n_outputs = train_x.shape[1], 
train_x.shape[2], train_y.shape[1]
	# reshape output into [samples, timesteps, features]
	train_y = train_y.reshape((train_y.shape[0], train_y.shape[1], 1))
	# define model
	model = Sequential()
	model.add(LSTM(200, activation='relu', input_shape=(n_timesteps, 
n_features)))
	model.add(RepeatVector(n_outputs))
	model.add(LSTM(200, activation='relu', return_sequences=True))
	model.add(TimeDistributed(Dense(100, activation='relu')))
	model.add(TimeDistributed(Dense(1)))
	model.compile(loss='mse', optimizer='adam')
	# fit network
	model.fit(train_x, train_y, epochs=epochs, batch_size=batch_size, 
verbose=verbose)
	return model

# make a forecast
def forecast(model, history, n_input):
	# flatten data
	data = array(history)
	data = data.reshape((data.shape[0]*data.shape[1], data.shape[2]))
	# retrieve last observations for input data
	input_x = data[-n_input:, :]
	# reshape into [1, n_input, n]
	input_x = input_x.reshape((1, input_x.shape[0], input_x.shape[1]))
	# forecast the next week
	yhat = model.predict(input_x, verbose=0)
	# we only want the vector forecast
	yhat = yhat[0]
	return yhat

# evaluate a single model
def evaluate_model(train, test, n_input):
	# fit model
	model = build_model(train, n_input)
	# history is a list of weekly data
	history = [x for x in train]
	# walk-forward validation over each week
	predictions = list()
	for i in range(len(test)):
		# predict the week
		yhat_sequence = forecast(model, history, n_input)
		# store the predictions
		predictions.append(yhat_sequence)
		# get real observation and add to history for predicting the next week
		history.append(test[i, :])
	# evaluate predictions days for each week
	predictions = array(predictions)
	score, scores = evaluate_forecasts(test[:, :, 0], predictions)
	return score, scores

# load the new file
dataset = read_csv('household_power_consumption_days.csv', header=0, 
infer_datetime_format=True, parse_dates=['datetime'], 
index_col=['datetime'])
# split into train and test
train, test = split_dataset(dataset.values)
# evaluate model and get scores
n_input = 14
score, scores = evaluate_model(train, test, n_input)
# summarize scores
summarize_scores('lstm', score, scores)
# plot scores
days = ['sun', 'mon', 'tue', 'wed', 'thr', 'fri', 'sat']
pyplot.plot(days, scores, marker='o', label='lstm')
pyplot.show()</textarea></div>
			<div class="crayon-main" style="position: relative; z-index: 1; overflow: hidden;">
				<table class="crayon-table" style="">
					<tbody><tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5c08128ae9314684980846-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c08128ae9314684980846-2">2</div><div class="crayon-num" data-line="crayon-5c08128ae9314684980846-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c08128ae9314684980846-4">4</div><div class="crayon-num" data-line="crayon-5c08128ae9314684980846-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c08128ae9314684980846-6">6</div><div class="crayon-num" data-line="crayon-5c08128ae9314684980846-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c08128ae9314684980846-8">8</div><div class="crayon-num" data-line="crayon-5c08128ae9314684980846-9">9</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c08128ae9314684980846-10">10</div><div class="crayon-num" data-line="crayon-5c08128ae9314684980846-11">11</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c08128ae9314684980846-12">12</div><div class="crayon-num" data-line="crayon-5c08128ae9314684980846-13">13</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c08128ae9314684980846-14">14</div><div class="crayon-num" data-line="crayon-5c08128ae9314684980846-15">15</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c08128ae9314684980846-16">16</div><div class="crayon-num" data-line="crayon-5c08128ae9314684980846-17">17</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c08128ae9314684980846-18">18</div><div class="crayon-num" data-line="crayon-5c08128ae9314684980846-19">19</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c08128ae9314684980846-20">20</div><div class="crayon-num" data-line="crayon-5c08128ae9314684980846-21">21</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c08128ae9314684980846-22">22</div><div class="crayon-num" data-line="crayon-5c08128ae9314684980846-23">23</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c08128ae9314684980846-24">24</div><div class="crayon-num" data-line="crayon-5c08128ae9314684980846-25">25</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c08128ae9314684980846-26">26</div><div class="crayon-num" data-line="crayon-5c08128ae9314684980846-27">27</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c08128ae9314684980846-28">28</div><div class="crayon-num" data-line="crayon-5c08128ae9314684980846-29">29</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c08128ae9314684980846-30">30</div><div class="crayon-num" data-line="crayon-5c08128ae9314684980846-31">31</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c08128ae9314684980846-32">32</div><div class="crayon-num" data-line="crayon-5c08128ae9314684980846-33">33</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c08128ae9314684980846-34">34</div><div class="crayon-num" data-line="crayon-5c08128ae9314684980846-35">35</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c08128ae9314684980846-36">36</div><div class="crayon-num" data-line="crayon-5c08128ae9314684980846-37">37</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c08128ae9314684980846-38">38</div><div class="crayon-num" data-line="crayon-5c08128ae9314684980846-39">39</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c08128ae9314684980846-40">40</div><div class="crayon-num" data-line="crayon-5c08128ae9314684980846-41">41</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c08128ae9314684980846-42">42</div><div class="crayon-num" data-line="crayon-5c08128ae9314684980846-43">43</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c08128ae9314684980846-44">44</div><div class="crayon-num" data-line="crayon-5c08128ae9314684980846-45">45</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c08128ae9314684980846-46">46</div><div class="crayon-num" data-line="crayon-5c08128ae9314684980846-47">47</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c08128ae9314684980846-48">48</div><div class="crayon-num" data-line="crayon-5c08128ae9314684980846-49">49</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c08128ae9314684980846-50">50</div><div class="crayon-num" data-line="crayon-5c08128ae9314684980846-51">51</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c08128ae9314684980846-52">52</div><div class="crayon-num" data-line="crayon-5c08128ae9314684980846-53">53</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c08128ae9314684980846-54">54</div><div class="crayon-num" data-line="crayon-5c08128ae9314684980846-55">55</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c08128ae9314684980846-56">56</div><div class="crayon-num" data-line="crayon-5c08128ae9314684980846-57">57</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c08128ae9314684980846-58">58</div><div class="crayon-num" data-line="crayon-5c08128ae9314684980846-59">59</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c08128ae9314684980846-60">60</div><div class="crayon-num" data-line="crayon-5c08128ae9314684980846-61">61</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c08128ae9314684980846-62">62</div><div class="crayon-num" data-line="crayon-5c08128ae9314684980846-63">63</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c08128ae9314684980846-64">64</div><div class="crayon-num" data-line="crayon-5c08128ae9314684980846-65">65</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c08128ae9314684980846-66">66</div><div class="crayon-num" data-line="crayon-5c08128ae9314684980846-67">67</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c08128ae9314684980846-68">68</div><div class="crayon-num" data-line="crayon-5c08128ae9314684980846-69">69</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c08128ae9314684980846-70">70</div><div class="crayon-num" data-line="crayon-5c08128ae9314684980846-71">71</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c08128ae9314684980846-72">72</div><div class="crayon-num" data-line="crayon-5c08128ae9314684980846-73">73</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c08128ae9314684980846-74">74</div><div class="crayon-num" data-line="crayon-5c08128ae9314684980846-75">75</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c08128ae9314684980846-76">76</div><div class="crayon-num" data-line="crayon-5c08128ae9314684980846-77">77</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c08128ae9314684980846-78">78</div><div class="crayon-num" data-line="crayon-5c08128ae9314684980846-79">79</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c08128ae9314684980846-80">80</div><div class="crayon-num" data-line="crayon-5c08128ae9314684980846-81">81</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c08128ae9314684980846-82">82</div><div class="crayon-num" data-line="crayon-5c08128ae9314684980846-83">83</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c08128ae9314684980846-84">84</div><div class="crayon-num" data-line="crayon-5c08128ae9314684980846-85">85</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c08128ae9314684980846-86">86</div><div class="crayon-num" data-line="crayon-5c08128ae9314684980846-87">87</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c08128ae9314684980846-88">88</div><div class="crayon-num" data-line="crayon-5c08128ae9314684980846-89">89</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c08128ae9314684980846-90">90</div><div class="crayon-num" data-line="crayon-5c08128ae9314684980846-91">91</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c08128ae9314684980846-92">92</div><div class="crayon-num" data-line="crayon-5c08128ae9314684980846-93">93</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c08128ae9314684980846-94">94</div><div class="crayon-num" data-line="crayon-5c08128ae9314684980846-95">95</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c08128ae9314684980846-96">96</div><div class="crayon-num" data-line="crayon-5c08128ae9314684980846-97">97</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c08128ae9314684980846-98">98</div><div class="crayon-num" data-line="crayon-5c08128ae9314684980846-99">99</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c08128ae9314684980846-100">100</div><div class="crayon-num" data-line="crayon-5c08128ae9314684980846-101">101</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c08128ae9314684980846-102">102</div><div class="crayon-num" data-line="crayon-5c08128ae9314684980846-103">103</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c08128ae9314684980846-104">104</div><div class="crayon-num" data-line="crayon-5c08128ae9314684980846-105">105</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c08128ae9314684980846-106">106</div><div class="crayon-num" data-line="crayon-5c08128ae9314684980846-107">107</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c08128ae9314684980846-108">108</div><div class="crayon-num" data-line="crayon-5c08128ae9314684980846-109">109</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c08128ae9314684980846-110">110</div><div class="crayon-num" data-line="crayon-5c08128ae9314684980846-111">111</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c08128ae9314684980846-112">112</div><div class="crayon-num" data-line="crayon-5c08128ae9314684980846-113">113</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c08128ae9314684980846-114">114</div><div class="crayon-num" data-line="crayon-5c08128ae9314684980846-115">115</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c08128ae9314684980846-116">116</div><div class="crayon-num" data-line="crayon-5c08128ae9314684980846-117">117</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c08128ae9314684980846-118">118</div><div class="crayon-num" data-line="crayon-5c08128ae9314684980846-119">119</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c08128ae9314684980846-120">120</div><div class="crayon-num" data-line="crayon-5c08128ae9314684980846-121">121</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c08128ae9314684980846-122">122</div><div class="crayon-num" data-line="crayon-5c08128ae9314684980846-123">123</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c08128ae9314684980846-124">124</div><div class="crayon-num" data-line="crayon-5c08128ae9314684980846-125">125</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c08128ae9314684980846-126">126</div><div class="crayon-num" data-line="crayon-5c08128ae9314684980846-127">127</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c08128ae9314684980846-128">128</div><div class="crayon-num" data-line="crayon-5c08128ae9314684980846-129">129</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c08128ae9314684980846-130">130</div><div class="crayon-num" data-line="crayon-5c08128ae9314684980846-131">131</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c08128ae9314684980846-132">132</div><div class="crayon-num" data-line="crayon-5c08128ae9314684980846-133">133</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c08128ae9314684980846-134">134</div><div class="crayon-num" data-line="crayon-5c08128ae9314684980846-135">135</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5c08128ae9314684980846-1"><span class="crayon-p"># multivariate multi-step encoder-decoder lstm</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c08128ae9314684980846-2"><span class="crayon-e">from </span><span class="crayon-e">math </span><span class="crayon-e">import </span><span class="crayon-e">sqrt</span></div><div class="crayon-line" id="crayon-5c08128ae9314684980846-3"><span class="crayon-e">from </span><span class="crayon-e">numpy </span><span class="crayon-e">import </span><span class="crayon-e">split</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c08128ae9314684980846-4"><span class="crayon-e">from </span><span class="crayon-e">numpy </span><span class="crayon-e">import </span><span class="crayon-t">array</span></div><div class="crayon-line" id="crayon-5c08128ae9314684980846-5"><span class="crayon-e">from </span><span class="crayon-e">pandas </span><span class="crayon-e">import </span><span class="crayon-e">read_csv</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c08128ae9314684980846-6"><span class="crayon-e">from </span><span class="crayon-v">sklearn</span><span class="crayon-sy">.</span><span class="crayon-e">metrics </span><span class="crayon-e">import </span><span class="crayon-e">mean_squared_error</span></div><div class="crayon-line" id="crayon-5c08128ae9314684980846-7"><span class="crayon-e">from </span><span class="crayon-e">matplotlib </span><span class="crayon-e">import </span><span class="crayon-e">pyplot</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c08128ae9314684980846-8"><span class="crayon-e">from </span><span class="crayon-v">keras</span><span class="crayon-sy">.</span><span class="crayon-e">models </span><span class="crayon-e">import </span><span class="crayon-e">Sequential</span></div><div class="crayon-line" id="crayon-5c08128ae9314684980846-9"><span class="crayon-e">from </span><span class="crayon-v">keras</span><span class="crayon-sy">.</span><span class="crayon-e">layers </span><span class="crayon-e">import </span><span class="crayon-e">Dense</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c08128ae9314684980846-10"><span class="crayon-e">from </span><span class="crayon-v">keras</span><span class="crayon-sy">.</span><span class="crayon-e">layers </span><span class="crayon-e">import </span><span class="crayon-e">Flatten</span></div><div class="crayon-line" id="crayon-5c08128ae9314684980846-11"><span class="crayon-e">from </span><span class="crayon-v">keras</span><span class="crayon-sy">.</span><span class="crayon-e">layers </span><span class="crayon-e">import </span><span class="crayon-e">LSTM</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c08128ae9314684980846-12"><span class="crayon-e">from </span><span class="crayon-v">keras</span><span class="crayon-sy">.</span><span class="crayon-e">layers </span><span class="crayon-e">import </span><span class="crayon-e">RepeatVector</span></div><div class="crayon-line" id="crayon-5c08128ae9314684980846-13"><span class="crayon-e">from </span><span class="crayon-v">keras</span><span class="crayon-sy">.</span><span class="crayon-e">layers </span><span class="crayon-e">import </span><span class="crayon-v">TimeDistributed</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c08128ae9314684980846-14">&nbsp;</div><div class="crayon-line" id="crayon-5c08128ae9314684980846-15"><span class="crayon-p"># split a univariate dataset into train/test sets</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c08128ae9314684980846-16"><span class="crayon-e">def </span><span class="crayon-e">split_dataset</span><span class="crayon-sy">(</span><span class="crayon-v">data</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5c08128ae9314684980846-17"><span class="crayon-h">	</span><span class="crayon-p"># split into standard weeks</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c08128ae9314684980846-18"><span class="crayon-h">	</span><span class="crayon-v">train</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">test</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">data</span><span class="crayon-sy">[</span><span class="crayon-cn">1</span><span class="crayon-o">:</span><span class="crayon-o">-</span><span class="crayon-cn">328</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">data</span><span class="crayon-sy">[</span><span class="crayon-o">-</span><span class="crayon-cn">328</span><span class="crayon-o">:</span><span class="crayon-o">-</span><span class="crayon-cn">6</span><span class="crayon-sy">]</span></div><div class="crayon-line" id="crayon-5c08128ae9314684980846-19"><span class="crayon-h">	</span><span class="crayon-p"># restructure into windows of weekly data</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c08128ae9314684980846-20"><span class="crayon-h">	</span><span class="crayon-v">train</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-t">array</span><span class="crayon-sy">(</span><span class="crayon-e">split</span><span class="crayon-sy">(</span><span class="crayon-v">train</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-e">len</span><span class="crayon-sy">(</span><span class="crayon-v">train</span><span class="crayon-sy">)</span><span class="crayon-o">/</span><span class="crayon-cn">7</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c08128ae9314684980846-21"><span class="crayon-h">	</span><span class="crayon-v">test</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-t">array</span><span class="crayon-sy">(</span><span class="crayon-e">split</span><span class="crayon-sy">(</span><span class="crayon-v">test</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-e">len</span><span class="crayon-sy">(</span><span class="crayon-v">test</span><span class="crayon-sy">)</span><span class="crayon-o">/</span><span class="crayon-cn">7</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c08128ae9314684980846-22"><span class="crayon-h">	</span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">train</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">test</span></div><div class="crayon-line" id="crayon-5c08128ae9314684980846-23">&nbsp;</div><div class="crayon-line crayon-striped-line" id="crayon-5c08128ae9314684980846-24"><span class="crayon-p"># evaluate one or more weekly forecasts against expected values</span></div><div class="crayon-line" id="crayon-5c08128ae9314684980846-25"><span class="crayon-e">def </span><span class="crayon-e">evaluate_forecasts</span><span class="crayon-sy">(</span><span class="crayon-v">actual</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">predicted</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c08128ae9314684980846-26"><span class="crayon-h">	</span><span class="crayon-v">scores</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">list</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c08128ae9314684980846-27"><span class="crayon-h">	</span><span class="crayon-p"># calculate an RMSE score for each day</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c08128ae9314684980846-28"><span class="crayon-h">	</span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">i</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-v">actual</span><span class="crayon-sy">.</span><span class="crayon-v">shape</span><span class="crayon-sy">[</span><span class="crayon-cn">1</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5c08128ae9314684980846-29"><span class="crayon-h">		</span><span class="crayon-p"># calculate mse</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c08128ae9314684980846-30"><span class="crayon-h">		</span><span class="crayon-v">mse</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">mean_squared_error</span><span class="crayon-sy">(</span><span class="crayon-v">actual</span><span class="crayon-sy">[</span><span class="crayon-o">:</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">i</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">predicted</span><span class="crayon-sy">[</span><span class="crayon-o">:</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">i</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c08128ae9314684980846-31"><span class="crayon-h">		</span><span class="crayon-p"># calculate rmse</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c08128ae9314684980846-32"><span class="crayon-h">		</span><span class="crayon-v">rmse</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">sqrt</span><span class="crayon-sy">(</span><span class="crayon-v">mse</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c08128ae9314684980846-33"><span class="crayon-h">		</span><span class="crayon-p"># store</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c08128ae9314684980846-34"><span class="crayon-h">		</span><span class="crayon-v">scores</span><span class="crayon-sy">.</span><span class="crayon-e">append</span><span class="crayon-sy">(</span><span class="crayon-v">rmse</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c08128ae9314684980846-35"><span class="crayon-h">	</span><span class="crayon-p"># calculate overall RMSE</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c08128ae9314684980846-36"><span class="crayon-h">	</span><span class="crayon-v">s</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-cn">0</span></div><div class="crayon-line" id="crayon-5c08128ae9314684980846-37"><span class="crayon-h">	</span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-e">row </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-v">actual</span><span class="crayon-sy">.</span><span class="crayon-v">shape</span><span class="crayon-sy">[</span><span class="crayon-cn">0</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c08128ae9314684980846-38"><span class="crayon-h">		</span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-e">col </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-v">actual</span><span class="crayon-sy">.</span><span class="crayon-v">shape</span><span class="crayon-sy">[</span><span class="crayon-cn">1</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5c08128ae9314684980846-39"><span class="crayon-h">			</span><span class="crayon-v">s</span><span class="crayon-h"> </span><span class="crayon-o">+=</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-v">actual</span><span class="crayon-sy">[</span><span class="crayon-v">row</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">col</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-o">-</span><span class="crayon-h"> </span><span class="crayon-v">predicted</span><span class="crayon-sy">[</span><span class="crayon-v">row</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">col</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span><span class="crayon-o">*</span><span class="crayon-o">*</span><span class="crayon-cn">2</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c08128ae9314684980846-40"><span class="crayon-h">	</span><span class="crayon-v">score</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">sqrt</span><span class="crayon-sy">(</span><span class="crayon-v">s</span><span class="crayon-h"> </span><span class="crayon-o">/</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-v">actual</span><span class="crayon-sy">.</span><span class="crayon-v">shape</span><span class="crayon-sy">[</span><span class="crayon-cn">0</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-o">*</span><span class="crayon-h"> </span><span class="crayon-v">actual</span><span class="crayon-sy">.</span><span class="crayon-v">shape</span><span class="crayon-sy">[</span><span class="crayon-cn">1</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c08128ae9314684980846-41"><span class="crayon-h">	</span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">score</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">scores</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c08128ae9314684980846-42">&nbsp;</div><div class="crayon-line" id="crayon-5c08128ae9314684980846-43"><span class="crayon-p"># summarize scores</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c08128ae9314684980846-44"><span class="crayon-e">def </span><span class="crayon-e">summarize_scores</span><span class="crayon-sy">(</span><span class="crayon-v">name</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">score</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">scores</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5c08128ae9314684980846-45"><span class="crayon-h">	</span><span class="crayon-v">s_scores</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-s">', '</span><span class="crayon-sy">.</span><span class="crayon-e">join</span><span class="crayon-sy">(</span><span class="crayon-sy">[</span><span class="crayon-s">'%.1f'</span><span class="crayon-h"> </span><span class="crayon-o">%</span><span class="crayon-h"> </span><span class="crayon-i">s</span><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">s</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-v">scores</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c08128ae9314684980846-46"><span class="crayon-h">	</span><span class="crayon-e">print</span><span class="crayon-sy">(</span><span class="crayon-s">'%s: [%.3f] %s'</span><span class="crayon-h"> </span><span class="crayon-o">%</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-v">name</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">score</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">s_scores</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c08128ae9314684980846-47">&nbsp;</div><div class="crayon-line crayon-striped-line" id="crayon-5c08128ae9314684980846-48"><span class="crayon-p"># convert history into inputs and outputs</span></div><div class="crayon-line" id="crayon-5c08128ae9314684980846-49"><span class="crayon-e">def </span><span class="crayon-e">to_supervised</span><span class="crayon-sy">(</span><span class="crayon-v">train</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_input</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_out</span><span class="crayon-o">=</span><span class="crayon-cn">7</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c08128ae9314684980846-50"><span class="crayon-h">	</span><span class="crayon-p"># flatten data</span></div><div class="crayon-line" id="crayon-5c08128ae9314684980846-51"><span class="crayon-h">	</span><span class="crayon-v">data</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">train</span><span class="crayon-sy">.</span><span class="crayon-e">reshape</span><span class="crayon-sy">(</span><span class="crayon-sy">(</span><span class="crayon-v">train</span><span class="crayon-sy">.</span><span class="crayon-v">shape</span><span class="crayon-sy">[</span><span class="crayon-cn">0</span><span class="crayon-sy">]</span><span class="crayon-o">*</span><span class="crayon-v">train</span><span class="crayon-sy">.</span><span class="crayon-v">shape</span><span class="crayon-sy">[</span><span class="crayon-cn">1</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">train</span><span class="crayon-sy">.</span><span class="crayon-v">shape</span><span class="crayon-sy">[</span><span class="crayon-cn">2</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c08128ae9314684980846-52"><span class="crayon-h">	</span><span class="crayon-v">X</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">y</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">list</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-e">list</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c08128ae9314684980846-53"><span class="crayon-h">	</span><span class="crayon-v">in_start</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-cn">0</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c08128ae9314684980846-54"><span class="crayon-h">	</span><span class="crayon-p"># step over the entire history one time step at a time</span></div><div class="crayon-line" id="crayon-5c08128ae9314684980846-55"><span class="crayon-h">	</span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">_</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-e">len</span><span class="crayon-sy">(</span><span class="crayon-v">data</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c08128ae9314684980846-56"><span class="crayon-h">		</span><span class="crayon-p"># define the end of the input sequence</span></div><div class="crayon-line" id="crayon-5c08128ae9314684980846-57"><span class="crayon-h">		</span><span class="crayon-v">in_end</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">in_start</span><span class="crayon-h"> </span><span class="crayon-o">+</span><span class="crayon-h"> </span><span class="crayon-e">n_input</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c08128ae9314684980846-58"><span class="crayon-e">		</span><span class="crayon-v">out_end</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">in_end</span><span class="crayon-h"> </span><span class="crayon-o">+</span><span class="crayon-h"> </span><span class="crayon-v">n_out</span></div><div class="crayon-line" id="crayon-5c08128ae9314684980846-59"><span class="crayon-h">		</span><span class="crayon-p"># ensure we have enough data for this instance</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c08128ae9314684980846-60"><span class="crayon-h">		</span><span class="crayon-st">if</span><span class="crayon-h"> </span><span class="crayon-v">out_end</span><span class="crayon-h"> </span><span class="crayon-o">&lt;</span><span class="crayon-h"> </span><span class="crayon-e">len</span><span class="crayon-sy">(</span><span class="crayon-v">data</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5c08128ae9314684980846-61"><span class="crayon-h">			</span><span class="crayon-v">X</span><span class="crayon-sy">.</span><span class="crayon-e">append</span><span class="crayon-sy">(</span><span class="crayon-v">data</span><span class="crayon-sy">[</span><span class="crayon-v">in_start</span><span class="crayon-o">:</span><span class="crayon-v">in_end</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-o">:</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c08128ae9314684980846-62"><span class="crayon-h">			</span><span class="crayon-v">y</span><span class="crayon-sy">.</span><span class="crayon-e">append</span><span class="crayon-sy">(</span><span class="crayon-v">data</span><span class="crayon-sy">[</span><span class="crayon-v">in_end</span><span class="crayon-o">:</span><span class="crayon-v">out_end</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">0</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c08128ae9314684980846-63"><span class="crayon-h">		</span><span class="crayon-p"># move along one time step</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c08128ae9314684980846-64"><span class="crayon-h">		</span><span class="crayon-v">in_start</span><span class="crayon-h"> </span><span class="crayon-o">+=</span><span class="crayon-h"> </span><span class="crayon-cn">1</span></div><div class="crayon-line" id="crayon-5c08128ae9314684980846-65"><span class="crayon-h">	</span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-t">array</span><span class="crayon-sy">(</span><span class="crayon-v">X</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-t">array</span><span class="crayon-sy">(</span><span class="crayon-v">y</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c08128ae9314684980846-66">&nbsp;</div><div class="crayon-line" id="crayon-5c08128ae9314684980846-67"><span class="crayon-p"># train the model</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c08128ae9314684980846-68"><span class="crayon-e">def </span><span class="crayon-e">build_model</span><span class="crayon-sy">(</span><span class="crayon-v">train</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_input</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5c08128ae9314684980846-69"><span class="crayon-h">	</span><span class="crayon-p"># prepare data</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c08128ae9314684980846-70"><span class="crayon-h">	</span><span class="crayon-v">train_x</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">train_y</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">to_supervised</span><span class="crayon-sy">(</span><span class="crayon-v">train</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_input</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c08128ae9314684980846-71"><span class="crayon-h">	</span><span class="crayon-p"># define parameters</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c08128ae9314684980846-72"><span class="crayon-h">	</span><span class="crayon-v">verbose</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">epochs</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">batch_size</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-cn">0</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">50</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">16</span></div><div class="crayon-line" id="crayon-5c08128ae9314684980846-73"><span class="crayon-h">	</span><span class="crayon-v">n_timesteps</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_features</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_outputs</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">train_x</span><span class="crayon-sy">.</span><span class="crayon-v">shape</span><span class="crayon-sy">[</span><span class="crayon-cn">1</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">train_x</span><span class="crayon-sy">.</span><span class="crayon-v">shape</span><span class="crayon-sy">[</span><span class="crayon-cn">2</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">train_y</span><span class="crayon-sy">.</span><span class="crayon-v">shape</span><span class="crayon-sy">[</span><span class="crayon-cn">1</span><span class="crayon-sy">]</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c08128ae9314684980846-74"><span class="crayon-h">	</span><span class="crayon-p"># reshape output into [samples, timesteps, features]</span></div><div class="crayon-line" id="crayon-5c08128ae9314684980846-75"><span class="crayon-h">	</span><span class="crayon-v">train_y</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">train_y</span><span class="crayon-sy">.</span><span class="crayon-e">reshape</span><span class="crayon-sy">(</span><span class="crayon-sy">(</span><span class="crayon-v">train_y</span><span class="crayon-sy">.</span><span class="crayon-v">shape</span><span class="crayon-sy">[</span><span class="crayon-cn">0</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">train_y</span><span class="crayon-sy">.</span><span class="crayon-v">shape</span><span class="crayon-sy">[</span><span class="crayon-cn">1</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">1</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c08128ae9314684980846-76"><span class="crayon-h">	</span><span class="crayon-p"># define model</span></div><div class="crayon-line" id="crayon-5c08128ae9314684980846-77"><span class="crayon-h">	</span><span class="crayon-v">model</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">Sequential</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c08128ae9314684980846-78"><span class="crayon-h">	</span><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">add</span><span class="crayon-sy">(</span><span class="crayon-e">LSTM</span><span class="crayon-sy">(</span><span class="crayon-cn">200</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">activation</span><span class="crayon-o">=</span><span class="crayon-s">'relu'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">input_shape</span><span class="crayon-o">=</span><span class="crayon-sy">(</span><span class="crayon-v">n_timesteps</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_features</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c08128ae9314684980846-79"><span class="crayon-h">	</span><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">add</span><span class="crayon-sy">(</span><span class="crayon-e">RepeatVector</span><span class="crayon-sy">(</span><span class="crayon-v">n_outputs</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c08128ae9314684980846-80"><span class="crayon-h">	</span><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">add</span><span class="crayon-sy">(</span><span class="crayon-e">LSTM</span><span class="crayon-sy">(</span><span class="crayon-cn">200</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">activation</span><span class="crayon-o">=</span><span class="crayon-s">'relu'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">return_sequences</span><span class="crayon-o">=</span><span class="crayon-t">True</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c08128ae9314684980846-81"><span class="crayon-h">	</span><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">add</span><span class="crayon-sy">(</span><span class="crayon-e">TimeDistributed</span><span class="crayon-sy">(</span><span class="crayon-e">Dense</span><span class="crayon-sy">(</span><span class="crayon-cn">100</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">activation</span><span class="crayon-o">=</span><span class="crayon-s">'relu'</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c08128ae9314684980846-82"><span class="crayon-h">	</span><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">add</span><span class="crayon-sy">(</span><span class="crayon-e">TimeDistributed</span><span class="crayon-sy">(</span><span class="crayon-e">Dense</span><span class="crayon-sy">(</span><span class="crayon-cn">1</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c08128ae9314684980846-83"><span class="crayon-h">	</span><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">compile</span><span class="crayon-sy">(</span><span class="crayon-v">loss</span><span class="crayon-o">=</span><span class="crayon-s">'mse'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">optimizer</span><span class="crayon-o">=</span><span class="crayon-s">'adam'</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c08128ae9314684980846-84"><span class="crayon-h">	</span><span class="crayon-p"># fit network</span></div><div class="crayon-line" id="crayon-5c08128ae9314684980846-85"><span class="crayon-h">	</span><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">fit</span><span class="crayon-sy">(</span><span class="crayon-v">train_x</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">train_y</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">epochs</span><span class="crayon-o">=</span><span class="crayon-v">epochs</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">batch_size</span><span class="crayon-o">=</span><span class="crayon-v">batch_size</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">verbose</span><span class="crayon-o">=</span><span class="crayon-v">verbose</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c08128ae9314684980846-86"><span class="crayon-h">	</span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">model</span></div><div class="crayon-line" id="crayon-5c08128ae9314684980846-87">&nbsp;</div><div class="crayon-line crayon-striped-line" id="crayon-5c08128ae9314684980846-88"><span class="crayon-p"># make a forecast</span></div><div class="crayon-line" id="crayon-5c08128ae9314684980846-89"><span class="crayon-e">def </span><span class="crayon-e">forecast</span><span class="crayon-sy">(</span><span class="crayon-v">model</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">history</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_input</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c08128ae9314684980846-90"><span class="crayon-h">	</span><span class="crayon-p"># flatten data</span></div><div class="crayon-line" id="crayon-5c08128ae9314684980846-91"><span class="crayon-h">	</span><span class="crayon-v">data</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-t">array</span><span class="crayon-sy">(</span><span class="crayon-v">history</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c08128ae9314684980846-92"><span class="crayon-h">	</span><span class="crayon-v">data</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">data</span><span class="crayon-sy">.</span><span class="crayon-e">reshape</span><span class="crayon-sy">(</span><span class="crayon-sy">(</span><span class="crayon-v">data</span><span class="crayon-sy">.</span><span class="crayon-v">shape</span><span class="crayon-sy">[</span><span class="crayon-cn">0</span><span class="crayon-sy">]</span><span class="crayon-o">*</span><span class="crayon-v">data</span><span class="crayon-sy">.</span><span class="crayon-v">shape</span><span class="crayon-sy">[</span><span class="crayon-cn">1</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">data</span><span class="crayon-sy">.</span><span class="crayon-v">shape</span><span class="crayon-sy">[</span><span class="crayon-cn">2</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c08128ae9314684980846-93"><span class="crayon-h">	</span><span class="crayon-p"># retrieve last observations for input data</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c08128ae9314684980846-94"><span class="crayon-h">	</span><span class="crayon-v">input_x</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">data</span><span class="crayon-sy">[</span><span class="crayon-o">-</span><span class="crayon-v">n_input</span><span class="crayon-o">:</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-o">:</span><span class="crayon-sy">]</span></div><div class="crayon-line" id="crayon-5c08128ae9314684980846-95"><span class="crayon-h">	</span><span class="crayon-p"># reshape into [1, n_input, n]</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c08128ae9314684980846-96"><span class="crayon-h">	</span><span class="crayon-v">input_x</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">input_x</span><span class="crayon-sy">.</span><span class="crayon-e">reshape</span><span class="crayon-sy">(</span><span class="crayon-sy">(</span><span class="crayon-cn">1</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">input_x</span><span class="crayon-sy">.</span><span class="crayon-v">shape</span><span class="crayon-sy">[</span><span class="crayon-cn">0</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">input_x</span><span class="crayon-sy">.</span><span class="crayon-v">shape</span><span class="crayon-sy">[</span><span class="crayon-cn">1</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c08128ae9314684980846-97"><span class="crayon-h">	</span><span class="crayon-p"># forecast the next week</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c08128ae9314684980846-98"><span class="crayon-h">	</span><span class="crayon-v">yhat</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">predict</span><span class="crayon-sy">(</span><span class="crayon-v">input_x</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">verbose</span><span class="crayon-o">=</span><span class="crayon-cn">0</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c08128ae9314684980846-99"><span class="crayon-h">	</span><span class="crayon-p"># we only want the vector forecast</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c08128ae9314684980846-100"><span class="crayon-h">	</span><span class="crayon-v">yhat</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">yhat</span><span class="crayon-sy">[</span><span class="crayon-cn">0</span><span class="crayon-sy">]</span></div><div class="crayon-line" id="crayon-5c08128ae9314684980846-101"><span class="crayon-h">	</span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">yhat</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c08128ae9314684980846-102">&nbsp;</div><div class="crayon-line" id="crayon-5c08128ae9314684980846-103"><span class="crayon-p"># evaluate a single model</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c08128ae9314684980846-104"><span class="crayon-e">def </span><span class="crayon-e">evaluate_model</span><span class="crayon-sy">(</span><span class="crayon-v">train</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">test</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_input</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5c08128ae9314684980846-105"><span class="crayon-h">	</span><span class="crayon-p"># fit model</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c08128ae9314684980846-106"><span class="crayon-h">	</span><span class="crayon-v">model</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">build_model</span><span class="crayon-sy">(</span><span class="crayon-v">train</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_input</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c08128ae9314684980846-107"><span class="crayon-h">	</span><span class="crayon-p"># history is a list of weekly data</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c08128ae9314684980846-108"><span class="crayon-h">	</span><span class="crayon-v">history</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-i">x</span><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">x</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-v">train</span><span class="crayon-sy">]</span></div><div class="crayon-line" id="crayon-5c08128ae9314684980846-109"><span class="crayon-h">	</span><span class="crayon-p"># walk-forward validation over each week</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c08128ae9314684980846-110"><span class="crayon-h">	</span><span class="crayon-v">predictions</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">list</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c08128ae9314684980846-111"><span class="crayon-h">	</span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">i</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-e">len</span><span class="crayon-sy">(</span><span class="crayon-v">test</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c08128ae9314684980846-112"><span class="crayon-h">		</span><span class="crayon-p"># predict the week</span></div><div class="crayon-line" id="crayon-5c08128ae9314684980846-113"><span class="crayon-h">		</span><span class="crayon-v">yhat_sequence</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">forecast</span><span class="crayon-sy">(</span><span class="crayon-v">model</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">history</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_input</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c08128ae9314684980846-114"><span class="crayon-h">		</span><span class="crayon-p"># store the predictions</span></div><div class="crayon-line" id="crayon-5c08128ae9314684980846-115"><span class="crayon-h">		</span><span class="crayon-v">predictions</span><span class="crayon-sy">.</span><span class="crayon-e">append</span><span class="crayon-sy">(</span><span class="crayon-v">yhat_sequence</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c08128ae9314684980846-116"><span class="crayon-h">		</span><span class="crayon-p"># get real observation and add to history for predicting the next week</span></div><div class="crayon-line" id="crayon-5c08128ae9314684980846-117"><span class="crayon-h">		</span><span class="crayon-v">history</span><span class="crayon-sy">.</span><span class="crayon-e">append</span><span class="crayon-sy">(</span><span class="crayon-v">test</span><span class="crayon-sy">[</span><span class="crayon-v">i</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-o">:</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c08128ae9314684980846-118"><span class="crayon-h">	</span><span class="crayon-p"># evaluate predictions days for each week</span></div><div class="crayon-line" id="crayon-5c08128ae9314684980846-119"><span class="crayon-h">	</span><span class="crayon-v">predictions</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-t">array</span><span class="crayon-sy">(</span><span class="crayon-v">predictions</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c08128ae9314684980846-120"><span class="crayon-h">	</span><span class="crayon-v">score</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">scores</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">evaluate_forecasts</span><span class="crayon-sy">(</span><span class="crayon-v">test</span><span class="crayon-sy">[</span><span class="crayon-o">:</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-o">:</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">0</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">predictions</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c08128ae9314684980846-121"><span class="crayon-h">	</span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">score</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">scores</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c08128ae9314684980846-122">&nbsp;</div><div class="crayon-line" id="crayon-5c08128ae9314684980846-123"><span class="crayon-p"># load the new file</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c08128ae9314684980846-124"><span class="crayon-v">dataset</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">read_csv</span><span class="crayon-sy">(</span><span class="crayon-s">'household_power_consumption_days.csv'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">header</span><span class="crayon-o">=</span><span class="crayon-cn">0</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">infer_datetime_format</span><span class="crayon-o">=</span><span class="crayon-t">True</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">parse_dates</span><span class="crayon-o">=</span><span class="crayon-sy">[</span><span class="crayon-s">'datetime'</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">index_col</span><span class="crayon-o">=</span><span class="crayon-sy">[</span><span class="crayon-s">'datetime'</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c08128ae9314684980846-125"><span class="crayon-p"># split into train and test</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c08128ae9314684980846-126"><span class="crayon-v">train</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">test</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">split_dataset</span><span class="crayon-sy">(</span><span class="crayon-v">dataset</span><span class="crayon-sy">.</span><span class="crayon-v">values</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c08128ae9314684980846-127"><span class="crayon-p"># evaluate model and get scores</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c08128ae9314684980846-128"><span class="crayon-v">n_input</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-cn">14</span></div><div class="crayon-line" id="crayon-5c08128ae9314684980846-129"><span class="crayon-v">score</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">scores</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">evaluate_model</span><span class="crayon-sy">(</span><span class="crayon-v">train</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">test</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_input</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c08128ae9314684980846-130"><span class="crayon-p"># summarize scores</span></div><div class="crayon-line" id="crayon-5c08128ae9314684980846-131"><span class="crayon-e">summarize_scores</span><span class="crayon-sy">(</span><span class="crayon-s">'lstm'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">score</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">scores</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c08128ae9314684980846-132"><span class="crayon-p"># plot scores</span></div><div class="crayon-line" id="crayon-5c08128ae9314684980846-133"><span class="crayon-v">days</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-s">'sun'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-s">'mon'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-s">'tue'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-s">'wed'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-s">'thr'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-s">'fri'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-s">'sat'</span><span class="crayon-sy">]</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c08128ae9314684980846-134"><span class="crayon-v">pyplot</span><span class="crayon-sy">.</span><span class="crayon-e">plot</span><span class="crayon-sy">(</span><span class="crayon-v">days</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">scores</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">marker</span><span class="crayon-o">=</span><span class="crayon-s">'o'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">label</span><span class="crayon-o">=</span><span class="crayon-s">'lstm'</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c08128ae9314684980846-135"><span class="crayon-v">pyplot</span><span class="crayon-sy">.</span><span class="crayon-e">show</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div></div></td>
					</tr>
				</tbody></table>
			</div>
		</div>
<!-- [Format Time: 0.0075 seconds] -->
<p>Running the example fits the model and summarizes the performance on the test dataset.</p>
<p>Experimentation found that this model appears less stable than the 
univariate case and may be related to the differing scales of the input 
eight variables.</p>
<p>Your specific results may vary given the stochastic nature of the 
algorithm. You may want to try running the example a few times.</p>
<p>We can see that in this case, the model is skillful, achieving an overall RMSE score of about 376 kilowatts.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->

		<div id="crayon-5c08128ae9317767719569" class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" style="margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important; height: auto;">
		
			<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important; height: 18px !important; line-height: 18px !important; margin-top: -19px; display: none; z-index: 4;"><span class="crayon-title"></span>
			<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button crayon-pressed" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code" style="display: none;"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
			<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
			<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="readonly" style="-moz-tab-size: 4; font-size: 12px !important; line-height: 15px !important; z-index: 0; opacity: 0; overflow: hidden;" wrap="soft">lstm: [376.273] 378.5, 381.5, 328.4, 388.3, 361.2, 308.0, 467.2</textarea></div>
			<div class="crayon-main" style="position: relative; z-index: 1; overflow: hidden;">
				<table class="crayon-table" style="">
					<tbody><tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5c08128ae9317767719569-1">1</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5c08128ae9317767719569-1">lstm: [376.273] 378.5, 381.5, 328.4, 388.3, 361.2, 308.0, 467.2</div></div></td>
					</tr>
				</tbody></table>
			</div>
		</div>
<!-- [Format Time: 0.0000 seconds] -->
<p>A line plot of the per-day RMSE is also created.</p>
<div id="attachment_6290" style="width: 1290px" class="wp-caption aligncenter"><img class="size-full wp-image-6290" src="How%20to%20Develop%20LSTM%20Models%20for%20Multi-Step%20Time%20Series%20Forecasting%20of%20Household%20Power%20Consumption_fichiers/Line-Plot-of-RMSE-per-Day-for-Multivariate-Encoder-Decoder-L.png" alt="Line Plot of RMSE per Day for Multivariate Encoder-Decoder LSTM with 14-day Inputs" srcset="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2018/07/Line-Plot-of-RMSE-per-Day-for-Multivariate-Encoder-Decoder-LSTM-with-14-day-Inputs.png 1280w, https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2018/07/Line-Plot-of-RMSE-per-Day-for-Multivariate-Encoder-Decoder-LSTM-with-14-day-Inputs-300x225.png 300w, https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2018/07/Line-Plot-of-RMSE-per-Day-for-Multivariate-Encoder-Decoder-LSTM-with-14-day-Inputs-768x576.png 768w, https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2018/07/Line-Plot-of-RMSE-per-Day-for-Multivariate-Encoder-Decoder-LSTM-with-14-day-Inputs-1024x768.png 1024w" sizes="(max-width: 1280px) 100vw, 1280px" width="1280" height="960"><p class="wp-caption-text">Line Plot of RMSE per Day for Multivariate Encoder-Decoder LSTM with 14-day Inputs</p></div>
<h2>CNN-LSTM Encoder-Decoder Model With Univariate Input</h2>
<p>A convolutional neural network, or CNN, can be used as the encoder in an encoder-decoder architecture.</p>
<p>The CNN does not directly support sequence input; instead, a 1D CNN 
is capable of reading across sequence input and automatically learning 
the salient features. These can then be interpreted by an LSTM decoder 
as per normal. We refer to hybrid models that use a CNN and LSTM as <a href="https://machinelearningmastery.com/cnn-long-short-term-memory-networks/">CNN-LSTM models</a>, and in this case we are using them together in an encoder-decoder architecture.</p>
<p>The CNN expects the input data to have the same 3D structure as the 
LSTM model, although multiple features are read as different channels 
that ultimately have the same effect.</p>
<p>We will simplify the example and focus on the CNN-LSTM with 
univariate input, but it can just as easily be updated to use 
multivariate input, which is left as an exercise.</p>
<p>As before, we will use input sequences comprised of 14 days of daily total power consumption.</p>
<p>We will define a simple but effective CNN architecture for the 
encoder that is comprised of two convolutional layers followed by a max 
pooling layer, the results of which are then flattened.</p>
<p>The first convolutional layer reads across the input sequence and 
projects the results onto feature maps. The second performs the same 
operation on the feature maps created by the first layer, attempting to 
amplify any salient features. We will use 64 feature maps per 
convolutional layer and read the input sequences with a kernel size of 
three time steps.</p>
<p>The max pooling layer simplifies the feature maps by keeping 1/4 of 
the values with the largest (max) signal. The distilled feature maps 
after the pooling layer are then flattened into one long vector that can
 then be used as input to the decoding process.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->

		<div id="crayon-5c08128ae931a714575090" class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" style="margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important; height: auto;">
		
			<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important; height: 18px !important; line-height: 18px !important; margin-top: -19px; display: none; position: absolute; z-index: 2;"><span class="crayon-title"></span>
			<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button crayon-pressed" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
			<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
			<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="readonly" style="-moz-tab-size: 4; font-size: 12px !important; line-height: 15px !important; z-index: 0; opacity: 0; overflow: hidden;" wrap="soft">model.add(Conv1D(filters=64, kernel_size=3, activation='relu', input_shape=(n_timesteps,n_features)))
model.add(Conv1D(filters=64, kernel_size=3, activation='relu'))
model.add(MaxPooling1D(pool_size=2))
model.add(Flatten())</textarea></div>
			<div class="crayon-main" style="position: relative; z-index: 1; overflow: hidden;">
				<table class="crayon-table" style="">
					<tbody><tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5c08128ae931a714575090-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c08128ae931a714575090-2">2</div><div class="crayon-num" data-line="crayon-5c08128ae931a714575090-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c08128ae931a714575090-4">4</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5c08128ae931a714575090-1"><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">add</span><span class="crayon-sy">(</span><span class="crayon-e">Conv1D</span><span class="crayon-sy">(</span><span class="crayon-v">filters</span><span class="crayon-o">=</span><span class="crayon-cn">64</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">kernel_size</span><span class="crayon-o">=</span><span class="crayon-cn">3</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">activation</span><span class="crayon-o">=</span><span class="crayon-s">'relu'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">input_shape</span><span class="crayon-o">=</span><span class="crayon-sy">(</span><span class="crayon-v">n_timesteps</span><span class="crayon-sy">,</span><span class="crayon-v">n_features</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c08128ae931a714575090-2"><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">add</span><span class="crayon-sy">(</span><span class="crayon-e">Conv1D</span><span class="crayon-sy">(</span><span class="crayon-v">filters</span><span class="crayon-o">=</span><span class="crayon-cn">64</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">kernel_size</span><span class="crayon-o">=</span><span class="crayon-cn">3</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">activation</span><span class="crayon-o">=</span><span class="crayon-s">'relu'</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c08128ae931a714575090-3"><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">add</span><span class="crayon-sy">(</span><span class="crayon-e">MaxPooling1D</span><span class="crayon-sy">(</span><span class="crayon-v">pool_size</span><span class="crayon-o">=</span><span class="crayon-cn">2</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c08128ae931a714575090-4"><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">add</span><span class="crayon-sy">(</span><span class="crayon-e">Flatten</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div></div></td>
					</tr>
				</tbody></table>
			</div>
		</div>
<!-- [Format Time: 0.0005 seconds] -->
<p>The decoder is the same as was defined in previous sections.</p>
<p>The only other change is to set the number of training epochs to 20.</p>
<p>The <em>build_model()</em> function with these changes is listed below.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->

		<div id="crayon-5c08128ae931c266809654" class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" style="margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important; height: auto;">
		
			<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important; height: 18px !important; line-height: 18px !important; margin-top: -19px; display: none; position: absolute; z-index: 2;"><span class="crayon-title"></span>
			<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button crayon-pressed" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
			<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
			<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="readonly" style="-moz-tab-size: 4; font-size: 12px !important; line-height: 15px !important; z-index: 0; opacity: 0; overflow: hidden;" wrap="soft"># train the model
def build_model(train, n_input):
	# prepare data
	train_x, train_y = to_supervised(train, n_input)
	# define parameters
	verbose, epochs, batch_size = 0, 20, 16
	n_timesteps, n_features, n_outputs = train_x.shape[1], train_x.shape[2], train_y.shape[1]
	# reshape output into [samples, timesteps, features]
	train_y = train_y.reshape((train_y.shape[0], train_y.shape[1], 1))
	# define model
	model = Sequential()
	model.add(Conv1D(filters=64, kernel_size=3, activation='relu', input_shape=(n_timesteps,n_features)))
	model.add(Conv1D(filters=64, kernel_size=3, activation='relu'))
	model.add(MaxPooling1D(pool_size=2))
	model.add(Flatten())
	model.add(RepeatVector(n_outputs))
	model.add(LSTM(200, activation='relu', return_sequences=True))
	model.add(TimeDistributed(Dense(100, activation='relu')))
	model.add(TimeDistributed(Dense(1)))
	model.compile(loss='mse', optimizer='adam')
	# fit network
	model.fit(train_x, train_y, epochs=epochs, batch_size=batch_size, verbose=verbose)
	return model</textarea></div>
			<div class="crayon-main" style="position: relative; z-index: 1; overflow: hidden;">
				<table class="crayon-table" style="">
					<tbody><tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5c08128ae931c266809654-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c08128ae931c266809654-2">2</div><div class="crayon-num" data-line="crayon-5c08128ae931c266809654-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c08128ae931c266809654-4">4</div><div class="crayon-num" data-line="crayon-5c08128ae931c266809654-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c08128ae931c266809654-6">6</div><div class="crayon-num" data-line="crayon-5c08128ae931c266809654-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c08128ae931c266809654-8">8</div><div class="crayon-num" data-line="crayon-5c08128ae931c266809654-9">9</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c08128ae931c266809654-10">10</div><div class="crayon-num" data-line="crayon-5c08128ae931c266809654-11">11</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c08128ae931c266809654-12">12</div><div class="crayon-num" data-line="crayon-5c08128ae931c266809654-13">13</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c08128ae931c266809654-14">14</div><div class="crayon-num" data-line="crayon-5c08128ae931c266809654-15">15</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c08128ae931c266809654-16">16</div><div class="crayon-num" data-line="crayon-5c08128ae931c266809654-17">17</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c08128ae931c266809654-18">18</div><div class="crayon-num" data-line="crayon-5c08128ae931c266809654-19">19</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c08128ae931c266809654-20">20</div><div class="crayon-num" data-line="crayon-5c08128ae931c266809654-21">21</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c08128ae931c266809654-22">22</div><div class="crayon-num" data-line="crayon-5c08128ae931c266809654-23">23</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5c08128ae931c266809654-1"><span class="crayon-p"># train the model</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c08128ae931c266809654-2"><span class="crayon-e">def </span><span class="crayon-e">build_model</span><span class="crayon-sy">(</span><span class="crayon-v">train</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_input</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5c08128ae931c266809654-3"><span class="crayon-h">	</span><span class="crayon-p"># prepare data</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c08128ae931c266809654-4"><span class="crayon-h">	</span><span class="crayon-v">train_x</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">train_y</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">to_supervised</span><span class="crayon-sy">(</span><span class="crayon-v">train</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_input</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c08128ae931c266809654-5"><span class="crayon-h">	</span><span class="crayon-p"># define parameters</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c08128ae931c266809654-6"><span class="crayon-h">	</span><span class="crayon-v">verbose</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">epochs</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">batch_size</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-cn">0</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">20</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">16</span></div><div class="crayon-line" id="crayon-5c08128ae931c266809654-7"><span class="crayon-h">	</span><span class="crayon-v">n_timesteps</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_features</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_outputs</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">train_x</span><span class="crayon-sy">.</span><span class="crayon-v">shape</span><span class="crayon-sy">[</span><span class="crayon-cn">1</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">train_x</span><span class="crayon-sy">.</span><span class="crayon-v">shape</span><span class="crayon-sy">[</span><span class="crayon-cn">2</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">train_y</span><span class="crayon-sy">.</span><span class="crayon-v">shape</span><span class="crayon-sy">[</span><span class="crayon-cn">1</span><span class="crayon-sy">]</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c08128ae931c266809654-8"><span class="crayon-h">	</span><span class="crayon-p"># reshape output into [samples, timesteps, features]</span></div><div class="crayon-line" id="crayon-5c08128ae931c266809654-9"><span class="crayon-h">	</span><span class="crayon-v">train_y</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">train_y</span><span class="crayon-sy">.</span><span class="crayon-e">reshape</span><span class="crayon-sy">(</span><span class="crayon-sy">(</span><span class="crayon-v">train_y</span><span class="crayon-sy">.</span><span class="crayon-v">shape</span><span class="crayon-sy">[</span><span class="crayon-cn">0</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">train_y</span><span class="crayon-sy">.</span><span class="crayon-v">shape</span><span class="crayon-sy">[</span><span class="crayon-cn">1</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">1</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c08128ae931c266809654-10"><span class="crayon-h">	</span><span class="crayon-p"># define model</span></div><div class="crayon-line" id="crayon-5c08128ae931c266809654-11"><span class="crayon-h">	</span><span class="crayon-v">model</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">Sequential</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c08128ae931c266809654-12"><span class="crayon-h">	</span><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">add</span><span class="crayon-sy">(</span><span class="crayon-e">Conv1D</span><span class="crayon-sy">(</span><span class="crayon-v">filters</span><span class="crayon-o">=</span><span class="crayon-cn">64</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">kernel_size</span><span class="crayon-o">=</span><span class="crayon-cn">3</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">activation</span><span class="crayon-o">=</span><span class="crayon-s">'relu'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">input_shape</span><span class="crayon-o">=</span><span class="crayon-sy">(</span><span class="crayon-v">n_timesteps</span><span class="crayon-sy">,</span><span class="crayon-v">n_features</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c08128ae931c266809654-13"><span class="crayon-h">	</span><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">add</span><span class="crayon-sy">(</span><span class="crayon-e">Conv1D</span><span class="crayon-sy">(</span><span class="crayon-v">filters</span><span class="crayon-o">=</span><span class="crayon-cn">64</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">kernel_size</span><span class="crayon-o">=</span><span class="crayon-cn">3</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">activation</span><span class="crayon-o">=</span><span class="crayon-s">'relu'</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c08128ae931c266809654-14"><span class="crayon-h">	</span><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">add</span><span class="crayon-sy">(</span><span class="crayon-e">MaxPooling1D</span><span class="crayon-sy">(</span><span class="crayon-v">pool_size</span><span class="crayon-o">=</span><span class="crayon-cn">2</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c08128ae931c266809654-15"><span class="crayon-h">	</span><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">add</span><span class="crayon-sy">(</span><span class="crayon-e">Flatten</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c08128ae931c266809654-16"><span class="crayon-h">	</span><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">add</span><span class="crayon-sy">(</span><span class="crayon-e">RepeatVector</span><span class="crayon-sy">(</span><span class="crayon-v">n_outputs</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c08128ae931c266809654-17"><span class="crayon-h">	</span><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">add</span><span class="crayon-sy">(</span><span class="crayon-e">LSTM</span><span class="crayon-sy">(</span><span class="crayon-cn">200</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">activation</span><span class="crayon-o">=</span><span class="crayon-s">'relu'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">return_sequences</span><span class="crayon-o">=</span><span class="crayon-t">True</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c08128ae931c266809654-18"><span class="crayon-h">	</span><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">add</span><span class="crayon-sy">(</span><span class="crayon-e">TimeDistributed</span><span class="crayon-sy">(</span><span class="crayon-e">Dense</span><span class="crayon-sy">(</span><span class="crayon-cn">100</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">activation</span><span class="crayon-o">=</span><span class="crayon-s">'relu'</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c08128ae931c266809654-19"><span class="crayon-h">	</span><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">add</span><span class="crayon-sy">(</span><span class="crayon-e">TimeDistributed</span><span class="crayon-sy">(</span><span class="crayon-e">Dense</span><span class="crayon-sy">(</span><span class="crayon-cn">1</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c08128ae931c266809654-20"><span class="crayon-h">	</span><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">compile</span><span class="crayon-sy">(</span><span class="crayon-v">loss</span><span class="crayon-o">=</span><span class="crayon-s">'mse'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">optimizer</span><span class="crayon-o">=</span><span class="crayon-s">'adam'</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c08128ae931c266809654-21"><span class="crayon-h">	</span><span class="crayon-p"># fit network</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c08128ae931c266809654-22"><span class="crayon-h">	</span><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">fit</span><span class="crayon-sy">(</span><span class="crayon-v">train_x</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">train_y</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">epochs</span><span class="crayon-o">=</span><span class="crayon-v">epochs</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">batch_size</span><span class="crayon-o">=</span><span class="crayon-v">batch_size</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">verbose</span><span class="crayon-o">=</span><span class="crayon-v">verbose</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c08128ae931c266809654-23"><span class="crayon-h">	</span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">model</span></div></div></td>
					</tr>
				</tbody></table>
			</div>
		</div>
<!-- [Format Time: 0.0019 seconds] -->
<p>We are now ready to try the encoder-decoder architecture with a CNN encoder.</p>
<p>The complete code listing is provided below.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->

		<div id="crayon-5c08128ae931e126985880" class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" style="margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important; height: auto;">
		
			<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important; height: 18px !important; line-height: 18px !important; margin-top: -19px; display: none; position: absolute; z-index: 2;"><span class="crayon-title"></span>
			<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button crayon-pressed" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
			<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
			<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="readonly" style="-moz-tab-size: 4; font-size: 12px !important; line-height: 15px !important; z-index: 0; opacity: 0; overflow: hidden;" wrap="soft">#
 univariate multi-step encoder-decoder cnn-lstm
from math import sqrt
from numpy import split
from numpy import array
from pandas import read_csv
from sklearn.metrics import mean_squared_error
from matplotlib import pyplot
from keras.models import Sequential
from keras.layers import Dense
from keras.layers import Flatten
from keras.layers import LSTM
from keras.layers import RepeatVector
from keras.layers import TimeDistributed
from keras.layers.convolutional import Conv1D
from keras.layers.convolutional import MaxPooling1D

# split a univariate dataset into train/test sets
def split_dataset(data):
	# split into standard weeks
	train, test = data[1:-328], data[-328:-6]
	# restructure into windows of weekly data
	train = array(split(train, len(train)/7))
	test = array(split(test, len(test)/7))
	return train, test

# evaluate one or more weekly forecasts against expected values
def evaluate_forecasts(actual, predicted):
	scores = list()
	# calculate an RMSE score for each day
	for i in range(actual.shape[1]):
		# calculate mse
		mse = mean_squared_error(actual[:, i], predicted[:, i])
		# calculate rmse
		rmse = sqrt(mse)
		# store
		scores.append(rmse)
	# calculate overall RMSE
	s = 0
	for row in range(actual.shape[0]):
		for col in range(actual.shape[1]):
			s += (actual[row, col] - predicted[row, col])**2
	score = sqrt(s / (actual.shape[0] * actual.shape[1]))
	return score, scores

# summarize scores
def summarize_scores(name, score, scores):
	s_scores = ', '.join(['%.1f' % s for s in scores])
	print('%s: [%.3f] %s' % (name, score, s_scores))

# convert history into inputs and outputs
def to_supervised(train, n_input, n_out=7):
	# flatten data
	data = train.reshape((train.shape[0]*train.shape[1], train.shape[2]))
	X, y = list(), list()
	in_start = 0
	# step over the entire history one time step at a time
	for _ in range(len(data)):
		# define the end of the input sequence
		in_end = in_start + n_input
		out_end = in_end + n_out
		# ensure we have enough data for this instance
		if out_end &lt; len(data):
			x_input = data[in_start:in_end, 0]
			x_input = x_input.reshape((len(x_input), 1))
			X.append(x_input)
			y.append(data[in_end:out_end, 0])
		# move along one time step
		in_start += 1
	return array(X), array(y)

# train the model
def build_model(train, n_input):
	# prepare data
	train_x, train_y = to_supervised(train, n_input)
	# define parameters
	verbose, epochs, batch_size = 0, 20, 16
	n_timesteps, n_features, n_outputs = train_x.shape[1], 
train_x.shape[2], train_y.shape[1]
	# reshape output into [samples, timesteps, features]
	train_y = train_y.reshape((train_y.shape[0], train_y.shape[1], 1))
	# define model
	model = Sequential()
	model.add(Conv1D(filters=64, kernel_size=3, activation='relu', 
input_shape=(n_timesteps,n_features)))
	model.add(Conv1D(filters=64, kernel_size=3, activation='relu'))
	model.add(MaxPooling1D(pool_size=2))
	model.add(Flatten())
	model.add(RepeatVector(n_outputs))
	model.add(LSTM(200, activation='relu', return_sequences=True))
	model.add(TimeDistributed(Dense(100, activation='relu')))
	model.add(TimeDistributed(Dense(1)))
	model.compile(loss='mse', optimizer='adam')
	# fit network
	model.fit(train_x, train_y, epochs=epochs, batch_size=batch_size, 
verbose=verbose)
	return model

# make a forecast
def forecast(model, history, n_input):
	# flatten data
	data = array(history)
	data = data.reshape((data.shape[0]*data.shape[1], data.shape[2]))
	# retrieve last observations for input data
	input_x = data[-n_input:, 0]
	# reshape into [1, n_input, 1]
	input_x = input_x.reshape((1, len(input_x), 1))
	# forecast the next week
	yhat = model.predict(input_x, verbose=0)
	# we only want the vector forecast
	yhat = yhat[0]
	return yhat

# evaluate a single model
def evaluate_model(train, test, n_input):
	# fit model
	model = build_model(train, n_input)
	# history is a list of weekly data
	history = [x for x in train]
	# walk-forward validation over each week
	predictions = list()
	for i in range(len(test)):
		# predict the week
		yhat_sequence = forecast(model, history, n_input)
		# store the predictions
		predictions.append(yhat_sequence)
		# get real observation and add to history for predicting the next week
		history.append(test[i, :])
	# evaluate predictions days for each week
	predictions = array(predictions)
	score, scores = evaluate_forecasts(test[:, :, 0], predictions)
	return score, scores

# load the new file
dataset = read_csv('household_power_consumption_days.csv', header=0, 
infer_datetime_format=True, parse_dates=['datetime'], 
index_col=['datetime'])
# split into train and test
train, test = split_dataset(dataset.values)
# evaluate model and get scores
n_input = 14
score, scores = evaluate_model(train, test, n_input)
# summarize scores
summarize_scores('lstm', score, scores)
# plot scores
days = ['sun', 'mon', 'tue', 'wed', 'thr', 'fri', 'sat']
pyplot.plot(days, scores, marker='o', label='lstm')
pyplot.show()</textarea></div>
			<div class="crayon-main" style="position: relative; z-index: 1; overflow: hidden;">
				<table class="crayon-table" style="">
					<tbody><tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5c08128ae931e126985880-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c08128ae931e126985880-2">2</div><div class="crayon-num" data-line="crayon-5c08128ae931e126985880-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c08128ae931e126985880-4">4</div><div class="crayon-num" data-line="crayon-5c08128ae931e126985880-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c08128ae931e126985880-6">6</div><div class="crayon-num" data-line="crayon-5c08128ae931e126985880-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c08128ae931e126985880-8">8</div><div class="crayon-num" data-line="crayon-5c08128ae931e126985880-9">9</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c08128ae931e126985880-10">10</div><div class="crayon-num" data-line="crayon-5c08128ae931e126985880-11">11</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c08128ae931e126985880-12">12</div><div class="crayon-num" data-line="crayon-5c08128ae931e126985880-13">13</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c08128ae931e126985880-14">14</div><div class="crayon-num" data-line="crayon-5c08128ae931e126985880-15">15</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c08128ae931e126985880-16">16</div><div class="crayon-num" data-line="crayon-5c08128ae931e126985880-17">17</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c08128ae931e126985880-18">18</div><div class="crayon-num" data-line="crayon-5c08128ae931e126985880-19">19</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c08128ae931e126985880-20">20</div><div class="crayon-num" data-line="crayon-5c08128ae931e126985880-21">21</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c08128ae931e126985880-22">22</div><div class="crayon-num" data-line="crayon-5c08128ae931e126985880-23">23</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c08128ae931e126985880-24">24</div><div class="crayon-num" data-line="crayon-5c08128ae931e126985880-25">25</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c08128ae931e126985880-26">26</div><div class="crayon-num" data-line="crayon-5c08128ae931e126985880-27">27</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c08128ae931e126985880-28">28</div><div class="crayon-num" data-line="crayon-5c08128ae931e126985880-29">29</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c08128ae931e126985880-30">30</div><div class="crayon-num" data-line="crayon-5c08128ae931e126985880-31">31</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c08128ae931e126985880-32">32</div><div class="crayon-num" data-line="crayon-5c08128ae931e126985880-33">33</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c08128ae931e126985880-34">34</div><div class="crayon-num" data-line="crayon-5c08128ae931e126985880-35">35</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c08128ae931e126985880-36">36</div><div class="crayon-num" data-line="crayon-5c08128ae931e126985880-37">37</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c08128ae931e126985880-38">38</div><div class="crayon-num" data-line="crayon-5c08128ae931e126985880-39">39</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c08128ae931e126985880-40">40</div><div class="crayon-num" data-line="crayon-5c08128ae931e126985880-41">41</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c08128ae931e126985880-42">42</div><div class="crayon-num" data-line="crayon-5c08128ae931e126985880-43">43</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c08128ae931e126985880-44">44</div><div class="crayon-num" data-line="crayon-5c08128ae931e126985880-45">45</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c08128ae931e126985880-46">46</div><div class="crayon-num" data-line="crayon-5c08128ae931e126985880-47">47</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c08128ae931e126985880-48">48</div><div class="crayon-num" data-line="crayon-5c08128ae931e126985880-49">49</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c08128ae931e126985880-50">50</div><div class="crayon-num" data-line="crayon-5c08128ae931e126985880-51">51</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c08128ae931e126985880-52">52</div><div class="crayon-num" data-line="crayon-5c08128ae931e126985880-53">53</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c08128ae931e126985880-54">54</div><div class="crayon-num" data-line="crayon-5c08128ae931e126985880-55">55</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c08128ae931e126985880-56">56</div><div class="crayon-num" data-line="crayon-5c08128ae931e126985880-57">57</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c08128ae931e126985880-58">58</div><div class="crayon-num" data-line="crayon-5c08128ae931e126985880-59">59</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c08128ae931e126985880-60">60</div><div class="crayon-num" data-line="crayon-5c08128ae931e126985880-61">61</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c08128ae931e126985880-62">62</div><div class="crayon-num" data-line="crayon-5c08128ae931e126985880-63">63</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c08128ae931e126985880-64">64</div><div class="crayon-num" data-line="crayon-5c08128ae931e126985880-65">65</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c08128ae931e126985880-66">66</div><div class="crayon-num" data-line="crayon-5c08128ae931e126985880-67">67</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c08128ae931e126985880-68">68</div><div class="crayon-num" data-line="crayon-5c08128ae931e126985880-69">69</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c08128ae931e126985880-70">70</div><div class="crayon-num" data-line="crayon-5c08128ae931e126985880-71">71</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c08128ae931e126985880-72">72</div><div class="crayon-num" data-line="crayon-5c08128ae931e126985880-73">73</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c08128ae931e126985880-74">74</div><div class="crayon-num" data-line="crayon-5c08128ae931e126985880-75">75</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c08128ae931e126985880-76">76</div><div class="crayon-num" data-line="crayon-5c08128ae931e126985880-77">77</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c08128ae931e126985880-78">78</div><div class="crayon-num" data-line="crayon-5c08128ae931e126985880-79">79</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c08128ae931e126985880-80">80</div><div class="crayon-num" data-line="crayon-5c08128ae931e126985880-81">81</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c08128ae931e126985880-82">82</div><div class="crayon-num" data-line="crayon-5c08128ae931e126985880-83">83</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c08128ae931e126985880-84">84</div><div class="crayon-num" data-line="crayon-5c08128ae931e126985880-85">85</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c08128ae931e126985880-86">86</div><div class="crayon-num" data-line="crayon-5c08128ae931e126985880-87">87</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c08128ae931e126985880-88">88</div><div class="crayon-num" data-line="crayon-5c08128ae931e126985880-89">89</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c08128ae931e126985880-90">90</div><div class="crayon-num" data-line="crayon-5c08128ae931e126985880-91">91</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c08128ae931e126985880-92">92</div><div class="crayon-num" data-line="crayon-5c08128ae931e126985880-93">93</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c08128ae931e126985880-94">94</div><div class="crayon-num" data-line="crayon-5c08128ae931e126985880-95">95</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c08128ae931e126985880-96">96</div><div class="crayon-num" data-line="crayon-5c08128ae931e126985880-97">97</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c08128ae931e126985880-98">98</div><div class="crayon-num" data-line="crayon-5c08128ae931e126985880-99">99</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c08128ae931e126985880-100">100</div><div class="crayon-num" data-line="crayon-5c08128ae931e126985880-101">101</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c08128ae931e126985880-102">102</div><div class="crayon-num" data-line="crayon-5c08128ae931e126985880-103">103</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c08128ae931e126985880-104">104</div><div class="crayon-num" data-line="crayon-5c08128ae931e126985880-105">105</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c08128ae931e126985880-106">106</div><div class="crayon-num" data-line="crayon-5c08128ae931e126985880-107">107</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c08128ae931e126985880-108">108</div><div class="crayon-num" data-line="crayon-5c08128ae931e126985880-109">109</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c08128ae931e126985880-110">110</div><div class="crayon-num" data-line="crayon-5c08128ae931e126985880-111">111</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c08128ae931e126985880-112">112</div><div class="crayon-num" data-line="crayon-5c08128ae931e126985880-113">113</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c08128ae931e126985880-114">114</div><div class="crayon-num" data-line="crayon-5c08128ae931e126985880-115">115</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c08128ae931e126985880-116">116</div><div class="crayon-num" data-line="crayon-5c08128ae931e126985880-117">117</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c08128ae931e126985880-118">118</div><div class="crayon-num" data-line="crayon-5c08128ae931e126985880-119">119</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c08128ae931e126985880-120">120</div><div class="crayon-num" data-line="crayon-5c08128ae931e126985880-121">121</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c08128ae931e126985880-122">122</div><div class="crayon-num" data-line="crayon-5c08128ae931e126985880-123">123</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c08128ae931e126985880-124">124</div><div class="crayon-num" data-line="crayon-5c08128ae931e126985880-125">125</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c08128ae931e126985880-126">126</div><div class="crayon-num" data-line="crayon-5c08128ae931e126985880-127">127</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c08128ae931e126985880-128">128</div><div class="crayon-num" data-line="crayon-5c08128ae931e126985880-129">129</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c08128ae931e126985880-130">130</div><div class="crayon-num" data-line="crayon-5c08128ae931e126985880-131">131</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c08128ae931e126985880-132">132</div><div class="crayon-num" data-line="crayon-5c08128ae931e126985880-133">133</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c08128ae931e126985880-134">134</div><div class="crayon-num" data-line="crayon-5c08128ae931e126985880-135">135</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c08128ae931e126985880-136">136</div><div class="crayon-num" data-line="crayon-5c08128ae931e126985880-137">137</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c08128ae931e126985880-138">138</div><div class="crayon-num" data-line="crayon-5c08128ae931e126985880-139">139</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c08128ae931e126985880-140">140</div><div class="crayon-num" data-line="crayon-5c08128ae931e126985880-141">141</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c08128ae931e126985880-142">142</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5c08128ae931e126985880-1"><span class="crayon-p"># univariate multi-step encoder-decoder cnn-lstm</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c08128ae931e126985880-2"><span class="crayon-e">from </span><span class="crayon-e">math </span><span class="crayon-e">import </span><span class="crayon-e">sqrt</span></div><div class="crayon-line" id="crayon-5c08128ae931e126985880-3"><span class="crayon-e">from </span><span class="crayon-e">numpy </span><span class="crayon-e">import </span><span class="crayon-e">split</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c08128ae931e126985880-4"><span class="crayon-e">from </span><span class="crayon-e">numpy </span><span class="crayon-e">import </span><span class="crayon-t">array</span></div><div class="crayon-line" id="crayon-5c08128ae931e126985880-5"><span class="crayon-e">from </span><span class="crayon-e">pandas </span><span class="crayon-e">import </span><span class="crayon-e">read_csv</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c08128ae931e126985880-6"><span class="crayon-e">from </span><span class="crayon-v">sklearn</span><span class="crayon-sy">.</span><span class="crayon-e">metrics </span><span class="crayon-e">import </span><span class="crayon-e">mean_squared_error</span></div><div class="crayon-line" id="crayon-5c08128ae931e126985880-7"><span class="crayon-e">from </span><span class="crayon-e">matplotlib </span><span class="crayon-e">import </span><span class="crayon-e">pyplot</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c08128ae931e126985880-8"><span class="crayon-e">from </span><span class="crayon-v">keras</span><span class="crayon-sy">.</span><span class="crayon-e">models </span><span class="crayon-e">import </span><span class="crayon-e">Sequential</span></div><div class="crayon-line" id="crayon-5c08128ae931e126985880-9"><span class="crayon-e">from </span><span class="crayon-v">keras</span><span class="crayon-sy">.</span><span class="crayon-e">layers </span><span class="crayon-e">import </span><span class="crayon-e">Dense</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c08128ae931e126985880-10"><span class="crayon-e">from </span><span class="crayon-v">keras</span><span class="crayon-sy">.</span><span class="crayon-e">layers </span><span class="crayon-e">import </span><span class="crayon-e">Flatten</span></div><div class="crayon-line" id="crayon-5c08128ae931e126985880-11"><span class="crayon-e">from </span><span class="crayon-v">keras</span><span class="crayon-sy">.</span><span class="crayon-e">layers </span><span class="crayon-e">import </span><span class="crayon-e">LSTM</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c08128ae931e126985880-12"><span class="crayon-e">from </span><span class="crayon-v">keras</span><span class="crayon-sy">.</span><span class="crayon-e">layers </span><span class="crayon-e">import </span><span class="crayon-e">RepeatVector</span></div><div class="crayon-line" id="crayon-5c08128ae931e126985880-13"><span class="crayon-e">from </span><span class="crayon-v">keras</span><span class="crayon-sy">.</span><span class="crayon-e">layers </span><span class="crayon-e">import </span><span class="crayon-e">TimeDistributed</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c08128ae931e126985880-14"><span class="crayon-e">from </span><span class="crayon-v">keras</span><span class="crayon-sy">.</span><span class="crayon-v">layers</span><span class="crayon-sy">.</span><span class="crayon-e">convolutional </span><span class="crayon-e">import </span><span class="crayon-e">Conv1D</span></div><div class="crayon-line" id="crayon-5c08128ae931e126985880-15"><span class="crayon-e">from </span><span class="crayon-v">keras</span><span class="crayon-sy">.</span><span class="crayon-v">layers</span><span class="crayon-sy">.</span><span class="crayon-e">convolutional </span><span class="crayon-e">import </span><span class="crayon-v">MaxPooling1D</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c08128ae931e126985880-16">&nbsp;</div><div class="crayon-line" id="crayon-5c08128ae931e126985880-17"><span class="crayon-p"># split a univariate dataset into train/test sets</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c08128ae931e126985880-18"><span class="crayon-e">def </span><span class="crayon-e">split_dataset</span><span class="crayon-sy">(</span><span class="crayon-v">data</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5c08128ae931e126985880-19"><span class="crayon-h">	</span><span class="crayon-p"># split into standard weeks</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c08128ae931e126985880-20"><span class="crayon-h">	</span><span class="crayon-v">train</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">test</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">data</span><span class="crayon-sy">[</span><span class="crayon-cn">1</span><span class="crayon-o">:</span><span class="crayon-o">-</span><span class="crayon-cn">328</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">data</span><span class="crayon-sy">[</span><span class="crayon-o">-</span><span class="crayon-cn">328</span><span class="crayon-o">:</span><span class="crayon-o">-</span><span class="crayon-cn">6</span><span class="crayon-sy">]</span></div><div class="crayon-line" id="crayon-5c08128ae931e126985880-21"><span class="crayon-h">	</span><span class="crayon-p"># restructure into windows of weekly data</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c08128ae931e126985880-22"><span class="crayon-h">	</span><span class="crayon-v">train</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-t">array</span><span class="crayon-sy">(</span><span class="crayon-e">split</span><span class="crayon-sy">(</span><span class="crayon-v">train</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-e">len</span><span class="crayon-sy">(</span><span class="crayon-v">train</span><span class="crayon-sy">)</span><span class="crayon-o">/</span><span class="crayon-cn">7</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c08128ae931e126985880-23"><span class="crayon-h">	</span><span class="crayon-v">test</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-t">array</span><span class="crayon-sy">(</span><span class="crayon-e">split</span><span class="crayon-sy">(</span><span class="crayon-v">test</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-e">len</span><span class="crayon-sy">(</span><span class="crayon-v">test</span><span class="crayon-sy">)</span><span class="crayon-o">/</span><span class="crayon-cn">7</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c08128ae931e126985880-24"><span class="crayon-h">	</span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">train</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">test</span></div><div class="crayon-line" id="crayon-5c08128ae931e126985880-25">&nbsp;</div><div class="crayon-line crayon-striped-line" id="crayon-5c08128ae931e126985880-26"><span class="crayon-p"># evaluate one or more weekly forecasts against expected values</span></div><div class="crayon-line" id="crayon-5c08128ae931e126985880-27"><span class="crayon-e">def </span><span class="crayon-e">evaluate_forecasts</span><span class="crayon-sy">(</span><span class="crayon-v">actual</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">predicted</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c08128ae931e126985880-28"><span class="crayon-h">	</span><span class="crayon-v">scores</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">list</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c08128ae931e126985880-29"><span class="crayon-h">	</span><span class="crayon-p"># calculate an RMSE score for each day</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c08128ae931e126985880-30"><span class="crayon-h">	</span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">i</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-v">actual</span><span class="crayon-sy">.</span><span class="crayon-v">shape</span><span class="crayon-sy">[</span><span class="crayon-cn">1</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5c08128ae931e126985880-31"><span class="crayon-h">		</span><span class="crayon-p"># calculate mse</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c08128ae931e126985880-32"><span class="crayon-h">		</span><span class="crayon-v">mse</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">mean_squared_error</span><span class="crayon-sy">(</span><span class="crayon-v">actual</span><span class="crayon-sy">[</span><span class="crayon-o">:</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">i</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">predicted</span><span class="crayon-sy">[</span><span class="crayon-o">:</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">i</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c08128ae931e126985880-33"><span class="crayon-h">		</span><span class="crayon-p"># calculate rmse</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c08128ae931e126985880-34"><span class="crayon-h">		</span><span class="crayon-v">rmse</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">sqrt</span><span class="crayon-sy">(</span><span class="crayon-v">mse</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c08128ae931e126985880-35"><span class="crayon-h">		</span><span class="crayon-p"># store</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c08128ae931e126985880-36"><span class="crayon-h">		</span><span class="crayon-v">scores</span><span class="crayon-sy">.</span><span class="crayon-e">append</span><span class="crayon-sy">(</span><span class="crayon-v">rmse</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c08128ae931e126985880-37"><span class="crayon-h">	</span><span class="crayon-p"># calculate overall RMSE</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c08128ae931e126985880-38"><span class="crayon-h">	</span><span class="crayon-v">s</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-cn">0</span></div><div class="crayon-line" id="crayon-5c08128ae931e126985880-39"><span class="crayon-h">	</span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-e">row </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-v">actual</span><span class="crayon-sy">.</span><span class="crayon-v">shape</span><span class="crayon-sy">[</span><span class="crayon-cn">0</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c08128ae931e126985880-40"><span class="crayon-h">		</span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-e">col </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-v">actual</span><span class="crayon-sy">.</span><span class="crayon-v">shape</span><span class="crayon-sy">[</span><span class="crayon-cn">1</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5c08128ae931e126985880-41"><span class="crayon-h">			</span><span class="crayon-v">s</span><span class="crayon-h"> </span><span class="crayon-o">+=</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-v">actual</span><span class="crayon-sy">[</span><span class="crayon-v">row</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">col</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-o">-</span><span class="crayon-h"> </span><span class="crayon-v">predicted</span><span class="crayon-sy">[</span><span class="crayon-v">row</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">col</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span><span class="crayon-o">*</span><span class="crayon-o">*</span><span class="crayon-cn">2</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c08128ae931e126985880-42"><span class="crayon-h">	</span><span class="crayon-v">score</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">sqrt</span><span class="crayon-sy">(</span><span class="crayon-v">s</span><span class="crayon-h"> </span><span class="crayon-o">/</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-v">actual</span><span class="crayon-sy">.</span><span class="crayon-v">shape</span><span class="crayon-sy">[</span><span class="crayon-cn">0</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-o">*</span><span class="crayon-h"> </span><span class="crayon-v">actual</span><span class="crayon-sy">.</span><span class="crayon-v">shape</span><span class="crayon-sy">[</span><span class="crayon-cn">1</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c08128ae931e126985880-43"><span class="crayon-h">	</span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">score</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">scores</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c08128ae931e126985880-44">&nbsp;</div><div class="crayon-line" id="crayon-5c08128ae931e126985880-45"><span class="crayon-p"># summarize scores</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c08128ae931e126985880-46"><span class="crayon-e">def </span><span class="crayon-e">summarize_scores</span><span class="crayon-sy">(</span><span class="crayon-v">name</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">score</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">scores</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5c08128ae931e126985880-47"><span class="crayon-h">	</span><span class="crayon-v">s_scores</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-s">', '</span><span class="crayon-sy">.</span><span class="crayon-e">join</span><span class="crayon-sy">(</span><span class="crayon-sy">[</span><span class="crayon-s">'%.1f'</span><span class="crayon-h"> </span><span class="crayon-o">%</span><span class="crayon-h"> </span><span class="crayon-i">s</span><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">s</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-v">scores</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c08128ae931e126985880-48"><span class="crayon-h">	</span><span class="crayon-e">print</span><span class="crayon-sy">(</span><span class="crayon-s">'%s: [%.3f] %s'</span><span class="crayon-h"> </span><span class="crayon-o">%</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-v">name</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">score</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">s_scores</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c08128ae931e126985880-49">&nbsp;</div><div class="crayon-line crayon-striped-line" id="crayon-5c08128ae931e126985880-50"><span class="crayon-p"># convert history into inputs and outputs</span></div><div class="crayon-line" id="crayon-5c08128ae931e126985880-51"><span class="crayon-e">def </span><span class="crayon-e">to_supervised</span><span class="crayon-sy">(</span><span class="crayon-v">train</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_input</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_out</span><span class="crayon-o">=</span><span class="crayon-cn">7</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c08128ae931e126985880-52"><span class="crayon-h">	</span><span class="crayon-p"># flatten data</span></div><div class="crayon-line" id="crayon-5c08128ae931e126985880-53"><span class="crayon-h">	</span><span class="crayon-v">data</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">train</span><span class="crayon-sy">.</span><span class="crayon-e">reshape</span><span class="crayon-sy">(</span><span class="crayon-sy">(</span><span class="crayon-v">train</span><span class="crayon-sy">.</span><span class="crayon-v">shape</span><span class="crayon-sy">[</span><span class="crayon-cn">0</span><span class="crayon-sy">]</span><span class="crayon-o">*</span><span class="crayon-v">train</span><span class="crayon-sy">.</span><span class="crayon-v">shape</span><span class="crayon-sy">[</span><span class="crayon-cn">1</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">train</span><span class="crayon-sy">.</span><span class="crayon-v">shape</span><span class="crayon-sy">[</span><span class="crayon-cn">2</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c08128ae931e126985880-54"><span class="crayon-h">	</span><span class="crayon-v">X</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">y</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">list</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-e">list</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c08128ae931e126985880-55"><span class="crayon-h">	</span><span class="crayon-v">in_start</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-cn">0</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c08128ae931e126985880-56"><span class="crayon-h">	</span><span class="crayon-p"># step over the entire history one time step at a time</span></div><div class="crayon-line" id="crayon-5c08128ae931e126985880-57"><span class="crayon-h">	</span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">_</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-e">len</span><span class="crayon-sy">(</span><span class="crayon-v">data</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c08128ae931e126985880-58"><span class="crayon-h">		</span><span class="crayon-p"># define the end of the input sequence</span></div><div class="crayon-line" id="crayon-5c08128ae931e126985880-59"><span class="crayon-h">		</span><span class="crayon-v">in_end</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">in_start</span><span class="crayon-h"> </span><span class="crayon-o">+</span><span class="crayon-h"> </span><span class="crayon-e">n_input</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c08128ae931e126985880-60"><span class="crayon-e">		</span><span class="crayon-v">out_end</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">in_end</span><span class="crayon-h"> </span><span class="crayon-o">+</span><span class="crayon-h"> </span><span class="crayon-v">n_out</span></div><div class="crayon-line" id="crayon-5c08128ae931e126985880-61"><span class="crayon-h">		</span><span class="crayon-p"># ensure we have enough data for this instance</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c08128ae931e126985880-62"><span class="crayon-h">		</span><span class="crayon-st">if</span><span class="crayon-h"> </span><span class="crayon-v">out_end</span><span class="crayon-h"> </span><span class="crayon-o">&lt;</span><span class="crayon-h"> </span><span class="crayon-e">len</span><span class="crayon-sy">(</span><span class="crayon-v">data</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5c08128ae931e126985880-63"><span class="crayon-h">			</span><span class="crayon-v">x_input</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">data</span><span class="crayon-sy">[</span><span class="crayon-v">in_start</span><span class="crayon-o">:</span><span class="crayon-v">in_end</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">0</span><span class="crayon-sy">]</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c08128ae931e126985880-64"><span class="crayon-h">			</span><span class="crayon-v">x_input</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">x_input</span><span class="crayon-sy">.</span><span class="crayon-e">reshape</span><span class="crayon-sy">(</span><span class="crayon-sy">(</span><span class="crayon-e">len</span><span class="crayon-sy">(</span><span class="crayon-v">x_input</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">1</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c08128ae931e126985880-65"><span class="crayon-h">			</span><span class="crayon-v">X</span><span class="crayon-sy">.</span><span class="crayon-e">append</span><span class="crayon-sy">(</span><span class="crayon-v">x_input</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c08128ae931e126985880-66"><span class="crayon-h">			</span><span class="crayon-v">y</span><span class="crayon-sy">.</span><span class="crayon-e">append</span><span class="crayon-sy">(</span><span class="crayon-v">data</span><span class="crayon-sy">[</span><span class="crayon-v">in_end</span><span class="crayon-o">:</span><span class="crayon-v">out_end</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">0</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c08128ae931e126985880-67"><span class="crayon-h">		</span><span class="crayon-p"># move along one time step</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c08128ae931e126985880-68"><span class="crayon-h">		</span><span class="crayon-v">in_start</span><span class="crayon-h"> </span><span class="crayon-o">+=</span><span class="crayon-h"> </span><span class="crayon-cn">1</span></div><div class="crayon-line" id="crayon-5c08128ae931e126985880-69"><span class="crayon-h">	</span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-t">array</span><span class="crayon-sy">(</span><span class="crayon-v">X</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-t">array</span><span class="crayon-sy">(</span><span class="crayon-v">y</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c08128ae931e126985880-70">&nbsp;</div><div class="crayon-line" id="crayon-5c08128ae931e126985880-71"><span class="crayon-p"># train the model</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c08128ae931e126985880-72"><span class="crayon-e">def </span><span class="crayon-e">build_model</span><span class="crayon-sy">(</span><span class="crayon-v">train</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_input</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5c08128ae931e126985880-73"><span class="crayon-h">	</span><span class="crayon-p"># prepare data</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c08128ae931e126985880-74"><span class="crayon-h">	</span><span class="crayon-v">train_x</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">train_y</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">to_supervised</span><span class="crayon-sy">(</span><span class="crayon-v">train</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_input</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c08128ae931e126985880-75"><span class="crayon-h">	</span><span class="crayon-p"># define parameters</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c08128ae931e126985880-76"><span class="crayon-h">	</span><span class="crayon-v">verbose</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">epochs</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">batch_size</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-cn">0</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">20</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">16</span></div><div class="crayon-line" id="crayon-5c08128ae931e126985880-77"><span class="crayon-h">	</span><span class="crayon-v">n_timesteps</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_features</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_outputs</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">train_x</span><span class="crayon-sy">.</span><span class="crayon-v">shape</span><span class="crayon-sy">[</span><span class="crayon-cn">1</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">train_x</span><span class="crayon-sy">.</span><span class="crayon-v">shape</span><span class="crayon-sy">[</span><span class="crayon-cn">2</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">train_y</span><span class="crayon-sy">.</span><span class="crayon-v">shape</span><span class="crayon-sy">[</span><span class="crayon-cn">1</span><span class="crayon-sy">]</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c08128ae931e126985880-78"><span class="crayon-h">	</span><span class="crayon-p"># reshape output into [samples, timesteps, features]</span></div><div class="crayon-line" id="crayon-5c08128ae931e126985880-79"><span class="crayon-h">	</span><span class="crayon-v">train_y</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">train_y</span><span class="crayon-sy">.</span><span class="crayon-e">reshape</span><span class="crayon-sy">(</span><span class="crayon-sy">(</span><span class="crayon-v">train_y</span><span class="crayon-sy">.</span><span class="crayon-v">shape</span><span class="crayon-sy">[</span><span class="crayon-cn">0</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">train_y</span><span class="crayon-sy">.</span><span class="crayon-v">shape</span><span class="crayon-sy">[</span><span class="crayon-cn">1</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">1</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c08128ae931e126985880-80"><span class="crayon-h">	</span><span class="crayon-p"># define model</span></div><div class="crayon-line" id="crayon-5c08128ae931e126985880-81"><span class="crayon-h">	</span><span class="crayon-v">model</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">Sequential</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c08128ae931e126985880-82"><span class="crayon-h">	</span><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">add</span><span class="crayon-sy">(</span><span class="crayon-e">Conv1D</span><span class="crayon-sy">(</span><span class="crayon-v">filters</span><span class="crayon-o">=</span><span class="crayon-cn">64</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">kernel_size</span><span class="crayon-o">=</span><span class="crayon-cn">3</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">activation</span><span class="crayon-o">=</span><span class="crayon-s">'relu'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">input_shape</span><span class="crayon-o">=</span><span class="crayon-sy">(</span><span class="crayon-v">n_timesteps</span><span class="crayon-sy">,</span><span class="crayon-v">n_features</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c08128ae931e126985880-83"><span class="crayon-h">	</span><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">add</span><span class="crayon-sy">(</span><span class="crayon-e">Conv1D</span><span class="crayon-sy">(</span><span class="crayon-v">filters</span><span class="crayon-o">=</span><span class="crayon-cn">64</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">kernel_size</span><span class="crayon-o">=</span><span class="crayon-cn">3</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">activation</span><span class="crayon-o">=</span><span class="crayon-s">'relu'</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c08128ae931e126985880-84"><span class="crayon-h">	</span><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">add</span><span class="crayon-sy">(</span><span class="crayon-e">MaxPooling1D</span><span class="crayon-sy">(</span><span class="crayon-v">pool_size</span><span class="crayon-o">=</span><span class="crayon-cn">2</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c08128ae931e126985880-85"><span class="crayon-h">	</span><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">add</span><span class="crayon-sy">(</span><span class="crayon-e">Flatten</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c08128ae931e126985880-86"><span class="crayon-h">	</span><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">add</span><span class="crayon-sy">(</span><span class="crayon-e">RepeatVector</span><span class="crayon-sy">(</span><span class="crayon-v">n_outputs</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c08128ae931e126985880-87"><span class="crayon-h">	</span><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">add</span><span class="crayon-sy">(</span><span class="crayon-e">LSTM</span><span class="crayon-sy">(</span><span class="crayon-cn">200</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">activation</span><span class="crayon-o">=</span><span class="crayon-s">'relu'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">return_sequences</span><span class="crayon-o">=</span><span class="crayon-t">True</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c08128ae931e126985880-88"><span class="crayon-h">	</span><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">add</span><span class="crayon-sy">(</span><span class="crayon-e">TimeDistributed</span><span class="crayon-sy">(</span><span class="crayon-e">Dense</span><span class="crayon-sy">(</span><span class="crayon-cn">100</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">activation</span><span class="crayon-o">=</span><span class="crayon-s">'relu'</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c08128ae931e126985880-89"><span class="crayon-h">	</span><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">add</span><span class="crayon-sy">(</span><span class="crayon-e">TimeDistributed</span><span class="crayon-sy">(</span><span class="crayon-e">Dense</span><span class="crayon-sy">(</span><span class="crayon-cn">1</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c08128ae931e126985880-90"><span class="crayon-h">	</span><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">compile</span><span class="crayon-sy">(</span><span class="crayon-v">loss</span><span class="crayon-o">=</span><span class="crayon-s">'mse'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">optimizer</span><span class="crayon-o">=</span><span class="crayon-s">'adam'</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c08128ae931e126985880-91"><span class="crayon-h">	</span><span class="crayon-p"># fit network</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c08128ae931e126985880-92"><span class="crayon-h">	</span><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">fit</span><span class="crayon-sy">(</span><span class="crayon-v">train_x</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">train_y</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">epochs</span><span class="crayon-o">=</span><span class="crayon-v">epochs</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">batch_size</span><span class="crayon-o">=</span><span class="crayon-v">batch_size</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">verbose</span><span class="crayon-o">=</span><span class="crayon-v">verbose</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c08128ae931e126985880-93"><span class="crayon-h">	</span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">model</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c08128ae931e126985880-94">&nbsp;</div><div class="crayon-line" id="crayon-5c08128ae931e126985880-95"><span class="crayon-p"># make a forecast</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c08128ae931e126985880-96"><span class="crayon-e">def </span><span class="crayon-e">forecast</span><span class="crayon-sy">(</span><span class="crayon-v">model</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">history</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_input</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5c08128ae931e126985880-97"><span class="crayon-h">	</span><span class="crayon-p"># flatten data</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c08128ae931e126985880-98"><span class="crayon-h">	</span><span class="crayon-v">data</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-t">array</span><span class="crayon-sy">(</span><span class="crayon-v">history</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c08128ae931e126985880-99"><span class="crayon-h">	</span><span class="crayon-v">data</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">data</span><span class="crayon-sy">.</span><span class="crayon-e">reshape</span><span class="crayon-sy">(</span><span class="crayon-sy">(</span><span class="crayon-v">data</span><span class="crayon-sy">.</span><span class="crayon-v">shape</span><span class="crayon-sy">[</span><span class="crayon-cn">0</span><span class="crayon-sy">]</span><span class="crayon-o">*</span><span class="crayon-v">data</span><span class="crayon-sy">.</span><span class="crayon-v">shape</span><span class="crayon-sy">[</span><span class="crayon-cn">1</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">data</span><span class="crayon-sy">.</span><span class="crayon-v">shape</span><span class="crayon-sy">[</span><span class="crayon-cn">2</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c08128ae931e126985880-100"><span class="crayon-h">	</span><span class="crayon-p"># retrieve last observations for input data</span></div><div class="crayon-line" id="crayon-5c08128ae931e126985880-101"><span class="crayon-h">	</span><span class="crayon-v">input_x</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">data</span><span class="crayon-sy">[</span><span class="crayon-o">-</span><span class="crayon-v">n_input</span><span class="crayon-o">:</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">0</span><span class="crayon-sy">]</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c08128ae931e126985880-102"><span class="crayon-h">	</span><span class="crayon-p"># reshape into [1, n_input, 1]</span></div><div class="crayon-line" id="crayon-5c08128ae931e126985880-103"><span class="crayon-h">	</span><span class="crayon-v">input_x</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">input_x</span><span class="crayon-sy">.</span><span class="crayon-e">reshape</span><span class="crayon-sy">(</span><span class="crayon-sy">(</span><span class="crayon-cn">1</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-e">len</span><span class="crayon-sy">(</span><span class="crayon-v">input_x</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">1</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c08128ae931e126985880-104"><span class="crayon-h">	</span><span class="crayon-p"># forecast the next week</span></div><div class="crayon-line" id="crayon-5c08128ae931e126985880-105"><span class="crayon-h">	</span><span class="crayon-v">yhat</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">predict</span><span class="crayon-sy">(</span><span class="crayon-v">input_x</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">verbose</span><span class="crayon-o">=</span><span class="crayon-cn">0</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c08128ae931e126985880-106"><span class="crayon-h">	</span><span class="crayon-p"># we only want the vector forecast</span></div><div class="crayon-line" id="crayon-5c08128ae931e126985880-107"><span class="crayon-h">	</span><span class="crayon-v">yhat</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">yhat</span><span class="crayon-sy">[</span><span class="crayon-cn">0</span><span class="crayon-sy">]</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c08128ae931e126985880-108"><span class="crayon-h">	</span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">yhat</span></div><div class="crayon-line" id="crayon-5c08128ae931e126985880-109">&nbsp;</div><div class="crayon-line crayon-striped-line" id="crayon-5c08128ae931e126985880-110"><span class="crayon-p"># evaluate a single model</span></div><div class="crayon-line" id="crayon-5c08128ae931e126985880-111"><span class="crayon-e">def </span><span class="crayon-e">evaluate_model</span><span class="crayon-sy">(</span><span class="crayon-v">train</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">test</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_input</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c08128ae931e126985880-112"><span class="crayon-h">	</span><span class="crayon-p"># fit model</span></div><div class="crayon-line" id="crayon-5c08128ae931e126985880-113"><span class="crayon-h">	</span><span class="crayon-v">model</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">build_model</span><span class="crayon-sy">(</span><span class="crayon-v">train</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_input</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c08128ae931e126985880-114"><span class="crayon-h">	</span><span class="crayon-p"># history is a list of weekly data</span></div><div class="crayon-line" id="crayon-5c08128ae931e126985880-115"><span class="crayon-h">	</span><span class="crayon-v">history</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-i">x</span><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">x</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-v">train</span><span class="crayon-sy">]</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c08128ae931e126985880-116"><span class="crayon-h">	</span><span class="crayon-p"># walk-forward validation over each week</span></div><div class="crayon-line" id="crayon-5c08128ae931e126985880-117"><span class="crayon-h">	</span><span class="crayon-v">predictions</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">list</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c08128ae931e126985880-118"><span class="crayon-h">	</span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">i</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-e">len</span><span class="crayon-sy">(</span><span class="crayon-v">test</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5c08128ae931e126985880-119"><span class="crayon-h">		</span><span class="crayon-p"># predict the week</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c08128ae931e126985880-120"><span class="crayon-h">		</span><span class="crayon-v">yhat_sequence</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">forecast</span><span class="crayon-sy">(</span><span class="crayon-v">model</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">history</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_input</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c08128ae931e126985880-121"><span class="crayon-h">		</span><span class="crayon-p"># store the predictions</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c08128ae931e126985880-122"><span class="crayon-h">		</span><span class="crayon-v">predictions</span><span class="crayon-sy">.</span><span class="crayon-e">append</span><span class="crayon-sy">(</span><span class="crayon-v">yhat_sequence</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c08128ae931e126985880-123"><span class="crayon-h">		</span><span class="crayon-p"># get real observation and add to history for predicting the next week</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c08128ae931e126985880-124"><span class="crayon-h">		</span><span class="crayon-v">history</span><span class="crayon-sy">.</span><span class="crayon-e">append</span><span class="crayon-sy">(</span><span class="crayon-v">test</span><span class="crayon-sy">[</span><span class="crayon-v">i</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-o">:</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c08128ae931e126985880-125"><span class="crayon-h">	</span><span class="crayon-p"># evaluate predictions days for each week</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c08128ae931e126985880-126"><span class="crayon-h">	</span><span class="crayon-v">predictions</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-t">array</span><span class="crayon-sy">(</span><span class="crayon-v">predictions</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c08128ae931e126985880-127"><span class="crayon-h">	</span><span class="crayon-v">score</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">scores</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">evaluate_forecasts</span><span class="crayon-sy">(</span><span class="crayon-v">test</span><span class="crayon-sy">[</span><span class="crayon-o">:</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-o">:</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">0</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">predictions</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c08128ae931e126985880-128"><span class="crayon-h">	</span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">score</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">scores</span></div><div class="crayon-line" id="crayon-5c08128ae931e126985880-129">&nbsp;</div><div class="crayon-line crayon-striped-line" id="crayon-5c08128ae931e126985880-130"><span class="crayon-p"># load the new file</span></div><div class="crayon-line" id="crayon-5c08128ae931e126985880-131"><span class="crayon-v">dataset</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">read_csv</span><span class="crayon-sy">(</span><span class="crayon-s">'household_power_consumption_days.csv'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">header</span><span class="crayon-o">=</span><span class="crayon-cn">0</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">infer_datetime_format</span><span class="crayon-o">=</span><span class="crayon-t">True</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">parse_dates</span><span class="crayon-o">=</span><span class="crayon-sy">[</span><span class="crayon-s">'datetime'</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">index_col</span><span class="crayon-o">=</span><span class="crayon-sy">[</span><span class="crayon-s">'datetime'</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c08128ae931e126985880-132"><span class="crayon-p"># split into train and test</span></div><div class="crayon-line" id="crayon-5c08128ae931e126985880-133"><span class="crayon-v">train</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">test</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">split_dataset</span><span class="crayon-sy">(</span><span class="crayon-v">dataset</span><span class="crayon-sy">.</span><span class="crayon-v">values</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c08128ae931e126985880-134"><span class="crayon-p"># evaluate model and get scores</span></div><div class="crayon-line" id="crayon-5c08128ae931e126985880-135"><span class="crayon-v">n_input</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-cn">14</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c08128ae931e126985880-136"><span class="crayon-v">score</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">scores</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">evaluate_model</span><span class="crayon-sy">(</span><span class="crayon-v">train</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">test</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_input</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c08128ae931e126985880-137"><span class="crayon-p"># summarize scores</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c08128ae931e126985880-138"><span class="crayon-e">summarize_scores</span><span class="crayon-sy">(</span><span class="crayon-s">'lstm'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">score</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">scores</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c08128ae931e126985880-139"><span class="crayon-p"># plot scores</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c08128ae931e126985880-140"><span class="crayon-v">days</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-s">'sun'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-s">'mon'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-s">'tue'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-s">'wed'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-s">'thr'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-s">'fri'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-s">'sat'</span><span class="crayon-sy">]</span></div><div class="crayon-line" id="crayon-5c08128ae931e126985880-141"><span class="crayon-v">pyplot</span><span class="crayon-sy">.</span><span class="crayon-e">plot</span><span class="crayon-sy">(</span><span class="crayon-v">days</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">scores</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">marker</span><span class="crayon-o">=</span><span class="crayon-s">'o'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">label</span><span class="crayon-o">=</span><span class="crayon-s">'lstm'</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c08128ae931e126985880-142"><span class="crayon-v">pyplot</span><span class="crayon-sy">.</span><span class="crayon-e">show</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div></div></td>
					</tr>
				</tbody></table>
			</div>
		</div>
<!-- [Format Time: 0.0091 seconds] -->
<p>Running the example fits the model and summarizes the performance on the test dataset.</p>
<p>A little experimentation showed that using two convolutional layers made the model more stable than using just a single layer.</p>
<p>Your specific results may vary given the stochastic nature of the 
algorithm. You may want to try running the example a few times.</p>
<p>We can see that in this case the model is skillful, achieving an overall RMSE score of about 372 kilowatts.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->

		<div id="crayon-5c08128ae9321813236963" class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" style="margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important; height: auto;">
		
			<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important; height: 18px !important; line-height: 18px !important; margin-top: -19px; display: none; z-index: 4;"><span class="crayon-title"></span>
			<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button crayon-pressed" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code" style="display: none;"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
			<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
			<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="readonly" style="-moz-tab-size: 4; font-size: 12px !important; line-height: 15px !important; z-index: 0; opacity: 0; overflow: hidden;" wrap="soft">lstm: [372.055] 383.8, 381.6, 339.1, 371.8, 371.8, 319.6, 427.2</textarea></div>
			<div class="crayon-main" style="position: relative; z-index: 1; overflow: hidden;">
				<table class="crayon-table" style="">
					<tbody><tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5c08128ae9321813236963-1">1</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5c08128ae9321813236963-1">lstm: [372.055] 383.8, 381.6, 339.1, 371.8, 371.8, 319.6, 427.2</div></div></td>
					</tr>
				</tbody></table>
			</div>
		</div>
<!-- [Format Time: 0.0000 seconds] -->
<p>A line plot of the per-day RMSE is also created.</p>
<div id="attachment_6291" style="width: 1290px" class="wp-caption aligncenter"><img class="size-full wp-image-6291" src="How%20to%20Develop%20LSTM%20Models%20for%20Multi-Step%20Time%20Series%20Forecasting%20of%20Household%20Power%20Consumption_fichiers/Line-Plot-of-RMSE-per-Day-for-Univariate-Encoder-Decoder-CNN.png" alt="Line Plot of RMSE per Day for Univariate Encoder-Decoder CNN LSTM with 14-day Inputs" srcset="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2018/07/Line-Plot-of-RMSE-per-Day-for-Univariate-Encoder-Decoder-CNN-LSTM-with-14-day-Inputs.png 1280w, https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2018/07/Line-Plot-of-RMSE-per-Day-for-Univariate-Encoder-Decoder-CNN-LSTM-with-14-day-Inputs-300x225.png 300w, https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2018/07/Line-Plot-of-RMSE-per-Day-for-Univariate-Encoder-Decoder-CNN-LSTM-with-14-day-Inputs-768x576.png 768w, https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2018/07/Line-Plot-of-RMSE-per-Day-for-Univariate-Encoder-Decoder-CNN-LSTM-with-14-day-Inputs-1024x768.png 1024w" sizes="(max-width: 1280px) 100vw, 1280px" width="1280" height="960"><p class="wp-caption-text">Line Plot of RMSE per Day for Univariate Encoder-Decoder CNN LSTM with 14-day Inputs</p></div>
<h2>ConvLSTM Encoder-Decoder Model With Univariate Input</h2>
<p>A further extension of the CNN-LSTM approach is to perform the 
convolutions of the CNN (e.g. how the CNN reads the input sequence data)
 as part of the LSTM for each time step.</p>
<p>This combination is called a Convolutional LSTM, or ConvLSTM for 
short, and like the CNN-LSTM is also used for spatio-temporal data.</p>
<p>Unlike an LSTM that reads the data in directly in order to calculate 
internal state and state transitions, and unlike the CNN-LSTM that is 
interpreting the output from CNN models, the ConvLSTM is using 
convolutions directly as part of reading input into the LSTM units 
themselves.</p>
<p>For more information for how the equations for the ConvLSTM are calculated within the LSTM unit, see the paper:</p>
<ul>
<li><a href="https://arxiv.org/abs/1506.04214v1">Convolutional LSTM Network: A Machine Learning Approach for Precipitation Nowcasting</a>, 2015.</li>
</ul>
<p>The Keras library provides the <a href="https://keras.io/layers/recurrent/#convlstm2d">ConvLSTM2D class</a> that supports the ConvLSTM model for 2D data. It can be configured for 1D multivariate time series forecasting.</p>
<p>The ConvLSTM2D class, by default, expects input data to have the shape:</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->

		<div id="crayon-5c08128ae9323157901669" class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" style="margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important; height: auto;">
		
			<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important; height: 18px !important; line-height: 18px !important; margin-top: -19px; display: none; z-index: 4;"><span class="crayon-title"></span>
			<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button crayon-pressed" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code" style="display: none;"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
			<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
			<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="readonly" style="-moz-tab-size: 4; font-size: 12px !important; line-height: 15px !important; z-index: 0; opacity: 0; overflow: hidden;" wrap="soft">[samples, timesteps, rows, cols, channels]</textarea></div>
			<div class="crayon-main" style="position: relative; z-index: 1; overflow: hidden;">
				<table class="crayon-table" style="">
					<tbody><tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5c08128ae9323157901669-1">1</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5c08128ae9323157901669-1">[samples, timesteps, rows, cols, channels]</div></div></td>
					</tr>
				</tbody></table>
			</div>
		</div>
<!-- [Format Time: 0.0000 seconds] -->
<p>Where each time step of data is defined as an image of (<em>rows * columns</em>) data points.</p>
<p>We are working with a one-dimensional sequence of total power 
consumption, which we can interpret as one row with 14 columns, if we 
assume that we are using two weeks of data as input.</p>
<p>For the ConvLSTM, this would be a single read: that is, the LSTM 
would read one time step of 14 days and perform a convolution across 
those time steps.</p>
<p>This is not ideal.</p>
<p>Instead, we can split the 14 days into two subsequences with a length
 of seven days. The ConvLSTM can then read across the two time steps and
 perform the CNN process on the seven days of data within each.</p>
<p>For this chosen framing of the problem, the input for the ConvLSTM2D would therefore be:</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->

		<div id="crayon-5c08128ae9325456166131" class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" style="margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important; height: auto;">
		
			<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important; height: 18px !important; line-height: 18px !important; margin-top: -19px; display: none; z-index: 4;"><span class="crayon-title"></span>
			<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button crayon-pressed" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code" style="display: none;"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
			<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
			<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="readonly" style="-moz-tab-size: 4; font-size: 12px !important; line-height: 15px !important; z-index: 0; opacity: 0; overflow: hidden;" wrap="soft">[n, 2, 1, 7, 1]</textarea></div>
			<div class="crayon-main" style="position: relative; z-index: 1; overflow: hidden;">
				<table class="crayon-table" style="">
					<tbody><tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5c08128ae9325456166131-1">1</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5c08128ae9325456166131-1">[n, 2, 1, 7, 1]</div></div></td>
					</tr>
				</tbody></table>
			</div>
		</div>
<!-- [Format Time: 0.0000 seconds] -->
<p>Or:</p>
<ul>
<li><strong>Samples</strong>: n, for the number of examples in the training dataset.</li>
<li><strong>Time</strong>: 2, for the two subsequences that we split a window of 14 days into.</li>
<li><strong>Rows</strong>: 1, for the one-dimensional shape of each subsequence.</li>
<li><strong>Columns</strong>: 7, for the seven days in each subsequence.</li>
<li><strong>Channels</strong>: 1, for the single feature that we are working with as input.</li>
</ul>
<p>You can explore other configurations, such as providing 21 days of 
input split into three subsequences of seven days, and/or providing all 
eight features or channels as input.</p>
<p>We can now prepare the data for the ConvLSTM2D model.</p>
<p>First, we must reshape the training dataset into the expected structure of [<em>samples, timesteps, rows, cols, channels</em>].</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->

		<div id="crayon-5c08128ae9327088835639" class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" style="margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important; height: auto;">
		
			<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important; height: 18px !important; line-height: 18px !important; margin-top: -19px; display: none; z-index: 4;"><span class="crayon-title"></span>
			<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button crayon-pressed" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code" style="display: none;"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
			<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
			<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="readonly" style="-moz-tab-size: 4; font-size: 12px !important; line-height: 15px !important; z-index: 0; opacity: 0; overflow: hidden;" wrap="soft"># reshape into subsequences [samples, time steps, rows, cols, channels]
train_x = train_x.reshape((train_x.shape[0], n_steps, 1, n_length, n_features))</textarea></div>
			<div class="crayon-main" style="position: relative; z-index: 1; overflow: hidden;">
				<table class="crayon-table" style="">
					<tbody><tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5c08128ae9327088835639-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c08128ae9327088835639-2">2</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5c08128ae9327088835639-1"><span class="crayon-p"># reshape into subsequences [samples, time steps, rows, cols, channels]</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c08128ae9327088835639-2"><span class="crayon-v">train_x</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">train_x</span><span class="crayon-sy">.</span><span class="crayon-e">reshape</span><span class="crayon-sy">(</span><span class="crayon-sy">(</span><span class="crayon-v">train_x</span><span class="crayon-sy">.</span><span class="crayon-v">shape</span><span class="crayon-sy">[</span><span class="crayon-cn">0</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_steps</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">1</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_length</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_features</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div></div></td>
					</tr>
				</tbody></table>
			</div>
		</div>
<!-- [Format Time: 0.0003 seconds] -->
<p>We can then define the encoder as a ConvLSTM hidden layer followed by a flatten layer ready for decoding.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->

		<div id="crayon-5c08128ae9329368006511" class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" style="margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important; height: auto;">
		
			<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important; height: 18px !important; line-height: 18px !important; margin-top: -19px; display: none; z-index: 4;"><span class="crayon-title"></span>
			<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button crayon-pressed" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
			<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
			<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="readonly" style="-moz-tab-size: 4; font-size: 12px !important; line-height: 15px !important; z-index: 0; opacity: 0; overflow: hidden;" wrap="soft">model.add(ConvLSTM2D(filters=64, kernel_size=(1,3), activation='relu', input_shape=(n_steps, 1, n_length, n_features)))
model.add(Flatten())</textarea></div>
			<div class="crayon-main" style="position: relative; z-index: 1; overflow: hidden;">
				<table class="crayon-table" style="">
					<tbody><tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5c08128ae9329368006511-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c08128ae9329368006511-2">2</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5c08128ae9329368006511-1"><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">add</span><span class="crayon-sy">(</span><span class="crayon-e">ConvLSTM2D</span><span class="crayon-sy">(</span><span class="crayon-v">filters</span><span class="crayon-o">=</span><span class="crayon-cn">64</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">kernel_size</span><span class="crayon-o">=</span><span class="crayon-sy">(</span><span class="crayon-cn">1</span><span class="crayon-sy">,</span><span class="crayon-cn">3</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">activation</span><span class="crayon-o">=</span><span class="crayon-s">'relu'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">input_shape</span><span class="crayon-o">=</span><span class="crayon-sy">(</span><span class="crayon-v">n_steps</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">1</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_length</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_features</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c08128ae9329368006511-2"><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">add</span><span class="crayon-sy">(</span><span class="crayon-e">Flatten</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div></div></td>
					</tr>
				</tbody></table>
			</div>
		</div>
<!-- [Format Time: 0.0004 seconds] -->
<p>We will also parameterize the number of subsequences (<em>n_steps</em>) and the length of each subsequence (<em>n_length</em>) and pass them as arguments.</p>
<p>The rest of the model and training is the same. The <em>build_model()</em> function with these changes is listed below.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->

		<div id="crayon-5c08128ae932b427619379" class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" style="margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important; height: auto;">
		
			<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important; height: 18px !important; line-height: 18px !important; margin-top: -19px; display: none; position: absolute; z-index: 2;"><span class="crayon-title"></span>
			<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button crayon-pressed" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
			<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
			<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="readonly" style="-moz-tab-size: 4; font-size: 12px !important; line-height: 15px !important; z-index: 0; opacity: 0; overflow: hidden;" wrap="soft"># train the model
def build_model(train, n_steps, n_length, n_input):
	# prepare data
	train_x, train_y = to_supervised(train, n_input)
	# define parameters
	verbose, epochs, batch_size = 0, 20, 16
	n_timesteps, n_features, n_outputs = train_x.shape[1], train_x.shape[2], train_y.shape[1]
	# reshape into subsequences [samples, time steps, rows, cols, channels]
	train_x = train_x.reshape((train_x.shape[0], n_steps, 1, n_length, n_features))
	# reshape output into [samples, timesteps, features]
	train_y = train_y.reshape((train_y.shape[0], train_y.shape[1], 1))
	# define model
	model = Sequential()
	model.add(ConvLSTM2D(filters=64, kernel_size=(1,3), activation='relu', input_shape=(n_steps, 1, n_length, n_features)))
	model.add(Flatten())
	model.add(RepeatVector(n_outputs))
	model.add(LSTM(200, activation='relu', return_sequences=True))
	model.add(TimeDistributed(Dense(100, activation='relu')))
	model.add(TimeDistributed(Dense(1)))
	model.compile(loss='mse', optimizer='adam')
	# fit network
	model.fit(train_x, train_y, epochs=epochs, batch_size=batch_size, verbose=verbose)
	return model</textarea></div>
			<div class="crayon-main" style="position: relative; z-index: 1; overflow: hidden;">
				<table class="crayon-table" style="">
					<tbody><tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5c08128ae932b427619379-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c08128ae932b427619379-2">2</div><div class="crayon-num" data-line="crayon-5c08128ae932b427619379-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c08128ae932b427619379-4">4</div><div class="crayon-num" data-line="crayon-5c08128ae932b427619379-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c08128ae932b427619379-6">6</div><div class="crayon-num" data-line="crayon-5c08128ae932b427619379-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c08128ae932b427619379-8">8</div><div class="crayon-num" data-line="crayon-5c08128ae932b427619379-9">9</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c08128ae932b427619379-10">10</div><div class="crayon-num" data-line="crayon-5c08128ae932b427619379-11">11</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c08128ae932b427619379-12">12</div><div class="crayon-num" data-line="crayon-5c08128ae932b427619379-13">13</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c08128ae932b427619379-14">14</div><div class="crayon-num" data-line="crayon-5c08128ae932b427619379-15">15</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c08128ae932b427619379-16">16</div><div class="crayon-num" data-line="crayon-5c08128ae932b427619379-17">17</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c08128ae932b427619379-18">18</div><div class="crayon-num" data-line="crayon-5c08128ae932b427619379-19">19</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c08128ae932b427619379-20">20</div><div class="crayon-num" data-line="crayon-5c08128ae932b427619379-21">21</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c08128ae932b427619379-22">22</div><div class="crayon-num" data-line="crayon-5c08128ae932b427619379-23">23</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5c08128ae932b427619379-1"><span class="crayon-p"># train the model</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c08128ae932b427619379-2"><span class="crayon-e">def </span><span class="crayon-e">build_model</span><span class="crayon-sy">(</span><span class="crayon-v">train</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_steps</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_length</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_input</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5c08128ae932b427619379-3"><span class="crayon-h">	</span><span class="crayon-p"># prepare data</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c08128ae932b427619379-4"><span class="crayon-h">	</span><span class="crayon-v">train_x</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">train_y</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">to_supervised</span><span class="crayon-sy">(</span><span class="crayon-v">train</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_input</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c08128ae932b427619379-5"><span class="crayon-h">	</span><span class="crayon-p"># define parameters</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c08128ae932b427619379-6"><span class="crayon-h">	</span><span class="crayon-v">verbose</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">epochs</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">batch_size</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-cn">0</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">20</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">16</span></div><div class="crayon-line" id="crayon-5c08128ae932b427619379-7"><span class="crayon-h">	</span><span class="crayon-v">n_timesteps</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_features</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_outputs</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">train_x</span><span class="crayon-sy">.</span><span class="crayon-v">shape</span><span class="crayon-sy">[</span><span class="crayon-cn">1</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">train_x</span><span class="crayon-sy">.</span><span class="crayon-v">shape</span><span class="crayon-sy">[</span><span class="crayon-cn">2</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">train_y</span><span class="crayon-sy">.</span><span class="crayon-v">shape</span><span class="crayon-sy">[</span><span class="crayon-cn">1</span><span class="crayon-sy">]</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c08128ae932b427619379-8"><span class="crayon-h">	</span><span class="crayon-p"># reshape into subsequences [samples, time steps, rows, cols, channels]</span></div><div class="crayon-line" id="crayon-5c08128ae932b427619379-9"><span class="crayon-h">	</span><span class="crayon-v">train_x</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">train_x</span><span class="crayon-sy">.</span><span class="crayon-e">reshape</span><span class="crayon-sy">(</span><span class="crayon-sy">(</span><span class="crayon-v">train_x</span><span class="crayon-sy">.</span><span class="crayon-v">shape</span><span class="crayon-sy">[</span><span class="crayon-cn">0</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_steps</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">1</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_length</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_features</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c08128ae932b427619379-10"><span class="crayon-h">	</span><span class="crayon-p"># reshape output into [samples, timesteps, features]</span></div><div class="crayon-line" id="crayon-5c08128ae932b427619379-11"><span class="crayon-h">	</span><span class="crayon-v">train_y</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">train_y</span><span class="crayon-sy">.</span><span class="crayon-e">reshape</span><span class="crayon-sy">(</span><span class="crayon-sy">(</span><span class="crayon-v">train_y</span><span class="crayon-sy">.</span><span class="crayon-v">shape</span><span class="crayon-sy">[</span><span class="crayon-cn">0</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">train_y</span><span class="crayon-sy">.</span><span class="crayon-v">shape</span><span class="crayon-sy">[</span><span class="crayon-cn">1</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">1</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c08128ae932b427619379-12"><span class="crayon-h">	</span><span class="crayon-p"># define model</span></div><div class="crayon-line" id="crayon-5c08128ae932b427619379-13"><span class="crayon-h">	</span><span class="crayon-v">model</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">Sequential</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c08128ae932b427619379-14"><span class="crayon-h">	</span><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">add</span><span class="crayon-sy">(</span><span class="crayon-e">ConvLSTM2D</span><span class="crayon-sy">(</span><span class="crayon-v">filters</span><span class="crayon-o">=</span><span class="crayon-cn">64</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">kernel_size</span><span class="crayon-o">=</span><span class="crayon-sy">(</span><span class="crayon-cn">1</span><span class="crayon-sy">,</span><span class="crayon-cn">3</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">activation</span><span class="crayon-o">=</span><span class="crayon-s">'relu'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">input_shape</span><span class="crayon-o">=</span><span class="crayon-sy">(</span><span class="crayon-v">n_steps</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">1</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_length</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_features</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c08128ae932b427619379-15"><span class="crayon-h">	</span><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">add</span><span class="crayon-sy">(</span><span class="crayon-e">Flatten</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c08128ae932b427619379-16"><span class="crayon-h">	</span><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">add</span><span class="crayon-sy">(</span><span class="crayon-e">RepeatVector</span><span class="crayon-sy">(</span><span class="crayon-v">n_outputs</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c08128ae932b427619379-17"><span class="crayon-h">	</span><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">add</span><span class="crayon-sy">(</span><span class="crayon-e">LSTM</span><span class="crayon-sy">(</span><span class="crayon-cn">200</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">activation</span><span class="crayon-o">=</span><span class="crayon-s">'relu'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">return_sequences</span><span class="crayon-o">=</span><span class="crayon-t">True</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c08128ae932b427619379-18"><span class="crayon-h">	</span><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">add</span><span class="crayon-sy">(</span><span class="crayon-e">TimeDistributed</span><span class="crayon-sy">(</span><span class="crayon-e">Dense</span><span class="crayon-sy">(</span><span class="crayon-cn">100</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">activation</span><span class="crayon-o">=</span><span class="crayon-s">'relu'</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c08128ae932b427619379-19"><span class="crayon-h">	</span><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">add</span><span class="crayon-sy">(</span><span class="crayon-e">TimeDistributed</span><span class="crayon-sy">(</span><span class="crayon-e">Dense</span><span class="crayon-sy">(</span><span class="crayon-cn">1</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c08128ae932b427619379-20"><span class="crayon-h">	</span><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">compile</span><span class="crayon-sy">(</span><span class="crayon-v">loss</span><span class="crayon-o">=</span><span class="crayon-s">'mse'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">optimizer</span><span class="crayon-o">=</span><span class="crayon-s">'adam'</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c08128ae932b427619379-21"><span class="crayon-h">	</span><span class="crayon-p"># fit network</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c08128ae932b427619379-22"><span class="crayon-h">	</span><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">fit</span><span class="crayon-sy">(</span><span class="crayon-v">train_x</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">train_y</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">epochs</span><span class="crayon-o">=</span><span class="crayon-v">epochs</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">batch_size</span><span class="crayon-o">=</span><span class="crayon-v">batch_size</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">verbose</span><span class="crayon-o">=</span><span class="crayon-v">verbose</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c08128ae932b427619379-23"><span class="crayon-h">	</span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">model</span></div></div></td>
					</tr>
				</tbody></table>
			</div>
		</div>
<!-- [Format Time: 0.0020 seconds] -->
<p>This model expects five-dimensional data as input. Therefore, we must also update the preparation of a single sample in the <em>forecast()</em> function when making a prediction.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->

		<div id="crayon-5c08128ae932d427948574" class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" style="margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important; height: auto;">
		
			<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important; height: 18px !important; line-height: 18px !important; margin-top: -19px; display: none; z-index: 4;"><span class="crayon-title"></span>
			<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button crayon-pressed" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code" style="display: none;"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
			<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
			<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="readonly" style="-moz-tab-size: 4; font-size: 12px !important; line-height: 15px !important; z-index: 0; opacity: 0; overflow: hidden;" wrap="soft"># reshape into [samples, time steps, rows, cols, channels]
input_x = input_x.reshape((1, n_steps, 1, n_length, 1))</textarea></div>
			<div class="crayon-main" style="position: relative; z-index: 1; overflow: hidden;">
				<table class="crayon-table" style="">
					<tbody><tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5c08128ae932d427948574-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c08128ae932d427948574-2">2</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5c08128ae932d427948574-1"><span class="crayon-p"># reshape into [samples, time steps, rows, cols, channels]</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c08128ae932d427948574-2"><span class="crayon-v">input_x</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">input_x</span><span class="crayon-sy">.</span><span class="crayon-e">reshape</span><span class="crayon-sy">(</span><span class="crayon-sy">(</span><span class="crayon-cn">1</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_steps</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">1</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_length</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">1</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div></div></td>
					</tr>
				</tbody></table>
			</div>
		</div>
<!-- [Format Time: 0.0002 seconds] -->
<p>The <em>forecast()</em> function with this change and with the parameterized subsequences is provided below.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->

		<div id="crayon-5c08128ae932f064709116" class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" style="margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important; height: auto;">
		
			<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important; height: 18px !important; line-height: 18px !important; margin-top: -19px; display: none; position: absolute; z-index: 2;"><span class="crayon-title"></span>
			<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button crayon-pressed" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code" style="display: none;"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
			<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
			<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="readonly" style="-moz-tab-size: 4; font-size: 12px !important; line-height: 15px !important; z-index: 0; opacity: 0; overflow: hidden;" wrap="soft"># make a forecast
def forecast(model, history, n_steps, n_length, n_input):
	# flatten data
	data = array(history)
	data = data.reshape((data.shape[0]*data.shape[1], data.shape[2]))
	# retrieve last observations for input data
	input_x = data[-n_input:, 0]
	# reshape into [samples, time steps, rows, cols, channels]
	input_x = input_x.reshape((1, n_steps, 1, n_length, 1))
	# forecast the next week
	yhat = model.predict(input_x, verbose=0)
	# we only want the vector forecast
	yhat = yhat[0]
	return yhat</textarea></div>
			<div class="crayon-main" style="position: relative; z-index: 1; overflow: hidden;">
				<table class="crayon-table" style="">
					<tbody><tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5c08128ae932f064709116-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c08128ae932f064709116-2">2</div><div class="crayon-num" data-line="crayon-5c08128ae932f064709116-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c08128ae932f064709116-4">4</div><div class="crayon-num" data-line="crayon-5c08128ae932f064709116-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c08128ae932f064709116-6">6</div><div class="crayon-num" data-line="crayon-5c08128ae932f064709116-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c08128ae932f064709116-8">8</div><div class="crayon-num" data-line="crayon-5c08128ae932f064709116-9">9</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c08128ae932f064709116-10">10</div><div class="crayon-num" data-line="crayon-5c08128ae932f064709116-11">11</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c08128ae932f064709116-12">12</div><div class="crayon-num" data-line="crayon-5c08128ae932f064709116-13">13</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c08128ae932f064709116-14">14</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5c08128ae932f064709116-1"><span class="crayon-p"># make a forecast</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c08128ae932f064709116-2"><span class="crayon-e">def </span><span class="crayon-e">forecast</span><span class="crayon-sy">(</span><span class="crayon-v">model</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">history</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_steps</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_length</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_input</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5c08128ae932f064709116-3"><span class="crayon-h">	</span><span class="crayon-p"># flatten data</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c08128ae932f064709116-4"><span class="crayon-h">	</span><span class="crayon-v">data</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-t">array</span><span class="crayon-sy">(</span><span class="crayon-v">history</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c08128ae932f064709116-5"><span class="crayon-h">	</span><span class="crayon-v">data</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">data</span><span class="crayon-sy">.</span><span class="crayon-e">reshape</span><span class="crayon-sy">(</span><span class="crayon-sy">(</span><span class="crayon-v">data</span><span class="crayon-sy">.</span><span class="crayon-v">shape</span><span class="crayon-sy">[</span><span class="crayon-cn">0</span><span class="crayon-sy">]</span><span class="crayon-o">*</span><span class="crayon-v">data</span><span class="crayon-sy">.</span><span class="crayon-v">shape</span><span class="crayon-sy">[</span><span class="crayon-cn">1</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">data</span><span class="crayon-sy">.</span><span class="crayon-v">shape</span><span class="crayon-sy">[</span><span class="crayon-cn">2</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c08128ae932f064709116-6"><span class="crayon-h">	</span><span class="crayon-p"># retrieve last observations for input data</span></div><div class="crayon-line" id="crayon-5c08128ae932f064709116-7"><span class="crayon-h">	</span><span class="crayon-v">input_x</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">data</span><span class="crayon-sy">[</span><span class="crayon-o">-</span><span class="crayon-v">n_input</span><span class="crayon-o">:</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">0</span><span class="crayon-sy">]</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c08128ae932f064709116-8"><span class="crayon-h">	</span><span class="crayon-p"># reshape into [samples, time steps, rows, cols, channels]</span></div><div class="crayon-line" id="crayon-5c08128ae932f064709116-9"><span class="crayon-h">	</span><span class="crayon-v">input_x</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">input_x</span><span class="crayon-sy">.</span><span class="crayon-e">reshape</span><span class="crayon-sy">(</span><span class="crayon-sy">(</span><span class="crayon-cn">1</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_steps</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">1</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_length</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">1</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c08128ae932f064709116-10"><span class="crayon-h">	</span><span class="crayon-p"># forecast the next week</span></div><div class="crayon-line" id="crayon-5c08128ae932f064709116-11"><span class="crayon-h">	</span><span class="crayon-v">yhat</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">predict</span><span class="crayon-sy">(</span><span class="crayon-v">input_x</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">verbose</span><span class="crayon-o">=</span><span class="crayon-cn">0</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c08128ae932f064709116-12"><span class="crayon-h">	</span><span class="crayon-p"># we only want the vector forecast</span></div><div class="crayon-line" id="crayon-5c08128ae932f064709116-13"><span class="crayon-h">	</span><span class="crayon-v">yhat</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">yhat</span><span class="crayon-sy">[</span><span class="crayon-cn">0</span><span class="crayon-sy">]</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c08128ae932f064709116-14"><span class="crayon-h">	</span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">yhat</span></div></div></td>
					</tr>
				</tbody></table>
			</div>
		</div>
<!-- [Format Time: 0.0011 seconds] -->
<p>We now have all of the elements for evaluating an encoder-decoder 
architecture for multi-step time series forecasting where a ConvLSTM is 
used as the encoder.</p>
<p>The complete code example is listed below.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->

		<div id="crayon-5c08128ae9330086185733" class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" style="margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important; height: auto;">
		
			<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important; height: 18px !important; line-height: 18px !important; margin-top: -19px; display: none; position: absolute; z-index: 2;"><span class="crayon-title"></span>
			<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button crayon-pressed" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
			<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
			<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="readonly" style="-moz-tab-size: 4; font-size: 12px !important; line-height: 15px !important; z-index: 0; opacity: 0; overflow: hidden;" wrap="soft">#
 univariate multi-step encoder-decoder convlstm
from math import sqrt
from numpy import split
from numpy import array
from pandas import read_csv
from sklearn.metrics import mean_squared_error
from matplotlib import pyplot
from keras.models import Sequential
from keras.layers import Dense
from keras.layers import Flatten
from keras.layers import LSTM
from keras.layers import RepeatVector
from keras.layers import TimeDistributed
from keras.layers import ConvLSTM2D

# split a univariate dataset into train/test sets
def split_dataset(data):
	# split into standard weeks
	train, test = data[1:-328], data[-328:-6]
	# restructure into windows of weekly data
	train = array(split(train, len(train)/7))
	test = array(split(test, len(test)/7))
	return train, test

# evaluate one or more weekly forecasts against expected values
def evaluate_forecasts(actual, predicted):
	scores = list()
	# calculate an RMSE score for each day
	for i in range(actual.shape[1]):
		# calculate mse
		mse = mean_squared_error(actual[:, i], predicted[:, i])
		# calculate rmse
		rmse = sqrt(mse)
		# store
		scores.append(rmse)
	# calculate overall RMSE
	s = 0
	for row in range(actual.shape[0]):
		for col in range(actual.shape[1]):
			s += (actual[row, col] - predicted[row, col])**2
	score = sqrt(s / (actual.shape[0] * actual.shape[1]))
	return score, scores

# summarize scores
def summarize_scores(name, score, scores):
	s_scores = ', '.join(['%.1f' % s for s in scores])
	print('%s: [%.3f] %s' % (name, score, s_scores))

# convert history into inputs and outputs
def to_supervised(train, n_input, n_out=7):
	# flatten data
	data = train.reshape((train.shape[0]*train.shape[1], train.shape[2]))
	X, y = list(), list()
	in_start = 0
	# step over the entire history one time step at a time
	for _ in range(len(data)):
		# define the end of the input sequence
		in_end = in_start + n_input
		out_end = in_end + n_out
		# ensure we have enough data for this instance
		if out_end &lt; len(data):
			x_input = data[in_start:in_end, 0]
			x_input = x_input.reshape((len(x_input), 1))
			X.append(x_input)
			y.append(data[in_end:out_end, 0])
		# move along one time step
		in_start += 1
	return array(X), array(y)

# train the model
def build_model(train, n_steps, n_length, n_input):
	# prepare data
	train_x, train_y = to_supervised(train, n_input)
	# define parameters
	verbose, epochs, batch_size = 0, 20, 16
	n_timesteps, n_features, n_outputs = train_x.shape[1], 
train_x.shape[2], train_y.shape[1]
	# reshape into subsequences [samples, time steps, rows, cols, channels]
	train_x = train_x.reshape((train_x.shape[0], n_steps, 1, n_length, 
n_features))
	# reshape output into [samples, timesteps, features]
	train_y = train_y.reshape((train_y.shape[0], train_y.shape[1], 1))
	# define model
	model = Sequential()
	model.add(ConvLSTM2D(filters=64, kernel_size=(1,3), activation='relu', 
input_shape=(n_steps, 1, n_length, n_features)))
	model.add(Flatten())
	model.add(RepeatVector(n_outputs))
	model.add(LSTM(200, activation='relu', return_sequences=True))
	model.add(TimeDistributed(Dense(100, activation='relu')))
	model.add(TimeDistributed(Dense(1)))
	model.compile(loss='mse', optimizer='adam')
	# fit network
	model.fit(train_x, train_y, epochs=epochs, batch_size=batch_size, 
verbose=verbose)
	return model

# make a forecast
def forecast(model, history, n_steps, n_length, n_input):
	# flatten data
	data = array(history)
	data = data.reshape((data.shape[0]*data.shape[1], data.shape[2]))
	# retrieve last observations for input data
	input_x = data[-n_input:, 0]
	# reshape into [samples, time steps, rows, cols, channels]
	input_x = input_x.reshape((1, n_steps, 1, n_length, 1))
	# forecast the next week
	yhat = model.predict(input_x, verbose=0)
	# we only want the vector forecast
	yhat = yhat[0]
	return yhat

# evaluate a single model
def evaluate_model(train, test, n_steps, n_length, n_input):
	# fit model
	model = build_model(train, n_steps, n_length, n_input)
	# history is a list of weekly data
	history = [x for x in train]
	# walk-forward validation over each week
	predictions = list()
	for i in range(len(test)):
		# predict the week
		yhat_sequence = forecast(model, history, n_steps, n_length, n_input)
		# store the predictions
		predictions.append(yhat_sequence)
		# get real observation and add to history for predicting the next week
		history.append(test[i, :])
	# evaluate predictions days for each week
	predictions = array(predictions)
	score, scores = evaluate_forecasts(test[:, :, 0], predictions)
	return score, scores

# load the new file
dataset = read_csv('household_power_consumption_days.csv', header=0, 
infer_datetime_format=True, parse_dates=['datetime'], 
index_col=['datetime'])
# split into train and test
train, test = split_dataset(dataset.values)
# define the number of subsequences and the length of subsequences
n_steps, n_length = 2, 7
# define the total days to use as input
n_input = n_length * n_steps
score, scores = evaluate_model(train, test, n_steps, n_length, n_input)
# summarize scores
summarize_scores('lstm', score, scores)
# plot scores
days = ['sun', 'mon', 'tue', 'wed', 'thr', 'fri', 'sat']
pyplot.plot(days, scores, marker='o', label='lstm')
pyplot.show()</textarea></div>
			<div class="crayon-main" style="position: relative; z-index: 1; overflow: hidden;">
				<table class="crayon-table" style="">
					<tbody><tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5c08128ae9330086185733-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c08128ae9330086185733-2">2</div><div class="crayon-num" data-line="crayon-5c08128ae9330086185733-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c08128ae9330086185733-4">4</div><div class="crayon-num" data-line="crayon-5c08128ae9330086185733-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c08128ae9330086185733-6">6</div><div class="crayon-num" data-line="crayon-5c08128ae9330086185733-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c08128ae9330086185733-8">8</div><div class="crayon-num" data-line="crayon-5c08128ae9330086185733-9">9</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c08128ae9330086185733-10">10</div><div class="crayon-num" data-line="crayon-5c08128ae9330086185733-11">11</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c08128ae9330086185733-12">12</div><div class="crayon-num" data-line="crayon-5c08128ae9330086185733-13">13</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c08128ae9330086185733-14">14</div><div class="crayon-num" data-line="crayon-5c08128ae9330086185733-15">15</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c08128ae9330086185733-16">16</div><div class="crayon-num" data-line="crayon-5c08128ae9330086185733-17">17</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c08128ae9330086185733-18">18</div><div class="crayon-num" data-line="crayon-5c08128ae9330086185733-19">19</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c08128ae9330086185733-20">20</div><div class="crayon-num" data-line="crayon-5c08128ae9330086185733-21">21</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c08128ae9330086185733-22">22</div><div class="crayon-num" data-line="crayon-5c08128ae9330086185733-23">23</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c08128ae9330086185733-24">24</div><div class="crayon-num" data-line="crayon-5c08128ae9330086185733-25">25</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c08128ae9330086185733-26">26</div><div class="crayon-num" data-line="crayon-5c08128ae9330086185733-27">27</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c08128ae9330086185733-28">28</div><div class="crayon-num" data-line="crayon-5c08128ae9330086185733-29">29</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c08128ae9330086185733-30">30</div><div class="crayon-num" data-line="crayon-5c08128ae9330086185733-31">31</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c08128ae9330086185733-32">32</div><div class="crayon-num" data-line="crayon-5c08128ae9330086185733-33">33</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c08128ae9330086185733-34">34</div><div class="crayon-num" data-line="crayon-5c08128ae9330086185733-35">35</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c08128ae9330086185733-36">36</div><div class="crayon-num" data-line="crayon-5c08128ae9330086185733-37">37</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c08128ae9330086185733-38">38</div><div class="crayon-num" data-line="crayon-5c08128ae9330086185733-39">39</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c08128ae9330086185733-40">40</div><div class="crayon-num" data-line="crayon-5c08128ae9330086185733-41">41</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c08128ae9330086185733-42">42</div><div class="crayon-num" data-line="crayon-5c08128ae9330086185733-43">43</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c08128ae9330086185733-44">44</div><div class="crayon-num" data-line="crayon-5c08128ae9330086185733-45">45</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c08128ae9330086185733-46">46</div><div class="crayon-num" data-line="crayon-5c08128ae9330086185733-47">47</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c08128ae9330086185733-48">48</div><div class="crayon-num" data-line="crayon-5c08128ae9330086185733-49">49</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c08128ae9330086185733-50">50</div><div class="crayon-num" data-line="crayon-5c08128ae9330086185733-51">51</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c08128ae9330086185733-52">52</div><div class="crayon-num" data-line="crayon-5c08128ae9330086185733-53">53</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c08128ae9330086185733-54">54</div><div class="crayon-num" data-line="crayon-5c08128ae9330086185733-55">55</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c08128ae9330086185733-56">56</div><div class="crayon-num" data-line="crayon-5c08128ae9330086185733-57">57</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c08128ae9330086185733-58">58</div><div class="crayon-num" data-line="crayon-5c08128ae9330086185733-59">59</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c08128ae9330086185733-60">60</div><div class="crayon-num" data-line="crayon-5c08128ae9330086185733-61">61</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c08128ae9330086185733-62">62</div><div class="crayon-num" data-line="crayon-5c08128ae9330086185733-63">63</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c08128ae9330086185733-64">64</div><div class="crayon-num" data-line="crayon-5c08128ae9330086185733-65">65</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c08128ae9330086185733-66">66</div><div class="crayon-num" data-line="crayon-5c08128ae9330086185733-67">67</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c08128ae9330086185733-68">68</div><div class="crayon-num" data-line="crayon-5c08128ae9330086185733-69">69</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c08128ae9330086185733-70">70</div><div class="crayon-num" data-line="crayon-5c08128ae9330086185733-71">71</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c08128ae9330086185733-72">72</div><div class="crayon-num" data-line="crayon-5c08128ae9330086185733-73">73</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c08128ae9330086185733-74">74</div><div class="crayon-num" data-line="crayon-5c08128ae9330086185733-75">75</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c08128ae9330086185733-76">76</div><div class="crayon-num" data-line="crayon-5c08128ae9330086185733-77">77</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c08128ae9330086185733-78">78</div><div class="crayon-num" data-line="crayon-5c08128ae9330086185733-79">79</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c08128ae9330086185733-80">80</div><div class="crayon-num" data-line="crayon-5c08128ae9330086185733-81">81</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c08128ae9330086185733-82">82</div><div class="crayon-num" data-line="crayon-5c08128ae9330086185733-83">83</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c08128ae9330086185733-84">84</div><div class="crayon-num" data-line="crayon-5c08128ae9330086185733-85">85</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c08128ae9330086185733-86">86</div><div class="crayon-num" data-line="crayon-5c08128ae9330086185733-87">87</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c08128ae9330086185733-88">88</div><div class="crayon-num" data-line="crayon-5c08128ae9330086185733-89">89</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c08128ae9330086185733-90">90</div><div class="crayon-num" data-line="crayon-5c08128ae9330086185733-91">91</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c08128ae9330086185733-92">92</div><div class="crayon-num" data-line="crayon-5c08128ae9330086185733-93">93</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c08128ae9330086185733-94">94</div><div class="crayon-num" data-line="crayon-5c08128ae9330086185733-95">95</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c08128ae9330086185733-96">96</div><div class="crayon-num" data-line="crayon-5c08128ae9330086185733-97">97</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c08128ae9330086185733-98">98</div><div class="crayon-num" data-line="crayon-5c08128ae9330086185733-99">99</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c08128ae9330086185733-100">100</div><div class="crayon-num" data-line="crayon-5c08128ae9330086185733-101">101</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c08128ae9330086185733-102">102</div><div class="crayon-num" data-line="crayon-5c08128ae9330086185733-103">103</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c08128ae9330086185733-104">104</div><div class="crayon-num" data-line="crayon-5c08128ae9330086185733-105">105</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c08128ae9330086185733-106">106</div><div class="crayon-num" data-line="crayon-5c08128ae9330086185733-107">107</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c08128ae9330086185733-108">108</div><div class="crayon-num" data-line="crayon-5c08128ae9330086185733-109">109</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c08128ae9330086185733-110">110</div><div class="crayon-num" data-line="crayon-5c08128ae9330086185733-111">111</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c08128ae9330086185733-112">112</div><div class="crayon-num" data-line="crayon-5c08128ae9330086185733-113">113</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c08128ae9330086185733-114">114</div><div class="crayon-num" data-line="crayon-5c08128ae9330086185733-115">115</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c08128ae9330086185733-116">116</div><div class="crayon-num" data-line="crayon-5c08128ae9330086185733-117">117</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c08128ae9330086185733-118">118</div><div class="crayon-num" data-line="crayon-5c08128ae9330086185733-119">119</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c08128ae9330086185733-120">120</div><div class="crayon-num" data-line="crayon-5c08128ae9330086185733-121">121</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c08128ae9330086185733-122">122</div><div class="crayon-num" data-line="crayon-5c08128ae9330086185733-123">123</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c08128ae9330086185733-124">124</div><div class="crayon-num" data-line="crayon-5c08128ae9330086185733-125">125</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c08128ae9330086185733-126">126</div><div class="crayon-num" data-line="crayon-5c08128ae9330086185733-127">127</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c08128ae9330086185733-128">128</div><div class="crayon-num" data-line="crayon-5c08128ae9330086185733-129">129</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c08128ae9330086185733-130">130</div><div class="crayon-num" data-line="crayon-5c08128ae9330086185733-131">131</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c08128ae9330086185733-132">132</div><div class="crayon-num" data-line="crayon-5c08128ae9330086185733-133">133</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c08128ae9330086185733-134">134</div><div class="crayon-num" data-line="crayon-5c08128ae9330086185733-135">135</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c08128ae9330086185733-136">136</div><div class="crayon-num" data-line="crayon-5c08128ae9330086185733-137">137</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c08128ae9330086185733-138">138</div><div class="crayon-num" data-line="crayon-5c08128ae9330086185733-139">139</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c08128ae9330086185733-140">140</div><div class="crayon-num" data-line="crayon-5c08128ae9330086185733-141">141</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c08128ae9330086185733-142">142</div><div class="crayon-num" data-line="crayon-5c08128ae9330086185733-143">143</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5c08128ae9330086185733-1"><span class="crayon-p"># univariate multi-step encoder-decoder convlstm</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c08128ae9330086185733-2"><span class="crayon-e">from </span><span class="crayon-e">math </span><span class="crayon-e">import </span><span class="crayon-e">sqrt</span></div><div class="crayon-line" id="crayon-5c08128ae9330086185733-3"><span class="crayon-e">from </span><span class="crayon-e">numpy </span><span class="crayon-e">import </span><span class="crayon-e">split</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c08128ae9330086185733-4"><span class="crayon-e">from </span><span class="crayon-e">numpy </span><span class="crayon-e">import </span><span class="crayon-t">array</span></div><div class="crayon-line" id="crayon-5c08128ae9330086185733-5"><span class="crayon-e">from </span><span class="crayon-e">pandas </span><span class="crayon-e">import </span><span class="crayon-e">read_csv</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c08128ae9330086185733-6"><span class="crayon-e">from </span><span class="crayon-v">sklearn</span><span class="crayon-sy">.</span><span class="crayon-e">metrics </span><span class="crayon-e">import </span><span class="crayon-e">mean_squared_error</span></div><div class="crayon-line" id="crayon-5c08128ae9330086185733-7"><span class="crayon-e">from </span><span class="crayon-e">matplotlib </span><span class="crayon-e">import </span><span class="crayon-e">pyplot</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c08128ae9330086185733-8"><span class="crayon-e">from </span><span class="crayon-v">keras</span><span class="crayon-sy">.</span><span class="crayon-e">models </span><span class="crayon-e">import </span><span class="crayon-e">Sequential</span></div><div class="crayon-line" id="crayon-5c08128ae9330086185733-9"><span class="crayon-e">from </span><span class="crayon-v">keras</span><span class="crayon-sy">.</span><span class="crayon-e">layers </span><span class="crayon-e">import </span><span class="crayon-e">Dense</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c08128ae9330086185733-10"><span class="crayon-e">from </span><span class="crayon-v">keras</span><span class="crayon-sy">.</span><span class="crayon-e">layers </span><span class="crayon-e">import </span><span class="crayon-e">Flatten</span></div><div class="crayon-line" id="crayon-5c08128ae9330086185733-11"><span class="crayon-e">from </span><span class="crayon-v">keras</span><span class="crayon-sy">.</span><span class="crayon-e">layers </span><span class="crayon-e">import </span><span class="crayon-e">LSTM</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c08128ae9330086185733-12"><span class="crayon-e">from </span><span class="crayon-v">keras</span><span class="crayon-sy">.</span><span class="crayon-e">layers </span><span class="crayon-e">import </span><span class="crayon-e">RepeatVector</span></div><div class="crayon-line" id="crayon-5c08128ae9330086185733-13"><span class="crayon-e">from </span><span class="crayon-v">keras</span><span class="crayon-sy">.</span><span class="crayon-e">layers </span><span class="crayon-e">import </span><span class="crayon-e">TimeDistributed</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c08128ae9330086185733-14"><span class="crayon-e">from </span><span class="crayon-v">keras</span><span class="crayon-sy">.</span><span class="crayon-e">layers </span><span class="crayon-e">import </span><span class="crayon-v">ConvLSTM2D</span></div><div class="crayon-line" id="crayon-5c08128ae9330086185733-15">&nbsp;</div><div class="crayon-line crayon-striped-line" id="crayon-5c08128ae9330086185733-16"><span class="crayon-p"># split a univariate dataset into train/test sets</span></div><div class="crayon-line" id="crayon-5c08128ae9330086185733-17"><span class="crayon-e">def </span><span class="crayon-e">split_dataset</span><span class="crayon-sy">(</span><span class="crayon-v">data</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c08128ae9330086185733-18"><span class="crayon-h">	</span><span class="crayon-p"># split into standard weeks</span></div><div class="crayon-line" id="crayon-5c08128ae9330086185733-19"><span class="crayon-h">	</span><span class="crayon-v">train</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">test</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">data</span><span class="crayon-sy">[</span><span class="crayon-cn">1</span><span class="crayon-o">:</span><span class="crayon-o">-</span><span class="crayon-cn">328</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">data</span><span class="crayon-sy">[</span><span class="crayon-o">-</span><span class="crayon-cn">328</span><span class="crayon-o">:</span><span class="crayon-o">-</span><span class="crayon-cn">6</span><span class="crayon-sy">]</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c08128ae9330086185733-20"><span class="crayon-h">	</span><span class="crayon-p"># restructure into windows of weekly data</span></div><div class="crayon-line" id="crayon-5c08128ae9330086185733-21"><span class="crayon-h">	</span><span class="crayon-v">train</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-t">array</span><span class="crayon-sy">(</span><span class="crayon-e">split</span><span class="crayon-sy">(</span><span class="crayon-v">train</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-e">len</span><span class="crayon-sy">(</span><span class="crayon-v">train</span><span class="crayon-sy">)</span><span class="crayon-o">/</span><span class="crayon-cn">7</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c08128ae9330086185733-22"><span class="crayon-h">	</span><span class="crayon-v">test</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-t">array</span><span class="crayon-sy">(</span><span class="crayon-e">split</span><span class="crayon-sy">(</span><span class="crayon-v">test</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-e">len</span><span class="crayon-sy">(</span><span class="crayon-v">test</span><span class="crayon-sy">)</span><span class="crayon-o">/</span><span class="crayon-cn">7</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c08128ae9330086185733-23"><span class="crayon-h">	</span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">train</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">test</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c08128ae9330086185733-24">&nbsp;</div><div class="crayon-line" id="crayon-5c08128ae9330086185733-25"><span class="crayon-p"># evaluate one or more weekly forecasts against expected values</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c08128ae9330086185733-26"><span class="crayon-e">def </span><span class="crayon-e">evaluate_forecasts</span><span class="crayon-sy">(</span><span class="crayon-v">actual</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">predicted</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5c08128ae9330086185733-27"><span class="crayon-h">	</span><span class="crayon-v">scores</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">list</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c08128ae9330086185733-28"><span class="crayon-h">	</span><span class="crayon-p"># calculate an RMSE score for each day</span></div><div class="crayon-line" id="crayon-5c08128ae9330086185733-29"><span class="crayon-h">	</span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">i</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-v">actual</span><span class="crayon-sy">.</span><span class="crayon-v">shape</span><span class="crayon-sy">[</span><span class="crayon-cn">1</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c08128ae9330086185733-30"><span class="crayon-h">		</span><span class="crayon-p"># calculate mse</span></div><div class="crayon-line" id="crayon-5c08128ae9330086185733-31"><span class="crayon-h">		</span><span class="crayon-v">mse</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">mean_squared_error</span><span class="crayon-sy">(</span><span class="crayon-v">actual</span><span class="crayon-sy">[</span><span class="crayon-o">:</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">i</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">predicted</span><span class="crayon-sy">[</span><span class="crayon-o">:</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">i</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c08128ae9330086185733-32"><span class="crayon-h">		</span><span class="crayon-p"># calculate rmse</span></div><div class="crayon-line" id="crayon-5c08128ae9330086185733-33"><span class="crayon-h">		</span><span class="crayon-v">rmse</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">sqrt</span><span class="crayon-sy">(</span><span class="crayon-v">mse</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c08128ae9330086185733-34"><span class="crayon-h">		</span><span class="crayon-p"># store</span></div><div class="crayon-line" id="crayon-5c08128ae9330086185733-35"><span class="crayon-h">		</span><span class="crayon-v">scores</span><span class="crayon-sy">.</span><span class="crayon-e">append</span><span class="crayon-sy">(</span><span class="crayon-v">rmse</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c08128ae9330086185733-36"><span class="crayon-h">	</span><span class="crayon-p"># calculate overall RMSE</span></div><div class="crayon-line" id="crayon-5c08128ae9330086185733-37"><span class="crayon-h">	</span><span class="crayon-v">s</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-cn">0</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c08128ae9330086185733-38"><span class="crayon-h">	</span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-e">row </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-v">actual</span><span class="crayon-sy">.</span><span class="crayon-v">shape</span><span class="crayon-sy">[</span><span class="crayon-cn">0</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5c08128ae9330086185733-39"><span class="crayon-h">		</span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-e">col </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-v">actual</span><span class="crayon-sy">.</span><span class="crayon-v">shape</span><span class="crayon-sy">[</span><span class="crayon-cn">1</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c08128ae9330086185733-40"><span class="crayon-h">			</span><span class="crayon-v">s</span><span class="crayon-h"> </span><span class="crayon-o">+=</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-v">actual</span><span class="crayon-sy">[</span><span class="crayon-v">row</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">col</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-o">-</span><span class="crayon-h"> </span><span class="crayon-v">predicted</span><span class="crayon-sy">[</span><span class="crayon-v">row</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">col</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span><span class="crayon-o">*</span><span class="crayon-o">*</span><span class="crayon-cn">2</span></div><div class="crayon-line" id="crayon-5c08128ae9330086185733-41"><span class="crayon-h">	</span><span class="crayon-v">score</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">sqrt</span><span class="crayon-sy">(</span><span class="crayon-v">s</span><span class="crayon-h"> </span><span class="crayon-o">/</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-v">actual</span><span class="crayon-sy">.</span><span class="crayon-v">shape</span><span class="crayon-sy">[</span><span class="crayon-cn">0</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-o">*</span><span class="crayon-h"> </span><span class="crayon-v">actual</span><span class="crayon-sy">.</span><span class="crayon-v">shape</span><span class="crayon-sy">[</span><span class="crayon-cn">1</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c08128ae9330086185733-42"><span class="crayon-h">	</span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">score</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">scores</span></div><div class="crayon-line" id="crayon-5c08128ae9330086185733-43">&nbsp;</div><div class="crayon-line crayon-striped-line" id="crayon-5c08128ae9330086185733-44"><span class="crayon-p"># summarize scores</span></div><div class="crayon-line" id="crayon-5c08128ae9330086185733-45"><span class="crayon-e">def </span><span class="crayon-e">summarize_scores</span><span class="crayon-sy">(</span><span class="crayon-v">name</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">score</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">scores</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c08128ae9330086185733-46"><span class="crayon-h">	</span><span class="crayon-v">s_scores</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-s">', '</span><span class="crayon-sy">.</span><span class="crayon-e">join</span><span class="crayon-sy">(</span><span class="crayon-sy">[</span><span class="crayon-s">'%.1f'</span><span class="crayon-h"> </span><span class="crayon-o">%</span><span class="crayon-h"> </span><span class="crayon-i">s</span><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">s</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-v">scores</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c08128ae9330086185733-47"><span class="crayon-h">	</span><span class="crayon-e">print</span><span class="crayon-sy">(</span><span class="crayon-s">'%s: [%.3f] %s'</span><span class="crayon-h"> </span><span class="crayon-o">%</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-v">name</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">score</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">s_scores</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c08128ae9330086185733-48">&nbsp;</div><div class="crayon-line" id="crayon-5c08128ae9330086185733-49"><span class="crayon-p"># convert history into inputs and outputs</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c08128ae9330086185733-50"><span class="crayon-e">def </span><span class="crayon-e">to_supervised</span><span class="crayon-sy">(</span><span class="crayon-v">train</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_input</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_out</span><span class="crayon-o">=</span><span class="crayon-cn">7</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5c08128ae9330086185733-51"><span class="crayon-h">	</span><span class="crayon-p"># flatten data</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c08128ae9330086185733-52"><span class="crayon-h">	</span><span class="crayon-v">data</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">train</span><span class="crayon-sy">.</span><span class="crayon-e">reshape</span><span class="crayon-sy">(</span><span class="crayon-sy">(</span><span class="crayon-v">train</span><span class="crayon-sy">.</span><span class="crayon-v">shape</span><span class="crayon-sy">[</span><span class="crayon-cn">0</span><span class="crayon-sy">]</span><span class="crayon-o">*</span><span class="crayon-v">train</span><span class="crayon-sy">.</span><span class="crayon-v">shape</span><span class="crayon-sy">[</span><span class="crayon-cn">1</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">train</span><span class="crayon-sy">.</span><span class="crayon-v">shape</span><span class="crayon-sy">[</span><span class="crayon-cn">2</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c08128ae9330086185733-53"><span class="crayon-h">	</span><span class="crayon-v">X</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">y</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">list</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-e">list</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c08128ae9330086185733-54"><span class="crayon-h">	</span><span class="crayon-v">in_start</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-cn">0</span></div><div class="crayon-line" id="crayon-5c08128ae9330086185733-55"><span class="crayon-h">	</span><span class="crayon-p"># step over the entire history one time step at a time</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c08128ae9330086185733-56"><span class="crayon-h">	</span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">_</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-e">len</span><span class="crayon-sy">(</span><span class="crayon-v">data</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5c08128ae9330086185733-57"><span class="crayon-h">		</span><span class="crayon-p"># define the end of the input sequence</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c08128ae9330086185733-58"><span class="crayon-h">		</span><span class="crayon-v">in_end</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">in_start</span><span class="crayon-h"> </span><span class="crayon-o">+</span><span class="crayon-h"> </span><span class="crayon-e">n_input</span></div><div class="crayon-line" id="crayon-5c08128ae9330086185733-59"><span class="crayon-e">		</span><span class="crayon-v">out_end</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">in_end</span><span class="crayon-h"> </span><span class="crayon-o">+</span><span class="crayon-h"> </span><span class="crayon-v">n_out</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c08128ae9330086185733-60"><span class="crayon-h">		</span><span class="crayon-p"># ensure we have enough data for this instance</span></div><div class="crayon-line" id="crayon-5c08128ae9330086185733-61"><span class="crayon-h">		</span><span class="crayon-st">if</span><span class="crayon-h"> </span><span class="crayon-v">out_end</span><span class="crayon-h"> </span><span class="crayon-o">&lt;</span><span class="crayon-h"> </span><span class="crayon-e">len</span><span class="crayon-sy">(</span><span class="crayon-v">data</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c08128ae9330086185733-62"><span class="crayon-h">			</span><span class="crayon-v">x_input</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">data</span><span class="crayon-sy">[</span><span class="crayon-v">in_start</span><span class="crayon-o">:</span><span class="crayon-v">in_end</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">0</span><span class="crayon-sy">]</span></div><div class="crayon-line" id="crayon-5c08128ae9330086185733-63"><span class="crayon-h">			</span><span class="crayon-v">x_input</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">x_input</span><span class="crayon-sy">.</span><span class="crayon-e">reshape</span><span class="crayon-sy">(</span><span class="crayon-sy">(</span><span class="crayon-e">len</span><span class="crayon-sy">(</span><span class="crayon-v">x_input</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">1</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c08128ae9330086185733-64"><span class="crayon-h">			</span><span class="crayon-v">X</span><span class="crayon-sy">.</span><span class="crayon-e">append</span><span class="crayon-sy">(</span><span class="crayon-v">x_input</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c08128ae9330086185733-65"><span class="crayon-h">			</span><span class="crayon-v">y</span><span class="crayon-sy">.</span><span class="crayon-e">append</span><span class="crayon-sy">(</span><span class="crayon-v">data</span><span class="crayon-sy">[</span><span class="crayon-v">in_end</span><span class="crayon-o">:</span><span class="crayon-v">out_end</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">0</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c08128ae9330086185733-66"><span class="crayon-h">		</span><span class="crayon-p"># move along one time step</span></div><div class="crayon-line" id="crayon-5c08128ae9330086185733-67"><span class="crayon-h">		</span><span class="crayon-v">in_start</span><span class="crayon-h"> </span><span class="crayon-o">+=</span><span class="crayon-h"> </span><span class="crayon-cn">1</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c08128ae9330086185733-68"><span class="crayon-h">	</span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-t">array</span><span class="crayon-sy">(</span><span class="crayon-v">X</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-t">array</span><span class="crayon-sy">(</span><span class="crayon-v">y</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c08128ae9330086185733-69">&nbsp;</div><div class="crayon-line crayon-striped-line" id="crayon-5c08128ae9330086185733-70"><span class="crayon-p"># train the model</span></div><div class="crayon-line" id="crayon-5c08128ae9330086185733-71"><span class="crayon-e">def </span><span class="crayon-e">build_model</span><span class="crayon-sy">(</span><span class="crayon-v">train</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_steps</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_length</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_input</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c08128ae9330086185733-72"><span class="crayon-h">	</span><span class="crayon-p"># prepare data</span></div><div class="crayon-line" id="crayon-5c08128ae9330086185733-73"><span class="crayon-h">	</span><span class="crayon-v">train_x</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">train_y</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">to_supervised</span><span class="crayon-sy">(</span><span class="crayon-v">train</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_input</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c08128ae9330086185733-74"><span class="crayon-h">	</span><span class="crayon-p"># define parameters</span></div><div class="crayon-line" id="crayon-5c08128ae9330086185733-75"><span class="crayon-h">	</span><span class="crayon-v">verbose</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">epochs</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">batch_size</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-cn">0</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">20</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">16</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c08128ae9330086185733-76"><span class="crayon-h">	</span><span class="crayon-v">n_timesteps</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_features</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_outputs</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">train_x</span><span class="crayon-sy">.</span><span class="crayon-v">shape</span><span class="crayon-sy">[</span><span class="crayon-cn">1</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">train_x</span><span class="crayon-sy">.</span><span class="crayon-v">shape</span><span class="crayon-sy">[</span><span class="crayon-cn">2</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">train_y</span><span class="crayon-sy">.</span><span class="crayon-v">shape</span><span class="crayon-sy">[</span><span class="crayon-cn">1</span><span class="crayon-sy">]</span></div><div class="crayon-line" id="crayon-5c08128ae9330086185733-77"><span class="crayon-h">	</span><span class="crayon-p"># reshape into subsequences [samples, time steps, rows, cols, channels]</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c08128ae9330086185733-78"><span class="crayon-h">	</span><span class="crayon-v">train_x</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">train_x</span><span class="crayon-sy">.</span><span class="crayon-e">reshape</span><span class="crayon-sy">(</span><span class="crayon-sy">(</span><span class="crayon-v">train_x</span><span class="crayon-sy">.</span><span class="crayon-v">shape</span><span class="crayon-sy">[</span><span class="crayon-cn">0</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_steps</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">1</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_length</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_features</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c08128ae9330086185733-79"><span class="crayon-h">	</span><span class="crayon-p"># reshape output into [samples, timesteps, features]</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c08128ae9330086185733-80"><span class="crayon-h">	</span><span class="crayon-v">train_y</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">train_y</span><span class="crayon-sy">.</span><span class="crayon-e">reshape</span><span class="crayon-sy">(</span><span class="crayon-sy">(</span><span class="crayon-v">train_y</span><span class="crayon-sy">.</span><span class="crayon-v">shape</span><span class="crayon-sy">[</span><span class="crayon-cn">0</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">train_y</span><span class="crayon-sy">.</span><span class="crayon-v">shape</span><span class="crayon-sy">[</span><span class="crayon-cn">1</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">1</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c08128ae9330086185733-81"><span class="crayon-h">	</span><span class="crayon-p"># define model</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c08128ae9330086185733-82"><span class="crayon-h">	</span><span class="crayon-v">model</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">Sequential</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c08128ae9330086185733-83"><span class="crayon-h">	</span><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">add</span><span class="crayon-sy">(</span><span class="crayon-e">ConvLSTM2D</span><span class="crayon-sy">(</span><span class="crayon-v">filters</span><span class="crayon-o">=</span><span class="crayon-cn">64</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">kernel_size</span><span class="crayon-o">=</span><span class="crayon-sy">(</span><span class="crayon-cn">1</span><span class="crayon-sy">,</span><span class="crayon-cn">3</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">activation</span><span class="crayon-o">=</span><span class="crayon-s">'relu'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">input_shape</span><span class="crayon-o">=</span><span class="crayon-sy">(</span><span class="crayon-v">n_steps</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">1</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_length</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_features</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c08128ae9330086185733-84"><span class="crayon-h">	</span><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">add</span><span class="crayon-sy">(</span><span class="crayon-e">Flatten</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c08128ae9330086185733-85"><span class="crayon-h">	</span><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">add</span><span class="crayon-sy">(</span><span class="crayon-e">RepeatVector</span><span class="crayon-sy">(</span><span class="crayon-v">n_outputs</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c08128ae9330086185733-86"><span class="crayon-h">	</span><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">add</span><span class="crayon-sy">(</span><span class="crayon-e">LSTM</span><span class="crayon-sy">(</span><span class="crayon-cn">200</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">activation</span><span class="crayon-o">=</span><span class="crayon-s">'relu'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">return_sequences</span><span class="crayon-o">=</span><span class="crayon-t">True</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c08128ae9330086185733-87"><span class="crayon-h">	</span><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">add</span><span class="crayon-sy">(</span><span class="crayon-e">TimeDistributed</span><span class="crayon-sy">(</span><span class="crayon-e">Dense</span><span class="crayon-sy">(</span><span class="crayon-cn">100</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">activation</span><span class="crayon-o">=</span><span class="crayon-s">'relu'</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c08128ae9330086185733-88"><span class="crayon-h">	</span><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">add</span><span class="crayon-sy">(</span><span class="crayon-e">TimeDistributed</span><span class="crayon-sy">(</span><span class="crayon-e">Dense</span><span class="crayon-sy">(</span><span class="crayon-cn">1</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c08128ae9330086185733-89"><span class="crayon-h">	</span><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">compile</span><span class="crayon-sy">(</span><span class="crayon-v">loss</span><span class="crayon-o">=</span><span class="crayon-s">'mse'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">optimizer</span><span class="crayon-o">=</span><span class="crayon-s">'adam'</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c08128ae9330086185733-90"><span class="crayon-h">	</span><span class="crayon-p"># fit network</span></div><div class="crayon-line" id="crayon-5c08128ae9330086185733-91"><span class="crayon-h">	</span><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">fit</span><span class="crayon-sy">(</span><span class="crayon-v">train_x</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">train_y</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">epochs</span><span class="crayon-o">=</span><span class="crayon-v">epochs</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">batch_size</span><span class="crayon-o">=</span><span class="crayon-v">batch_size</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">verbose</span><span class="crayon-o">=</span><span class="crayon-v">verbose</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c08128ae9330086185733-92"><span class="crayon-h">	</span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">model</span></div><div class="crayon-line" id="crayon-5c08128ae9330086185733-93">&nbsp;</div><div class="crayon-line crayon-striped-line" id="crayon-5c08128ae9330086185733-94"><span class="crayon-p"># make a forecast</span></div><div class="crayon-line" id="crayon-5c08128ae9330086185733-95"><span class="crayon-e">def </span><span class="crayon-e">forecast</span><span class="crayon-sy">(</span><span class="crayon-v">model</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">history</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_steps</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_length</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_input</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c08128ae9330086185733-96"><span class="crayon-h">	</span><span class="crayon-p"># flatten data</span></div><div class="crayon-line" id="crayon-5c08128ae9330086185733-97"><span class="crayon-h">	</span><span class="crayon-v">data</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-t">array</span><span class="crayon-sy">(</span><span class="crayon-v">history</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c08128ae9330086185733-98"><span class="crayon-h">	</span><span class="crayon-v">data</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">data</span><span class="crayon-sy">.</span><span class="crayon-e">reshape</span><span class="crayon-sy">(</span><span class="crayon-sy">(</span><span class="crayon-v">data</span><span class="crayon-sy">.</span><span class="crayon-v">shape</span><span class="crayon-sy">[</span><span class="crayon-cn">0</span><span class="crayon-sy">]</span><span class="crayon-o">*</span><span class="crayon-v">data</span><span class="crayon-sy">.</span><span class="crayon-v">shape</span><span class="crayon-sy">[</span><span class="crayon-cn">1</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">data</span><span class="crayon-sy">.</span><span class="crayon-v">shape</span><span class="crayon-sy">[</span><span class="crayon-cn">2</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c08128ae9330086185733-99"><span class="crayon-h">	</span><span class="crayon-p"># retrieve last observations for input data</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c08128ae9330086185733-100"><span class="crayon-h">	</span><span class="crayon-v">input_x</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">data</span><span class="crayon-sy">[</span><span class="crayon-o">-</span><span class="crayon-v">n_input</span><span class="crayon-o">:</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">0</span><span class="crayon-sy">]</span></div><div class="crayon-line" id="crayon-5c08128ae9330086185733-101"><span class="crayon-h">	</span><span class="crayon-p"># reshape into [samples, time steps, rows, cols, channels]</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c08128ae9330086185733-102"><span class="crayon-h">	</span><span class="crayon-v">input_x</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">input_x</span><span class="crayon-sy">.</span><span class="crayon-e">reshape</span><span class="crayon-sy">(</span><span class="crayon-sy">(</span><span class="crayon-cn">1</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_steps</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">1</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_length</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">1</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c08128ae9330086185733-103"><span class="crayon-h">	</span><span class="crayon-p"># forecast the next week</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c08128ae9330086185733-104"><span class="crayon-h">	</span><span class="crayon-v">yhat</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">predict</span><span class="crayon-sy">(</span><span class="crayon-v">input_x</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">verbose</span><span class="crayon-o">=</span><span class="crayon-cn">0</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c08128ae9330086185733-105"><span class="crayon-h">	</span><span class="crayon-p"># we only want the vector forecast</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c08128ae9330086185733-106"><span class="crayon-h">	</span><span class="crayon-v">yhat</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">yhat</span><span class="crayon-sy">[</span><span class="crayon-cn">0</span><span class="crayon-sy">]</span></div><div class="crayon-line" id="crayon-5c08128ae9330086185733-107"><span class="crayon-h">	</span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">yhat</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c08128ae9330086185733-108">&nbsp;</div><div class="crayon-line" id="crayon-5c08128ae9330086185733-109"><span class="crayon-p"># evaluate a single model</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c08128ae9330086185733-110"><span class="crayon-e">def </span><span class="crayon-e">evaluate_model</span><span class="crayon-sy">(</span><span class="crayon-v">train</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">test</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_steps</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_length</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_input</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5c08128ae9330086185733-111"><span class="crayon-h">	</span><span class="crayon-p"># fit model</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c08128ae9330086185733-112"><span class="crayon-h">	</span><span class="crayon-v">model</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">build_model</span><span class="crayon-sy">(</span><span class="crayon-v">train</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_steps</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_length</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_input</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c08128ae9330086185733-113"><span class="crayon-h">	</span><span class="crayon-p"># history is a list of weekly data</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c08128ae9330086185733-114"><span class="crayon-h">	</span><span class="crayon-v">history</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-i">x</span><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">x</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-v">train</span><span class="crayon-sy">]</span></div><div class="crayon-line" id="crayon-5c08128ae9330086185733-115"><span class="crayon-h">	</span><span class="crayon-p"># walk-forward validation over each week</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c08128ae9330086185733-116"><span class="crayon-h">	</span><span class="crayon-v">predictions</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">list</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c08128ae9330086185733-117"><span class="crayon-h">	</span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">i</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-e">len</span><span class="crayon-sy">(</span><span class="crayon-v">test</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c08128ae9330086185733-118"><span class="crayon-h">		</span><span class="crayon-p"># predict the week</span></div><div class="crayon-line" id="crayon-5c08128ae9330086185733-119"><span class="crayon-h">		</span><span class="crayon-v">yhat_sequence</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">forecast</span><span class="crayon-sy">(</span><span class="crayon-v">model</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">history</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_steps</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_length</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_input</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c08128ae9330086185733-120"><span class="crayon-h">		</span><span class="crayon-p"># store the predictions</span></div><div class="crayon-line" id="crayon-5c08128ae9330086185733-121"><span class="crayon-h">		</span><span class="crayon-v">predictions</span><span class="crayon-sy">.</span><span class="crayon-e">append</span><span class="crayon-sy">(</span><span class="crayon-v">yhat_sequence</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c08128ae9330086185733-122"><span class="crayon-h">		</span><span class="crayon-p"># get real observation and add to history for predicting the next week</span></div><div class="crayon-line" id="crayon-5c08128ae9330086185733-123"><span class="crayon-h">		</span><span class="crayon-v">history</span><span class="crayon-sy">.</span><span class="crayon-e">append</span><span class="crayon-sy">(</span><span class="crayon-v">test</span><span class="crayon-sy">[</span><span class="crayon-v">i</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-o">:</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c08128ae9330086185733-124"><span class="crayon-h">	</span><span class="crayon-p"># evaluate predictions days for each week</span></div><div class="crayon-line" id="crayon-5c08128ae9330086185733-125"><span class="crayon-h">	</span><span class="crayon-v">predictions</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-t">array</span><span class="crayon-sy">(</span><span class="crayon-v">predictions</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c08128ae9330086185733-126"><span class="crayon-h">	</span><span class="crayon-v">score</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">scores</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">evaluate_forecasts</span><span class="crayon-sy">(</span><span class="crayon-v">test</span><span class="crayon-sy">[</span><span class="crayon-o">:</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-o">:</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">0</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">predictions</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c08128ae9330086185733-127"><span class="crayon-h">	</span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">score</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">scores</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c08128ae9330086185733-128">&nbsp;</div><div class="crayon-line" id="crayon-5c08128ae9330086185733-129"><span class="crayon-p"># load the new file</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c08128ae9330086185733-130"><span class="crayon-v">dataset</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">read_csv</span><span class="crayon-sy">(</span><span class="crayon-s">'household_power_consumption_days.csv'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">header</span><span class="crayon-o">=</span><span class="crayon-cn">0</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">infer_datetime_format</span><span class="crayon-o">=</span><span class="crayon-t">True</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">parse_dates</span><span class="crayon-o">=</span><span class="crayon-sy">[</span><span class="crayon-s">'datetime'</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">index_col</span><span class="crayon-o">=</span><span class="crayon-sy">[</span><span class="crayon-s">'datetime'</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c08128ae9330086185733-131"><span class="crayon-p"># split into train and test</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c08128ae9330086185733-132"><span class="crayon-v">train</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">test</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">split_dataset</span><span class="crayon-sy">(</span><span class="crayon-v">dataset</span><span class="crayon-sy">.</span><span class="crayon-v">values</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c08128ae9330086185733-133"><span class="crayon-p"># define the number of subsequences and the length of subsequences</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c08128ae9330086185733-134"><span class="crayon-v">n_steps</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_length</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-cn">2</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">7</span></div><div class="crayon-line" id="crayon-5c08128ae9330086185733-135"><span class="crayon-p"># define the total days to use as input</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c08128ae9330086185733-136"><span class="crayon-v">n_input</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e ">n_length *</span><span class="crayon-h"> </span><span class="crayon-e">n_steps</span></div><div class="crayon-line" id="crayon-5c08128ae9330086185733-137"><span class="crayon-v">score</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">scores</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">evaluate_model</span><span class="crayon-sy">(</span><span class="crayon-v">train</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">test</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_steps</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_length</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_input</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c08128ae9330086185733-138"><span class="crayon-p"># summarize scores</span></div><div class="crayon-line" id="crayon-5c08128ae9330086185733-139"><span class="crayon-e">summarize_scores</span><span class="crayon-sy">(</span><span class="crayon-s">'lstm'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">score</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">scores</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c08128ae9330086185733-140"><span class="crayon-p"># plot scores</span></div><div class="crayon-line" id="crayon-5c08128ae9330086185733-141"><span class="crayon-v">days</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-s">'sun'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-s">'mon'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-s">'tue'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-s">'wed'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-s">'thr'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-s">'fri'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-s">'sat'</span><span class="crayon-sy">]</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c08128ae9330086185733-142"><span class="crayon-v">pyplot</span><span class="crayon-sy">.</span><span class="crayon-e">plot</span><span class="crayon-sy">(</span><span class="crayon-v">days</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">scores</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">marker</span><span class="crayon-o">=</span><span class="crayon-s">'o'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">label</span><span class="crayon-o">=</span><span class="crayon-s">'lstm'</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c08128ae9330086185733-143"><span class="crayon-v">pyplot</span><span class="crayon-sy">.</span><span class="crayon-e">show</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div></div></td>
					</tr>
				</tbody></table>
			</div>
		</div>
<!-- [Format Time: 0.0086 seconds] -->
<p>Running the example fits the model and summarizes the performance on the test dataset.</p>
<p>A little experimentation showed that using two convolutional layers made the model more stable than using just a single layer.</p>
<p>We can see that in this case the model is skillful, achieving an overall RMSE score of about 367 kilowatts.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->

		<div id="crayon-5c08128ae9333148902232" class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" style="margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important; height: auto;">
		
			<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important; height: 18px !important; line-height: 18px !important; margin-top: -19px; display: none; z-index: 4;"><span class="crayon-title"></span>
			<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button crayon-pressed" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code" style="display: none;"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
			<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
			<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="readonly" style="-moz-tab-size: 4; font-size: 12px !important; line-height: 15px !important; z-index: 0; opacity: 0; overflow: hidden;" wrap="soft">lstm: [367.929] 416.3, 379.7, 334.7, 362.3, 374.7, 284.8, 406.7</textarea></div>
			<div class="crayon-main" style="position: relative; z-index: 1; overflow: hidden;">
				<table class="crayon-table" style="">
					<tbody><tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5c08128ae9333148902232-1">1</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5c08128ae9333148902232-1">lstm: [367.929] 416.3, 379.7, 334.7, 362.3, 374.7, 284.8, 406.7</div></div></td>
					</tr>
				</tbody></table>
			</div>
		</div>
<!-- [Format Time: 0.0000 seconds] -->
<p>A line plot of the per-day RMSE is also created.</p>
<div id="attachment_6292" style="width: 1290px" class="wp-caption aligncenter"><img class="size-full wp-image-6292" src="How%20to%20Develop%20LSTM%20Models%20for%20Multi-Step%20Time%20Series%20Forecasting%20of%20Household%20Power%20Consumption_fichiers/Line-Plot-of-RMSE-per-Day-for-Univariate-Encoder-Decoder-Con.png" alt="Line Plot of RMSE per Day for Univariate Encoder-Decoder ConvLSTM with 14-day Inputs" srcset="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2018/07/Line-Plot-of-RMSE-per-Day-for-Univariate-Encoder-Decoder-ConvLSTM-with-14-day-Inputs.png 1280w, https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2018/07/Line-Plot-of-RMSE-per-Day-for-Univariate-Encoder-Decoder-ConvLSTM-with-14-day-Inputs-300x225.png 300w, https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2018/07/Line-Plot-of-RMSE-per-Day-for-Univariate-Encoder-Decoder-ConvLSTM-with-14-day-Inputs-768x576.png 768w, https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2018/07/Line-Plot-of-RMSE-per-Day-for-Univariate-Encoder-Decoder-ConvLSTM-with-14-day-Inputs-1024x768.png 1024w" sizes="(max-width: 1280px) 100vw, 1280px" width="1280" height="960"><p class="wp-caption-text">Line Plot of RMSE per Day for Univariate Encoder-Decoder ConvLSTM with 14-day Inputs</p></div>
<h2>Extensions</h2>
<p>This section lists some ideas for extending the tutorial that you may wish to explore.</p>
<ul>
<li><strong>Size of Input</strong>. Explore more or fewer number of days used as input for the model, such as three days, 21 days, 30 days, and more.</li>
<li><strong>Model Tuning</strong>. Tune the structure and hyperparameters for a model and further lift model performance on average.</li>
<li><strong>Data Scaling</strong>. Explore whether data scaling, such as
 standardization and normalization, can be used to improve the 
performance of any of the LSTM models.</li>
<li><strong>Learning Diagnostics</strong>. Use diagnostics such as 
learning curves for the train and validation loss and mean squared error
 to help tune the structure and hyperparameters of a LSTM model.</li>
</ul>
<p>If you explore any of these extensions, I’d love to know.</p>
<h2>Further Reading</h2>
<p>This section provides more resources on the topic if you are looking to go deeper.</p>
<h3>Posts</h3>
<ul>
<li><a href="https://machinelearningmastery.com/multi-step-time-series-forecasting/">4 Strategies for Multi-Step Time Series Forecasting</a></li>
<li><a href="https://machinelearningmastery.com/crash-course-recurrent-neural-networks-deep-learning/">Crash Course in Recurrent Neural Networks for Deep Learning</a></li>
<li><a href="https://machinelearningmastery.com/gentle-introduction-long-short-term-memory-networks-experts/">A Gentle Introduction to Long Short-Term Memory Networks by the Experts</a></li>
<li><a href="https://machinelearningmastery.com/suitability-long-short-term-memory-networks-time-series-forecasting/">On the Suitability of LSTMs for Time Series Forecasting</a></li>
<li><a href="https://machinelearningmastery.com/cnn-long-short-term-memory-networks/">CNN Long Short-Term Memory Networks</a></li>
<li><a href="https://machinelearningmastery.com/develop-encoder-decoder-model-sequence-sequence-prediction-keras/">How to Develop an Encoder-Decoder Model for Sequence-to-Sequence Prediction in Keras</a></li>
</ul>
<h3>API</h3>
<ul>
<li><a href="https://pandas.pydata.org/pandas-docs/stable/generated/pandas.read_csv.html">pandas.read_csv API</a></li>
<li><a href="https://pandas.pydata.org/pandas-docs/stable/generated/pandas.DataFrame.resample.html">pandas.DataFrame.resample API</a></li>
<li><a href="http://pandas.pydata.org/pandas-docs/stable/timeseries.html#offset-aliases">Resample Offset Aliases</a></li>
<li><a href="http://scikit-learn.org/stable/modules/generated/sklearn.metrics.mean_squared_error.html">sklearn.metrics.mean_squared_error API</a></li>
<li><a href="https://docs.scipy.org/doc/numpy/reference/generated/numpy.split.html">numpy.split API</a></li>
</ul>
<h3>Articles</h3>
<ul>
<li><a href="https://archive.ics.uci.edu/ml/datasets/individual+household+electric+power+consumption">Individual household electric power consumption Data Set, UCI Machine Learning Repository</a>.</li>
<li><a href="https://en.wikipedia.org/wiki/AC_power">AC power, Wikipedia</a>.</li>
<li><a href="https://arxiv.org/abs/1506.04214v1">Convolutional LSTM Network: A Machine Learning Approach for Precipitation Nowcasting</a>, 2015.</li>
</ul>
<h2>Summary</h2>
<p>In this tutorial, you discovered how to develop long short-term 
memory recurrent neural networks for multi-step time series forecasting 
of household power consumption.</p>
<p>Specifically, you learned:</p>
<ul>
<li>How to develop and evaluate Univariate and multivariate Encoder-Decoder LSTMs for multi-step time series forecasting.</li>
<li>How to develop and evaluate an CNN-LSTM Encoder-Decoder model for multi-step time series forecasting.</li>
<li>How to develop and evaluate a ConvLSTM Encoder-Decoder model for multi-step time series forecasting.</li>
</ul>
<p>Do you have any questions?<br>
Ask your questions in the comments below and I will do my best to answer.</p>
<div class="awac-wrapper"><div class="awac widget text-52">			<div class="textwidget"><p></p><center><br>
<div class="woo-sc-hr"></div><p></p>
<h2>Develop Deep Learning models for Time Series Today!</h2>
<p><a href="https://machinelearningmastery.com/deep-learning-for-time-series-forecasting/"><img style="border: 0;" src="How%20to%20Develop%20LSTM%20Models%20for%20Multi-Step%20Time%20Series%20Forecasting%20of%20Household%20Power%20Consumption_fichiers/Cover-220.png" alt="Deep Learning for Time Series Forecasting" align="left"></a></p>
<h4>Develop Your Own Forecasting models in Minutes</h4>
<p>…with just a few lines of python code</p>
<p>Discover how in my new Ebook:<br>
<a href="https://machinelearningmastery.com/deep-learning-for-time-series-forecasting/">Deep Learning for Time Series Forecasting</a></p>
<p>It provides <strong>self-study tutorials</strong> on topics like: <em>CNNs</em>, <em>LSTMs</em>,<br>
<em>Multivariate Forecasting</em>, <em>Multi-Step Forecasting</em> and much more…</p>
<h4>Finally Bring Deep Learning to your Time Series Forecasting Projects</h4>
<p>Skip the Academics. Just Results.</p>
<p><a href="https://machinelearningmastery.com/deep-learning-for-time-series-forecasting/">Click to learn more</a>.<br>
</p><div class="woo-sc-hr"></div><br>
</center><p></p>
</div>
		</div></div><div class="simplesocialbuttons simplesocial-simple-icons simplesocialbuttons_inline simplesocialbuttons-align-left post-6286 post  simplesocialbuttons-inline-no-animation">
<button class="ssb_tweet-icon" data-href="https://twitter.com/share?text=How+to+Develop+LSTM+Models+for+Multi-Step+Time+Series+Forecasting+of+Household+Power+Consumption&amp;url=https://machinelearningmastery.com/how-to-develop-lstm-models-for-multi-step-time-series-forecasting-of-household-power-consumption/" rel="nofollow" onclick="javascript:window.open(this.dataset.href, '', 'menubar=no,toolbar=no,resizable=yes,scrollbars=yes,height=600,width=600');return false;">
						<span class="icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 72 72"><path fill="none" d="M0 0h72v72H0z"></path><path class="icon" fill="#fff" d="M68.812 15.14c-2.348 1.04-4.87 1.744-7.52 2.06 2.704-1.62 4.78-4.186 5.757-7.243-2.53 1.5-5.33 2.592-8.314 3.176C56.35 10.59 52.948 9 49.182 9c-7.23 0-13.092 5.86-13.092 13.093 0 1.026.118 2.02.338 2.98C25.543 24.527 15.9 19.318 9.44 11.396c-1.125 1.936-1.77 4.184-1.77 6.58 0 4.543 2.312 8.552 5.824 10.9-2.146-.07-4.165-.658-5.93-1.64-.002.056-.002.11-.002.163 0 6.345 4.513 11.638 10.504 12.84-1.1.298-2.256.457-3.45.457-.845 0-1.666-.078-2.464-.23 1.667 5.2 6.5 8.985 12.23 9.09-4.482 3.51-10.13 5.605-16.26 5.605-1.055 0-2.096-.06-3.122-.184 5.794 3.717 12.676 5.882 20.067 5.882 24.083 0 37.25-19.95 37.25-37.25 0-.565-.013-1.133-.038-1.693 2.558-1.847 4.778-4.15 6.532-6.774z"></path></svg></span><i class="simplesocialtxt">Tweet </i></button>
		<button class="ssb_fbshare-icon" target="_blank" data-href="https://www.facebook.com/sharer/sharer.php?u=https://machinelearningmastery.com/how-to-develop-lstm-models-for-multi-step-time-series-forecasting-of-household-power-consumption/" onclick="javascript:window.open(this.dataset.href, '', 'menubar=no,toolbar=no,resizable=yes,scrollbars=yes,height=600,width=600');return false;">
						<span class="icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16" class="_1pbq" color="#ffffff"><path fill="#ffffff" fill-rule="evenodd" class="icon" d="M8 14H3.667C2.733 13.9 2 13.167 2 12.233V3.667A1.65 1.65 0 0 1 3.667 2h8.666A1.65 1.65 0 0 1 14 3.667v8.566c0 .934-.733 1.667-1.667 1.767H10v-3.967h1.3l.7-2.066h-2V6.933c0-.466.167-.9.867-.9H12v-1.8c.033 0-.933-.266-1.533-.266-1.267 0-2.434.7-2.467 2.133v1.867H6v2.066h2V14z"></path></svg></span>
						<span class="simplesocialtxt">Share </span> </button>
<button class="ssb_linkedin-icon" data-href="https://www.linkedin.com/cws/share?url=https://machinelearningmastery.com/how-to-develop-lstm-models-for-multi-step-time-series-forecasting-of-household-power-consumption/" onclick="javascript:window.open(this.dataset.href, '', 'menubar=no,toolbar=no,resizable=yes,scrollbars=yes,height=600,width=600');return false;">
						<span class="icon"> <svg version="1.1" id="Layer_1" xmlns="http://www.w3.org/2000/svg" xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" width="15px" height="14.1px" viewBox="-301.4 387.5 15 14.1" enable-background="new -301.4 387.5 15 14.1" xml:space="preserve"> <g id="XMLID_398_"> <path id="XMLID_399_" fill="#FFFFFF" d="M-296.2,401.6c0-3.2,0-6.3,0-9.5h0.1c1,0,2,0,2.9,0c0.1,0,0.1,0,0.1,0.1c0,0.4,0,0.8,0,1.2 c0.1-0.1,0.2-0.3,0.3-0.4c0.5-0.7,1.2-1,2.1-1.1c0.8-0.1,1.5,0,2.2,0.3c0.7,0.4,1.2,0.8,1.5,1.4c0.4,0.8,0.6,1.7,0.6,2.5 c0,1.8,0,3.6,0,5.4v0.1c-1.1,0-2.1,0-3.2,0c0-0.1,0-0.1,0-0.2c0-1.6,0-3.2,0-4.8c0-0.4,0-0.8-0.2-1.2c-0.2-0.7-0.8-1-1.6-1 c-0.8,0.1-1.3,0.5-1.6,1.2c-0.1,0.2-0.1,0.5-0.1,0.8c0,1.7,0,3.4,0,5.1c0,0.2,0,0.2-0.2,0.2c-1,0-1.9,0-2.9,0 C-296.1,401.6-296.2,401.6-296.2,401.6z"></path> <path id="XMLID_400_" fill="#FFFFFF" d="M-298,401.6L-298,401.6c-1.1,0-2.1,0-3,0c-0.1,0-0.1,0-0.1-0.1c0-3.1,0-6.1,0-9.2 c0-0.1,0-0.1,0.1-0.1c1,0,2,0,2.9,0h0.1C-298,395.3-298,398.5-298,401.6z"></path> <path id="XMLID_401_" fill="#FFFFFF" d="M-299.6,390.9c-0.7-0.1-1.2-0.3-1.6-0.8c-0.5-0.8-0.2-2.1,1-2.4c0.6-0.2,1.2-0.1,1.8,0.2 c0.5,0.4,0.7,0.9,0.6,1.5c-0.1,0.7-0.5,1.1-1.1,1.3C-299.1,390.8-299.4,390.8-299.6,390.9L-299.6,390.9z"></path> </g> </svg> </span>
						<span class="simplesocialtxt">Share</span> </button>
<button class="ssb_gplus-icon" data-href="https://plus.google.com/share?url=https://machinelearningmastery.com/how-to-develop-lstm-models-for-multi-step-time-series-forecasting-of-household-power-consumption/" onclick="javascript:window.open(this.dataset.href, '', 'menubar=no,toolbar=no,resizable=yes,scrollbars=yes,height=600,width=600');return false;">
						<span class="icon"><svg version="1.1" xmlns="http://www.w3.org/2000/svg" preserveAspectRatio="xMidYMid meet" width="30px" height="18px" viewBox="-10 -6 60 36" class="ozWidgetRioButtonSvg_ ozWidgetRioButtonPlusOne_"><path d="M30 7h-3v4h-4v3h4v4h3v-4h4v-3h-4V7z"></path><path d="M11 9.9v4h5.4C16 16.3 14 18 11 18c-3.3 0-5.9-2.8-5.9-6S7.7 6 11 6c1.5 0 2.8.5 3.8 1.5l2.9-2.9C15.9 3 13.7 2 11 2 5.5 2 1 6.5 1 12s4.5 10 10 10c5.8 0 9.6-4.1 9.6-9.8 0-.7-.1-1.5-.2-2.2H11z"></path></svg></span>
						<span class="simplesocialtxt">Google Plus </span></button>
</div>
	</section><!-- /.entry -->
	<div class="fix"></div>
<aside id="post-author">
	<div class="profile-image"><img alt="" src="How%20to%20Develop%20LSTM%20Models%20for%20Multi-Step%20Time%20Series%20Forecasting%20of%20Household%20Power%20Consumption_fichiers/1d75d46040c28497f0dee5d8e100db37_003.jpg" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=160&amp;d=mm&amp;r=g 2x" class="avatar avatar-80 photo" width="80" height="80"></div>
	<div class="profile-content">
		<h4>About Jason Brownlee</h4>
		Jason Brownlee, PhD is a machine learning specialist who teaches 
developers how to get results with modern machine learning methods via 
hands-on tutorials.				<div class="profile-link">
			<a href="https://machinelearningmastery.com/author/jasonb/">
				View all posts by Jason Brownlee <span class="meta-nav">→</span>			</a>
		</div><!--#profile-link-->
			</div>
	<div class="fix"></div>
</aside>
<div class="post-utility"></div>
</article><!-- /.post -->
	        <div class="post-entries">
	            <div class="nav-prev fl"><a href="https://machinelearningmastery.com/how-to-develop-convolutional-neural-networks-for-multi-step-time-series-forecasting/" rel="prev"><i class="fa fa-angle-left"></i> How to Develop Convolutional Neural Networks for Multi-Step Time Series Forecasting</a></div>
	            <div class="nav-next fr"><a href="https://machinelearningmastery.com/how-to-load-visualize-and-explore-a-complex-multivariate-multistep-time-series-forecasting-dataset/" rel="next">How to Load, Visualize, and Explore a Complex Multivariate Multistep Time Series Forecasting Dataset <i class="fa fa-angle-right"></i></a></div>
	            <div class="fix"></div>
	        </div>

		<div id="comments">		 	<h3 id="comments-title">45 Responses to <em>How to Develop LSTM Models for Multi-Step Time Series Forecasting of Household Power Consumption</em></h3>
		 	<ol class="commentlist">
				
		<li id="comment-451187" class="comment even thread-even depth-1 parent">

	      	<div id="li-comment-451187" class="comment-container">

					                <div class="avatar"><img alt="" src="How%20to%20Develop%20LSTM%20Models%20for%20Multi-Step%20Time%20Series%20Forecasting%20of%20Household%20Power%20Consumption_fichiers/374d1a98c46b3fcdb98c8b77597ebe68.jpg" srcset="https://secure.gravatar.com/avatar/374d1a98c46b3fcdb98c8b77597ebe68?s=80&amp;d=mm&amp;r=g 2x" class="avatar avatar-40 photo" width="40" height="40"></div>
	            
		      	<div class="comment-head">

	                <span class="name">Konrad</span>
	                <span class="date">October 10, 2018 at 8:12 am</span>
	                <span class="perma"><a href="https://machinelearningmastery.com/how-to-develop-lstm-models-for-multi-step-time-series-forecasting-of-household-power-consumption/#comment-451187" title="Direct link to this comment">#</a></span>
	                <span class="edit"></span>

				</div><!-- /.comment-head -->

		   		<div class="comment-entry">

				<p>Hi Jason,</p>
<p>Thanks for another great article. </p>
<p>I’ve got a question about your thoughts about Attention based 
networks and how do they compere to LSTMs. I heard many voices in favor 
of the first ones, but I would like to know how this looks in real 
situations and not competitions-world <img draggable="false" class="emoji" alt="😉" src="How%20to%20Develop%20LSTM%20Models%20for%20Multi-Step%20Time%20Series%20Forecasting%20of%20Household%20Power%20Consumption_fichiers/1f609.svg"></p>
<p>Thanks,<br>
Konrad</p>

				
	                <div class="reply">
	                    <a rel="nofollow" class="comment-reply-link" href="#comment-451187" onclick='return addComment.moveForm( "comment-451187", "451187", "respond", "6286" )' aria-label="Reply to Konrad">Reply</a>	                </div><!-- /.reply -->

				</div><!-- /comment-entry -->

			</div><!-- /.comment-container -->

	<ul class="children">

		<li id="comment-451209" class="comment byuser comment-author-jasonb bypostauthor odd alt depth-2 parent">

	      	<div id="li-comment-451209" class="comment-container">

					                <div class="avatar"><img alt="" src="How%20to%20Develop%20LSTM%20Models%20for%20Multi-Step%20Time%20Series%20Forecasting%20of%20Household%20Power%20Consumption_fichiers/1d75d46040c28497f0dee5d8e100db37_002.jpg" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" class="avatar avatar-40 photo" width="40" height="40"></div>
	            
		      	<div class="comment-head">

	                <span class="name"><a href="http://machinelearningmastery.com/" rel="external nofollow" class="url">Jason Brownlee</a></span>
	                <span class="date">October 10, 2018 at 2:58 pm</span>
	                <span class="perma"><a href="https://machinelearningmastery.com/how-to-develop-lstm-models-for-multi-step-time-series-forecasting-of-household-power-consumption/#comment-451209" title="Direct link to this comment">#</a></span>
	                <span class="edit"></span>

				</div><!-- /.comment-head -->

		   		<div class="comment-entry">

				<p>Attention-based models can offer a lot of benefit on challenging sequence prediction problems.</p>
<p>I have not used attention for time series forecasting though, sorry. Id on’t have good off the cuff advice.</p>

				
	                <div class="reply">
	                    <a rel="nofollow" class="comment-reply-link" href="#comment-451209" onclick='return addComment.moveForm( "comment-451209", "451209", "respond", "6286" )' aria-label="Reply to Jason Brownlee">Reply</a>	                </div><!-- /.reply -->

				</div><!-- /comment-entry -->

			</div><!-- /.comment-container -->

	<ul class="children">

		<li id="comment-451277" class="comment even depth-3">

	      	<div id="li-comment-451277" class="comment-container">

					                <div class="avatar"><img alt="" src="How%20to%20Develop%20LSTM%20Models%20for%20Multi-Step%20Time%20Series%20Forecasting%20of%20Household%20Power%20Consumption_fichiers/374d1a98c46b3fcdb98c8b77597ebe68.jpg" srcset="https://secure.gravatar.com/avatar/374d1a98c46b3fcdb98c8b77597ebe68?s=80&amp;d=mm&amp;r=g 2x" class="avatar avatar-40 photo" width="40" height="40"></div>
	            
		      	<div class="comment-head">

	                <span class="name">Konrad</span>
	                <span class="date">October 11, 2018 at 6:05 am</span>
	                <span class="perma"><a href="https://machinelearningmastery.com/how-to-develop-lstm-models-for-multi-step-time-series-forecasting-of-household-power-consumption/#comment-451277" title="Direct link to this comment">#</a></span>
	                <span class="edit"></span>

				</div><!-- /.comment-head -->

		   		<div class="comment-entry">

				<p>Ok, sure, thanks for reply! <img draggable="false" class="emoji" alt="🙂" src="How%20to%20Develop%20LSTM%20Models%20for%20Multi-Step%20Time%20Series%20Forecasting%20of%20Household%20Power%20Consumption_fichiers/1f642.svg"></p>

				
	                <div class="reply">
	                    <a rel="nofollow" class="comment-reply-link" href="#comment-451277" onclick='return addComment.moveForm( "comment-451277", "451277", "respond", "6286" )' aria-label="Reply to Konrad">Reply</a>	                </div><!-- /.reply -->

				</div><!-- /comment-entry -->

			</div><!-- /.comment-container -->

	</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->

		<li id="comment-451436" class="comment odd alt thread-odd thread-alt depth-1 parent">

	      	<div id="li-comment-451436" class="comment-container">

					                <div class="avatar"><img alt="" src="How%20to%20Develop%20LSTM%20Models%20for%20Multi-Step%20Time%20Series%20Forecasting%20of%20Household%20Power%20Consumption_fichiers/1f0788916a9fa130b449673180dc9fa6.jpg" srcset="https://secure.gravatar.com/avatar/1f0788916a9fa130b449673180dc9fa6?s=80&amp;d=mm&amp;r=g 2x" class="avatar avatar-40 photo" width="40" height="40"></div>
	            
		      	<div class="comment-head">

	                <span class="name">shamsul</span>
	                <span class="date">October 12, 2018 at 1:03 pm</span>
	                <span class="perma"><a href="https://machinelearningmastery.com/how-to-develop-lstm-models-for-multi-step-time-series-forecasting-of-household-power-consumption/#comment-451436" title="Direct link to this comment">#</a></span>
	                <span class="edit"></span>

				</div><!-- /.comment-head -->

		   		<div class="comment-entry">

				<p># model.add(LSTM(200, activation=’relu’, input_shape=(n_timesteps, n_features)))<br>
# model.add(Dense(100, activation=’relu’))</p>
<p>how do we choose LSTM unit and dense unit? for example, here 200 
units for LSTM and 100 units for Dense have been used.  is there any 
formula out there? should we guess? </p>
<p>it would be great if you could explain!  Thanks in advance.</p>

				
	                <div class="reply">
	                    <a rel="nofollow" class="comment-reply-link" href="#comment-451436" onclick='return addComment.moveForm( "comment-451436", "451436", "respond", "6286" )' aria-label="Reply to shamsul">Reply</a>	                </div><!-- /.reply -->

				</div><!-- /comment-entry -->

			</div><!-- /.comment-container -->

	<ul class="children">

		<li id="comment-451514" class="comment byuser comment-author-jasonb bypostauthor even depth-2">

	      	<div id="li-comment-451514" class="comment-container">

					                <div class="avatar"><img alt="" src="How%20to%20Develop%20LSTM%20Models%20for%20Multi-Step%20Time%20Series%20Forecasting%20of%20Household%20Power%20Consumption_fichiers/1d75d46040c28497f0dee5d8e100db37_002.jpg" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" class="avatar avatar-40 photo" width="40" height="40"></div>
	            
		      	<div class="comment-head">

	                <span class="name"><a href="http://machinelearningmastery.com/" rel="external nofollow" class="url">Jason Brownlee</a></span>
	                <span class="date">October 13, 2018 at 6:07 am</span>
	                <span class="perma"><a href="https://machinelearningmastery.com/how-to-develop-lstm-models-for-multi-step-time-series-forecasting-of-household-power-consumption/#comment-451514" title="Direct link to this comment">#</a></span>
	                <span class="edit"></span>

				</div><!-- /.comment-head -->

		   		<div class="comment-entry">

				<p>Trial and error. I explain more here:<br>
<a href="https://machinelearningmastery.com/faq/single-faq/how-many-layers-and-nodes-do-i-need-in-my-neural-network" rel="nofollow">https://machinelearningmastery.com/faq/single-faq/how-many-layers-and-nodes-do-i-need-in-my-neural-network</a></p>

				
	                <div class="reply">
	                    <a rel="nofollow" class="comment-reply-link" href="#comment-451514" onclick='return addComment.moveForm( "comment-451514", "451514", "respond", "6286" )' aria-label="Reply to Jason Brownlee">Reply</a>	                </div><!-- /.reply -->

				</div><!-- /comment-entry -->

			</div><!-- /.comment-container -->

	</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->

		<li id="comment-451488" class="comment odd alt thread-even depth-1 parent">

	      	<div id="li-comment-451488" class="comment-container">

					                <div class="avatar"><img alt="" src="How%20to%20Develop%20LSTM%20Models%20for%20Multi-Step%20Time%20Series%20Forecasting%20of%20Household%20Power%20Consumption_fichiers/e9483875b9006c72e3a202b18739b6f5.jpg" srcset="https://secure.gravatar.com/avatar/e9483875b9006c72e3a202b18739b6f5?s=80&amp;d=mm&amp;r=g 2x" class="avatar avatar-40 photo" width="40" height="40"></div>
	            
		      	<div class="comment-head">

	                <span class="name">NoobAtMl</span>
	                <span class="date">October 12, 2018 at 11:08 pm</span>
	                <span class="perma"><a href="https://machinelearningmastery.com/how-to-develop-lstm-models-for-multi-step-time-series-forecasting-of-household-power-consumption/#comment-451488" title="Direct link to this comment">#</a></span>
	                <span class="edit"></span>

				</div><!-- /.comment-head -->

		   		<div class="comment-entry">

				<p>How to calculate the accuracy of the Convolutional LSTM model of 
the electricity consumption dataset. Can you please provide the code for
 that?</p>

				
	                <div class="reply">
	                    <a rel="nofollow" class="comment-reply-link" href="#comment-451488" onclick='return addComment.moveForm( "comment-451488", "451488", "respond", "6286" )' aria-label="Reply to NoobAtMl">Reply</a>	                </div><!-- /.reply -->

				</div><!-- /comment-entry -->

			</div><!-- /.comment-container -->

	<ul class="children">

		<li id="comment-451519" class="comment byuser comment-author-jasonb bypostauthor even depth-2 parent">

	      	<div id="li-comment-451519" class="comment-container">

					                <div class="avatar"><img alt="" src="How%20to%20Develop%20LSTM%20Models%20for%20Multi-Step%20Time%20Series%20Forecasting%20of%20Household%20Power%20Consumption_fichiers/1d75d46040c28497f0dee5d8e100db37_002.jpg" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" class="avatar avatar-40 photo" width="40" height="40"></div>
	            
		      	<div class="comment-head">

	                <span class="name"><a href="http://machinelearningmastery.com/" rel="external nofollow" class="url">Jason Brownlee</a></span>
	                <span class="date">October 13, 2018 at 6:13 am</span>
	                <span class="perma"><a href="https://machinelearningmastery.com/how-to-develop-lstm-models-for-multi-step-time-series-forecasting-of-household-power-consumption/#comment-451519" title="Direct link to this comment">#</a></span>
	                <span class="edit"></span>

				</div><!-- /.comment-head -->

		   		<div class="comment-entry">

				<p>It is a regression problem, we cannot calculate accuracy for a regression problem.</p>

				
	                <div class="reply">
	                    <a rel="nofollow" class="comment-reply-link" href="#comment-451519" onclick='return addComment.moveForm( "comment-451519", "451519", "respond", "6286" )' aria-label="Reply to Jason Brownlee">Reply</a>	                </div><!-- /.reply -->

				</div><!-- /comment-entry -->

			</div><!-- /.comment-container -->

	<ul class="children">

		<li id="comment-453035" class="comment odd alt depth-3 parent">

	      	<div id="li-comment-453035" class="comment-container">

					                <div class="avatar"><img alt="" src="How%20to%20Develop%20LSTM%20Models%20for%20Multi-Step%20Time%20Series%20Forecasting%20of%20Household%20Power%20Consumption_fichiers/e9c8a6c0ae0a81f222717e326dce7c1a.jpg" srcset="https://secure.gravatar.com/avatar/e9c8a6c0ae0a81f222717e326dce7c1a?s=80&amp;d=mm&amp;r=g 2x" class="avatar avatar-40 photo" width="40" height="40"></div>
	            
		      	<div class="comment-head">

	                <span class="name">luo zhongbin</span>
	                <span class="date">October 29, 2018 at 2:14 pm</span>
	                <span class="perma"><a href="https://machinelearningmastery.com/how-to-develop-lstm-models-for-multi-step-time-series-forecasting-of-household-power-consumption/#comment-453035" title="Direct link to this comment">#</a></span>
	                <span class="edit"></span>

				</div><!-- /.comment-head -->

		   		<div class="comment-entry">

				<p>Is it possible to calculate accuracy with mse?</p>

				
	                <div class="reply">
	                    <a rel="nofollow" class="comment-reply-link" href="#comment-453035" onclick='return addComment.moveForm( "comment-453035", "453035", "respond", "6286" )' aria-label="Reply to luo zhongbin">Reply</a>	                </div><!-- /.reply -->

				</div><!-- /comment-entry -->

			</div><!-- /.comment-container -->

	<ul class="children">

		<li id="comment-453086" class="comment byuser comment-author-jasonb bypostauthor even depth-4">

	      	<div id="li-comment-453086" class="comment-container">

					                <div class="avatar"><img alt="" src="How%20to%20Develop%20LSTM%20Models%20for%20Multi-Step%20Time%20Series%20Forecasting%20of%20Household%20Power%20Consumption_fichiers/1d75d46040c28497f0dee5d8e100db37_002.jpg" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" class="avatar avatar-40 photo" width="40" height="40"></div>
	            
		      	<div class="comment-head">

	                <span class="name"><a href="http://machinelearningmastery.com/" rel="external nofollow" class="url">Jason Brownlee</a></span>
	                <span class="date">October 30, 2018 at 5:51 am</span>
	                <span class="perma"><a href="https://machinelearningmastery.com/how-to-develop-lstm-models-for-multi-step-time-series-forecasting-of-household-power-consumption/#comment-453086" title="Direct link to this comment">#</a></span>
	                <span class="edit"></span>

				</div><!-- /.comment-head -->

		   		<div class="comment-entry">

				<p>No, MSE is a calculation of error for regression.Accuracy is a calculation of performance for classification problems.</p>
<p>More details here:<br>
<a href="https://machinelearningmastery.com/classification-versus-regression-in-machine-learning/" rel="nofollow">https://machinelearningmastery.com/classification-versus-regression-in-machine-learning/</a></p>

				
	                <div class="reply">
	                    <a rel="nofollow" class="comment-reply-link" href="#comment-453086" onclick='return addComment.moveForm( "comment-453086", "453086", "respond", "6286" )' aria-label="Reply to Jason Brownlee">Reply</a>	                </div><!-- /.reply -->

				</div><!-- /comment-entry -->

			</div><!-- /.comment-container -->

	</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->

		<li id="comment-451523" class="comment odd alt thread-odd thread-alt depth-1 parent">

	      	<div id="li-comment-451523" class="comment-container">

					                <div class="avatar"><img alt="" src="How%20to%20Develop%20LSTM%20Models%20for%20Multi-Step%20Time%20Series%20Forecasting%20of%20Household%20Power%20Consumption_fichiers/d8776005e0f26c7a79b3c8fa208f0a0f.jpg" srcset="https://secure.gravatar.com/avatar/d8776005e0f26c7a79b3c8fa208f0a0f?s=80&amp;d=mm&amp;r=g 2x" class="avatar avatar-40 photo" width="40" height="40"></div>
	            
		      	<div class="comment-head">

	                <span class="name">Troy</span>
	                <span class="date">October 13, 2018 at 7:07 am</span>
	                <span class="perma"><a href="https://machinelearningmastery.com/how-to-develop-lstm-models-for-multi-step-time-series-forecasting-of-household-power-consumption/#comment-451523" title="Direct link to this comment">#</a></span>
	                <span class="edit"></span>

				</div><!-- /.comment-head -->

		   		<div class="comment-entry">

				<p>Hey Jason,</p>
<p>Great article.  I’m trying to understand how you have your encoder decoder model vs. the official Keras example below:</p>
<p><a href="https://blog.keras.io/a-ten-minute-introduction-to-sequence-to-sequence-learning-in-keras.html" rel="nofollow">https://blog.keras.io/a-ten-minute-introduction-to-sequence-to-sequence-learning-in-keras.html</a></p>
<p>I also worked through this example from JEddy92 where he adopted the Keras method to do time series analysis:</p>
<p><a href="https://github.com/JEddy92/TimeSeries_Seq2Seq/blob/master/notebooks/TS_Seq2Seq_Intro.ipynb" rel="nofollow">https://github.com/JEddy92/TimeSeries_Seq2Seq/blob/master/notebooks/TS_Seq2Seq_Intro.ipynb</a></p>
<p>I’ve tried building the Keras model as similar to your model as 
possible and running both over the same data.  Your model seems 
significantly different from their example, and I can’t quite reconcile 
the differences.  </p>
<p>I actually can’t get the Keras model for sequence to sequence to 
produce any good results for time series analysis.  Running 1000 epochs 
and I got RMSE of 466.192.  Have you built any time series models using 
the approach they are trying? Any ideas why this approach is so much 
harder to train than the one you have above?</p>

				
	                <div class="reply">
	                    <a rel="nofollow" class="comment-reply-link" href="#comment-451523" onclick='return addComment.moveForm( "comment-451523", "451523", "respond", "6286" )' aria-label="Reply to Troy">Reply</a>	                </div><!-- /.reply -->

				</div><!-- /comment-entry -->

			</div><!-- /.comment-container -->

	<ul class="children">

		<li id="comment-451574" class="comment byuser comment-author-jasonb bypostauthor even depth-2">

	      	<div id="li-comment-451574" class="comment-container">

					                <div class="avatar"><img alt="" src="How%20to%20Develop%20LSTM%20Models%20for%20Multi-Step%20Time%20Series%20Forecasting%20of%20Household%20Power%20Consumption_fichiers/1d75d46040c28497f0dee5d8e100db37_002.jpg" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" class="avatar avatar-40 photo" width="40" height="40"></div>
	            
		      	<div class="comment-head">

	                <span class="name"><a href="http://machinelearningmastery.com/" rel="external nofollow" class="url">Jason Brownlee</a></span>
	                <span class="date">October 14, 2018 at 5:56 am</span>
	                <span class="perma"><a href="https://machinelearningmastery.com/how-to-develop-lstm-models-for-multi-step-time-series-forecasting-of-household-power-consumption/#comment-451574" title="Direct link to this comment">#</a></span>
	                <span class="edit"></span>

				</div><!-- /.comment-head -->

		   		<div class="comment-entry">

				<p>I use a simple autoencoder LSTM approach which seems to perform 
better in my tests. The difference is learning an internal 
representation (autoencoder) vs copying state from the encoder. I 
explain the latter more here:<br>
<a href="https://machinelearningmastery.com/develop-encoder-decoder-model-sequence-sequence-prediction-keras/" rel="nofollow">https://machinelearningmastery.com/develop-encoder-decoder-model-sequence-sequence-prediction-keras/</a></p>
<p>I don’t know about the post you’ve linked. I can report better performance in general with CNNs and hybrid models.</p>

				
	                <div class="reply">
	                    <a rel="nofollow" class="comment-reply-link" href="#comment-451574" onclick='return addComment.moveForm( "comment-451574", "451574", "respond", "6286" )' aria-label="Reply to Jason Brownlee">Reply</a>	                </div><!-- /.reply -->

				</div><!-- /comment-entry -->

			</div><!-- /.comment-container -->

	</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->

		<li id="comment-451885" class="comment odd alt thread-even depth-1 parent">

	      	<div id="li-comment-451885" class="comment-container">

					                <div class="avatar"><img alt="" src="How%20to%20Develop%20LSTM%20Models%20for%20Multi-Step%20Time%20Series%20Forecasting%20of%20Household%20Power%20Consumption_fichiers/d14639a6aef18968ead1f0db2b018d6c.jpg" srcset="https://secure.gravatar.com/avatar/d14639a6aef18968ead1f0db2b018d6c?s=80&amp;d=mm&amp;r=g 2x" class="avatar avatar-40 photo" width="40" height="40"></div>
	            
		      	<div class="comment-head">

	                <span class="name">JiaojiaoFu</span>
	                <span class="date">October 17, 2018 at 2:33 pm</span>
	                <span class="perma"><a href="https://machinelearningmastery.com/how-to-develop-lstm-models-for-multi-step-time-series-forecasting-of-household-power-consumption/#comment-451885" title="Direct link to this comment">#</a></span>
	                <span class="edit"></span>

				</div><!-- /.comment-head -->

		   		<div class="comment-entry">

				<p>Multivariate prediction is which of these variables is predicted?
 I did not see the introduction of this part. Is the default giving the 
first variable of multiple variables?</p>

				
	                <div class="reply">
	                    <a rel="nofollow" class="comment-reply-link" href="#comment-451885" onclick='return addComment.moveForm( "comment-451885", "451885", "respond", "6286" )' aria-label="Reply to JiaojiaoFu">Reply</a>	                </div><!-- /.reply -->

				</div><!-- /comment-entry -->

			</div><!-- /.comment-container -->

	<ul class="children">

		<li id="comment-451941" class="comment byuser comment-author-jasonb bypostauthor even depth-2">

	      	<div id="li-comment-451941" class="comment-container">

					                <div class="avatar"><img alt="" src="How%20to%20Develop%20LSTM%20Models%20for%20Multi-Step%20Time%20Series%20Forecasting%20of%20Household%20Power%20Consumption_fichiers/1d75d46040c28497f0dee5d8e100db37_002.jpg" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" class="avatar avatar-40 photo" width="40" height="40"></div>
	            
		      	<div class="comment-head">

	                <span class="name"><a href="http://machinelearningmastery.com/" rel="external nofollow" class="url">Jason Brownlee</a></span>
	                <span class="date">October 18, 2018 at 6:23 am</span>
	                <span class="perma"><a href="https://machinelearningmastery.com/how-to-develop-lstm-models-for-multi-step-time-series-forecasting-of-household-power-consumption/#comment-451941" title="Direct link to this comment">#</a></span>
	                <span class="edit"></span>

				</div><!-- /.comment-head -->

		   		<div class="comment-entry">

				<p>Some of the models in the above tutorials take multivariate input and make a multi-step univariate prediction.</p>

				
	                <div class="reply">
	                    <a rel="nofollow" class="comment-reply-link" href="#comment-451941" onclick='return addComment.moveForm( "comment-451941", "451941", "respond", "6286" )' aria-label="Reply to Jason Brownlee">Reply</a>	                </div><!-- /.reply -->

				</div><!-- /comment-entry -->

			</div><!-- /.comment-container -->

	</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->

		<li id="comment-452034" class="comment odd alt thread-odd thread-alt depth-1 parent">

	      	<div id="li-comment-452034" class="comment-container">

					                <div class="avatar"><img alt="" src="How%20to%20Develop%20LSTM%20Models%20for%20Multi-Step%20Time%20Series%20Forecasting%20of%20Household%20Power%20Consumption_fichiers/b5d3f204b81b42a283e23dafe6ecbed9.jpg" srcset="https://secure.gravatar.com/avatar/b5d3f204b81b42a283e23dafe6ecbed9?s=80&amp;d=mm&amp;r=g 2x" class="avatar avatar-40 photo" width="40" height="40"></div>
	            
		      	<div class="comment-head">

	                <span class="name">Hasan</span>
	                <span class="date">October 19, 2018 at 1:27 am</span>
	                <span class="perma"><a href="https://machinelearningmastery.com/how-to-develop-lstm-models-for-multi-step-time-series-forecasting-of-household-power-consumption/#comment-452034" title="Direct link to this comment">#</a></span>
	                <span class="edit"></span>

				</div><!-- /.comment-head -->

		   		<div class="comment-entry">

				<p>Hi Jason,</p>
<p>Great article, thanks. </p>
<p>I am trying out image (spectrogram) input sequences for classification output.<br>
My network looks similar to “CNN-LSTM Encoder-Decoder Model With 
Univariate Input” with the difference that I am using 
TimeDistributed(Conv2D) layers and Multivariate Input.<br>
Your examples do not use TimeDistributed Conv layers , but I was 
wondering if you have any thoughts ? My intention is to pass every 
sample of my batch individually through the Conv layer and collectively 
through the LSTM decoder. This I think would allow me to not have to 
explicitly preprocess my input data by collecting all samples 
representing a sequence together.<br>
I am not sure if that would work okay, any comments would be a great help.<br>
Thanks</p>

				
	                <div class="reply">
	                    <a rel="nofollow" class="comment-reply-link" href="#comment-452034" onclick='return addComment.moveForm( "comment-452034", "452034", "respond", "6286" )' aria-label="Reply to Hasan">Reply</a>	                </div><!-- /.reply -->

				</div><!-- /comment-entry -->

			</div><!-- /.comment-container -->

	<ul class="children">

		<li id="comment-452067" class="comment byuser comment-author-jasonb bypostauthor even depth-2">

	      	<div id="li-comment-452067" class="comment-container">

					                <div class="avatar"><img alt="" src="How%20to%20Develop%20LSTM%20Models%20for%20Multi-Step%20Time%20Series%20Forecasting%20of%20Household%20Power%20Consumption_fichiers/1d75d46040c28497f0dee5d8e100db37_002.jpg" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" class="avatar avatar-40 photo" width="40" height="40"></div>
	            
		      	<div class="comment-head">

	                <span class="name"><a href="http://machinelearningmastery.com/" rel="external nofollow" class="url">Jason Brownlee</a></span>
	                <span class="date">October 19, 2018 at 6:08 am</span>
	                <span class="perma"><a href="https://machinelearningmastery.com/how-to-develop-lstm-models-for-multi-step-time-series-forecasting-of-household-power-consumption/#comment-452067" title="Direct link to this comment">#</a></span>
	                <span class="edit"></span>

				</div><!-- /.comment-head -->

		   		<div class="comment-entry">

				<p>You can adapt the above example to use a time distributed conv. </p>
<p>Perhaps try it and see, use results to guide you.</p>

				
	                <div class="reply">
	                    <a rel="nofollow" class="comment-reply-link" href="#comment-452067" onclick='return addComment.moveForm( "comment-452067", "452067", "respond", "6286" )' aria-label="Reply to Jason Brownlee">Reply</a>	                </div><!-- /.reply -->

				</div><!-- /comment-entry -->

			</div><!-- /.comment-container -->

	</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->

		<li id="comment-452806" class="comment odd alt thread-even depth-1 parent">

	      	<div id="li-comment-452806" class="comment-container">

					                <div class="avatar"><img alt="" src="How%20to%20Develop%20LSTM%20Models%20for%20Multi-Step%20Time%20Series%20Forecasting%20of%20Household%20Power%20Consumption_fichiers/b29d54b905970c2cb544a82e5ea910c4.jpg" srcset="https://secure.gravatar.com/avatar/b29d54b905970c2cb544a82e5ea910c4?s=80&amp;d=mm&amp;r=g 2x" class="avatar avatar-40 photo" width="40" height="40"></div>
	            
		      	<div class="comment-head">

	                <span class="name">Silvia Maria</span>
	                <span class="date">October 26, 2018 at 7:01 pm</span>
	                <span class="perma"><a href="https://machinelearningmastery.com/how-to-develop-lstm-models-for-multi-step-time-series-forecasting-of-household-power-consumption/#comment-452806" title="Direct link to this comment">#</a></span>
	                <span class="edit"></span>

				</div><!-- /.comment-head -->

		   		<div class="comment-entry">

				<p>Hi Jason,</p>
<p>another great article, thank you… and this time it is exactly what I needed for my univariate time series forecasting project! </p>
<p>I learned so much from your tutorials and your book, I cannot be more grateful <img draggable="false" class="emoji" alt="🙂" src="How%20to%20Develop%20LSTM%20Models%20for%20Multi-Step%20Time%20Series%20Forecasting%20of%20Household%20Power%20Consumption_fichiers/1f642.svg"></p>
<p>I wanted to ask you a couple of questions, with reference to both proposed models (Vanilla LSTM and Encoder-Decoder):</p>
<p>1) If I wanted to make the (Vanilla LSTM / Encoder-Decoder) networks deeper, how should I insert more layers?</p>
<p>2) Statefulness, i.e., memory between batches: here you are using 
stateless networks, I guess you do that under the hypothesis that a 
single training batch contains all the series variability timescales we 
want to model, is that right? </p>
<p>If I wanted to make the models stateful to see if statefulness leads 
to better results with my series, how should I do that? I’m not sure in 
which layers I should set return_sequences = True. </p>
<p>Tank you very much for your attention, best,</p>
<p>Silvia</p>

				
	                <div class="reply">
	                    <a rel="nofollow" class="comment-reply-link" href="#comment-452806" onclick='return addComment.moveForm( "comment-452806", "452806", "respond", "6286" )' aria-label="Reply to Silvia Maria">Reply</a>	                </div><!-- /.reply -->

				</div><!-- /comment-entry -->

			</div><!-- /.comment-container -->

	<ul class="children">

		<li id="comment-452841" class="comment byuser comment-author-jasonb bypostauthor even depth-2">

	      	<div id="li-comment-452841" class="comment-container">

					                <div class="avatar"><img alt="" src="How%20to%20Develop%20LSTM%20Models%20for%20Multi-Step%20Time%20Series%20Forecasting%20of%20Household%20Power%20Consumption_fichiers/1d75d46040c28497f0dee5d8e100db37_002.jpg" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" class="avatar avatar-40 photo" width="40" height="40"></div>
	            
		      	<div class="comment-head">

	                <span class="name"><a href="http://machinelearningmastery.com/" rel="external nofollow" class="url">Jason Brownlee</a></span>
	                <span class="date">October 27, 2018 at 5:58 am</span>
	                <span class="perma"><a href="https://machinelearningmastery.com/how-to-develop-lstm-models-for-multi-step-time-series-forecasting-of-household-power-consumption/#comment-452841" title="Direct link to this comment">#</a></span>
	                <span class="edit"></span>

				</div><!-- /.comment-head -->

		   		<div class="comment-entry">

				<p>Thanks.</p>
<p>Yes, you can make a model deeper by adding more layers.</p>
<p>Don’t worry about statefulness for now, it does not impact model skill in my experiments.</p>

				
	                <div class="reply">
	                    <a rel="nofollow" class="comment-reply-link" href="#comment-452841" onclick='return addComment.moveForm( "comment-452841", "452841", "respond", "6286" )' aria-label="Reply to Jason Brownlee">Reply</a>	                </div><!-- /.reply -->

				</div><!-- /comment-entry -->

			</div><!-- /.comment-container -->

	</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->

		<li id="comment-452885" class="comment odd alt thread-odd thread-alt depth-1 parent">

	      	<div id="li-comment-452885" class="comment-container">

					                <div class="avatar"><img alt="" src="How%20to%20Develop%20LSTM%20Models%20for%20Multi-Step%20Time%20Series%20Forecasting%20of%20Household%20Power%20Consumption_fichiers/b29d54b905970c2cb544a82e5ea910c4.jpg" srcset="https://secure.gravatar.com/avatar/b29d54b905970c2cb544a82e5ea910c4?s=80&amp;d=mm&amp;r=g 2x" class="avatar avatar-40 photo" width="40" height="40"></div>
	            
		      	<div class="comment-head">

	                <span class="name">Silvia Maria</span>
	                <span class="date">October 27, 2018 at 7:17 pm</span>
	                <span class="perma"><a href="https://machinelearningmastery.com/how-to-develop-lstm-models-for-multi-step-time-series-forecasting-of-household-power-consumption/#comment-452885" title="Direct link to this comment">#</a></span>
	                <span class="edit"></span>

				</div><!-- /.comment-head -->

		   		<div class="comment-entry">

				<p>Thank you for your prompt answer.<br>
Now, it is very clear to me how I can add more layers in the Vanilla 
case, but not so clear in the Encoder-Decoder case. Should I add layers 
in both the encoder and the decoder? Could you please give me an 
example? Thank you for your patience, best, Silvia</p>

				
	                <div class="reply">
	                    <a rel="nofollow" class="comment-reply-link" href="#comment-452885" onclick='return addComment.moveForm( "comment-452885", "452885", "respond", "6286" )' aria-label="Reply to Silvia Maria">Reply</a>	                </div><!-- /.reply -->

				</div><!-- /comment-entry -->

			</div><!-- /.comment-container -->

	<ul class="children">

		<li id="comment-452924" class="comment byuser comment-author-jasonb bypostauthor even depth-2">

	      	<div id="li-comment-452924" class="comment-container">

					                <div class="avatar"><img alt="" src="How%20to%20Develop%20LSTM%20Models%20for%20Multi-Step%20Time%20Series%20Forecasting%20of%20Household%20Power%20Consumption_fichiers/1d75d46040c28497f0dee5d8e100db37_002.jpg" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" class="avatar avatar-40 photo" width="40" height="40"></div>
	            
		      	<div class="comment-head">

	                <span class="name"><a href="http://machinelearningmastery.com/" rel="external nofollow" class="url">Jason Brownlee</a></span>
	                <span class="date">October 28, 2018 at 6:08 am</span>
	                <span class="perma"><a href="https://machinelearningmastery.com/how-to-develop-lstm-models-for-multi-step-time-series-forecasting-of-household-power-consumption/#comment-452924" title="Direct link to this comment">#</a></span>
	                <span class="edit"></span>

				</div><!-- /.comment-head -->

		   		<div class="comment-entry">

				<p>You can add more layers to the encoder or more layers to the decoder.</p>

				
	                <div class="reply">
	                    <a rel="nofollow" class="comment-reply-link" href="#comment-452924" onclick='return addComment.moveForm( "comment-452924", "452924", "respond", "6286" )' aria-label="Reply to Jason Brownlee">Reply</a>	                </div><!-- /.reply -->

				</div><!-- /comment-entry -->

			</div><!-- /.comment-container -->

	</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->

		<li id="comment-452979" class="comment odd alt thread-even depth-1 parent">

	      	<div id="li-comment-452979" class="comment-container">

					                <div class="avatar"><img alt="" src="How%20to%20Develop%20LSTM%20Models%20for%20Multi-Step%20Time%20Series%20Forecasting%20of%20Household%20Power%20Consumption_fichiers/7de504fa39e8724c3da6a386c7c2d35b.jpg" srcset="https://secure.gravatar.com/avatar/7de504fa39e8724c3da6a386c7c2d35b?s=80&amp;d=mm&amp;r=g 2x" class="avatar avatar-40 photo" width="40" height="40"></div>
	            
		      	<div class="comment-head">

	                <span class="name">Daniel</span>
	                <span class="date">October 29, 2018 at 1:27 am</span>
	                <span class="perma"><a href="https://machinelearningmastery.com/how-to-develop-lstm-models-for-multi-step-time-series-forecasting-of-household-power-consumption/#comment-452979" title="Direct link to this comment">#</a></span>
	                <span class="edit"></span>

				</div><!-- /.comment-head -->

		   		<div class="comment-entry">

				<p>Hi Jason, I am enjoying a lot these posts! I am trying to 
replicate the Encoder-Decoder LSTM Model With Multivariate Input, but 
instead of using daily data, I resampled the data to hourly values. The 
goal is to predict a full week of values at an hourly level.</p>
<p>I kept the rest of the model as is, except for the number of inputs 
(one week = 7*24) and the split_database, which now looks like this:</p>
<p>    train, test = data[32:24392], data[24392:34472]<br>
    plt.plot(train)<br>
    plt.show()<br>
    # restructure into windows of weekly data<br>
    train = array(split(train, len(train)/(7*24)))<br>
    print(‘[samples(weeks), timesteps(hours), features]: {}’.format(train.shape))<br>
    test = array(split(test, len(test)/(7*24)))<br>
    print(‘[samples(weeks), timestemps(hours), features]: {}’.format(test.shape))<br>
    return train, test</p>
<p>When I train the RNN, I get nan values in the loss function from the very beginning.</p>
<p>I tried to use a MinMaxScaler on the data, and also tried with other optimizers, but I wasn’t successful.</p>
<p>Any insights on this matter? Thanks a lot <img draggable="false" class="emoji" alt="🙂" src="How%20to%20Develop%20LSTM%20Models%20for%20Multi-Step%20Time%20Series%20Forecasting%20of%20Household%20Power%20Consumption_fichiers/1f642.svg"></p>

				
	                <div class="reply">
	                    <a rel="nofollow" class="comment-reply-link" href="#comment-452979" onclick='return addComment.moveForm( "comment-452979", "452979", "respond", "6286" )' aria-label="Reply to Daniel">Reply</a>	                </div><!-- /.reply -->

				</div><!-- /comment-entry -->

			</div><!-- /.comment-container -->

	<ul class="children">

		<li id="comment-453005" class="comment byuser comment-author-jasonb bypostauthor even depth-2 parent">

	      	<div id="li-comment-453005" class="comment-container">

					                <div class="avatar"><img alt="" src="How%20to%20Develop%20LSTM%20Models%20for%20Multi-Step%20Time%20Series%20Forecasting%20of%20Household%20Power%20Consumption_fichiers/1d75d46040c28497f0dee5d8e100db37_002.jpg" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" class="avatar avatar-40 photo" width="40" height="40"></div>
	            
		      	<div class="comment-head">

	                <span class="name"><a href="http://machinelearningmastery.com/" rel="external nofollow" class="url">Jason Brownlee</a></span>
	                <span class="date">October 29, 2018 at 5:58 am</span>
	                <span class="perma"><a href="https://machinelearningmastery.com/how-to-develop-lstm-models-for-multi-step-time-series-forecasting-of-household-power-consumption/#comment-453005" title="Direct link to this comment">#</a></span>
	                <span class="edit"></span>

				</div><!-- /.comment-head -->

		   		<div class="comment-entry">

				<p>Perhaps double check your input data does not have any nan’s.</p>

				
	                <div class="reply">
	                    <a rel="nofollow" class="comment-reply-link" href="#comment-453005" onclick='return addComment.moveForm( "comment-453005", "453005", "respond", "6286" )' aria-label="Reply to Jason Brownlee">Reply</a>	                </div><!-- /.reply -->

				</div><!-- /comment-entry -->

			</div><!-- /.comment-container -->

	<ul class="children">

		<li id="comment-453012" class="comment odd alt depth-3 parent">

	      	<div id="li-comment-453012" class="comment-container">

					                <div class="avatar"><img alt="" src="How%20to%20Develop%20LSTM%20Models%20for%20Multi-Step%20Time%20Series%20Forecasting%20of%20Household%20Power%20Consumption_fichiers/7de504fa39e8724c3da6a386c7c2d35b.jpg" srcset="https://secure.gravatar.com/avatar/7de504fa39e8724c3da6a386c7c2d35b?s=80&amp;d=mm&amp;r=g 2x" class="avatar avatar-40 photo" width="40" height="40"></div>
	            
		      	<div class="comment-head">

	                <span class="name">Daniel</span>
	                <span class="date">October 29, 2018 at 6:59 am</span>
	                <span class="perma"><a href="https://machinelearningmastery.com/how-to-develop-lstm-models-for-multi-step-time-series-forecasting-of-household-power-consumption/#comment-453012" title="Direct link to this comment">#</a></span>
	                <span class="edit"></span>

				</div><!-- /.comment-head -->

		   		<div class="comment-entry">

				<p>I did that, but there were no nans. I got it working using that 
MinMaxScaler, plus tanh activation functions instead of ReLu for the 
LSTM layers. Thanks a lot and keep up this awesome work you are doing.</p>

				
	                <div class="reply">
	                    <a rel="nofollow" class="comment-reply-link" href="#comment-453012" onclick='return addComment.moveForm( "comment-453012", "453012", "respond", "6286" )' aria-label="Reply to Daniel">Reply</a>	                </div><!-- /.reply -->

				</div><!-- /comment-entry -->

			</div><!-- /.comment-container -->

	<ul class="children">

		<li id="comment-453029" class="comment byuser comment-author-jasonb bypostauthor even depth-4">

	      	<div id="li-comment-453029" class="comment-container">

					                <div class="avatar"><img alt="" src="How%20to%20Develop%20LSTM%20Models%20for%20Multi-Step%20Time%20Series%20Forecasting%20of%20Household%20Power%20Consumption_fichiers/1d75d46040c28497f0dee5d8e100db37_002.jpg" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" class="avatar avatar-40 photo" width="40" height="40"></div>
	            
		      	<div class="comment-head">

	                <span class="name"><a href="http://machinelearningmastery.com/" rel="external nofollow" class="url">Jason Brownlee</a></span>
	                <span class="date">October 29, 2018 at 2:10 pm</span>
	                <span class="perma"><a href="https://machinelearningmastery.com/how-to-develop-lstm-models-for-multi-step-time-series-forecasting-of-household-power-consumption/#comment-453029" title="Direct link to this comment">#</a></span>
	                <span class="edit"></span>

				</div><!-- /.comment-head -->

		   		<div class="comment-entry">

				<p>Nice work.</p>

				
	                <div class="reply">
	                    <a rel="nofollow" class="comment-reply-link" href="#comment-453029" onclick='return addComment.moveForm( "comment-453029", "453029", "respond", "6286" )' aria-label="Reply to Jason Brownlee">Reply</a>	                </div><!-- /.reply -->

				</div><!-- /comment-entry -->

			</div><!-- /.comment-container -->

	</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->

		<li id="comment-453465" class="comment odd alt thread-odd thread-alt depth-1 parent">

	      	<div id="li-comment-453465" class="comment-container">

					                <div class="avatar"><img alt="" src="How%20to%20Develop%20LSTM%20Models%20for%20Multi-Step%20Time%20Series%20Forecasting%20of%20Household%20Power%20Consumption_fichiers/dca71fe07dc8ae9d26e3361eafef7c60.jpg" srcset="https://secure.gravatar.com/avatar/dca71fe07dc8ae9d26e3361eafef7c60?s=80&amp;d=mm&amp;r=g 2x" class="avatar avatar-40 photo" width="40" height="40"></div>
	            
		      	<div class="comment-head">

	                <span class="name">Allen</span>
	                <span class="date">November 2, 2018 at 9:05 pm</span>
	                <span class="perma"><a href="https://machinelearningmastery.com/how-to-develop-lstm-models-for-multi-step-time-series-forecasting-of-household-power-consumption/#comment-453465" title="Direct link to this comment">#</a></span>
	                <span class="edit"></span>

				</div><!-- /.comment-head -->

		   		<div class="comment-entry">

				<p>Hi Jason,</p>
<p>Thank you for the nice tutorial! It helps a lot! I noticed that you 
used differencing and scaling in the other tutorials for time series 
data, is there a reason why you don’t use it in this tutorial? Thank 
you!</p>

				
	                <div class="reply">
	                    <a rel="nofollow" class="comment-reply-link" href="#comment-453465" onclick='return addComment.moveForm( "comment-453465", "453465", "respond", "6286" )' aria-label="Reply to Allen">Reply</a>	                </div><!-- /.reply -->

				</div><!-- /comment-entry -->

			</div><!-- /.comment-container -->

	<ul class="children">

		<li id="comment-453519" class="comment byuser comment-author-jasonb bypostauthor even depth-2">

	      	<div id="li-comment-453519" class="comment-container">

					                <div class="avatar"><img alt="" src="How%20to%20Develop%20LSTM%20Models%20for%20Multi-Step%20Time%20Series%20Forecasting%20of%20Household%20Power%20Consumption_fichiers/1d75d46040c28497f0dee5d8e100db37_002.jpg" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" class="avatar avatar-40 photo" width="40" height="40"></div>
	            
		      	<div class="comment-head">

	                <span class="name"><a href="http://machinelearningmastery.com/" rel="external nofollow" class="url">Jason Brownlee</a></span>
	                <span class="date">November 3, 2018 at 7:02 am</span>
	                <span class="perma"><a href="https://machinelearningmastery.com/how-to-develop-lstm-models-for-multi-step-time-series-forecasting-of-household-power-consumption/#comment-453519" title="Direct link to this comment">#</a></span>
	                <span class="edit"></span>

				</div><!-- /.comment-head -->

		   		<div class="comment-entry">

				<p>To try to keep the example simple.</p>
<p>I do recommend scaling input and target variables in general. It will make life easier for the learning algorithm.</p>

				
	                <div class="reply">
	                    <a rel="nofollow" class="comment-reply-link" href="#comment-453519" onclick='return addComment.moveForm( "comment-453519", "453519", "respond", "6286" )' aria-label="Reply to Jason Brownlee">Reply</a>	                </div><!-- /.reply -->

				</div><!-- /comment-entry -->

			</div><!-- /.comment-container -->

	</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->

		<li id="comment-453817" class="comment odd alt thread-even depth-1 parent">

	      	<div id="li-comment-453817" class="comment-container">

					                <div class="avatar"><img alt="" src="How%20to%20Develop%20LSTM%20Models%20for%20Multi-Step%20Time%20Series%20Forecasting%20of%20Household%20Power%20Consumption_fichiers/6e22be886729290f801aafc9e34cff1f.jpg" srcset="https://secure.gravatar.com/avatar/6e22be886729290f801aafc9e34cff1f?s=80&amp;d=mm&amp;r=g 2x" class="avatar avatar-40 photo" width="40" height="40"></div>
	            
		      	<div class="comment-head">

	                <span class="name">Jose Rafael</span>
	                <span class="date">November 6, 2018 at 11:42 am</span>
	                <span class="perma"><a href="https://machinelearningmastery.com/how-to-develop-lstm-models-for-multi-step-time-series-forecasting-of-household-power-consumption/#comment-453817" title="Direct link to this comment">#</a></span>
	                <span class="edit"></span>

				</div><!-- /.comment-head -->

		   		<div class="comment-entry">

				<p>Hello Jason Brownlee,</p>
<p>You are one of my best research references, great job!</p>
<p>This article has helped me to understand something about the context,
 however, I have a question on how I can simulate or predict future 
values using machine learning or deep learning, but with algorithms and 
graphs showing clearly, for example, for a set of historical daily 
temperature data, how could I simulate a possible value for month 6 But 
10 years ahead?</p>
<p>Do you have another article or link of any reference?</p>
<p>Thank you very much.</p>
<p>Rafael</p>

				
	                <div class="reply">
	                    <a rel="nofollow" class="comment-reply-link" href="#comment-453817" onclick='return addComment.moveForm( "comment-453817", "453817", "respond", "6286" )' aria-label="Reply to Jose Rafael">Reply</a>	                </div><!-- /.reply -->

				</div><!-- /comment-entry -->

			</div><!-- /.comment-container -->

	<ul class="children">

		<li id="comment-453835" class="comment byuser comment-author-jasonb bypostauthor even depth-2">

	      	<div id="li-comment-453835" class="comment-container">

					                <div class="avatar"><img alt="" src="How%20to%20Develop%20LSTM%20Models%20for%20Multi-Step%20Time%20Series%20Forecasting%20of%20Household%20Power%20Consumption_fichiers/1d75d46040c28497f0dee5d8e100db37_002.jpg" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" class="avatar avatar-40 photo" width="40" height="40"></div>
	            
		      	<div class="comment-head">

	                <span class="name"><a href="http://machinelearningmastery.com/" rel="external nofollow" class="url">Jason Brownlee</a></span>
	                <span class="date">November 6, 2018 at 2:18 pm</span>
	                <span class="perma"><a href="https://machinelearningmastery.com/how-to-develop-lstm-models-for-multi-step-time-series-forecasting-of-household-power-consumption/#comment-453835" title="Direct link to this comment">#</a></span>
	                <span class="edit"></span>

				</div><!-- /.comment-head -->

		   		<div class="comment-entry">

				<p>Thanks Rafael.</p>
<p>The further into the future you forecast, the more error you can expect.</p>
<p>You could train a model to focus on predicting 10 years out.<br>
Or you can use a short term model and run it out 10 years using outputs as inputs (e.g. recursive).</p>
<p>Perhaps this post will give you some ideas:<br>
<a href="https://machinelearningmastery.com/multi-step-time-series-forecasting/" rel="nofollow">https://machinelearningmastery.com/multi-step-time-series-forecasting/</a></p>

				
	                <div class="reply">
	                    <a rel="nofollow" class="comment-reply-link" href="#comment-453835" onclick='return addComment.moveForm( "comment-453835", "453835", "respond", "6286" )' aria-label="Reply to Jason Brownlee">Reply</a>	                </div><!-- /.reply -->

				</div><!-- /comment-entry -->

			</div><!-- /.comment-container -->

	</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->

		<li id="comment-453979" class="comment odd alt thread-odd thread-alt depth-1 parent">

	      	<div id="li-comment-453979" class="comment-container">

					                <div class="avatar"><img alt="" src="How%20to%20Develop%20LSTM%20Models%20for%20Multi-Step%20Time%20Series%20Forecasting%20of%20Household%20Power%20Consumption_fichiers/4d8979042c31b916db08a41347fe3a56.jpg" srcset="https://secure.gravatar.com/avatar/4d8979042c31b916db08a41347fe3a56?s=80&amp;d=mm&amp;r=g 2x" class="avatar avatar-40 photo" width="40" height="40"></div>
	            
		      	<div class="comment-head">

	                <span class="name">Ameni</span>
	                <span class="date">November 7, 2018 at 6:37 pm</span>
	                <span class="perma"><a href="https://machinelearningmastery.com/how-to-develop-lstm-models-for-multi-step-time-series-forecasting-of-household-power-consumption/#comment-453979" title="Direct link to this comment">#</a></span>
	                <span class="edit"></span>

				</div><!-- /.comment-head -->

		   		<div class="comment-entry">

				<p>Hi, thanks for your very nice tutorial.<br>
My question is about evaluating the overall RMSE during the training phase.<br>
Is it correct to use this code:</p>
<p>from keras import backend as K</p>
<p>def root_mean_squared_error(y_true, y_pred):<br>
        return K.sqrt(K.mean(K.square(y_pred – y_true)))</p>
<p>and the use 	model.compile(optimizer = ‘adam’, loss = root_mean_squared_error ,metrics=[root_mean_squared_error])</p>
<p> instead of </p>
<p>model.compile(optimizer = ‘adam’, loss = ‘mse’)</p>

				
	                <div class="reply">
	                    <a rel="nofollow" class="comment-reply-link" href="#comment-453979" onclick='return addComment.moveForm( "comment-453979", "453979", "respond", "6286" )' aria-label="Reply to Ameni">Reply</a>	                </div><!-- /.reply -->

				</div><!-- /comment-entry -->

			</div><!-- /.comment-container -->

	<ul class="children">

		<li id="comment-454015" class="comment byuser comment-author-jasonb bypostauthor even depth-2">

	      	<div id="li-comment-454015" class="comment-container">

					                <div class="avatar"><img alt="" src="How%20to%20Develop%20LSTM%20Models%20for%20Multi-Step%20Time%20Series%20Forecasting%20of%20Household%20Power%20Consumption_fichiers/1d75d46040c28497f0dee5d8e100db37_002.jpg" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" class="avatar avatar-40 photo" width="40" height="40"></div>
	            
		      	<div class="comment-head">

	                <span class="name"><a href="http://machinelearningmastery.com/" rel="external nofollow" class="url">Jason Brownlee</a></span>
	                <span class="date">November 8, 2018 at 6:05 am</span>
	                <span class="perma"><a href="https://machinelearningmastery.com/how-to-develop-lstm-models-for-multi-step-time-series-forecasting-of-household-power-consumption/#comment-454015" title="Direct link to this comment">#</a></span>
	                <span class="edit"></span>

				</div><!-- /.comment-head -->

		   		<div class="comment-entry">

				<p>I don’t recommend using RMSE for loss, instead I recommend using MSE for loss and RMSE as a metric.</p>
<p>I give an example here:<br>
<a href="https://machinelearningmastery.com/custom-metrics-deep-learning-keras-python/" rel="nofollow">https://machinelearningmastery.com/custom-metrics-deep-learning-keras-python/</a></p>

				
	                <div class="reply">
	                    <a rel="nofollow" class="comment-reply-link" href="#comment-454015" onclick='return addComment.moveForm( "comment-454015", "454015", "respond", "6286" )' aria-label="Reply to Jason Brownlee">Reply</a>	                </div><!-- /.reply -->

				</div><!-- /comment-entry -->

			</div><!-- /.comment-container -->

	</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->

		<li id="comment-454320" class="comment odd alt thread-even depth-1 parent">

	      	<div id="li-comment-454320" class="comment-container">

					                <div class="avatar"><img alt="" src="How%20to%20Develop%20LSTM%20Models%20for%20Multi-Step%20Time%20Series%20Forecasting%20of%20Household%20Power%20Consumption_fichiers/d7a1050833521b57a290a6fa813699cd.jpg" srcset="https://secure.gravatar.com/avatar/d7a1050833521b57a290a6fa813699cd?s=80&amp;d=mm&amp;r=g 2x" class="avatar avatar-40 photo" width="40" height="40"></div>
	            
		      	<div class="comment-head">

	                <span class="name">Anubhav Srivastava</span>
	                <span class="date">November 10, 2018 at 8:39 pm</span>
	                <span class="perma"><a href="https://machinelearningmastery.com/how-to-develop-lstm-models-for-multi-step-time-series-forecasting-of-household-power-consumption/#comment-454320" title="Direct link to this comment">#</a></span>
	                <span class="edit"></span>

				</div><!-- /.comment-head -->

		   		<div class="comment-entry">

				<p>For the LSTM with multi-step forecasting, curious why you didn’t 
use LSTM layers with return_sequence=True and a Dense(1) output layer? 
Instead you have used two Dense layers, one with 100 outputs and an 
final Dense(7).</p>
<p>Would the return_sequence=True in an LSTM followed by a Dense(1) approach be wrong?</p>

				
	                <div class="reply">
	                    <a rel="nofollow" class="comment-reply-link" href="#comment-454320" onclick='return addComment.moveForm( "comment-454320", "454320", "respond", "6286" )' aria-label="Reply to Anubhav Srivastava">Reply</a>	                </div><!-- /.reply -->

				</div><!-- /comment-entry -->

			</div><!-- /.comment-container -->

	<ul class="children">

		<li id="comment-454368" class="comment byuser comment-author-jasonb bypostauthor even depth-2 parent">

	      	<div id="li-comment-454368" class="comment-container">

					                <div class="avatar"><img alt="" src="How%20to%20Develop%20LSTM%20Models%20for%20Multi-Step%20Time%20Series%20Forecasting%20of%20Household%20Power%20Consumption_fichiers/1d75d46040c28497f0dee5d8e100db37_002.jpg" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" class="avatar avatar-40 photo" width="40" height="40"></div>
	            
		      	<div class="comment-head">

	                <span class="name"><a href="http://machinelearningmastery.com/" rel="external nofollow" class="url">Jason Brownlee</a></span>
	                <span class="date">November 11, 2018 at 6:02 am</span>
	                <span class="perma"><a href="https://machinelearningmastery.com/how-to-develop-lstm-models-for-multi-step-time-series-forecasting-of-household-power-consumption/#comment-454368" title="Direct link to this comment">#</a></span>
	                <span class="edit"></span>

				</div><!-- /.comment-head -->

		   		<div class="comment-entry">

				<p>Note, we do use this approach in the encoder-decoder, which requires the use of a TimeDistributed wrapper layer.</p>

				
	                <div class="reply">
	                    <a rel="nofollow" class="comment-reply-link" href="#comment-454368" onclick='return addComment.moveForm( "comment-454368", "454368", "respond", "6286" )' aria-label="Reply to Jason Brownlee">Reply</a>	                </div><!-- /.reply -->

				</div><!-- /comment-entry -->

			</div><!-- /.comment-container -->

	<ul class="children">

		<li id="comment-454409" class="comment odd alt depth-3 parent">

	      	<div id="li-comment-454409" class="comment-container">

					                <div class="avatar"><img alt="" src="How%20to%20Develop%20LSTM%20Models%20for%20Multi-Step%20Time%20Series%20Forecasting%20of%20Household%20Power%20Consumption_fichiers/d7a1050833521b57a290a6fa813699cd.jpg" srcset="https://secure.gravatar.com/avatar/d7a1050833521b57a290a6fa813699cd?s=80&amp;d=mm&amp;r=g 2x" class="avatar avatar-40 photo" width="40" height="40"></div>
	            
		      	<div class="comment-head">

	                <span class="name">Anubhav Srivastava</span>
	                <span class="date">November 11, 2018 at 3:29 pm</span>
	                <span class="perma"><a href="https://machinelearningmastery.com/how-to-develop-lstm-models-for-multi-step-time-series-forecasting-of-household-power-consumption/#comment-454409" title="Direct link to this comment">#</a></span>
	                <span class="edit"></span>

				</div><!-- /.comment-head -->

		   		<div class="comment-entry">

				<p>Got it. So I take that to be a valid approach too?</p>

				
	                <div class="reply">
	                    <a rel="nofollow" class="comment-reply-link" href="#comment-454409" onclick='return addComment.moveForm( "comment-454409", "454409", "respond", "6286" )' aria-label="Reply to Anubhav Srivastava">Reply</a>	                </div><!-- /.reply -->

				</div><!-- /comment-entry -->

			</div><!-- /.comment-container -->

	<ul class="children">

		<li id="comment-454471" class="comment byuser comment-author-jasonb bypostauthor even depth-4">

	      	<div id="li-comment-454471" class="comment-container">

					                <div class="avatar"><img alt="" src="How%20to%20Develop%20LSTM%20Models%20for%20Multi-Step%20Time%20Series%20Forecasting%20of%20Household%20Power%20Consumption_fichiers/1d75d46040c28497f0dee5d8e100db37_002.jpg" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" class="avatar avatar-40 photo" width="40" height="40"></div>
	            
		      	<div class="comment-head">

	                <span class="name"><a href="http://machinelearningmastery.com/" rel="external nofollow" class="url">Jason Brownlee</a></span>
	                <span class="date">November 12, 2018 at 5:36 am</span>
	                <span class="perma"><a href="https://machinelearningmastery.com/how-to-develop-lstm-models-for-multi-step-time-series-forecasting-of-household-power-consumption/#comment-454471" title="Direct link to this comment">#</a></span>
	                <span class="edit"></span>

				</div><!-- /.comment-head -->

		   		<div class="comment-entry">

				<p>Valid? I don’t follow, sorry.</p>
<p>Try a suite of models and the one that gives the best performance is the one to use. Whether a model works or not is not enough.</p>

				
	                <div class="reply">
	                    <a rel="nofollow" class="comment-reply-link" href="#comment-454471" onclick='return addComment.moveForm( "comment-454471", "454471", "respond", "6286" )' aria-label="Reply to Jason Brownlee">Reply</a>	                </div><!-- /.reply -->

				</div><!-- /comment-entry -->

			</div><!-- /.comment-container -->

	</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->

		<li id="comment-454912" class="comment odd alt thread-odd thread-alt depth-1 parent">

	      	<div id="li-comment-454912" class="comment-container">

					                <div class="avatar"><img alt="" src="How%20to%20Develop%20LSTM%20Models%20for%20Multi-Step%20Time%20Series%20Forecasting%20of%20Household%20Power%20Consumption_fichiers/08d830b38c321dfd20d7858fc3a37575.jpg" srcset="https://secure.gravatar.com/avatar/08d830b38c321dfd20d7858fc3a37575?s=80&amp;d=mm&amp;r=g 2x" class="avatar avatar-40 photo" width="40" height="40"></div>
	            
		      	<div class="comment-head">

	                <span class="name">Simone Faragalli</span>
	                <span class="date">November 16, 2018 at 2:44 am</span>
	                <span class="perma"><a href="https://machinelearningmastery.com/how-to-develop-lstm-models-for-multi-step-time-series-forecasting-of-household-power-consumption/#comment-454912" title="Direct link to this comment">#</a></span>
	                <span class="edit"></span>

				</div><!-- /.comment-head -->

		   		<div class="comment-entry">

				<p>Hi, Great Article.</p>
<p></p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->

		<div id="crayon-5c08128aeb21b351509733" class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" style="margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important; height: auto;">
		
			<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important; height: 18px !important; line-height: 18px !important; margin-top: -19px; display: none; position: absolute; z-index: 2;"><span class="crayon-title"></span>
			<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button crayon-pressed" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code" style="display: none;"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
			<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
			<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly="readonly" style="-moz-tab-size: 4; font-size: 12px !important; line-height: 15px !important; z-index: 0; opacity: 0; overflow: hidden;" wrap="soft">On the following code:
def evaluate_model(train, test, n_steps, n_length, n_input):
	# fit model
	model = build_model(train, n_steps, n_length, n_input)
	# history is a list of weekly data
	history = [x for x in train]</textarea></div>
			<div class="crayon-main" style="position: relative; z-index: 1; overflow: hidden;">
				<table class="crayon-table" style="">
					<tbody><tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5c08128aeb21b351509733-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c08128aeb21b351509733-2">2</div><div class="crayon-num" data-line="crayon-5c08128aeb21b351509733-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c08128aeb21b351509733-4">4</div><div class="crayon-num" data-line="crayon-5c08128aeb21b351509733-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5c08128aeb21b351509733-6">6</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5c08128aeb21b351509733-1"><span class="crayon-e">On </span><span class="crayon-e">the </span><span class="crayon-e">following </span><span class="crayon-v">code</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c08128aeb21b351509733-2"><span class="crayon-e">def </span><span class="crayon-e">evaluate_model</span><span class="crayon-sy">(</span><span class="crayon-v">train</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">test</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_steps</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_length</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_input</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5c08128aeb21b351509733-3"><span class="crayon-h">	</span><span class="crayon-p"># fit model</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c08128aeb21b351509733-4"><span class="crayon-h">	</span><span class="crayon-v">model</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">build_model</span><span class="crayon-sy">(</span><span class="crayon-v">train</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_steps</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_length</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n_input</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5c08128aeb21b351509733-5"><span class="crayon-h">	</span><span class="crayon-p"># history is a list of weekly data</span></div><div class="crayon-line crayon-striped-line" id="crayon-5c08128aeb21b351509733-6"><span class="crayon-h">	</span><span class="crayon-v">history</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-i">x</span><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">x</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-v">train</span><span class="crayon-sy">]</span></div></div></td>
					</tr>
				</tbody></table>
			</div>
		</div>
<!-- [Format Time: 0.0008 seconds] -->
<p></p>
<p>Should it not be “test” instead of “train” series?</p>
<p>Many thanks</p>

				
	                <div class="reply">
	                    <a rel="nofollow" class="comment-reply-link" href="#comment-454912" onclick='return addComment.moveForm( "comment-454912", "454912", "respond", "6286" )' aria-label="Reply to Simone Faragalli">Reply</a>	                </div><!-- /.reply -->

				</div><!-- /comment-entry -->

			</div><!-- /.comment-container -->

	<ul class="children">

		<li id="comment-454933" class="comment byuser comment-author-jasonb bypostauthor even depth-2">

	      	<div id="li-comment-454933" class="comment-container">

					                <div class="avatar"><img alt="" src="How%20to%20Develop%20LSTM%20Models%20for%20Multi-Step%20Time%20Series%20Forecasting%20of%20Household%20Power%20Consumption_fichiers/1d75d46040c28497f0dee5d8e100db37_002.jpg" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" class="avatar avatar-40 photo" width="40" height="40"></div>
	            
		      	<div class="comment-head">

	                <span class="name"><a href="http://machinelearningmastery.com/" rel="external nofollow" class="url">Jason Brownlee</a></span>
	                <span class="date">November 16, 2018 at 6:17 am</span>
	                <span class="perma"><a href="https://machinelearningmastery.com/how-to-develop-lstm-models-for-multi-step-time-series-forecasting-of-household-power-consumption/#comment-454933" title="Direct link to this comment">#</a></span>
	                <span class="edit"></span>

				</div><!-- /.comment-head -->

		   		<div class="comment-entry">

				<p>No, here we are adding seeding the history with the training set.</p>

				
	                <div class="reply">
	                    <a rel="nofollow" class="comment-reply-link" href="#comment-454933" onclick='return addComment.moveForm( "comment-454933", "454933", "respond", "6286" )' aria-label="Reply to Jason Brownlee">Reply</a>	                </div><!-- /.reply -->

				</div><!-- /comment-entry -->

			</div><!-- /.comment-container -->

	</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->

		<li id="comment-455057" class="comment odd alt thread-even depth-1 parent">

	      	<div id="li-comment-455057" class="comment-container">

					                <div class="avatar"><img alt="" src="How%20to%20Develop%20LSTM%20Models%20for%20Multi-Step%20Time%20Series%20Forecasting%20of%20Household%20Power%20Consumption_fichiers/7de504fa39e8724c3da6a386c7c2d35b.jpg" srcset="https://secure.gravatar.com/avatar/7de504fa39e8724c3da6a386c7c2d35b?s=80&amp;d=mm&amp;r=g 2x" class="avatar avatar-40 photo" width="40" height="40"></div>
	            
		      	<div class="comment-head">

	                <span class="name">Daniel</span>
	                <span class="date">November 17, 2018 at 4:20 am</span>
	                <span class="perma"><a href="https://machinelearningmastery.com/how-to-develop-lstm-models-for-multi-step-time-series-forecasting-of-household-power-consumption/#comment-455057" title="Direct link to this comment">#</a></span>
	                <span class="edit"></span>

				</div><!-- /.comment-head -->

		   		<div class="comment-entry">

				<p>Hi Jason! Any insights or rule of thumb to set input_size and batch size? Should these two be related?</p>
<p>Thanks a lot!</p>

				
	                <div class="reply">
	                    <a rel="nofollow" class="comment-reply-link" href="#comment-455057" onclick='return addComment.moveForm( "comment-455057", "455057", "respond", "6286" )' aria-label="Reply to Daniel">Reply</a>	                </div><!-- /.reply -->

				</div><!-- /comment-entry -->

			</div><!-- /.comment-container -->

	<ul class="children">

		<li id="comment-455081" class="comment byuser comment-author-jasonb bypostauthor even depth-2">

	      	<div id="li-comment-455081" class="comment-container">

					                <div class="avatar"><img alt="" src="How%20to%20Develop%20LSTM%20Models%20for%20Multi-Step%20Time%20Series%20Forecasting%20of%20Household%20Power%20Consumption_fichiers/1d75d46040c28497f0dee5d8e100db37_002.jpg" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" class="avatar avatar-40 photo" width="40" height="40"></div>
	            
		      	<div class="comment-head">

	                <span class="name"><a href="http://machinelearningmastery.com/" rel="external nofollow" class="url">Jason Brownlee</a></span>
	                <span class="date">November 17, 2018 at 5:52 am</span>
	                <span class="perma"><a href="https://machinelearningmastery.com/how-to-develop-lstm-models-for-multi-step-time-series-forecasting-of-household-power-consumption/#comment-455081" title="Direct link to this comment">#</a></span>
	                <span class="edit"></span>

				</div><!-- /.comment-head -->

		   		<div class="comment-entry">

				<p>Unrelated.</p>
<p>Input size for lstms is the shape of each sample, e.g. timesteps and variables.</p>
<p>Batch size is the number of samples to process before estimating the error gradient and updating weights via backprop.</p>

				
	                <div class="reply">
	                    <a rel="nofollow" class="comment-reply-link" href="#comment-455081" onclick='return addComment.moveForm( "comment-455081", "455081", "respond", "6286" )' aria-label="Reply to Jason Brownlee">Reply</a>	                </div><!-- /.reply -->

				</div><!-- /comment-entry -->

			</div><!-- /.comment-container -->

	</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->

		<li id="comment-455145" class="comment odd alt thread-odd thread-alt depth-1 parent">

	      	<div id="li-comment-455145" class="comment-container">

					                <div class="avatar"><img alt="" src="How%20to%20Develop%20LSTM%20Models%20for%20Multi-Step%20Time%20Series%20Forecasting%20of%20Household%20Power%20Consumption_fichiers/7de504fa39e8724c3da6a386c7c2d35b.jpg" srcset="https://secure.gravatar.com/avatar/7de504fa39e8724c3da6a386c7c2d35b?s=80&amp;d=mm&amp;r=g 2x" class="avatar avatar-40 photo" width="40" height="40"></div>
	            
		      	<div class="comment-head">

	                <span class="name">Daniel</span>
	                <span class="date">November 17, 2018 at 9:44 pm</span>
	                <span class="perma"><a href="https://machinelearningmastery.com/how-to-develop-lstm-models-for-multi-step-time-series-forecasting-of-household-power-consumption/#comment-455145" title="Direct link to this comment">#</a></span>
	                <span class="edit"></span>

				</div><!-- /.comment-head -->

		   		<div class="comment-entry">

				<p>Thanks for your reply! So, if I am trying to forecast a full week
 with hourly granularity, and I have let’s say, a full year of hourly 
observations, would a large batch size better capture the variation in 
the dependencies accross variables in the past? Or would it depend only 
on the input size?</p>
<p>I would like the network to remember not only the recent behaviour, but also the past! <img draggable="false" class="emoji" alt="🙂" src="How%20to%20Develop%20LSTM%20Models%20for%20Multi-Step%20Time%20Series%20Forecasting%20of%20Household%20Power%20Consumption_fichiers/1f642.svg"></p>
<p>Thanks a lot!</p>

				
	                <div class="reply">
	                    <a rel="nofollow" class="comment-reply-link" href="#comment-455145" onclick='return addComment.moveForm( "comment-455145", "455145", "respond", "6286" )' aria-label="Reply to Daniel">Reply</a>	                </div><!-- /.reply -->

				</div><!-- /comment-entry -->

			</div><!-- /.comment-container -->

	<ul class="children">

		<li id="comment-455231" class="comment byuser comment-author-jasonb bypostauthor even depth-2 parent">

	      	<div id="li-comment-455231" class="comment-container">

					                <div class="avatar"><img alt="" src="How%20to%20Develop%20LSTM%20Models%20for%20Multi-Step%20Time%20Series%20Forecasting%20of%20Household%20Power%20Consumption_fichiers/1d75d46040c28497f0dee5d8e100db37_002.jpg" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" class="avatar avatar-40 photo" width="40" height="40"></div>
	            
		      	<div class="comment-head">

	                <span class="name"><a href="http://machinelearningmastery.com/" rel="external nofollow" class="url">Jason Brownlee</a></span>
	                <span class="date">November 18, 2018 at 6:40 am</span>
	                <span class="perma"><a href="https://machinelearningmastery.com/how-to-develop-lstm-models-for-multi-step-time-series-forecasting-of-household-power-consumption/#comment-455231" title="Direct link to this comment">#</a></span>
	                <span class="edit"></span>

				</div><!-- /.comment-head -->

		   		<div class="comment-entry">

				<p>Try it and see.</p>

				
	                <div class="reply">
	                    <a rel="nofollow" class="comment-reply-link" href="#comment-455231" onclick='return addComment.moveForm( "comment-455231", "455231", "respond", "6286" )' aria-label="Reply to Jason Brownlee">Reply</a>	                </div><!-- /.reply -->

				</div><!-- /comment-entry -->

			</div><!-- /.comment-container -->

	<ul class="children">

		<li id="comment-455417" class="comment odd alt depth-3 parent">

	      	<div id="li-comment-455417" class="comment-container">

					                <div class="avatar"><img alt="" src="How%20to%20Develop%20LSTM%20Models%20for%20Multi-Step%20Time%20Series%20Forecasting%20of%20Household%20Power%20Consumption_fichiers/7de504fa39e8724c3da6a386c7c2d35b.jpg" srcset="https://secure.gravatar.com/avatar/7de504fa39e8724c3da6a386c7c2d35b?s=80&amp;d=mm&amp;r=g 2x" class="avatar avatar-40 photo" width="40" height="40"></div>
	            
		      	<div class="comment-head">

	                <span class="name">Daniel</span>
	                <span class="date">November 19, 2018 at 5:20 am</span>
	                <span class="perma"><a href="https://machinelearningmastery.com/how-to-develop-lstm-models-for-multi-step-time-series-forecasting-of-household-power-consumption/#comment-455417" title="Direct link to this comment">#</a></span>
	                <span class="edit"></span>

				</div><!-- /.comment-head -->

		   		<div class="comment-entry">

				<p>Hi again, I’d recomend anyone trying so to check out this paper, 
they give optimal hyperparameters for exactly the focus of this post 
using LSTM seq2seq <img draggable="false" class="emoji" alt="🙂" src="How%20to%20Develop%20LSTM%20Models%20for%20Multi-Step%20Time%20Series%20Forecasting%20of%20Household%20Power%20Consumption_fichiers/1f642.svg"></p>
<p><a href="https://arxiv.org/pdf/1705.04378.pdf" rel="nofollow">https://arxiv.org/pdf/1705.04378.pdf</a></p>

				
	                <div class="reply">
	                    <a rel="nofollow" class="comment-reply-link" href="#comment-455417" onclick='return addComment.moveForm( "comment-455417", "455417", "respond", "6286" )' aria-label="Reply to Daniel">Reply</a>	                </div><!-- /.reply -->

				</div><!-- /comment-entry -->

			</div><!-- /.comment-container -->

	<ul class="children">

		<li id="comment-455444" class="comment byuser comment-author-jasonb bypostauthor even depth-4">

	      	<div id="li-comment-455444" class="comment-container">

					                <div class="avatar"><img alt="" src="How%20to%20Develop%20LSTM%20Models%20for%20Multi-Step%20Time%20Series%20Forecasting%20of%20Household%20Power%20Consumption_fichiers/1d75d46040c28497f0dee5d8e100db37_002.jpg" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" class="avatar avatar-40 photo" width="40" height="40"></div>
	            
		      	<div class="comment-head">

	                <span class="name"><a href="http://machinelearningmastery.com/" rel="external nofollow" class="url">Jason Brownlee</a></span>
	                <span class="date">November 19, 2018 at 6:50 am</span>
	                <span class="perma"><a href="https://machinelearningmastery.com/how-to-develop-lstm-models-for-multi-step-time-series-forecasting-of-household-power-consumption/#comment-455444" title="Direct link to this comment">#</a></span>
	                <span class="edit"></span>

				</div><!-- /.comment-head -->

		   		<div class="comment-entry">

				<p>Thanks for sharing.</p>

				
	                <div class="reply">
	                    <a rel="nofollow" class="comment-reply-link" href="#comment-455444" onclick='return addComment.moveForm( "comment-455444", "455444", "respond", "6286" )' aria-label="Reply to Jason Brownlee">Reply</a>	                </div><!-- /.reply -->

				</div><!-- /comment-entry -->

			</div><!-- /.comment-container -->

	</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->

		<li id="comment-455522" class="comment odd alt depth-3 parent">

	      	<div id="li-comment-455522" class="comment-container">

					                <div class="avatar"><img alt="" src="How%20to%20Develop%20LSTM%20Models%20for%20Multi-Step%20Time%20Series%20Forecasting%20of%20Household%20Power%20Consumption_fichiers/7de504fa39e8724c3da6a386c7c2d35b.jpg" srcset="https://secure.gravatar.com/avatar/7de504fa39e8724c3da6a386c7c2d35b?s=80&amp;d=mm&amp;r=g 2x" class="avatar avatar-40 photo" width="40" height="40"></div>
	            
		      	<div class="comment-head">

	                <span class="name">Daniel</span>
	                <span class="date">November 19, 2018 at 11:26 pm</span>
	                <span class="perma"><a href="https://machinelearningmastery.com/how-to-develop-lstm-models-for-multi-step-time-series-forecasting-of-household-power-consumption/#comment-455522" title="Direct link to this comment">#</a></span>
	                <span class="edit"></span>

				</div><!-- /.comment-head -->

		   		<div class="comment-entry">

				<p>Another thing worth mentioning when predicting several timesteps 
using LSTM seq2seq, for me it made a huge impact on the model learning 
to add L2 regularization rather than dropout, for those who see their 
model is overfitting! I got the idea from that paper!</p>

				
	                <div class="reply">
	                    <a rel="nofollow" class="comment-reply-link" href="#comment-455522" onclick='return addComment.moveForm( "comment-455522", "455522", "respond", "6286" )' aria-label="Reply to Daniel">Reply</a>	                </div><!-- /.reply -->

				</div><!-- /comment-entry -->

			</div><!-- /.comment-container -->

	<ul class="children">

		<li id="comment-455564" class="comment byuser comment-author-jasonb bypostauthor even depth-4">

	      	<div id="li-comment-455564" class="comment-container">

					                <div class="avatar"><img alt="" src="How%20to%20Develop%20LSTM%20Models%20for%20Multi-Step%20Time%20Series%20Forecasting%20of%20Household%20Power%20Consumption_fichiers/1d75d46040c28497f0dee5d8e100db37_002.jpg" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" class="avatar avatar-40 photo" width="40" height="40"></div>
	            
		      	<div class="comment-head">

	                <span class="name"><a href="http://machinelearningmastery.com/" rel="external nofollow" class="url">Jason Brownlee</a></span>
	                <span class="date">November 20, 2018 at 6:35 am</span>
	                <span class="perma"><a href="https://machinelearningmastery.com/how-to-develop-lstm-models-for-multi-step-time-series-forecasting-of-household-power-consumption/#comment-455564" title="Direct link to this comment">#</a></span>
	                <span class="edit"></span>

				</div><!-- /.comment-head -->

		   		<div class="comment-entry">

				<p>Great tip. Yes, weight regularization is often overlooked and performs very well:<br>
<a href="https://machinelearningmastery.com/weight-regularization-to-reduce-overfitting-of-deep-learning-models/" rel="nofollow">https://machinelearningmastery.com/weight-regularization-to-reduce-overfitting-of-deep-learning-models/</a></p>

				
	                <div class="reply">
	                    <a rel="nofollow" class="comment-reply-link" href="#comment-455564" onclick='return addComment.moveForm( "comment-455564", "455564", "respond", "6286" )' aria-label="Reply to Jason Brownlee">Reply</a>	                </div><!-- /.reply -->

				</div><!-- /comment-entry -->

			</div><!-- /.comment-container -->

	</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->

		<li id="comment-456748" class="comment odd alt thread-even depth-1 parent">

	      	<div id="li-comment-456748" class="comment-container">

					                <div class="avatar"><img alt="" src="How%20to%20Develop%20LSTM%20Models%20for%20Multi-Step%20Time%20Series%20Forecasting%20of%20Household%20Power%20Consumption_fichiers/a0e59ae595cf05b6cbb8c8831b676a22.jpg" srcset="https://secure.gravatar.com/avatar/a0e59ae595cf05b6cbb8c8831b676a22?s=80&amp;d=mm&amp;r=g 2x" class="avatar avatar-40 photo" width="40" height="40"></div>
	            
		      	<div class="comment-head">

	                <span class="name">Pierre</span>
	                <span class="date">December 1, 2018 at 2:28 am</span>
	                <span class="perma"><a href="https://machinelearningmastery.com/how-to-develop-lstm-models-for-multi-step-time-series-forecasting-of-household-power-consumption/#comment-456748" title="Direct link to this comment">#</a></span>
	                <span class="edit"></span>

				</div><!-- /.comment-head -->

		   		<div class="comment-entry">

				<p>I really like your Tutorial.</p>
<p>I am trying to improve the model by using forecast weather to improve the load forecast.<br>
I have a dataset with many weather variables. I Want to build a model 
that use past_load, past_weather and future_weather to forecast future 
load.<br>
I would like to know what is the best way to prepare the dataset to optimally use LSTM.<br>
My problem is how to arrange the data in timesteps and features for each
 sample when there are some features that are not avalaible at all 
timesteps.</p>
<p>I have tested many approaches: </p>
<p>1) I have tried training my models with 1 timestep per sample and 
inputing all past weather and load and future weather as distinct 
features.<br>
2) I also tried with many timesteps and one feature per time step but 
inputting a dummy value in the future load to make such that the model 
put zero weights in the future loads that will not be available when the
 model will be used in prediction mode.</p>
<p>I am sure that this is a common prediction problem and I am sure that there is a better way to proceed.</p>

				
	                <div class="reply">
	                    <a rel="nofollow" class="comment-reply-link" href="#comment-456748" onclick='return addComment.moveForm( "comment-456748", "456748", "respond", "6286" )' aria-label="Reply to Pierre">Reply</a>	                </div><!-- /.reply -->

				</div><!-- /comment-entry -->

			</div><!-- /.comment-container -->

	<ul class="children">

		<li id="comment-456765" class="comment byuser comment-author-jasonb bypostauthor even depth-2">

	      	<div id="li-comment-456765" class="comment-container">

					                <div class="avatar"><img alt="" src="How%20to%20Develop%20LSTM%20Models%20for%20Multi-Step%20Time%20Series%20Forecasting%20of%20Household%20Power%20Consumption_fichiers/1d75d46040c28497f0dee5d8e100db37_002.jpg" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=80&amp;d=mm&amp;r=g 2x" class="avatar avatar-40 photo" width="40" height="40"></div>
	            
		      	<div class="comment-head">

	                <span class="name"><a href="http://machinelearningmastery.com/" rel="external nofollow" class="url">Jason Brownlee</a></span>
	                <span class="date">December 1, 2018 at 6:52 am</span>
	                <span class="perma"><a href="https://machinelearningmastery.com/how-to-develop-lstm-models-for-multi-step-time-series-forecasting-of-household-power-consumption/#comment-456765" title="Direct link to this comment">#</a></span>
	                <span class="edit"></span>

				</div><!-- /.comment-head -->

		   		<div class="comment-entry">

				<p>For missing data, you could try using a masking layer and mark the missing values to be ignored.</p>
<p>There is no best way in applied machine learning, I recommend testing
 a suite of framings of the problem in order to discover what works best
 for your specific dataset.</p>

				
	                <div class="reply">
	                    <a rel="nofollow" class="comment-reply-link" href="#comment-456765" onclick='return addComment.moveForm( "comment-456765", "456765", "respond", "6286" )' aria-label="Reply to Jason Brownlee">Reply</a>	                </div><!-- /.reply -->

				</div><!-- /comment-entry -->

			</div><!-- /.comment-container -->

	</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
			</ol>
		 	</div>	<div id="respond" class="comment-respond">
		<h3 id="reply-title" class="comment-reply-title">Leave a Reply <small><a rel="nofollow" id="cancel-comment-reply-link" href="https://machinelearningmastery.com/how-to-develop-lstm-models-for-multi-step-time-series-forecasting-of-household-power-consumption/#respond" style="display:none;">Click here to cancel reply.</a></small></h3>			<form action="https://machinelearningmastery.com/wp-comments-post.php?wpe-comment-post=mlmastery" method="post" id="commentform" class="comment-form">
				<p class="comment-form-comment"><label class="hide" for="comment">Comment</label> <textarea tabindex="4" id="comment" name="comment" cols="50" rows="10" maxlength="65525" required="required"></textarea></p><p class="comment-form-author"><input id="author" name="author" type="text" class="txt" tabindex="1" size="30" aria-required="true"><label for="author">Name <span class="required">(required)</span></label> </p>
<p class="comment-form-email"><input id="email" name="email" type="text" class="txt" tabindex="2" size="30" aria-required="true"><label for="email">Email (will not be published) <span class="required">(required)</span></label> </p>
<p class="comment-form-url"><input id="url" name="url" type="text" class="txt" tabindex="3" size="30"><label for="url">Website</label></p>
<p class="form-submit"><input name="submit" type="submit" id="submit" class="submit" value="Submit Comment"> <input type="hidden" name="comment_post_ID" value="6286" id="comment_post_ID">
<input type="hidden" name="comment_parent" id="comment_parent" value="0">
</p><p style="display: none;"><input type="hidden" id="akismet_comment_nonce" name="akismet_comment_nonce" value="c3663dcc31"></p><p style="display: none;"></p>			<input type="hidden" id="ak_js" name="ak_js" value="1544033140101"></form>
			</div><!-- #respond -->
	     
            </section><!-- /#main -->
                
            <aside id="sidebar">
<div id="woo_blogauthorinfo-2" class="widget widget_woo_blogauthorinfo"><h3>Welcome to Machine Learning Mastery!</h3><span class="left"><img alt="" src="How%20to%20Develop%20LSTM%20Models%20for%20Multi-Step%20Time%20Series%20Forecasting%20of%20Household%20Power%20Consumption_fichiers/1d75d46040c28497f0dee5d8e100db37.jpg" srcset="https://secure.gravatar.com/avatar/1d75d46040c28497f0dee5d8e100db37?s=200&amp;d=mm&amp;r=g 2x" class="avatar avatar-100 photo" width="100" height="100"></span>
<p>Hi, I'm Jason Brownlee, PhD
<br>
I write tutorials to help developers (<i>like you</i>) get results with machine learning.</p>
<p><a href="https://machinelearningmastery.com/about">Read More</a></p>
<div class="fix"></div>
</div><div id="text-51" class="widget widget_text">			<div class="textwidget"><p></p><center><br>
<strong>Deep Learning for Time Series</strong><br>
Forecast the future with MLPs, CNNs, and LSTMs.<p></p>
<p><a href="https://machinelearningmastery.com/deep-learning-for-time-series-forecasting/">Click to Get Started Now!</a><br>
<a href="https://machinelearningmastery.com/deep-learning-for-time-series-forecasting/"><img src="How%20to%20Develop%20LSTM%20Models%20for%20Multi-Step%20Time%20Series%20Forecasting%20of%20Household%20Power%20Consumption_fichiers/Cover-220.png"></a><br>
</p></center><p></p>
</div>
		</div>
		<div id="woo_tabs-2" class="widget widget_woo_tabs"> 		<div id="tabs">

            <ul class="wooTabs">
                                <li class="popular"><a href="#tab-pop" class="selected">Popular</a></li>                                                            </ul>

            <div class="clear"></div>

            <div class="boxes box inside">

	            
                                <ul id="tab-pop" class="list" style="display: block;">
                    	<li>
		<a href="https://machinelearningmastery.com/develop-neural-machine-translation-system-keras/" title="How to Develop a Neural Machine Translation System from Scratch"><img src="How%20to%20Develop%20LSTM%20Models%20for%20Multi-Step%20Time%20Series%20Forecasting%20of%20Household%20Power%20Consumption_fichiers/How-to-Develop-a-Neural-Machine-Translation-System-in-Keras-.jpg" class="thumbnail wp-post-image" alt="How to Develop a Neural Machine Translation System in Keras" title="How to Develop a Neural Machine Translation System from Scratch" width="45" height="45"></a>		<a title="How to Develop a Neural Machine Translation System from Scratch" href="https://machinelearningmastery.com/develop-neural-machine-translation-system-keras/">How to Develop a Neural Machine Translation System from Scratch</a>
		<span class="meta">January 10, 2018</span>
		<div class="fix"></div>
	</li>
		<li>
		<a href="https://machinelearningmastery.com/classification-versus-regression-in-machine-learning/" title="Difference Between Classification and Regression in Machine Learning"><img src="How%20to%20Develop%20LSTM%20Models%20for%20Multi-Step%20Time%20Series%20Forecasting%20of%20Household%20Power%20Consumption_fichiers/Difference-Between-Classification-and-Regression-in-Machine-.jpg" class="thumbnail wp-post-image" alt="Difference Between Classification and Regression in Machine Learning" title="Difference Between Classification and Regression in Machine Learning" width="45" height="45"></a>		<a title="Difference Between Classification and Regression in Machine Learning" href="https://machinelearningmastery.com/classification-versus-regression-in-machine-learning/">Difference Between Classification and Regression in Machine Learning</a>
		<span class="meta">December 11, 2017</span>
		<div class="fix"></div>
	</li>
		<li>
		<a href="https://machinelearningmastery.com/develop-n-gram-multichannel-convolutional-neural-network-sentiment-analysis/" title="How to Develop an N-gram Multichannel Convolutional Neural Network for Sentiment Analysis"><img src="How%20to%20Develop%20LSTM%20Models%20for%20Multi-Step%20Time%20Series%20Forecasting%20of%20Household%20Power%20Consumption_fichiers/Plot-of-the-Multichannel-Convolutional-Neural-Network-For-Te.png" class="thumbnail wp-post-image" alt="Plot of the Multichannel Convolutional Neural Network For Text" title="How to Develop an N-gram Multichannel Convolutional Neural Network for Sentiment Analysis" width="45" height="45"></a>		<a title="How to Develop an N-gram Multichannel Convolutional Neural Network for Sentiment Analysis" href="https://machinelearningmastery.com/develop-n-gram-multichannel-convolutional-neural-network-sentiment-analysis/">How to Develop an N-gram Multichannel Convolutional Neural Network for Sentiment Analysis</a>
		<span class="meta">January 12, 2018</span>
		<div class="fix"></div>
	</li>
		<li>
		<a href="https://machinelearningmastery.com/working-machine-learning-problem/" title="So, You are Working on a Machine Learning Problem..."><img src="How%20to%20Develop%20LSTM%20Models%20for%20Multi-Step%20Time%20Series%20Forecasting%20of%20Household%20Power%20Consumption_fichiers/So-You-are-Working-on-a-Machine-Learning-Problem.jpg" class="thumbnail wp-post-image" alt="So, You are Working on a Machine Learning Problem..." title="So, You are Working on a Machine Learning Problem..." width="45" height="45"></a>		<a title="So, You are Working on a Machine Learning Problem…" href="https://machinelearningmastery.com/working-machine-learning-problem/">So, You are Working on a Machine Learning Problem…</a>
		<span class="meta">April 4, 2018</span>
		<div class="fix"></div>
	</li>
		<li>
		<a href="https://machinelearningmastery.com/encoder-decoder-models-text-summarization-keras/" title="Encoder-Decoder Models for Text Summarization in Keras"><img src="How%20to%20Develop%20LSTM%20Models%20for%20Multi-Step%20Time%20Series%20Forecasting%20of%20Household%20Power%20Consumption_fichiers/Encoder-Decoder-Models-for-Text-Summarization-in-Keras-150x1.jpg" class="thumbnail wp-post-image" alt="Encoder-Decoder Models for Text Summarization in Keras" title="Encoder-Decoder Models for Text Summarization in Keras" width="45" height="45"></a>		<a title="Encoder-Decoder Models for Text Summarization in Keras" href="https://machinelearningmastery.com/encoder-decoder-models-text-summarization-keras/">Encoder-Decoder Models for Text Summarization in Keras</a>
		<span class="meta">December 8, 2017</span>
		<div class="fix"></div>
	</li>
		<li>
		<a href="https://machinelearningmastery.com/how-to-make-classification-and-regression-predictions-for-deep-learning-models-in-keras/" title="How to Make Predictions with Keras"><img src="How%20to%20Develop%20LSTM%20Models%20for%20Multi-Step%20Time%20Series%20Forecasting%20of%20Household%20Power%20Consumption_fichiers/How-to-Make-Classification-and-Regression-Predictions-for-De.jpg" class="thumbnail wp-post-image" alt="How to Make Classification and Regression Predictions for Deep Learning Models in Keras" title="How to Make Predictions with Keras" width="45" height="45"></a>		<a title="How to Make Predictions with Keras" href="https://machinelearningmastery.com/how-to-make-classification-and-regression-predictions-for-deep-learning-models-in-keras/">How to Make Predictions with Keras</a>
		<span class="meta">April 9, 2018</span>
		<div class="fix"></div>
	</li>
		<li style="border-bottom: 0px none;">
		<a href="https://machinelearningmastery.com/time-series-forecasting-methods-in-python-cheat-sheet/" title="11 Classical Time Series Forecasting Methods in Python (Cheat Sheet)"><img src="How%20to%20Develop%20LSTM%20Models%20for%20Multi-Step%20Time%20Series%20Forecasting%20of%20Household%20Power%20Consumption_fichiers/11-Classical-Time-Series-Forecasting-Methods-in-Python-Cheat.jpg" class="thumbnail wp-post-image" alt="11 Classical Time Series Forecasting Methods in Python (Cheat Sheet)" title="11 Classical Time Series Forecasting Methods in Python (Cheat Sheet)" width="45" height="45"></a>		<a title="11 Classical Time Series Forecasting Methods in Python (Cheat Sheet)" href="https://machinelearningmastery.com/time-series-forecasting-methods-in-python-cheat-sheet/">11 Classical Time Series Forecasting Methods in Python (Cheat Sheet)</a>
		<span class="meta">August 6, 2018</span>
		<div class="fix"></div>
	</li>
	                </ul>
                                                                
            </div><!-- /.boxes -->

        </div><!-- /wooTabs -->

        </div>         <div id="custom_html-2" class="widget_text widget widget_custom_html"><h3>You might also like…</h3><div class="textwidget custom-html-widget"><ul>
	<li><a href="https://machinelearningmastery.com/setup-python-environment-machine-learning-deep-learning-anaconda/">How to Install Python for Machine Learning</a></li>
  <li><a href="https://machinelearningmastery.com/machine-learning-in-python-step-by-step/">Your First Machine Learning Project in Python</a></li>
	<li><a href="https://machinelearningmastery.com/tutorial-first-neural-network-python-keras/">Your First Neural Network in Python</a></li>
	<li><a href="https://machinelearningmastery.com/how-to-run-your-first-classifier-in-weka/">Your First Classifier in Weka</a></li>
	<li><a href="https://machinelearningmastery.com/arima-for-time-series-forecasting-with-python/">Your First Time Series Forecasting Project</a></li>
</ul></div></div></aside><!-- /#sidebar -->

		</div><!-- /#main-sidebar-container -->         

		
    </div><!-- /#content -->
	
	<footer id="footer" class="col-full">

		
		<div id="copyright" class="col-left">
			<p>© 2018 Machine Learning Mastery. All Rights Reserved. </p>		</div>

		<div id="credit" class="col-right">
			<p></p><p>
<a href="https://machinelearningmastery.com/privacy/">Privacy</a> | 
<a href="https://machinelearningmastery.com/disclaimer/">Disclaimer</a> | 
<a href="https://machinelearningmastery.com/terms-of-service/">Terms</a> | 
<a href="https://machinelearningmastery.com/contact/">Contact</a>
</p><p></p>		</div>

	</footer>

	
	</div><!-- /#inner-wrapper -->

</div><!-- /#wrapper -->

<div class="fix"></div><!--/.fix-->

<!-- Drip -->
<script type="text/javascript">
  var _dcq = _dcq || [];
  var _dcs = _dcs || {};
  _dcs.account = '9556588';

  (function() {
    var dc = document.createElement('script');
    dc.type = 'text/javascript'; dc.async = true;
    dc.src = '//tag.getdrip.com/9556588.js';
    var s = document.getElementsByTagName('script')[0];
    s.parentNode.insertBefore(dc, s);
  })();
</script>
<!-- end Drip --><!-- Woo Tabs Widget -->
<script type="text/javascript">
jQuery(document).ready(function(){
	// UL = .wooTabs
	// Tab contents = .inside

	var tag_cloud_class = '#tagcloud';

	//Fix for tag clouds - unexpected height before .hide()
	var tag_cloud_height = jQuery( '#tagcloud').height();

	jQuery( '.inside ul li:last-child').css( 'border-bottom','0px' ); // remove last border-bottom from list in tab content
	jQuery( '.wooTabs').each(function(){
		jQuery(this).children( 'li').children( 'a:first').addClass( 'selected' ); // Add .selected class to first tab on load
	});
	jQuery( '.inside > *').hide();
	jQuery( '.inside > *:first-child').show();

	jQuery( '.wooTabs li a').click(function(evt){ // Init Click funtion on Tabs

		var clicked_tab_ref = jQuery(this).attr( 'href' ); // Strore Href value

		jQuery(this).parent().parent().children( 'li').children( 'a').removeClass( 'selected' ); //Remove selected from all tabs
		jQuery(this).addClass( 'selected' );
		jQuery(this).parent().parent().parent().children( '.inside').children( '*').hide();

		jQuery( '.inside ' + clicked_tab_ref).fadeIn(500);

		 evt.preventDefault();

	})
})
</script>
<script type="text/javascript" src="How%20to%20Develop%20LSTM%20Models%20for%20Multi-Step%20Time%20Series%20Forecasting%20of%20Household%20Power%20Consumption_fichiers/comment-reply.js"></script>
<script type="text/javascript">
/* <![CDATA[ */
var wpcf7 = {"apiSettings":{"root":"https:\/\/machinelearningmastery.com\/wp-json\/contact-form-7\/v1","namespace":"contact-form-7\/v1"},"recaptcha":{"messages":{"empty":"Please verify that you are not a robot."}},"cached":"1"};
/* ]]> */
</script>
<script type="text/javascript" src="How%20to%20Develop%20LSTM%20Models%20for%20Multi-Step%20Time%20Series%20Forecasting%20of%20Household%20Power%20Consumption_fichiers/scripts.js"></script>
<script type="text/javascript" src="How%20to%20Develop%20LSTM%20Models%20for%20Multi-Step%20Time%20Series%20Forecasting%20of%20Household%20Power%20Consumption_fichiers/wp-embed.js"></script>
<script async="async" type="text/javascript" src="How%20to%20Develop%20LSTM%20Models%20for%20Multi-Step%20Time%20Series%20Forecasting%20of%20Household%20Power%20Consumption_fichiers/form.js"></script>

<div style="position: absolute; right: 0px; left: 0px; bottom: 0px; top: 0px; z-index: 2147483646; background: black none repeat scroll 0% 0%; width: 100%; opacity: 0.5; display: none; height: 50296px;"></div><iframe src="How%20to%20Develop%20LSTM%20Models%20for%20Multi-Step%20Time%20Series%20Forecasting%20of%20Household%20Power%20Consumption_fichiers/a_002.html" style="position: absolute; left: 0px; top: 0px; width: 100%; display: none; border: medium none; z-index: 2147483647; height: 944px;"></iframe><iframe src="How%20to%20Develop%20LSTM%20Models%20for%20Multi-Step%20Time%20Series%20Forecasting%20of%20Household%20Power%20Consumption_fichiers/a_002.html" style="position: absolute; left: 0px; top: 0px; width: 100%; display: none; border: medium none; z-index: 2147483647; height: 944px;"></iframe><div class="drip-tab-container">
  <div id="drip-2211" class="drip-tab bottom right no-image classic">
    <div id="drip-header-2211" class="drip-header">
      <a href="#" id="drip-toggle-2211" class="drip-toggle">
        <h2 id="drip-teaser-2211">Your Start in Machine Learning</h2>
        <span id="drip-tab-up-2211" class="drip-arrow up">
          <svg width="12px" height="8px" viewBox="1362 659 12 8" version="1.1" xmlns="http://www.w3.org/2000/svg" xlink="http://www.w3.org/1999/xlink">
            <polygon id="right_angle" stroke="none" fill="#FFFFFF" fill-rule="evenodd" transform="translate(1368.000000, 662.703125) rotate(-90.000000) translate(-1368.000000, -662.703125) " points="1364.29688 667.296875 1368.89062 662.703125 1364.29688 658.109375 1365.70312 656.703125 1371.70312 662.703125 1365.70312 668.703125"></polygon>
          </svg>
        </span>
        <span id="drip-tab-down-2211" class="drip-arrow down" style="display: none"></span>
      </a>
    </div>

    <div id="drip-content-2211" class="drip-content drip-clearfix" style="height: auto; bottom: -549px;">
      <div id="drip-form-panel-2211" class="drip-panel" style="display: block;">
        <a id="drip-close-2211" class="drip-close">×</a>
        <h3 id="drip-content-header-2211">Your Start in Machine Learning</h3>
        <div id="drip-scroll-2211" class="drip-scroll">
          <div class="drip-clearfix">
            
            <div class="drip-description">You can master applied Machine Learning&nbsp;<br>
<strong>without the math or fancy degree</strong>.<br>
Find out how in this <em>free</em>&nbsp;and <em>practical</em> email course.</div>
          </div>
          <form id="drip-form-2211">
            <div style="display: none">
              <input type="hidden" name="form_id" value="2211">
            </div>
            <dl class="no-labels">
              
                
                  <dt>Email Address</dt>
                  <dd class="drip-clearfix">
                    
                      <input type="email" name="fields[email]" placeholder="Email Address" class="drip-text-field">
                      <div id="drip-errors-for-email-2211" class="drip-errors"></div>
                    
                  </dd>
                
              
                
                  <dt></dt>
                  <dd class="drip-clearfix">
                    
                      <div class="classic--checkbox hidden" data-container="eu-checkbox">
                        <input type="hidden" name="fields[eu_consent]" id="drip-field-eu_consent-denied" value="denied" disabled="disabled">
                        <input type="checkbox" name="fields[eu_consent]" id="drip-field-eu_consent" value="granted" disabled="disabled">
                        <label for="drip-field-eu_consent">I consent to receive information about services and special offers by email. For more information, see the <a href="https://machinelearningmastery.com/privacy/">Privacy Policy</a>.</label>
                      </div>
                    
                  </dd>
                
              
                
                  <input type="hidden" name="fields[eu_consent_message]" value="I consent to receive information about services and special offers by email. For more information, see the Privacy Policy (https://machinelearningmastery.com/privacy/).">
                
              
            </dl>
            <div class="form-controls">
              <input type="submit" name="submit" value="Start My Email Course" id="drip-submit-2211" class="drip-submit-button">
            </div>
          </form>
        </div>
      </div>

      <div id="drip-success-panel-2211" class="drip-success drip-panel drip-clearfix" style="display: none">
        <a id="drip-hide-2211" class="drip-close">×</a>
        <h3>Thank you for signing up!</h3>
        <p class="drip-description">Please check your email and click the link provided to confirm your subscription.</p>
      </div>

      
    </div>
  </div>
</div></body></html>